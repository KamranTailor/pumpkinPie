/* Spotify JS-SDK - v1.10.0-3c8fc4f */

!function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[a]={exports:{}};t[a][0].call(c.exports,(function(e){return i(t[a][1][e]||e)}),c,c.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createMonotonicNow=void 0,r.createMonotonicNow=function(e,t){try{if("number"==typeof e())return e}catch(e){}var r=t(),n=0;return function(){return n=Math.max(n,t()-r)}}},{}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Backoff=void 0;var n=e("tslib"),i=e("../promise_resolver"),o=e("./counter");var a={backoffInitial:!1,baseTime:200,ceiling:0,curve:"linear",jitter:!0,maxDuration:1/0,maxRetries:1/0,maxTime:1/0,retryPredicate:function(){return!0}},s=function(){function e(e,t){this._resolver=(0,i.createPromiseResolver)(),this._ts=0,this._callCount=0,this._tickInterval=0,this._isRunning=!1,this._isDestroyed=!1;var r=n.__assign(n.__assign({},a),t),s=r.backoffInitial,u=r.maxDuration,l=r.maxRetries,c=r.maxTime,d=r.retryPredicate,_=n.__rest(r,["backoffInitial","maxDuration","maxRetries","maxTime","retryPredicate"]);this._fn=e,this._backoffInitial=s,this._maxDuration=u,this._maxRetries=l,this._maxTime=c,this._retryPredicate=d,this._backoffInitial=s,this._counter=new o.Counter(_),this._backoffInitial&&(this._maxRetries+=1)}return e.init=function(t,r){return void 0===r&&(r={}),new e(t,r).start()},e.prototype._destroy=function(){this._isRunning=!1,this._isDestroyed=!0},e.prototype._failure=function(e){var t=this;if(!this._isDestroyed)if(e&&"retryAfter"in e)this._retryAfter(e);else{var r=this._counter.getTime(this._callCount);this._shouldRetry(r,e)?(this._callCount++,this._tickInterval=setTimeout((function(){return t._tick()}),r)):(this._resolver.reject(e),this._destroy())}},e.prototype._retryAfter=function(e){var t=this;this._callCount++,this._tickInterval=setTimeout((function(){return t._tick()}),e.retryAfter)},e.prototype._success=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this._isDestroyed||((e=this._resolver).resolve.apply(e,t),this._destroy())},e.prototype._shouldRetry=function(e,t){var r=Date.now()-this._ts+e;return this._callCount<this._maxRetries&&e<this._maxTime&&r<this._maxDuration&&this._retryPredicate(t)},e.prototype._tick=function(){var e=this;this._fn().then((function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e._success.apply(e,t)})).catch((function(t){return e._failure(t)}))},e.prototype.getResolver=function(){return this._resolver.promise},e.prototype.start=function(){var e=this;return this._isDestroyed?Promise.reject(new Error("Backoff already consumed")):(this._isRunning||(this._ts=Date.now(),this._isRunning=!0,this._backoffInitial?(this._callCount=1,this._tickInterval=setTimeout((function(){return e._tick()}),this._counter.getTime(0))):this._tick()),this._resolver.promise)},e.prototype.stop=function(){clearTimeout(this._tickInterval),this._destroy()},e.prototype.getRetryCount=function(){return this._callCount},e}();r.Backoff=s},{"../promise_resolver":16,"./counter":3,tslib:227}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Counter=void 0;var n=200,i=0,o="linear",a=!0,s=function(){function e(e){void 0===e&&(e={}),this._curve=e.curve||o,this._baseTime=e.baseTime||n,this._ceiling=e.ceiling||i,this._jitter="jitter"in e?!!e.jitter:a}return e.prototype.getTime=function(e){var t;switch(this._curve){case"static":t=1;break;case"logarithmic":t=Math.log(e);break;case"exponential":t=Math.pow(Math.E,e);break;case"linear":default:t=e+1}var r,n,i=Math.min(4294967296,Math.floor(t*this._baseTime));return this._ceiling&&(i=Math.min(i,this._ceiling)),this._jitter?(n=(r=i)/5,Math.floor(r-n/2+Math.random()*n)):i},e}();r.Counter=s},{}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("tslib");n.__exportStar(e("./backoff"),r),n.__exportStar(e("./counter"),r)},{"./backoff":2,"./counter":3,tslib:227}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Debouncer=void 0;var n=e("../promise_resolver"),i=1e3,o=0,a=!1,s=function(){function e(e,t){void 0===t&&(t={}),this._cancelFn=null,this._deferredTimer=0,this._fn=e,this._cancelFn=t.cancel||null,this._threshold=t.threshold||i,this._ts=t.initialTimetamp||o,this._blockInital=t.blockInitial||a}return e.prototype._deferFn=function(e){this._fn.apply(this._fn,e)},e.prototype._deferPromise=function(e,t){this._fn.apply(this._fn,e).then((function(e){t.resolve(e)}))},e.prototype.sync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Date.now()-this._ts;if(this._ts=Date.now(),r<this._threshold)return this._cancelFn&&this._deferredTimer&&this._cancelFn(),clearTimeout(this._deferredTimer),void(this._deferredTimer=setTimeout(this._deferFn.bind(this,e),this._threshold));!0!==this._blockInital?this._fn.apply(this._fn,e):this.sync.apply(this,e)},e.prototype.async=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Date.now()-this._ts;if(this._ts=Date.now(),r<this._threshold){this._cancelFn&&this._deferredTimer&&this._cancelFn(),clearTimeout(this._deferredTimer);var i=(0,n.createPromiseResolver)();return this._deferredTimer=setTimeout(this._deferPromise.bind(this,e,i),this._threshold),i.promise}return!0===this._blockInital?this.async.apply(this,e):this._fn.apply(this._fn,e)},e.prototype.setCancel=function(e){this._cancelFn=e},e}();r.Debouncer=s},{"../promise_resolver":16}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DummyLogger=void 0;var n=function(){function e(){this.tag="",this.description=""}return e.prototype.matchesTag=function(){return!1},e.prototype.setLevel=function(){},e.prototype.enable=function(){},e.prototype.disable=function(){},e.prototype.log=function(){},e.prototype.debug=function(){},e.prototype.info=function(){},e.prototype.warn=function(){},e.prototype.error=function(){},e}();r.DummyLogger=n},{}],7:[function(e,t,r){(function(t){(function(){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DebugLogger=void 0;var n=e("tslib"),i=e("./enums/log_level"),o=e("./_internal/dummy_logger"),a=function(){function e(e,t,r){void 0===t&&(t=""),void 0===r&&(r=function(){return!1}),this._tagParts=[],this._tagText="",this._enabled=!0,this._level=i.LogLevel.NONE,this.tag="",this.description="",this._predicate=function(){return!1},this.tag=e,this.description=t,this._predicate=r,this._tagParts=e.split("."),this._tagText="[".concat(e,"]")}return e.prototype._print=function(e,t,r){if(this._enabled||this._level&t){var i={args:r,type:e,tag:this.tag};this._predicate(i)||console[e].apply(console,n.__spreadArray([this._tagText],r,!1))}},e.prototype.matchesTag=function(e){var t=Array.isArray(e)?e:e.split("."),r=this._tagParts;if(t.length>r.length)return!1;for(var n=0,i=t.length;n<i;n++)if(("*"!==t[n]||!r[n])&&t[n]!==r[n])return!1;return!0},e.prototype.setLevel=function(e){var t=0;switch(e){case"error":t=i.LogLevel.ERROR;break;case"warn":t=i.LogLevel.WARN|i.LogLevel.ERROR;break;case"info":t=i.LogLevel.INFO|i.LogLevel.WARN|i.LogLevel.ERROR;break;case"debug":t=i.LogLevel.DEBUG|i.LogLevel.INFO|i.LogLevel.WARN|i.LogLevel.ERROR;break;case"log":default:t=i.LogLevel.LOG|i.LogLevel.DEBUG|i.LogLevel.INFO|i.LogLevel.WARN|i.LogLevel.ERROR}this._level=t},e.prototype.enable=function(){this._enabled=!0},e.prototype.disable=function(){this._enabled=!1},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._print("log",i.LogLevel.LOG,e)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._print("debug",i.LogLevel.DEBUG,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._print("info",i.LogLevel.INFO,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._print("warn",i.LogLevel.WARN,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._print("error",i.LogLevel.ERROR,e)},e}(),s=o.DummyLogger;r.DebugLogger=s;try{"true"===t.env.DEBUG&&(r.DebugLogger=s=a)}catch(e){}}).call(this)}).call(this,e("_process"))},{"./_internal/dummy_logger":6,"./enums/log_level":8,_process:225,tslib:227}],8:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.LogLevel=void 0,function(e){e[e.NONE=0]="NONE",e[e.LOG=1]="LOG",e[e.DEBUG=2]="DEBUG",e[e.INFO=4]="INFO",e[e.WARN=8]="WARN",e[e.ERROR=16]="ERROR"}(n||(r.LogLevel=n={}))},{}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.logging=void 0;var n=e("./logging");r.logging=n},{"./logging":10}],10:[function(e,t,r){(function(t){(function(){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.remove=r.forTag=r.disableAll=r.enableAll=r.setLevel=r.disable=r.enable=r.list=r.unintercept=r.intercept=void 0;var n=e("./debug_logger"),i=t.__dbgLoggerRegistry;i||(i={map:{},list:[],loggingPredicate:function(){}},Object.defineProperty?Object.defineProperty(t,"__dbgLoggerRegistry",{value:i}):t.__dbgLoggerRegistry=i);var o=i.map,a=i.list;function s(e){return!(!i.loggingPredicate||!i.loggingPredicate(e))}var u="log";r.intercept=function(e){if("function"!=typeof e)throw new TypeError("Logging.intercept requires a function predicate.");i.loggingPredicate=e},r.unintercept=function(){i.loggingPredicate=function(){}},r.list=function(e){var t=Object.keys(o).filter((function(e){return o[e]})).sort();return e?t.map((function(e){return{tag:e,description:o[e].description||"No description."}})):t.reduce((function(e,t){return e[t]=o[t].description||"No description",e}),{})},r.enable=function(e){for(var t,r=Array.isArray(e)?e:[e],n=r.length;n--;)for(var i=null===(t=r[n])||void 0===t?void 0:t.toLowerCase(),o=a.length;o--;){var s=a[o];s.matchesTag(i)&&s.enable()}},r.disable=function(e){for(var t,r=Array.isArray(e)?e:[e],n=r.length;n--;)for(var i=null===(t=r[n])||void 0===t?void 0:t.toLowerCase(),o=a.length;o--;){var s=a[o];s.matchesTag(i)&&s.disable()}},r.setLevel=function(e){u=e;for(var t=a.length;t--;){var r=a[t];r&&r.setLevel(e)}},r.enableAll=function(){for(var e=a.length;e--;)a[e]&&a[e].enable()},r.disableAll=function(){for(var e=a.length;e--;)a[e]&&a[e].disable()},r.forTag=function(e,t){var r,i;if("string"==typeof e?(r=e.toLowerCase(),i=t):(r=e.tag,i=e.description),o.hasOwnProperty(r)&&o[r])return o[r];var l=new n.DebugLogger(r,i,s);return l.setLevel(u),o[r]=l,a.push(l),l},r.remove=function(e){var t=e.toLowerCase();if(o.hasOwnProperty(t)&&o[t]){var r=o[t];o[t]=null;var n=a.indexOf(r);-1!==n&&a.splice(n,1)}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./debug_logger":7}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fromHex=r.toHex=r.toBytes=r.fromBytes=void 0;var n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",i={},o={};function a(e,t,r){for(var n=0,i=0;i<e.length;++i){var o=e[i]*t+n;e[i]=o%r,n=~~(o/r)}for(;n;)e.push(n%r),n=~~(n/r)}function s(e,t,r,n){var i,o,a=0;for(o=0;o<t.length;++o)i=~~e[o]+t[o]*r+a,e[o]=i%n,a=~~(i/n);for(;a;)i=~~e[o]+a,e[o]=i%n,a=~~(i/n),++o}function u(e,t,r){for(var n=[0],i=[1],o=0,u=e;o<u.length;o++){s(n,i,u[o],r),a(i,t,r)}return n}function l(e,t){for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n];r.push(t[o])}return r.reverse()}function c(e,t){for(void 0===t&&(t=0);e.length<t;)e.push(0);return e}!function(){for(var e=0,t=n.length;e<t;++e)o[n[e]]=e;for(e=0;e<16;++e)i["0123456789abcdef"[e]]=e;for(e=0;e<16;++e)i["0123456789ABCDEF"[e]]=e}(),r.fromBytes=function(e,t){return l(c(u(e.slice(0).reverse(),256,62),t),n).join("")},r.toBytes=function(e,t){return c(u(l(e.split(""),o),62,256),t).reverse()},r.toHex=function(e,t){var r=u(l(e.split(""),o),62,16);return l(c(r,t),n).join("")},r.fromHex=function(e,t){var r=u(l(e.split(""),i),16,62);return l(c(r,t),n).join("")}},{}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.decode=r.encode=void 0;var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=function(){for(var e=[],t=0;t<256;++t)e[t]=255;for(t=0;t<n.length;++t)e[n.charCodeAt(t)]=t;return String.fromCharCode.apply(String,e)}();var o=function(e){for(var t=String(e),r=[],i=t.length,o=0;o<i;){var a=255&t.charCodeAt(o++);if(o===i){r.push(n.charAt(a>>2),n.charAt((3&a)<<4),"==");break}var s=t.charCodeAt(o++);if(o===i){r.push(n.charAt(a>>2),n.charAt((3&a)<<4|(240&s)>>4),n.charAt((15&s)<<2),"=");break}var u=t.charCodeAt(o++);r.push(n.charAt(a>>2),n.charAt((3&a)<<4|(240&s)>>4),n.charAt((15&s)<<2|(192&u)>>6),n.charAt(63&u))}return r.join("")};r.encode=o;var a=function(e){for(var t,r,n=String(e),o=[],a=n.length,s=0;;){do{t=i.charCodeAt(255&n.charCodeAt(s++))}while(255===t&&s<a);do{r=i.charCodeAt(255&n.charCodeAt(s++))}while(255===r&&s<a);if(255===r)break;o.push(255&(t<<2|r>>4));do{t=i.charCodeAt(255&n.charCodeAt(s++))}while(255===t&&s<a);if(255===t)break;o.push(255&(r<<4|t>>2));do{r=i.charCodeAt(255&n.charCodeAt(s++))}while(255===r&&s<a);if(255===r)break;o.push(255&(t<<6|r))}return function(e){if(e.length<4096)return String.fromCharCode.apply(String,e);var t=0,r=[];do{r.push(String.fromCharCode.apply(String,e.slice(t,t+4096))),t+=4096}while(t<e.length);return r.join("")}(o)};r.decode=a,"undefined"!=typeof window&&window.btoa&&window.atob&&(r.encode=o=function(e){return window.btoa(e)},r.decode=a=function(e){return window.atob(e)})},{}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Base64=r.Base62=void 0;var n=e("./base62");r.Base62=n;var i=e("./base64");r.Base64=i},{"./base62":11,"./base64":12}],14:[function(e,t,r){"use strict";function n(){if("undefined"==typeof Promise)return function(e){return setTimeout(e,0)};var e=Promise.resolve();return function(t){e.then(t).catch((function(e){return setTimeout((function(){throw e}),0)}))}}Object.defineProperty(r,"__esModule",{value:!0}),r.queueTask=r.makeQueueMicrotaskShim=void 0,r.makeQueueMicrotaskShim=n,r.queueTask="undefined"!=typeof globalThis&&"function"==typeof globalThis.queueMicrotask?globalThis.queueMicrotask.bind(globalThis):n()},{}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.monotonicDuration=r.monotonicNow=void 0;var n=e("./_internal/create_monotonic_now");r.monotonicNow=(0,n.createMonotonicNow)((function(){return performance.now()}),Date.now);r.monotonicDuration=function(e,t){return void 0===t&&(t=(0,r.monotonicNow)()),Math.round(Math.abs(t-e))}},{"./_internal/create_monotonic_now":1}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createPromiseResolver=void 0,r.createPromiseResolver=function(){var e,t;return{promise:new Promise((function(r,n){e=r,t=n})),resolve:e,reject:t}}},{}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.throttle=void 0;var n=e("../monotonic_now");r.throttle=function(e,t,r){var i;return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];var s=(0,n.monotonicNow)();if(!i||s-i>=e)return i=s,t.apply(r,o)}}},{"../monotonic_now":15}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.interpolateUA=void 0;var n=e("./parse_ua");r.interpolateUA=function(e){if(!e)return e;var t=(0,n.parseUA)(navigator.userAgent,navigator.platform);return e.replace(/\{\{([^}]+?)\}\}/g,(function(e,r){return n=r,(i=t)&&i.hasOwnProperty(n)?t[r]:"";var n,i}))}},{"./parse_ua":19}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.parseUA=void 0;var n=/(edge)[\s\/:]([\w\d\.]+)/,i=new RegExp("(opera|ie|firefox|chrome|trident|crios|version)[\\s/:]([\\w\\d\\.]+)?.*?(safari|(?:rv[\\s\\/:]|version[\\s\\/:])([\\w\\d\\.]+)|$)"),o={};r.parseUA=function(e,t){var r,a,s,u=e.toLowerCase(),l=t?t.toLowerCase():"",c="".concat(u,":").concat(l),d=o[c];if(d)return d;var _=u.match(n),p=u.match(i)||[null,"unknown",0],f=_||p;"trident"===f[1]?(f[1]="ie",f[4]&&(f[2]=f[4])):"crios"===f[1]&&(f[1]="chrome"),"win"===(l=u.match(/ip(?:ad|od|hone)/)?"ios":null!==(r=(u.match(/(?:webos|android)/)||u.match(/mac|win|linux|cros/)||[])[0])&&void 0!==r?r:"other")&&(l="windows");var h="version"===f[1]?f[3]:f[1],v="opera"===f[1]&&f[4]?f[4]:f[2],y={name:null!==(a=null==h?void 0:h.toString())&&void 0!==a?a:"unknown",version:null!==(s=null==v?void 0:v.toString())&&void 0!==s?s:"unknown",platform:l};return o[c]=y,y}},{}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createPromiseResolver=function(){var e,t;return{promise:new Promise((function(r,n){e=r,t=n})),resolve:e,reject:t}}},{}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.interpolateUA=function(e){if(!e)return e;var t=(0,n.parseUA)(navigator.userAgent,navigator.platform);return e.replace(/\{\{([^}]+?)\}\}/g,(function(e,r){return n=r,(i=t)&&i.hasOwnProperty(n)?t[r]:"";var n,i}))};var n=e("./parse_ua")},{"./parse_ua":22}],22:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.parseUA=function(e,t){var r,a,s,u=e.toLowerCase(),l=t?t.toLowerCase():"",c="".concat(u,":").concat(l),d=o[c];if(d)return d;var _=u.match(n),p=u.match(i)||[null,"unknown",0],f=_||p;"trident"===f[1]?(f[1]="ie",f[4]&&(f[2]=f[4])):"crios"===f[1]&&(f[1]="chrome");"win"===(l=u.match(/ip(?:ad|od|hone)/)?"ios":null!==(r=(u.match(/(?:webos|android)/)||u.match(/mac|win|linux|cros/)||[])[0])&&void 0!==r?r:"other")&&(l="windows");var h="version"===f[1]?f[3]:f[1],v="opera"===f[1]&&f[4]?f[4]:f[2],y={name:null!==(a=null==h?void 0:h.toString())&&void 0!==a?a:"unknown",version:null!==(s=null==v?void 0:v.toString())&&void 0!==s?s:"unknown",platform:l};return o[c]=y,y};var n=/(edge)[\s\/:]([\w\d\.]+)/,i=new RegExp("(opera|ie|firefox|chrome|trident|crios|version)[\\s/:]([\\w\\d\\.]+)?.*?(safari|(?:rv[\\s\\/:]|version[\\s\\/:])([\\w\\d\\.]+)|$)"),o={}},{}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.groupBy=void 0,r.groupBy=function(e,t){return e.reduce((function(e,r){var n,i=r[t];return void 0===i||(e[i]=null!==(n=e[i])&&void 0!==n?n:[],e[i].push(r)),e}),{})}},{}],24:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LoggingError=void 0;var n=e("tslib"),i=function(e){function t(t,r,n){var i=e.call(this,r)||this;return i.name="LoggingError",i.code=t,i.status=n||0,i}return n.__extends(t,e),t}(Error);r.LoggingError=i},{tslib:227}],25:[function(e,t,r){"use strict";function n(e,t){var r=e.indexOf(t);return-1===r?[e,""]:[e.slice(0,r),e.slice(r+t.length)]}Object.defineProperty(r,"__esModule",{value:!0}),r.urlWithQueryParam=r.splitOnce=void 0,r.splitOnce=n,r.urlWithQueryParam=function(e,t,r){for(var i=n(e,"#"),o=i[0],a=i[1],s=n(o,"?"),u=s[0],l=s[1],c=a?"#"+a:"",d=t+"="+encodeURIComponent(r),_=0,p=l.split("&");_<p.length;_++){var f=p[_];f.length>0&&n(f,"=")[0]!==t&&(d+="&"+f)}return u+"?"+d+c}},{}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LoggingErrors=void 0,function(e){e.INVALID_IDENT_DATA="INVALID_IDENT_DATA",e.LOGGING_REQUEST_FAILED="LOGGING_REQUEST_FAILED"}(r.LoggingErrors||(r.LoggingErrors={}))},{}],27:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LogValues=void 0,r.LogValues={UNKNOWN:"unknown",EMPTY:"",ZERO:0,EMPTY_VERSION:"0.0.0"}},{}],28:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("tslib");n.__exportStar(e("./logger"),r),n.__exportStar(e("./enums/errors"),r),n.__exportStar(e("./enums/log_values"),r)},{"./enums/errors":26,"./enums/log_values":27,"./logger":29,tslib:227}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MelodyLogger=void 0;var n=e("tslib"),i=e("@js-sdk/common/es5/microtask"),o=e("./enums/errors"),a=e("./enums/log_values"),s=e("./_internal/group_by"),u=e("./_internal/logging_error"),l=e("./_internal/url_utils"),c=function(){function e(e){this._transport=e.transport,this._endpoint=e.endpoint||"@webgate/melody",this._batchQueue=[],this._identData=Promise.all([e.sdkId,e.platform,e.clientVersion]).then((function(e){var t=e[0],r=e[1],n=e[2];return{sdk_id:t||a.LogValues.EMPTY,platform:r||a.LogValues.EMPTY,client_version:n||a.LogValues.EMPTY_VERSION}}))}return e.prototype._assertValidIdentData=function(e){if(!e.sdk_id)throw new u.LoggingError(o.LoggingErrors.INVALID_IDENT_DATA,"sdkId must be a non-empty string.",0)},e.prototype._sendBatchedLogs=function(){var e=this;return this._identData.then((function(t){e._assertValidIdentData(t);var r=e._batchQueue.splice(0,e._batchQueue.length);if(r.length){var i=s.groupBy(r,"endpoint"),a=Object.keys(i).map((function(r){var a,s=null===(a=i[r])||void 0===a?void 0:a.map((function(e){return e.payload}));return(null==s?void 0:s.length)?e._transport.request(""+e._endpoint+r,{method:"POST",payload:JSON.stringify(n.__assign({messages:s},t)),retry:{maxRetries:5,condition:function(e){return 202!==e.status}}}).then((function(e){var t=e.status;return 202===t||Promise.reject(new u.LoggingError(o.LoggingErrors.LOGGING_REQUEST_FAILED,"Logging service responded with status "+t,t))})):Promise.resolve(!0)}));return Promise.all(a).then((function(){return!0}))}return Promise.resolve(!0)}))},e.prototype._sendLog=function(e,t){return this.sendLog(e,t)},e.prototype.sendLog=function(e,t,r){var a=this,s=null==r?void 0:r.forget;if(null==r?void 0:r.batch){if(s)throw new Error("'forget' cannot be used together with 'batch'.");return new Promise((function(r){a._batchQueue.push({endpoint:e,payload:t}),i.queueTask((function(){a._sendBatchedLogs().then(r)}))}))}return this._identData.then((function(r){a._assertValidIdentData(r);var i=a._endpoint+e,o=s?a._transport.getLastToken():null;return o&&(i=l.urlWithQueryParam(i,"access_token",o)),a._transport.request(i,{method:"POST",payload:JSON.stringify(n.__assign(n.__assign({},t),r)),forget:s,retry:{maxRetries:5,condition:function(e){return 202!==e.status}}})})).then((function(e){var t=e.status;return!(!s&&202!==t)||Promise.reject(new u.LoggingError(o.LoggingErrors.LOGGING_REQUEST_FAILED,"Logging service responded with status "+t,t))}))},e}();r.MelodyLogger=c},{"./_internal/group_by":23,"./_internal/logging_error":24,"./_internal/url_utils":25,"./enums/errors":26,"./enums/log_values":27,"@js-sdk/common/es5/microtask":14,tslib:227}],30:[function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){var e,i;e="undefined"!=typeof self?self:this,i=function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=18)}([function(e,t,r){(function(t){var r;r="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},e.exports=r}).call(t,r(6))},function(e,t){function r(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function i(e,t){var r=S(e)||function(e){return function(e){return function(e){return!!e&&"object"==n(e)}(e)&&l(e)}(e)&&m.call(e,"callee")&&(!g.call(e,"callee")||E.call(e)==p)}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],i=r.length,o=!!i;for(var s in e)!t&&!m.call(e,s)||o&&("length"==s||a(s,i))||r.push(s);return r}function o(e,t,r){var n=e[t];m.call(e,t)&&u(n,r)&&(void 0!==r||t in e)||(e[t]=r)}function a(e,t){return!!(t=null==t?_:t)&&("number"==typeof e||v.test(e))&&e>-1&&e%1==0&&e<t}function s(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||y)}function u(e,t){return e===t||e!=e&&t!=t}function l(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=_}(e.length)&&!function(e){var t=c(e)?E.call(e):"";return t==f||t==h}(e)}function c(e){var t=n(e);return!!e&&("object"==t||"function"==t)}function d(e){return l(e)?i(e):function(e){if(!s(e))return R(e);var t=[];for(var r in Object(e))m.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}var _=9007199254740991,p="[object Arguments]",f="[object Function]",h="[object GeneratorFunction]",v=/^(?:0|[1-9]\d*)$/,y=Object.prototype,m=y.hasOwnProperty,E=y.toString,g=y.propertyIsEnumerable,R=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),T=Math.max,I=!g.call({valueOf:1},"valueOf"),S=Array.isArray,P=function(e){return function(e,t){return t=T(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,o=T(n.length-t,0),a=Array(o);++i<o;)a[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=a,r(e,this,s)}}((function(t,r){var i=-1,o=r.length,s=o>1?r[o-1]:void 0,d=o>2?r[2]:void 0;for(s=e.length>3&&"function"==typeof s?(o--,s):void 0,d&&function(e,t,r){if(!c(r))return!1;var i=n(t);return!!("number"==i?l(r)&&a(t,r.length):"string"==i&&t in r)&&u(r[t],e)}(r[0],r[1],d)&&(s=o<3?void 0:s,o=1),t=Object(t);++i<o;){var _=r[i];_&&e(t,_)}return t}))}((function(e,t){if(I||s(t)||l(t))!function(e,t,r,n){r||(r={});for(var i=-1,a=t.length;++i<a;){var s=t[i],u=n?n(r[s],e[s],s,r,e):void 0;o(r,s,void 0===u?e[s]:u)}}(t,d(t),e);else for(var r in t)m.call(t,r)&&o(e,r,t[r])}));e.exports=P},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){r=void 0===r?1:r,e[t]=e[t]||0,e[t]+=r}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),i={now:function(){var e=n.default.performance,t=e&&e.timing;return t&&"number"==typeof t.navigationStart&&"function"==typeof e.now?t.navigationStart+e.now():Date.now()}};t.default=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(20)),i=n.default.methodFactory;n.default.methodFactory=function(e,t,r){var n=i(e,t,r);return function(){for(var e=["[mux]"],t=0;t<arguments.length;t++)e.push(arguments[t]);n.apply(void 0,e)}},n.default.setLevel(n.default.getLevel()),t.default=n.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){if("string"!=typeof e||""===e)return["localhost"];var t=(e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/)||[])[4],r=void 0;return t&&(r=(t.match(/[^\.]+\.[^\.]+$/)||[])[0]),[t,r]};t.extractHostnameAndDomain=n,t.extractHostname=function(e){return n(e)[0]},t.extractDomain=function(e){return n(e)[1]}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==("undefined"==typeof window?"undefined":n(window))&&(r=window)}e.exports=r},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},t.generateShortID=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return(e=e||"").trim().split(/[\r\n]+/).forEach((function(e){if(e){var r=e.split(": "),i=r.shift();i&&n.indexOf(i.toLowerCase())>=0&&(t[i]=r.join(": "))}})),t};var n=["x-cdn","content-type"]},function(e,t,r){var i=SyntaxError,o=Function,a=TypeError,s=function(e){try{return o('"use strict"; return ('+e+").constructor;")()}catch(e){}},u=Object.getOwnPropertyDescriptor;if(u)try{u({},"")}catch(e){u=null}var l=function(){throw new a},c=u?function(){try{return l}catch(e){try{return u(arguments,"callee").get}catch(e){return l}}}():l,d=r(46)(),_=Object.getPrototypeOf||function(e){return e.__proto__},p={},f="undefined"==typeof Uint8Array?void 0:_(Uint8Array),h={"%AggregateError%":"undefined"==typeof AggregateError?void 0:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer,"%ArrayIteratorPrototype%":d?_([][Symbol.iterator]()):void 0,"%AsyncFromSyncIteratorPrototype%":void 0,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?void 0:Atomics,"%BigInt%":"undefined"==typeof BigInt?void 0:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?void 0:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?void 0:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?void 0:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?void 0:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?void 0:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?void 0:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?void 0:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d?_(_([][Symbol.iterator]())):void 0,"%JSON%":"object"==("undefined"==typeof JSON?"undefined":n(JSON))?JSON:void 0,"%Map%":"undefined"==typeof Map?void 0:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&d?_((new Map)[Symbol.iterator]()):void 0,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?void 0:Promise,"%Proxy%":"undefined"==typeof Proxy?void 0:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?void 0:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?void 0:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&d?_((new Set)[Symbol.iterator]()):void 0,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d?_(""[Symbol.iterator]()):void 0,"%Symbol%":d?Symbol:void 0,"%SyntaxError%":i,"%ThrowTypeError%":c,"%TypedArray%":f,"%TypeError%":a,"%Uint8Array%":"undefined"==typeof Uint8Array?void 0:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?void 0:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?void 0:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?void 0:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?void 0:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?void 0:WeakSet},v=function e(t){var r;if("%AsyncFunction%"===t)r=s("async function () {}");else if("%GeneratorFunction%"===t)r=s("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=s("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&(r=_(i.prototype))}return h[t]=r,r},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},m=r(10),E=r(49),g=m.call(Function.call,Array.prototype.concat),R=m.call(Function.apply,Array.prototype.splice),T=m.call(Function.call,String.prototype.replace),I=m.call(Function.call,String.prototype.slice),S=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,P=/\\(\\)?/g,b=function(e){var t=I(e,0,1),r=I(e,-1);if("%"===t&&"%"!==r)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new i("invalid intrinsic syntax, expected opening `%`");var n=[];return T(e,S,(function(e,t,r,i){n[n.length]=r?T(i,P,"$1"):t||e})),n},A=function(e,t){var r,n=e;if(E(y,n)&&(n="%"+(r=y[n])[0]+"%"),E(h,n)){var o=h[n];if(o===p&&(o=v(n)),void 0===o&&!t)throw new a("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:o}}throw new i("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new a('"allowMissing" argument must be a boolean');var r=b(e),n=r.length>0?r[0]:"",o=A("%"+n+"%",t),s=o.name,l=o.value,c=!1,d=o.alias;d&&(n=d[0],R(r,g([0,1],d)));for(var _=1,p=!0;_<r.length;_+=1){var f=r[_],v=I(f,0,1),y=I(f,-1);if(('"'===v||"'"===v||"`"===v||'"'===y||"'"===y||"`"===y)&&v!==y)throw new i("property names with quotes must have matching quotes");if("constructor"!==f&&p||(c=!0),E(h,s="%"+(n+="."+f)+"%"))l=h[s];else if(null!=l){if(!(f in l)){if(!t)throw new a("base intrinsic for "+e+" exists, but the property is not available.");return}if(u&&_+1>=r.length){var m=u(l,f);l=(p=!!m)&&"get"in m&&!("originalValue"in m.get)?m.get:l[f]}else p=E(l,f),l=l[f];p&&!c&&(h[s]=l)}}return l}},function(e,t,r){var n=r(48);e.exports=Function.prototype.bind||n},function(e,t,r){var n=String.prototype.replace,i=/%20/g,o="RFC1738",a="RFC3986";e.exports={default:a,formatters:{RFC1738:function(e){return n.call(e,i,"+")},RFC3986:function(e){return String(e)}},RFC1738:o,RFC3986:a}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.findMediaElement=t.getMuxPlayerId=void 0;var n=r(7),i=function(e){return e&&void 0!==e.nodeName?(e.muxId||(e.muxId=e.id||(0,n.generateShortID)()),e.muxId):e};t.getMuxPlayerId=i,t.findMediaElement=function(e){var t=void 0;return e&&void 0!==e.nodeName?e=i(t=e):t=document.querySelector(e),[t,e,t&&t.nodeName?t.nodeName.toLowerCase():""]}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return"1"===(n.default.doNotTrack||n.default.navigator&&(n.default.navigator.doNotTrack||n.default.navigator.msDoNotTrack))};var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),i={exists:function(){var e=n.default.performance;return void 0!==(e&&e.timing)},domContentLoadedEventEnd:function(){var e=n.default.performance,t=e&&e.timing;return t&&t.domContentLoadedEventEnd},navigationStart:function(){var e=n.default.performance,t=e&&e.timing;return t&&t.navigationStart}};t.default=i},function(e,t,r){var n=r(44),i=r(54),o=r(11);e.exports={formats:o,parse:i,stringify:n}},function(e,t,r){var i=r(11),o=Object.prototype.hasOwnProperty,a=Array.isArray,s=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),u=function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(a(r)){for(var n=[],i=0;i<r.length;++i)void 0!==r[i]&&n.push(r[i]);t.obj[t.prop]=n}}},l=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r};e.exports={arrayToObject:l,assign:function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],i=0;i<t.length;++i)for(var o=t[i],a=o.obj[o.prop],s=Object.keys(a),l=0;l<s.length;++l){var c=s[l],d=a[c];"object"==n(d)&&null!==d&&-1===r.indexOf(d)&&(t.push({obj:a,prop:c}),r.push(d))}return u(t),e},decode:function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,t,r,o,a){if(0===e.length)return e;var u=e;if("symbol"==n(e)?u=Symbol.prototype.toString.call(e):"string"!=typeof e&&(u=String(e)),"iso-8859-1"===r)return escape(u).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var l="",c=0;c<u.length;++c){var d=u.charCodeAt(c);45===d||46===d||95===d||126===d||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||a===i.RFC1738&&(40===d||41===d)?l+=u.charAt(c):d<128?l+=s[d]:d<2048?l+=s[192|d>>6]+s[128|63&d]:d<55296||d>=57344?l+=s[224|d>>12]+s[128|d>>6&63]+s[128|63&d]:(c+=1,d=65536+((1023&d)<<10|1023&u.charCodeAt(c)),l+=s[240|d>>18]+s[128|d>>12&63]+s[128|d>>6&63]+s[128|63&d])}return l},isBuffer:function(e){return!(!e||"object"!=n(e)||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(a(e)){for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)},merge:function e(t,r,i){if(!r)return t;if("object"!=n(r)){if(a(t))t.push(r);else{if(!t||"object"!=n(t))return[t,r];(i&&(i.plainObjects||i.allowPrototypes)||!o.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=n(t))return[t].concat(r);var s=t;return a(t)&&!a(r)&&(s=l(t,i)),a(t)&&a(r)?(r.forEach((function(r,a){if(o.call(t,a)){var s=t[a];s&&"object"==n(s)&&r&&"object"==n(r)?t[a]=e(s,r,i):t.push(r)}else t[a]=r})),t):Object.keys(r).reduce((function(t,n){var a=r[n];return o.call(t,n)?t[n]=e(t[n],a,i):t[n]=a,t}),s)}}},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}function i(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[e[r]]=r);return t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={},r={};return Object.keys(e).forEach((function(n){var i=!1;if(e.hasOwnProperty(n)&&void 0!==e[n]){var a=n.split("_"),l=a[0],c=s[l];c||(o.default.info("Data key word `"+a[0]+"` not expected in "+n),c=l+"_"),a.splice(1).forEach((function(e){"url"===e&&(i=!0),u[e]?c+=u[e]:Number(e)&&Math.floor(Number(e))===Number(e)?c+=e:(o.default.info("Data key word `"+e+"` not expected in "+n),c+="_"+e+"_")})),i?r[c]=e[n]:t[c]=e[n]}})),(0,a.default)(t,r)};var o=n(r(4)),a=n(r(1)),s=i({a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"}),u=i({ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cd:"code",cg:"category",ch:"changed",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",du:"duration",dv:"device",ec:"encoding",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",fi:"first",fm:"family",ft:"format",fq:"frequency",fr:"frame",fs:"fullscreen",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"})},function(e,t,r){e.exports=r(19).default},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=n(r(0)),a=r(12),s=n(r(4)),u=n(r(13)),l=n(r(3)),c=n(r(21)),d=n(r(61)),_=n(r(62)),p={},f=function e(t){var r=arguments;"string"==typeof t?e.hasOwnProperty(t)?o.default.setTimeout((function(){r=Array.prototype.splice.call(r,1),e[t].apply(null,r)}),0):s.default.warn("`"+t+"` is an unknown task"):"function"==typeof t?o.default.setTimeout((function(){t(e)}),0):s.default.warn("`"+t+"` is invalid.")};f.loaded=l.default.now(),f.NAME="mux-embed",f.VERSION="4.2.3",f.API_VERSION="2.1",f.PLAYER_TRACKED=!1,f.monitor=function(e,t){return(0,d.default)(f,e,t)},f.destroyMonitor=function(e){var t=(0,a.findMediaElement)(e),r=i(t,1)[0];r&&r.mux&&"function"==typeof r.mux.destroy?r.mux.destroy():s.default.error("A video element monitor for `"+e+"` has not been initialized via `mux.monitor`.")},f.addHLSJS=function(e,t){var r=(0,a.getMuxPlayerId)(e);p[r]?p[r].addHLSJS(t):s.default.error("A monitor for `"+r+"` has not been initialized.")},f.addDashJS=function(e,t){var r=(0,a.getMuxPlayerId)(e);p[r]?p[r].addDashJS(t):s.default.error("A monitor for `"+r+"` has not been initialized.")},f.removeHLSJS=function(e){var t=(0,a.getMuxPlayerId)(e);p[t]?p[t].removeHLSJS():s.default.error("A monitor for `"+t+"` has not been initialized.")},f.removeDashJS=function(e){var t=(0,a.getMuxPlayerId)(e);p[t]?p[t].removeDashJS():s.default.error("A monitor for `"+t+"` has not been initialized.")},f.init=function(e,t){(0,u.default)()&&t&&t.respectDoNotTrack&&s.default.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var r=(0,a.getMuxPlayerId)(e);p[r]=new c.default(f,r,t)},f.emit=function(e,t,r){var n=(0,a.getMuxPlayerId)(e);p[n]?(p[n].emit(t,r),"destroy"===t&&delete p[n]):s.default.error("A monitor for `"+n+"` has not been initialized.")},void 0!==o.default&&"function"==typeof o.default.addEventListener&&o.default.addEventListener("unload",(function(){f.WINDOW_UNLOADING=!0}),!1),f.checkDoNotTrack=u.default,f.log=s.default,f.utils=_.default,t.default=f},function(e,t,r){var i,o;i=function(){function e(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function t(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function r(r){return"debug"===r&&(r="log"),("undefined"==typeof console?"undefined":n(console))!==l&&("trace"===r&&c?t:void 0!==console[r]?e(console,r):void 0!==console.log?e(console,"log"):u)}function i(e,t){for(var r=0;r<d.length;r++){var n=d[r];this[n]=r<e?u:this.methodFactory(n,e,t)}this.log=this.debug}function o(e,t,r){return function(){("undefined"==typeof console?"undefined":n(console))!==l&&(i.call(this,t,r),this[e].apply(this,arguments))}}function a(e,t,n){return r(e)||o.apply(this,arguments)}function s(e,t,r){function o(){var e;if(("undefined"==typeof window?"undefined":n(window))!==l&&c){try{e=window.localStorage[c]}catch(e){}if(n(e)===l)try{var t=window.document.cookie,r=t.indexOf(encodeURIComponent(c)+"=");-1!==r&&(e=/^([^;]+)/.exec(t.slice(r))[1])}catch(e){}return void 0===u.levels[e]&&(e=void 0),e}}var s,u=this,c="loglevel";"string"==typeof e?c+=":"+e:"symbol"==n(e)&&(c=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=r||a,u.getLevel=function(){return s},u.setLevel=function(t,r){if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=u.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(s=t,!1!==r&&function(e){var t=(d[e]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":n(window))!==l&&c){try{return void(window.localStorage[c]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"="+t+";"}catch(e){}}}(t),i.call(u,t,e),("undefined"==typeof console?"undefined":n(console))===l&&t<u.levels.SILENT)return"No console available for logging"},u.setDefaultLevel=function(e){o()||u.setLevel(e,!1)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)};var _=o();null==_&&(_=null==t?"WARN":t),u.setLevel(_,!1)}var u=function(){},l="undefined",c=("undefined"==typeof window?"undefined":n(window))!==l&&n(window.navigator)!==l&&/Trident\/|MSIE /.test(window.navigator.userAgent),d=["trace","debug","info","warn","error"],_=new s,p={};_.getLogger=function(e){if("symbol"!=n(e)&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=p[e];return t||(t=p[e]=new s(e,_.getLevel(),_.methodFactory)),t};var f=("undefined"==typeof window?"undefined":n(window))!==l?window.log:void 0;return _.noConflict=function(){return("undefined"==typeof window?"undefined":n(window))!==l&&window.log===_&&(window.log=f),_},_.getLoggers=function(){return p},_.default=_,_},void 0!==(o="function"==typeof i?i.call(t,r,t,e):i)&&(e.exports=o)},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=n(r(4)),a=n(r(1)),s=r(7),u=r(5),l=n(r(0)),c=n(r(14)),d=n(r(2)),_=n(r(22)),p=r(27),f=r(28),h=n(r(29)),v=n(r(30)),y=n(r(31)),m=n(r(32)),E=n(r(33)),g=n(r(34)),R=n(r(35)),T=n(r(36)),I=n(r(37)),S=n(r(38)),P=n(r(39)),b=n(r(40)),A=n(r(41)),L=n(r(42)),C=n(r(60)),O=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],N=function(e,t,r){var n=this;this.DOM_CONTENT_LOADED_EVENT_END=c.default.domContentLoadedEventEnd(),this.NAVIGATION_START=c.default.navigationStart(),this.mux=e,this.id=t,(r=(0,a.default)({debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,errorTranslator:function(e){return e}},r)).data=r.data||{},r.data.property_key&&(r.data.env_key=r.data.property_key,delete r.data.property_key),o.default.setLevel(r.debug?"debug":"warn"),this.getPlayheadTime=r.getPlayheadTime,this.getStateData=r.getStateData||function(){},this.getAdData=r.getAdData||function(){},this.minimumRebufferDuration=r.minimumRebufferDuration,this.sustainedRebufferThreshold=r.sustainedRebufferThreshold,this.playbackHeartbeatTime=r.playbackHeartbeatTime,this.disableRebufferTracking=r.disableRebufferTracking,this.disableRebufferTracking&&this.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),this.errorTranslator=r.errorTranslator,this.playbackEventDispatcher=new L.default(e,r.data.env_key,r),this.data={player_instance_id:(0,s.generateUUID)(),mux_sample_rate:r.sampleRate,beacon_domain:r.beaconDomain},this.data.view_sequence_number=1,this.data.player_sequence_number=1,this.oldEmit=this.emit,this.emit=function(e,t){t=(0,a.default)({viewer_time:this.mux.utils.now()},t),this.oldEmit(e,t)};var i=function(){void 0===this.data.view_start&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(this);this.on("viewinit",(function(e,t){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),(0,a.default)(this.data,t),this._initializeViewData(),this.one("play",i),this.one("adbreakstart",i)}));var u=function(e){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",e)}.bind(this);this.on("videochange",(function(e,t){u(t)})),this.on("programchange",(function(e,t){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),u((0,a.default)(t,{view_program_changed:!0})),i(),this.emit("play"),this.emit("playing")})),this.on("destroy",this.destroy);var d=this.destroy.bind(this);void 0!==l.default&&"function"==typeof l.default.addEventListener&&l.default.addEventListener("unload",d,!1),this.on("destroy",(function(){void 0!==l.default&&"function"==typeof l.default.removeEventListener&&l.default.removeEventListener("unload",d)})),this.on("playerready",(function(e,t){(0,a.default)(this.data,t)})),O.forEach((function(e){n.on(e,(function(t,r){0!==e.indexOf("ad")&&this._updateStateData(),(0,a.default)(this.data,r),this._sanitizeData()})),n.on("after"+e,(function(){("error"!==e||this.viewErrored)&&this.send(e)}))})),this.on("viewend",(function(e,t){(0,a.default)(n.data,t)})),this.one("playerready",(function(e){var t=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=t-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time})),y.default.apply(this),A.default.apply(this),S.default.apply(this),g.default.apply(this),v.default.apply(this),I.default.apply(this),m.default.apply(this),E.default.apply(this),P.default.apply(this),R.default.apply(this),T.default.apply(this),b.default.apply(this),C.default.apply(this),r.hlsjs&&this.addHLSJS(r),r.dashjs&&this.addDashJS(r),this.emit("viewinit",r.data)};(0,a.default)(N.prototype,h.default.prototype),(0,a.default)(N.prototype,g.default.prototype),(0,a.default)(N.prototype,S.default.prototype),(0,a.default)(N.prototype,v.default.prototype),(0,a.default)(N.prototype,m.default.prototype),(0,a.default)(N.prototype,E.default.prototype),(0,a.default)(N.prototype,P.default.prototype),(0,a.default)(N.prototype,R.default.prototype),(0,a.default)(N.prototype,T.default.prototype),N.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,void 0!==this.data.view_start&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),l.default.clearTimeout(this._heartBeatTimeout))},N.prototype.send=function(e){var t=(0,a.default)({},this.data);if(1===t.player_error_code&&(delete t.player_error_code,delete t.player_error_message),t.player_source_duration===1/0||t.video_source_duration===1/0?t.video_source_is_live=!0:(t.player_source_duration>0||t.video_source_duration>0)&&(t.video_source_is_live=!1),t.video_source_url=t.video_source_url||t.player_source_url,t.video_source_url){var r=(0,u.extractHostnameAndDomain)(t.video_source_url),n=i(r,2),o=n[0],s=n[1];t.video_source_domain=s,t.video_source_hostname=o}delete t.ad_request_id,this.playbackEventDispatcher.send(e,t),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat()},N.prototype._updateStateData=function(){(0,a.default)(this.data,this.getStateData()),this.getPlayheadTime&&(this.data.player_playhead_time=this.getPlayheadTime()),this._sanitizeData()},N.prototype._sanitizeData=function(){var e=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach((function(t){var r=parseInt(e.data[t],10);e.data[t]=isNaN(r)?void 0:r})),["player_source_url","video_source_url"].forEach((function(t){if(e.data[t]){var r=e.data[t].toLowerCase();0!==r.indexOf("data:")&&0!==r.indexOf("blob:")||(e.data[t]="MSE style URL")}}))},N.prototype._resetVideoData=function(e,t){var r=this;Object.keys(this.data).forEach((function(e){0===e.indexOf("video_")&&delete r.data[e]}))},N.prototype._resetViewData=function(){var e=this;Object.keys(this.data).forEach((function(t){0===t.indexOf("view_")&&delete e.data[t]})),this.data.view_sequence_number=1},N.prototype._resetErrorData=function(e,t){delete this.data.player_error_code,delete this.data.player_error_message},N.prototype._initializeViewData=function(){var e=this,t=this.data.view_id=(0,s.generateUUID)();this.data.video_id||(this.data.video_id=(0,_.default)(this.data.player_source_url));var r=function(){t===e.data.view_id&&(0,d.default)(e.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",r):r()},N.prototype._restartHeartBeat=function(){var e=this;l.default.clearTimeout(this._heartBeatTimeout),this.viewErrored||(this._heartBeatTimeout=l.default.setTimeout((function(){e.data.player_is_paused||e.emit("hb")}),1e4))},N.prototype.addHLSJS=function(e){return e.hlsjs?this.hlsjs?void this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=e.hlsjs,void(0,p.monitorHlsJs)(this.mux,this.id,e.hlsjs,{},e.Hls||l.default.Hls)):void this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")},N.prototype.removeHLSJS=function(){this.hlsjs&&((0,p.stopMonitoringHlsJs)(this.hlsjs),this.hlsjs=void 0)},N.prototype.addDashJS=function(e){return e.dashjs?this.dashjs?void this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=e.dashjs,void(0,f.monitorDashJS)(this.mux,this.id,e.dashjs)):void this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")},N.prototype.removeDashJS=function(){this.dashjs&&((0,f.stopMonitoringDashJS)(this.dashjs),this.dashjs=void 0)},t.default=N},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=i.default.createElement("a");t.href=e;var r=t.pathname.replace(/\.[^/.]+$/,"");return o.default.encode(t.host+r).split("=")[0]};var i=n(r(23)),o=n(r(25))},function(e,t,r){(function(t){var n,i=void 0!==t?t:"undefined"!=typeof window?window:{},o=r(24);"undefined"!=typeof document?n=document:(n=i["__GLOBAL_DOCUMENT_CACHE@4"])||(n=i["__GLOBAL_DOCUMENT_CACHE@4"]=o),e.exports=n}).call(t,r(6))},function(e,t){},function(e,t,r){(function(e,i){var o;!function(a){n(t),"object"==n(e)&&e&&e.exports,n(i);var s=function(e){this.message=e};(s.prototype=new Error).name="InvalidCharacterError";var u=function(e){throw new s(e)},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=/[\t\n\f\r ]/g,d={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&u("The string to be encoded contains characters outside of the Latin1 range.");for(var t,r,n,i,o=e.length%3,a="",s=-1,c=e.length-o;++s<c;)t=e.charCodeAt(s)<<16,r=e.charCodeAt(++s)<<8,n=e.charCodeAt(++s),a+=l.charAt((i=t+r+n)>>18&63)+l.charAt(i>>12&63)+l.charAt(i>>6&63)+l.charAt(63&i);return 2==o?(t=e.charCodeAt(s)<<8,r=e.charCodeAt(++s),a+=l.charAt((i=t+r)>>10)+l.charAt(i>>4&63)+l.charAt(i<<2&63)+"="):1==o&&(i=e.charCodeAt(s),a+=l.charAt(i>>2)+l.charAt(i<<4&63)+"=="),a},decode:function(e){var t=(e=String(e).replace(c,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9/]/.test(e))&&u("Invalid character: the string to be decoded is not correctly encoded.");for(var r,n,i=0,o="",a=-1;++a<t;)n=l.indexOf(e.charAt(a)),r=i%4?64*r+n:n,i++%4&&(o+=String.fromCharCode(255&r>>(-2*i&6)));return o},version:"0.1.0"};void 0!==(o=function(){return d}.call(t,r,t,e))&&(e.exports=o)}()}).call(t,r(26)(e),r(6))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.stopMonitoringHlsJs=t.monitorHlsJs=void 0;var i=n(r(8)),o=n(r(14)),a=r(5),s=function(e){if(!e)return{};var t=o.default.navigationStart(),r=e.loading,n=r?r.start:e.trequest,i=r?r.first:e.tfirst,a=r?r.end:e.tload;return{bytesLoaded:e.total,requestStart:Math.round(t+n),responseStart:Math.round(t+i),responseEnd:Math.round(t+a)}},u=function(e){if(e&&"function"==typeof e.getAllResponseHeaders)return(0,i.default)(e.getAllResponseHeaders())};t.monitorHlsJs=function(e,t,r){var n=arguments[4],i=e.log;if(o.default.exists()){var l=function(r,n){return e.emit(t,r,n)},c=function(e,t){var r=t.levels,n=t.audioTracks,i=t.url,o=t.stats,c=t.networkDetails,d={},_={};r.forEach((function(e,t){d[t]={width:e.width,height:e.height,bitrate:e.bitrate,attrs:e.attrs}})),n.forEach((function(e,t){_[t]={name:e.name,language:e.lang,bitrate:e.bitrate}}));var p=s(o),f=p.bytesLoaded,h=p.requestStart,v=p.responseStart,y=p.responseEnd;l("requestcompleted",{request_event_type:e,request_bytes_loaded:f,request_start:h,request_response_start:v,request_response_end:y,request_type:"manifest",request_hostname:(0,a.extractHostname)(i),request_response_headers:u(c),request_rendition_lists:{media:d,audio:_,video:{}}})};r.on(n.Events.MANIFEST_LOADED,c);var d=function(e,t){var r=t.details,n=t.level,i=t.networkDetails,o=t.stats,c=s(o),d=c.bytesLoaded,_=c.requestStart,p=c.responseStart,f=c.responseEnd;l("requestcompleted",{request_event_type:e,request_bytes_loaded:d,request_start:_,request_response_start:p,request_response_end:f,request_current_level:n,request_type:"manifest",request_hostname:(0,a.extractHostname)(r.url),request_response_headers:u(i)})};r.on(n.Events.LEVEL_LOADED,d);var _=function(e,t){var r=t.details,n=t.networkDetails,i=t.stats,o=s(i),c=o.bytesLoaded,d=o.requestStart,_=o.responseStart,p=o.responseEnd;l("requestcompleted",{request_event_type:e,request_bytes_loaded:c,request_start:d,request_response_start:_,request_response_end:p,request_type:"manifest",request_hostname:(0,a.extractHostname)(r.url),request_response_headers:u(n)})};r.on(n.Events.AUDIO_TRACK_LOADED,_);var p=function(e,t){var n=t.stats,i=t.networkDetails,o=t.frag,c=s(n),d=c.bytesLoaded,_=c.requestStart,p=c.responseStart,f={request_event_type:e,request_bytes_loaded:d,request_start:_,request_response_start:p,request_response_end:c.responseEnd,request_hostname:i?(0,a.extractHostname)(i.responseURL):void 0,request_response_headers:u(i),request_media_duration:o.duration};"main"===o.type?(f.request_type="media",f.request_current_level=o.level,f.request_video_width=(r.levels[o.level]||{}).width,f.request_video_height=(r.levels[o.level]||{}).height):f.request_type=o.type,l("requestcompleted",f)};r.on(n.Events.FRAG_LOADED,p);var f=function(e,t){var r=t.details,i=t.response,o=t.context,s=t.frag;if(r===n.ErrorDetails.MANIFEST_LOAD_ERROR||r===n.ErrorDetails.MANIFEST_LOAD_TIMEOUT||r===n.ErrorDetails.FRAG_LOAD_ERROR||r===n.ErrorDetails.FRAG_LOAD_TIMEOUT||r===n.ErrorDetails.LEVEL_LOAD_ERROR||r===n.ErrorDetails.LEVEL_LOAD_TIMEOUT){var u=s&&s.url||o&&o.url||"";l("requestfailed",{request_error:r,request_url:u,request_hostname:(0,a.extractHostname)(u),request_type:r===n.ErrorDetails.FRAG_LOAD_ERROR||r===n.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":"manifest",request_error_code:i&&i.code,request_error_text:i&&i.text})}};r.on(n.Events.ERROR,f);var h=function(e,t){var r=t.frag,n=r&&r._url||"";l("requestcanceled",{request_cancel:e,request_url:n,request_type:"media",request_hostname:(0,a.extractHostname)(n)})};r.on(n.Events.FRAG_LOAD_EMERGENCY_ABORTED,h);var v=function(e,t){var n=t.level,o=r.levels[n];if(o&&o.attrs&&o.attrs.BANDWIDTH){var a=o.attrs.BANDWIDTH;a?l("renditionchange",{video_source_bitrate:a,video_source_width:o.width,video_source_height:o.height}):i.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};r.on(n.Events.LEVEL_SWITCHED,v),r._stopMuxMonitor=function(){r.off(n.Events.MANIFEST_LOADED,c),r.off(n.Events.LEVEL_LOADED,d),r.off(n.Events.AUDIO_TRACK_LOADED,_),r.off(n.Events.FRAG_LOADED,p),r.off(n.Events.ERROR,f),r.off(n.Events.FRAG_LOAD_EMERGENCY_ABORTED,h),r.off(n.Events.LEVEL_SWITCHED,v),r.off(n.Events.DESTROYING,r._stopMuxMonitor),delete r._stopMuxMonitor},r.on(n.Events.DESTROYING,r._stopMuxMonitor)}else i.warn("performance timing not supported. Not tracking HLS.js.")},t.stopMonitoringHlsJs=function(e){e&&"function"==typeof e._stopMuxMonitor&&e._stopMuxMonitor()}},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.stopMonitoringDashJS=t.monitorDashJS=void 0;var i=n(r(0)),o=n(r(8)),a=r(5),s=function(e,t){if(!e||"function"!=typeof e.getRequests)return{};var r=e.getRequests({state:"executed"});if(0===r.length)return{};var n=r[r.length-1],i=(0,a.extractHostname)(n.url),s=n.bytesLoaded,u=new Date(n.requestStartDate).getTime(),l=new Date(n.firstByteDate).getTime(),c=new Date(n.requestEndDate).getTime(),d=isNaN(n.duration)?0:n.duration,_="function"==typeof t.getMetricsFor?t.getMetricsFor(n.mediaType).HttpList:t.getDashMetrics().getHttpRequests(n.mediaType),p=void 0;return _.length>0&&(p=(0,o.default)(_[_.length-1]._responseHeaders||"")),{requestStart:u,requestResponseStart:l,requestResponseEnd:c,requestBytesLoaded:s,requestResponseHeaders:p,requestMediaDuration:d,requestHostname:i}},u=function(e,t){var r=t.getQualityFor(e),n=t.getCurrentTrackFor(e).bitrateList;return n?{currentLevel:r,renditionWidth:n[r].width||null,renditionHeight:n[r].height||null,renditionBitrate:n[r].bandwidth}:{}};t.monitorDashJS=function(e,t,r){var n=e.log;if(r&&r.on){var o=function(r,n){return e.emit(t,r,n)},l=function(e){var t=e.type,r=(e.data||{}).url;o("requestcompleted",{request_event_type:t,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:(0,a.extractHostname)(r)})};r.on("manifestLoaded",l);var c={},d=function(e){var t=e.type,n=e.fragmentModel,i=(e.chunk||{}).mediaInfo||{},a=i.type,u=i.bitrateList,l={};(u=u||[]).forEach((function(e,t){l[t]={},l[t].width=e.width,l[t].height=e.height,l[t].bitrate=e.bandwidth,l[t].attrs={}})),"video"===a?c.video=l:"audio"===a?c.audio=l:c.media=l;var d=s(n,r),_=d.requestStart,p=d.requestResponseStart,f=d.requestResponseEnd,h=d.requestResponseHeaders,v=d.requestMediaDuration,y=d.requestHostname;o("requestcompleted",{request_event_type:t,request_start:_,request_response_start:p,request_response_end:f,request_bytes_loaded:-1,request_type:a+"_init",request_response_headers:h,request_hostname:y,request_media_duration:v,request_rendition_lists:c})};r.on("initFragmentLoaded",d);var _=function(e){var t=e.type,n=e.fragmentModel,i=e.chunk||{},a=i.mediaInfo,l=i.start,c=(a||{}).type,d=s(n,r),_=d.requestStart,p=d.requestResponseStart,f=d.requestResponseEnd,h=d.requestBytesLoaded,v=d.requestResponseHeaders,y=d.requestMediaDuration,m=d.requestHostname,E=u(c,r),g=E.currentLevel,R=E.renditionWidth,T=E.renditionHeight,I=E.renditionBitrate;o("requestcompleted",{request_event_type:t,request_start:_,request_response_start:p,request_response_end:f,request_bytes_loaded:h,request_type:c,request_response_headers:v,request_hostname:m,request_media_start_time:l,request_media_duration:y,request_current_level:g,request_labeled_bitrate:I,request_video_width:R,request_video_height:T})};r.on("mediaFragmentLoaded",_);var p={video:void 0,audio:void 0,totalBitrate:void 0},f=function(){if(p.video&&"number"==typeof p.video.bitrate){if(!p.video.width||!p.video.height)return void n.warn("have bitrate info for video but missing width/height");var e=p.video.bitrate;return p.audio&&"number"==typeof p.audio.bitrate&&(e+=p.audio.bitrate),e!==p.totalBitrate?(p.totalBitrate=e,{video_source_bitrate:e,video_source_height:p.video.height,video_source_width:p.video.width}):void 0}},h=function(e,t,i){if("number"==typeof e.newQuality){var a=e.mediaType;if("audio"===a||"video"===a){var s=r.getBitrateInfoListFor(a).find((function(t){return t.qualityIndex===e.newQuality}));if(!s||"number"!=typeof s.bitrate)return void n.warn("missing bitrate info for "+a);p[a]=s;var u=f();u&&o("renditionchange",u)}}else n.warn("missing evt.newQuality in qualityChangeRendered event",e)};r.on("qualityChangeRendered",h);var v=function(e){var t=e.error,r=e.event,n=(r=r||{}).request||{},s=i.default.event&&i.default.event.currentTarget||{};o("requestfailed",{request_error:t+"_"+r.id+"_"+n.type,request_url:r.url,request_hostname:(0,a.extractHostname)(r.url),request_type:n.mediaType,request_error_code:s.status,request_error_type:s.statusText})};r.on("error",v),r._stopMuxMonitor=function(){r.off("manifestLoaded",l),r.off("initFragmentLoaded",d),r.off("mediaFragmentLoaded",_),r.off("qualityChangeRendered",h),r.off("error",v),delete r._stopMuxMonitor}}else n.warn("Invalid dash.js player reference. Monitoring blocked.")},t.stopMonitoringDashJS=function(e){e&&"function"==typeof e._stopMuxMonitor&&e._stopMuxMonitor()}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){},i=0;n.prototype.on=function(e,t,r){return t._eventEmitterGuid=t._eventEmitterGuid||++i,this._listeners=this._listeners||{},this._listeners[e]=this._listeners[e]||[],r&&(t=t.bind(r)),this._listeners[e].push(t),t},n.prototype.off=function(e,t){var r=this._listeners&&this._listeners[e];r&&r.forEach((function(e,n){e._eventEmitterGuid===t._eventEmitterGuid&&r.splice(n,1)}))},n.prototype.one=function(e,t,r){var n=this;t._eventEmitterGuid=t._eventEmitterGuid||++i;var o=function i(){n.off(e,i),t.apply(r||this,arguments)};o._eventEmitterGuid=t._eventEmitterGuid,this.on(e,o)},n.prototype.emit=function(e,t){var r=this;if(this._listeners){t=t||{};var n=this._listeners["before*"]||[],i=this._listeners[e]||[],o=this._listeners["after"+e]||[],a=function(t,n){(t=t.slice()).forEach((function(t){t.call(r,{type:e},n)}))};a(n,t),a(i,t),a(o,t)}},t.default=n},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),i=function(){this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,this.on("playing",(function(){this._playheadShouldBeProgressing=!0})),this.on("play",this._startPlaybackHeartbeatInterval),this.on("playing",this._startPlaybackHeartbeatInterval),this.on("adbreakstart",this._startPlaybackHeartbeatInterval),this.on("adplay",this._startPlaybackHeartbeatInterval),this.on("adplaying",this._startPlaybackHeartbeatInterval),this.on("seeking",this._startPlaybackHeartbeatInterval),this.on("devicewake",this._startPlaybackHeartbeatInterval),this.on("viewstart",this._startPlaybackHeartbeatInterval),this.on("pause",this._stopPlaybackHeartbeatInterval),this.on("ended",this._stopPlaybackHeartbeatInterval),this.on("viewend",this._stopPlaybackHeartbeatInterval),this.on("error",this._stopPlaybackHeartbeatInterval),this.on("aderror",this._stopPlaybackHeartbeatInterval),this.on("adpause",this._stopPlaybackHeartbeatInterval),this.on("adended",this._stopPlaybackHeartbeatInterval),this.on("adbreakend",this._stopPlaybackHeartbeatInterval),this.on("seeked",(function(){this.data.player_is_paused?this._stopPlaybackHeartbeatInterval():this._startPlaybackHeartbeatInterval()})),this.on("timeupdate",(function(){null!==this._playbackHeartbeatInterval&&this.emit("playbackheartbeat")})),this.on("devicesleep",(function(e,t){null!==this._playbackHeartbeatInterval&&(n.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend",{viewer_time:t.viewer_time}),this._playbackHeartbeatInterval=null)}))};i.prototype._startPlaybackHeartbeatInterval=function(){var e=this;null===this._playbackHeartbeatInterval&&(this.emit("playbackheartbeat"),this._playbackHeartbeatInterval=n.default.setInterval((function(){e.emit("playbackheartbeat")}),this.playbackHeartbeatTime))},i.prototype._stopPlaybackHeartbeatInterval=function(){this._playheadShouldBeProgressing=!1,null!==this._playbackHeartbeatInterval&&(n.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)},t.default=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=this;this.on("viewinit",(function(){e.viewErrored=!1})),this.on("error",(function(){try{var t=e.errorTranslator({player_error_code:e.data.player_error_code,player_error_message:e.data.player_error_message});t?(e.data.player_error_code=t.player_error_code,e.data.player_error_message=t.player_error_message,e.viewErrored=!0):(delete e.data.player_error_code,delete e.data.player_error_message)}catch(t){e.mux.log.warn("Exception in error translator callback.",t),e.viewErrored=!0}}))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(2)),i=function(){this._watchTimeTrackerLastCheckedTime=null,this.on("playbackheartbeat",this._updateWatchTime),this.on("playbackheartbeatend",this._clearWatchTimeState)};i.prototype._updateWatchTime=function(e,t){var r=t.viewer_time;null===this._watchTimeTrackerLastCheckedTime&&(this._watchTimeTrackerLastCheckedTime=r),(0,n.default)(this.data,"view_watch_time",r-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=r},i.prototype._clearWatchTimeState=function(e,t){this._updateWatchTime(e,t),this._watchTimeTrackerLastCheckedTime=null},t.default=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(2)),i=function(){this._playbackTimeTrackerLastPlayheadPosition=-1,this.on("playbackheartbeat",this._updatePlaybackTime),this.on("playbackheartbeatend",this._clearPlaybackTimeState),this.on("seeking",this._clearPlaybackTimeState)};i.prototype._updatePlaybackTime=function(){var e=this.data.player_playhead_time;if(this._playbackTimeTrackerLastPlayheadPosition>=0&&e>this._playbackTimeTrackerLastPlayheadPosition){var t=e-this._playbackTimeTrackerLastPlayheadPosition;t<=1e3&&(0,n.default)(this.data,"view_content_playback_time",t)}this._playbackTimeTrackerLastPlayheadPosition=e},i.prototype._clearPlaybackTimeState=function(){this._updatePlaybackTime(),this._playbackTimeTrackerLastPlayheadPosition=-1},t.default=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){this.on("playbackheartbeat",this._updatePlayheadTime),this.on("playbackheartbeatend",this._updatePlayheadTime),this.on("timeupdate",this._updatePlayheadTime),this.on("destroy",(function(){this.off("timeupdate",this._updatePlayheadTime)}))};n.prototype._updateMaxPlayheadPosition=function(){this.data.view_max_playhead_position=void 0===this.data.view_max_playhead_position?this.data.player_playhead_time:Math.max(this.data.view_max_playhead_position,this.data.player_playhead_time)},n.prototype._updatePlayheadTime=function(e,t){if(t.player_playhead_time)this.data.player_playhead_time=t.player_playhead_time,this._updateMaxPlayheadPosition();else if(this.getPlayheadTime){var r=this.getPlayheadTime();void 0!==r&&(this.data.player_playhead_time=r,this._updateMaxPlayheadPosition())}},t.default=n},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(3)),o=n(r(2)),a=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,this.on("playbackheartbeat",this._checkIfRebuffering),this.on("playbackheartbeatend",this._cleanupRebufferTracker),this.on("seeking",(function(){this._cleanupRebufferTracker(null,{viewer_time:i.default.now()})}))};a.prototype._checkIfRebuffering=function(e,t){if(!this.disableRebufferTracking){if(this.isSeeking||this.isAdBreak||!this._playheadShouldBeProgressing)return void this._cleanupRebufferTracker(e,t);if(null===this._lastCheckedTime)return this._prepareRebufferTrackerState(t.viewer_time),void this._updateRebufferMetrics();if(this._lastPlayheadTime!==this.data.player_playhead_time)return void this._cleanupRebufferTracker(e,t,!0);var r=t.viewer_time-this._lastPlayheadTimeUpdatedTime;r>=this.sustainedRebufferThreshold&&(this._rebuffering?this._updateRebufferMetrics(t.viewer_time-this._lastCheckedTime):(this._rebuffering=!0,(0,o.default)(this.data,"view_rebuffer_count",1),this._updateRebufferMetrics(r),this.emit("rebufferstart"))),this._lastCheckedTime=t.viewer_time}},a.prototype._clearRebufferTrackerState=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null},a.prototype._prepareRebufferTrackerState=function(e){this._lastCheckedTime=e,this._lastPlayheadTime=this.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=e},a.prototype._cleanupRebufferTracker=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.disableRebufferTracking){if(this._rebuffering)this._rebuffering=!1,this._updateRebufferMetrics(t.viewer_time-this._lastCheckedTime),this.emit("rebufferend",{viewer_time:t.viewer_time});else{if(null===this._lastCheckedTime)return void this._updateRebufferMetrics();var n=this.data.player_playhead_time-this._lastPlayheadTime,i=t.viewer_time-this._lastPlayheadTimeUpdatedTime;n>0&&i-n>this.minimumRebufferDuration?((0,o.default)(this.data,"view_rebuffer_count",1),this._updateRebufferMetrics(i-n),this.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+i-n})):this._updateRebufferMetrics()}r?this._prepareRebufferTrackerState(t.viewer_time):this._clearRebufferTrackerState()}},a.prototype._updateRebufferMetrics=function(e){e>0&&(0,o.default)(this.data,"view_rebuffer_duration",e),this.data.view_watch_time>=0&&this.data.view_rebuffer_count>0&&(this.data.view_rebuffer_frequency=this.data.view_rebuffer_count/this.data.view_watch_time,this.data.view_rebuffer_percentage=this.data.view_rebuffer_duration/this.data.view_watch_time)},t.default=a},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(3)),i=function(){this.on("viewinit",(function(){var e=this.data,t=e.view_id;if(!e.view_program_changed){var r=function(e,r){var i=r.viewer_time;"playing"===e.type&&void 0===this.data.view_time_to_first_frame?this.calculateTimeToFirstFrame(i||n.default.now(),t):"adplaying"!==e.type||void 0!==this.data.view_time_to_first_frame&&!this.inPrerollPosition()||this.calculateTimeToFirstFrame(i||n.default.now(),t)};this.one("playing",r),this.one("adplaying",r),this.one("viewend",(function(){this.off("playing",r),this.off("adplaying",r)}))}}))};i.prototype.calculateTimeToFirstFrame=function(e,t){t===this.data.view_id&&(this._updateWatchTime(null,{viewer_time:e}),this.data.view_time_to_first_frame=this.data.view_watch_time,(this.data.player_autoplay_on||this.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.data.view_aggregate_startup_time=this.data.view_start+this.data.view_watch_time-this.NAVIGATION_START))},t.default=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=this;this.on("viewinit",(function(){this._lastPlayheadPosition=-1})),["pause","rebufferstart","seeking","error","adbreakstart","hb"].forEach((function(t){e.on(t,(function(){if(this._lastPlayheadPosition>=0&&this.data.player_playhead_time>=0&&this._lastPlayerWidth>=0&&this._lastSourceWidth>0&&this._lastPlayerHeight>=0&&this._lastSourceHeight>0){var e=this.data.player_playhead_time-this._lastPlayheadPosition;if(e<0)return void(this._lastPlayheadPosition=-1);var t=Math.min(this._lastPlayerWidth/this._lastSourceWidth,this._lastPlayerHeight/this._lastSourceHeight),r=Math.max(0,t-1),i=Math.max(0,1-t);this.data.view_max_upscale_percentage=Math.max(this.data.view_max_upscale_percentage||0,r),this.data.view_max_downscale_percentage=Math.max(this.data.view_max_downscale_percentage||0,i),(0,n.default)(this.data,"view_total_content_playback_time",e),(0,n.default)(this.data,"view_total_upscaling",r*e),(0,n.default)(this.data,"view_total_downscaling",i*e)}this._lastPlayheadPosition=-1}))})),["playing","hb"].forEach((function(t){e.on(t,(function(){this._lastPlayheadPosition=this.data.player_playhead_time,this._lastPlayerWidth=this.data.player_width,this._lastPlayerHeight=this.data.player_height,this._lastSourceWidth=this.data.video_source_width,this._lastSourceHeight=this.data.video_source_height}))}))};var n=function(e){return e&&e.__esModule?e:{default:e}}(r(2))},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){this.isSeeking=!1,this.on("seeking",(function(e,t){(0,a.default)(this.data,t),this._lastSeekingTime=i.default.now(),!1===this.isSeeking&&(this.isSeeking=!0,this.send("seeking"))})),this.on("seeked",(function(){this.isSeeking=!1;var e=this._lastSeekingTime||i.default.now(),t=i.default.now()-e;(0,o.default)(this.data,"view_seek_count",1),(0,o.default)(this.data,"view_seek_duration",t);var r=this.data.view_max_seek_time||0;this.data.view_max_seek_time=Math.max(r,t)})),this.on("viewend",(function(){this.isSeeking=!1}))};var i=n(r(3)),o=n(r(2)),a=n(r(1))},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=n(r(2)),a=r(5),s=n(r(1)),u=function(e,t){e.push(t),e.sort((function(e,t){return e.viewer_time-t.viewer_time}))},l=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror"],c=function(){var e=this;this.on("viewinit",(function(){this.isAdBreak=!1,this._currentAdRequestNumber=0,this._currentAdResponseNumber=0,this._adRequests=[],this._adResponses=[],this._adHasPlayed=!1,this._wouldBeNewAdPlay=!0,this._prerollPlayTime=void 0})),l.forEach((function(t){return e.on(t,e._updateAdData)}));var t=function(){e.isAdBreak=!1};this.on("adbreakstart",(function(){this.isAdBreak=!0})),this.on("play",t),this.on("playing",t),this.on("viewend",t),this.on("adrequest",(function(e,t){t=(0,s.default)({ad_request_id:"generatedAdRequestId"+this._currentAdRequestNumber++},t),u(this._adRequests,t),(0,o.default)(this.data,"view_ad_request_count"),this.inPrerollPosition()&&(this.data.view_preroll_requested=!0,this._adHasPlayed||(0,o.default)(this.data,"view_preroll_request_count"))})),this.on("adresponse",(function(e,t){t=(0,s.default)({ad_request_id:"generatedAdRequestId"+this._currentAdResponseNumber++},t),u(this._adResponses,t);var r=this.findAdRequest(t.ad_request_id);r&&(0,o.default)(this.data,"view_ad_request_time",Math.max(0,t.viewer_time-r.viewer_time))})),this.on("adplay",(function(e,t){this._adHasPlayed=!0,this._wouldBeNewAdPlay&&(this._wouldBeNewAdPlay=!1,(0,o.default)(this.data,"view_ad_played_count")),this.inPrerollPosition()&&!this.data.view_preroll_played&&(this.data.view_preroll_played=!0,this._adRequests.length>0&&(this.data.view_preroll_request_time=Math.max(0,t.viewer_time-this._adRequests[0].viewer_time)),this.data.view_start&&(this.data.view_startup_preroll_request_time=Math.max(0,t.viewer_time-this.data.view_start)),this._prerollPlayTime=t.viewer_time)})),this.on("adplaying",(function(e,t){this.inPrerollPosition()&&void 0===this.data.view_preroll_load_time&&void 0!==this._prerollPlayTime&&(this.data.view_preroll_load_time=t.viewer_time-this._prerollPlayTime,this.data.view_startup_preroll_load_time=t.viewer_time-this._prerollPlayTime)})),this.on("adended",(function(){this._wouldBeNewAdPlay=!0})),this.on("aderror",(function(){this._wouldBeNewAdPlay=!0}))};c.prototype.inPrerollPosition=function(){return void 0===this.data.view_content_playback_time||this.data.view_content_playback_time<=1e3},c.prototype.findAdRequest=function(e){for(var t=0;t<this._adRequests.length;t++)if(this._adRequests[t].ad_request_id===e)return this._adRequests[t]},c.prototype._updateAdData=function(e,t){if(this.inPrerollPosition()){if(!this.data.view_preroll_ad_tag_hostname&&t.ad_tag_url){var r=(0,a.extractHostnameAndDomain)(t.ad_tag_url),n=i(r,2),o=n[0],s=n[1];this.data.view_preroll_ad_tag_domain=s,this.data.view_preroll_ad_tag_hostname=o}if(!this.data.view_preroll_ad_asset_hostname&&t.ad_asset_url){var u=(0,a.extractHostnameAndDomain)(t.ad_asset_url),l=i(u,2),c=l[0],d=l[1];this.data.view_preroll_ad_asset_domain=d,this.data.view_preroll_ad_asset_hostname=c}}},t.default=c},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=this,t=void 0,r=void 0,n=function(){e.disableRebufferTracking||t&&((0,o.default)(e.data,"view_waiting_rebuffer_duration",i.default.now()-t),t=!1,window.clearInterval(r))},a=!1,s=function(){a=!1,n()};this.on("waiting",(function(){a&&(e.disableRebufferTracking||((0,o.default)(e.data,"view_waiting_rebuffer_count",1),t=i.default.now(),r=window.setInterval((function(){if(t){var r=i.default.now();(0,o.default)(e.data,"view_waiting_rebuffer_duration",r-t),t=r}}),250)))})),this.on("playing",(function(){n(),a=!0})),this.on("pause",s),this.on("seeking",s)};var i=n(r(3)),o=n(r(2))},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=this;this.one("playbackheartbeat",a),this.on("playbackheartbeatend",(function(){e.off("before*",s),e.one("playbackheartbeat",a)}))};var i=n(r(1)),o=n(r(3)),a=function(){this.lastWallClockTime=o.default.now(),this.on("before*",s)},s=function(e){var t=o.default.now(),r=this.lastWallClockTime;this.lastWallClockTime=t,t-r>3e4&&(this.emit("devicesleep",{viewer_time:r}),(0,i.default)(this.data,{viewer_time:r}),this.send("devicesleep"),this.emit("devicewake",{viewer_time:t}),(0,i.default)(this.data,{viewer_time:t}),this.send("devicewake"))}},function(e,t,r){function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==n(Symbol.iterator)?function(e){return n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},a=i(r(0)),s=r(43),u=i(r(4)),l=i(r(56)),c=i(r(13)),d=i(r(57)),_=i(r(17)),p=i(r(58)),f=i(r(1)),h=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],v=["viewstart","error","ended","viewend"],y=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.mux=e,this.envKey=t,this.eventQueue=new p.default((0,l.default)(t,r.beaconDomain)),this.previousBeaconData=null,this.lastEventTime=null,this.sampleRate=r.sampleRate,this.disableCookies=r.disableCookies,this.respectDoNotTrack=r.respectDoNotTrack;var n=r.platform||{};this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:n.name,viewer_application_version:n.version,viewer_application_engine:n.layout,viewer_device_name:n.product,viewer_device_category:"",viewer_device_manufacturer:n.manufacturer,viewer_os_family:n.os&&n.os.family,viewer_os_architecture:n.os&&n.os.architecture,viewer_os_version:n.os&&n.os.version};var i=(0,d.default)();i&&(this.pageLevelData=(0,f.default)(this.pageLevelData,{viewer_connection_type:i})),void 0!==a.default&&a.default.location&&a.default.location.href&&(this.pageLevelData.page_url=a.default.location.href),this.viewerData=this.disableCookies?{}:(0,s.getAndUpdateViewerData)()};y.prototype.send=function(e,t){if(e){if(this.respectDoNotTrack&&(0,c.default)())return u.default.info("Not sending `"+e+"` because Do Not Track is enabled");if(!t||"object"!==(void 0===t?"undefined":o(t)))return u.default.error("A data object was expected in send() but was not provided");var r=this.disableCookies?{}:(0,s.getAndUpdateSessionData)(),n={};(0,f.default)(n,this.pageLevelData),(0,f.default)(n,t),(0,f.default)(n,r),(0,f.default)(n,this.viewerData),n.event=e,n.env_key=this.envKey,n.user_id&&(n.viewer_user_id=n.user_id,delete n.user_id);var i=n.mux_sample_number>=this.sampleRate,a=this._deduplicateBeaconData(e,n),l=(0,_.default)(a);if(this.lastEventTime=this.mux.utils.now(),i)return u.default.info("Not sending event due to sample rate restriction",e,n,l);if(!this.envKey)return u.default.info("Not sending event due to missing environment key",e,n,l);if(!this.rateLimited)if(u.default.info("Sending event",e,n,l),this.rateLimited=!this.eventQueue.queueEvent(e,l),this.mux.WINDOW_UNLOADING&&"viewend"===e)this.eventQueue.destroy(!0);else if(v.indexOf(e)>=0&&this.eventQueue.flushEvents(),this.rateLimited)return n.event="eventrateexceeded",l=(0,_.default)(n),this.eventQueue.queueEvent(n.event,l),u.default.error("Beaconing disabled due to rate limit.")}},y.prototype.destroy=function(){this.eventQueue.destroy(!1)};var m=function(e,t,r,n){return!(!e||0!==t.indexOf("request_")||"request_response_headers"!==t&&"object"===(void 0===r?"undefined":o(r))&&"object"===(void 0===n?"undefined":o(n))&&Object.keys(r||{}).length===Object.keys(n||{}).length)};y.prototype._deduplicateBeaconData=function(e,t){var r=this,n={},i=t.view_id;if(!i||"viewstart"===e||"viewend"===e||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)n=(0,f.default)({},t),i&&(this.previousBeaconData=n),i&&"viewend"===e&&(this.previousBeaconData=null);else{var o=0===e.indexOf("request");Object.keys(t).forEach((function(i){var a=t[i];(a!==r.previousBeaconData[i]||h.indexOf(i)>-1||m(o,i,a,r.previousBeaconData[i])||function(e,t){return"renditionchange"===e&&0===t.indexOf("video_source_")}(e,i))&&(n[i]=a,r.previousBeaconData[i]=a)}))}return n},t.default=y},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getAndUpdateSessionData=t.getAndUpdateViewerData=void 0;var i=n(r(15)),o=n(r(55)),a=r(7),s=n(r(3)),u=function(){var e=void 0;try{e=i.default.parse(o.default.get("muxData")||"")}catch(t){e={}}return e},l=function(e){try{o.default.set("muxData",i.default.stringify(e),{expires:7300})}catch(e){}};t.getAndUpdateViewerData=function(){var e=u();return e.mux_viewer_id=e.mux_viewer_id||(0,a.generateUUID)(),e.msn=e.msn||Math.random(),l(e),{mux_viewer_id:e.mux_viewer_id,mux_sample_number:e.msn}},t.getAndUpdateSessionData=function(){var e=u(),t=s.default.now();return e.session_start&&(e.sst=e.session_start,delete e.session_start),e.session_id&&(e.sid=e.session_id,delete e.session_id),e.session_expires&&(e.sex=e.session_expires,delete e.session_expires),(!e.sex||e.sex<t)&&(e.sid=(0,a.generateUUID)(),e.sst=t),e.sex=t+15e5,l(e),{session_id:e.sid,session_start:e.sst,session_expires:e.sex}}},function(e,t,r){var i=r(45),o=r(16),a=r(11),s=Object.prototype.hasOwnProperty,u={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},l=Array.isArray,c=Array.prototype.push,d=function(e,t){c.apply(e,l(t)?t:[t])},_=Date.prototype.toISOString,p=a.default,f={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:o.encode,encodeValuesOnly:!1,format:p,formatter:a.formatters[p],indices:!1,serializeDate:function(e){return _.call(e)},skipNulls:!1,strictNullHandling:!1},h=function e(t,r,a,s,u,c,_,p,h,v,y,m,E,g,R){var T=t;if(R.has(t))throw new RangeError("Cyclic object value");if("function"==typeof _?T=_(r,T):T instanceof Date?T=v(T):"comma"===a&&l(T)&&(T=o.maybeMap(T,(function(e){return e instanceof Date?v(e):e}))),null===T){if(s)return c&&!E?c(r,f.encoder,g,"key",y):r;T=""}if(function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||"symbol"==n(e)||"bigint"==typeof e}(T)||o.isBuffer(T))return c?[m(E?r:c(r,f.encoder,g,"key",y))+"="+m(c(T,f.encoder,g,"value",y))]:[m(r)+"="+m(String(T))];var I,S=[];if(void 0===T)return S;if("comma"===a&&l(T))I=[{value:T.length>0?T.join(",")||null:void 0}];else if(l(_))I=_;else{var P=Object.keys(T);I=p?P.sort(p):P}for(var b=0;b<I.length;++b){var A=I[b],L="object"==n(A)&&void 0!==A.value?A.value:T[A];if(!u||null!==L){var C=l(T)?"function"==typeof a?a(r,A):r:r+(h?"."+A:"["+A+"]");R.set(t,!0);var O=i();d(S,e(L,C,a,s,u,c,_,p,h,v,y,m,E,g,O))}}return S},v=function(e){if(!e)return f;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||f.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=a.default;if(void 0!==e.format){if(!s.call(a.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var n=a.formatters[r],i=f.filter;return("function"==typeof e.filter||l(e.filter))&&(i=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:f.addQueryPrefix,allowDots:void 0===e.allowDots?f.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:f.charsetSentinel,delimiter:void 0===e.delimiter?f.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:f.encode,encoder:"function"==typeof e.encoder?e.encoder:f.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:f.encodeValuesOnly,filter:i,format:r,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:f.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:f.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:f.strictNullHandling}};e.exports=function(e,t){var r,o=e,a=v(t);"function"==typeof a.filter?o=(0,a.filter)("",o):l(a.filter)&&(r=a.filter);var s,c=[];if("object"!=n(o)||null===o)return"";s=t&&t.arrayFormat in u?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var _=u[s];r||(r=Object.keys(o)),a.sort&&r.sort(a.sort);for(var p=i(),f=0;f<r.length;++f){var y=r[f];a.skipNulls&&null===o[y]||d(c,h(o[y],y,_,a.strictNullHandling,a.skipNulls,a.encode?a.encoder:null,a.filter,a.sort,a.allowDots,a.serializeDate,a.format,a.formatter,a.encodeValuesOnly,a.charset,p))}var m=c.join(a.delimiter),E=!0===a.addQueryPrefix?"?":"";return a.charsetSentinel&&("iso-8859-1"===a.charset?E+="utf8=%26%2310003%3B&":E+="utf8=%E2%9C%93&"),m.length>0?E+m:""}},function(e,t,r){var i=r(9),o=r(50),a=r(52),s=i("%TypeError%"),u=i("%WeakMap%",!0),l=i("%Map%",!0),c=o("WeakMap.prototype.get",!0),d=o("WeakMap.prototype.set",!0),_=o("WeakMap.prototype.has",!0),p=o("Map.prototype.get",!0),f=o("Map.prototype.set",!0),h=o("Map.prototype.has",!0),v=function(e,t){for(var r,n=e;null!==(r=n.next);n=r)if(r.key===t)return n.next=r.next,r.next=e.next,e.next=r,r};e.exports=function(){var e,t,r,i={assert:function(e){if(!i.has(e))throw new s("Side channel does not contain "+a(e))},get:function(i){if(u&&i&&("object"==n(i)||"function"==typeof i)){if(e)return c(e,i)}else if(l){if(t)return p(t,i)}else if(r)return function(e,t){var r=v(e,t);return r&&r.value}(r,i)},has:function(i){if(u&&i&&("object"==n(i)||"function"==typeof i)){if(e)return _(e,i)}else if(l){if(t)return h(t,i)}else if(r)return function(e,t){return!!v(e,t)}(r,i);return!1},set:function(i,o){u&&i&&("object"==n(i)||"function"==typeof i)?(e||(e=new u),d(e,i,o)):l?(t||(t=new l),f(t,i,o)):(r||(r={key:{},next:null}),function(e,t,r){var n=v(e,t);n?n.value=r:e.next={key:t,next:e.next,value:r}}(r,i,o))}};return i}},function(e,t,r){var i="undefined"!=typeof Symbol&&Symbol,o=r(47);e.exports=function(){return"function"==typeof i&&"function"==typeof Symbol&&"symbol"==n(i("foo"))&&"symbol"==n(Symbol("bar"))&&o()}},function(e,t,r){e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==n(Symbol.iterator))return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var i=Object.getOwnPropertySymbols(e);if(1!==i.length||i[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(42!==o.value||!0!==o.enumerable)return!1}return!0}},function(e,t,r){var n=Array.prototype.slice,i=Object.prototype.toString;e.exports=function(e){var t=this;if("function"!=typeof t||"[object Function]"!==i.call(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var r,o=n.call(arguments,1),a=function(){if(this instanceof r){var i=t.apply(this,o.concat(n.call(arguments)));return Object(i)===i?i:this}return t.apply(e,o.concat(n.call(arguments)))},s=Math.max(0,t.length-o.length),u=[],l=0;l<s;l++)u.push("$"+l);if(r=Function("binder","return function ("+u.join(",")+"){ return binder.apply(this,arguments); }")(a),t.prototype){var c=function(){};c.prototype=t.prototype,r.prototype=new c,c.prototype=null}return r}},function(e,t,r){var n=r(10);e.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},function(e,t,r){var n=r(9),i=r(51),o=i(n("String.prototype.indexOf"));e.exports=function(e,t){var r=n(e,!!t);return"function"==typeof r&&o(e,".prototype.")>-1?i(r):r}},function(e,t,r){var n=r(10),i=r(9),o=i("%Function.prototype.apply%"),a=i("%Function.prototype.call%"),s=i("%Reflect.apply%",!0)||n.call(a,o),u=i("%Object.getOwnPropertyDescriptor%",!0),l=i("%Object.defineProperty%",!0),c=i("%Math.max%");if(l)try{l({},"a",{value:1})}catch(e){l=null}e.exports=function(e){var t=s(n,a,arguments);return u&&l&&u(t,"length").configurable&&l(t,"length",{value:1+c(0,e.length-(arguments.length-1))}),t};var d=function(){return s(n,o,arguments)};l?l(e.exports,"apply",{value:d}):e.exports.apply=d},function(e,t,r){function i(e,t,r){var n="double"===(r.quoteStyle||t)?'"':"'";return n+e+n}function o(e){return String(e).replace(/"/g,"&quot;")}function a(e){return!("[object Array]"!==l(e)||q&&"object"==n(e)&&q in e)}function s(e){if(j)return e&&"object"==n(e)&&e instanceof Symbol;if("symbol"==n(e))return!0;if(!e||"object"!=n(e)||!H)return!1;try{return H.call(e),!0}catch(e){}return!1}function u(e,t){return K.call(e,t)}function l(e){return k.call(e)}function c(e){if(e.name)return e.name;var t=w.call(U.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function d(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function _(e){if(!O||!e||"object"!=n(e))return!1;try{O.call(e,O);try{N.call(e,N)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}function p(e){if(!D||!e||"object"!=n(e))return!1;try{return D.call(e),!0}catch(e){}return!1}function f(e){if(!N||!e||"object"!=n(e))return!1;try{N.call(e,N);try{O.call(e,O)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}function h(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return h(e.slice(0,t.maxStringLength),t)+n}return i(e.replace(/(['\\])/g,"\\$1").replace(/[\x00-\x1f]/g,v),"single",t)}function v(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+t.toString(16).toUpperCase()}function y(e){return"Object("+e+")"}function m(e){return e+" { ? }"}function E(e,t,r,n){return e+" ("+t+") {"+(n?g(r,n):r.join(", "))+"}"}function g(e,t){if(0===e.length)return"";var r="\n"+t.prev+t.base;return r+e.join(","+r)+"\n"+t.prev}function R(e,t){var r=a(e),n=[];if(r){n.length=e.length;for(var i=0;i<e.length;i++)n[i]=u(e,i)?t(e[i],e):""}var o,s="function"==typeof x?x(e):[];if(j){o={};for(var l=0;l<s.length;l++)o["$"+s[l]]=s[l]}for(var c in e)u(e,c)&&(r&&String(Number(c))===c&&c<e.length||j&&o["$"+c]instanceof Symbol||(/[^\w$]/.test(c)?n.push(t(c,e)+": "+t(e[c],e)):n.push(c+": "+t(e[c],e))));if("function"==typeof x)for(var d=0;d<s.length;d++)B.call(e,s[d])&&n.push("["+t(s[d])+"]: "+t(e[s[d]],e));return n}var T="function"==typeof Map&&Map.prototype,I=Object.getOwnPropertyDescriptor&&T?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,S=T&&I&&"function"==typeof I.get?I.get:null,P=T&&Map.prototype.forEach,b="function"==typeof Set&&Set.prototype,A=Object.getOwnPropertyDescriptor&&b?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,L=b&&A&&"function"==typeof A.get?A.get:null,C=b&&Set.prototype.forEach,O="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,N="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,D="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,M=Boolean.prototype.valueOf,k=Object.prototype.toString,U=Function.prototype.toString,w=String.prototype.match,F="function"==typeof BigInt?BigInt.prototype.valueOf:null,x=Object.getOwnPropertySymbols,H="function"==typeof Symbol&&"symbol"==n(Symbol.iterator)?Symbol.prototype.toString:null,j="function"==typeof Symbol&&"object"==n(Symbol.iterator),B=Object.prototype.propertyIsEnumerable,Y=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null),V=r(53).custom,G=V&&s(V)?V:null,q="function"==typeof Symbol&&void 0!==Symbol.toStringTag?Symbol.toStringTag:null;e.exports=function e(t,r,v,T){function I(t,r,n){if(r&&(T=T.slice()).push(r),n){var i={depth:b.depth};return u(b,"quoteStyle")&&(i.quoteStyle=b.quoteStyle),e(t,i,v+1,T)}return e(t,b,v+1,T)}var b=r||{};if(u(b,"quoteStyle")&&"single"!==b.quoteStyle&&"double"!==b.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(u(b,"maxStringLength")&&("number"==typeof b.maxStringLength?b.maxStringLength<0&&b.maxStringLength!==1/0:null!==b.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var A=!u(b,"customInspect")||b.customInspect;if("boolean"!=typeof A&&"symbol"!==A)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(u(b,"indent")&&null!==b.indent&&"\t"!==b.indent&&!(parseInt(b.indent,10)===b.indent&&b.indent>0))throw new TypeError('options "indent" must be "\\t", an integer > 0, or `null`');if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return h(t,b);if("number"==typeof t)return 0===t?1/0/t>0?"0":"-0":String(t);if("bigint"==typeof t)return String(t)+"n";var O=void 0===b.depth?5:b.depth;if(void 0===v&&(v=0),v>=O&&O>0&&"object"==n(t))return a(t)?"[Array]":"[Object]";var N=function(e,t){var r;if("\t"===e.indent)r="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;r=Array(e.indent+1).join(" ")}return{base:r,prev:Array(t+1).join(r)}}(b,v);if(void 0===T)T=[];else if(d(T,t)>=0)return"[Circular]";if("function"==typeof t){var D=c(t),k=R(t,I);return"[Function"+(D?": "+D:" (anonymous)")+"]"+(k.length>0?" { "+k.join(", ")+" }":"")}if(s(t)){var U=j?String(t).replace(/^(Symbol\(.*\))_[^)]*$/,"$1"):H.call(t);return"object"!=n(t)||j?U:y(U)}if(function(e){return!(!e||"object"!=n(e))&&("undefined"!=typeof HTMLElement&&e instanceof HTMLElement||"string"==typeof e.nodeName&&"function"==typeof e.getAttribute)}(t)){for(var w="<"+String(t.nodeName).toLowerCase(),x=t.attributes||[],B=0;B<x.length;B++)w+=" "+x[B].name+"="+i(o(x[B].value),"double",b);return w+=">",t.childNodes&&t.childNodes.length&&(w+="..."),w+"</"+String(t.nodeName).toLowerCase()+">"}if(a(t)){if(0===t.length)return"[]";var V=R(t,I);return N&&!function(e){for(var t=0;t<e.length;t++)if(d(e[t],"\n")>=0)return!1;return!0}(V)?"["+g(V,N)+"]":"[ "+V.join(", ")+" ]"}if(function(e){return!("[object Error]"!==l(e)||q&&"object"==n(e)&&q in e)}(t)){var K=R(t,I);return 0===K.length?"["+String(t)+"]":"{ ["+String(t)+"] "+K.join(", ")+" }"}if("object"==n(t)&&A){if(G&&"function"==typeof t[G])return t[G]();if("symbol"!==A&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!S||!e||"object"!=n(e))return!1;try{S.call(e);try{L.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var W=[];return P.call(t,(function(e,r){W.push(I(r,t,!0)+" => "+I(e,t))})),E("Map",S.call(t),W,N)}if(function(e){if(!L||!e||"object"!=n(e))return!1;try{L.call(e);try{S.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var Q=[];return C.call(t,(function(e){Q.push(I(e,t))})),E("Set",L.call(t),Q,N)}if(_(t))return m("WeakMap");if(f(t))return m("WeakSet");if(p(t))return m("WeakRef");if(function(e){return!("[object Number]"!==l(e)||q&&"object"==n(e)&&q in e)}(t))return y(I(Number(t)));if(function(e){if(!e||"object"!=n(e)||!F)return!1;try{return F.call(e),!0}catch(e){}return!1}(t))return y(I(F.call(t)));if(function(e){return!("[object Boolean]"!==l(e)||q&&"object"==n(e)&&q in e)}(t))return y(M.call(t));if(function(e){return!("[object String]"!==l(e)||q&&"object"==n(e)&&q in e)}(t))return y(I(String(t)));if(!function(e){return!("[object Date]"!==l(e)||q&&"object"==n(e)&&q in e)}(t)&&!function(e){return!("[object RegExp]"!==l(e)||q&&"object"==n(e)&&q in e)}(t)){var X=R(t,I),z=Y?Y(t)===Object.prototype:t instanceof Object||t.constructor===Object,J=t instanceof Object?"":"null prototype",Z=!z&&q&&Object(t)===t&&q in t?l(t).slice(8,-1):J?"Object":"",$=(z||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(Z||J?"["+[].concat(Z||[],J||[]).join(": ")+"] ":"");return 0===X.length?$+"{}":N?$+"{"+g(X,N)+"}":$+"{ "+X.join(", ")+" }"}return String(t)};var K=Object.prototype.hasOwnProperty||function(e){return e in this}},function(e,t){},function(e,t,r){var n=r(16),i=Object.prototype.hasOwnProperty,o=Array.isArray,a={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},s=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},u=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},l=function(e,t){var r,l={},c=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,d=t.parameterLimit===1/0?void 0:t.parameterLimit,_=c.split(t.delimiter,d),p=-1,f=t.charset;if(t.charsetSentinel)for(r=0;r<_.length;++r)0===_[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===_[r]?f="utf-8":"utf8=%26%2310003%3B"===_[r]&&(f="iso-8859-1"),p=r,r=_.length);for(r=0;r<_.length;++r)if(r!==p){var h,v,y=_[r],m=y.indexOf("]="),E=-1===m?y.indexOf("="):m+1;-1===E?(h=t.decoder(y,a.decoder,f,"key"),v=t.strictNullHandling?null:""):(h=t.decoder(y.slice(0,E),a.decoder,f,"key"),v=n.maybeMap(u(y.slice(E+1),t),(function(e){return t.decoder(e,a.decoder,f,"value")}))),v&&t.interpretNumericEntities&&"iso-8859-1"===f&&(v=s(v)),y.indexOf("[]=")>-1&&(v=o(v)?[v]:v),i.call(l,h)?l[h]=n.combine(l[h],v):l[h]=v}return l},c=function(e,t,r,n){for(var i=n?t:u(t,r),o=e.length-1;o>=0;--o){var a,s=e[o];if("[]"===s&&r.parseArrays)a=[].concat(i);else{a=r.plainObjects?Object.create(null):{};var l="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,c=parseInt(l,10);r.parseArrays||""!==l?!isNaN(c)&&s!==l&&String(c)===l&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(a=[])[c]=i:a[l]=i:a={0:i}}i=a}return i},d=function(e,t,r,n){if(e){var o=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,a=/(\[[^[\]]*])/g,s=r.depth>0&&/(\[[^[\]]*])/.exec(o),u=s?o.slice(0,s.index):o,l=[];if(u){if(!r.plainObjects&&i.call(Object.prototype,u)&&!r.allowPrototypes)return;l.push(u)}for(var d=0;r.depth>0&&null!==(s=a.exec(o))&&d<r.depth;){if(d+=1,!r.plainObjects&&i.call(Object.prototype,s[1].slice(1,-1))&&!r.allowPrototypes)return;l.push(s[1])}return s&&l.push("["+o.slice(s.index)+"]"),c(l,t,r,n)}},_=function(e){if(!e)return a;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?a.charset:e.charset;return{allowDots:void 0===e.allowDots?a.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:a.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:a.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:a.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:a.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:a.comma,decoder:"function"==typeof e.decoder?e.decoder:a.decoder,delimiter:"string"==typeof e.delimiter||n.isRegExp(e.delimiter)?e.delimiter:a.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:a.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:a.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:a.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:a.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:a.strictNullHandling}};e.exports=function(e,t){var r=_(t);if(""===e||null==e)return r.plainObjects?Object.create(null):{};for(var i="string"==typeof e?l(e,r):e,o=r.plainObjects?Object.create(null):{},a=Object.keys(i),s=0;s<a.length;++s){var u=a[s],c=d(u,i[u],r,"string"==typeof e);o=n.merge(o,c,r)}return!0===r.allowSparse?o:n.compact(o)}},function(e,t,r){var i,o,a="function"==typeof Symbol&&"symbol"==n(Symbol.iterator)?function(e){return n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)};!function(n){var s=!1;if(void 0!==(o="function"==typeof(i=n)?i.call(t,r,t,e):i)&&(e.exports=o),s=!0,"object"===a(t)&&(e.exports=n(),s=!0),!s){var u=window.Cookies,l=window.Cookies=n();l.noConflict=function(){return window.Cookies=u,l}}}((function(){var e=function(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t};return function t(r){function n(t,i,o){var a;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(o=e({path:"/"},n.defaults,o)).expires){var s=new Date;s.setMilliseconds(s.getMilliseconds()+864e5*o.expires),o.expires=s}try{a=JSON.stringify(i),/^[\{\[]/.test(a)&&(i=a)}catch(t){}return i=r.write?r.write(i,t):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[t,"=",i,o.expires?"; expires="+o.expires.toUTCString():"",o.path?"; path="+o.path:"",o.domain?"; domain="+o.domain:"",o.secure?"; secure":""].join("")}t||(a={});for(var u=document.cookie?document.cookie.split("; "):[],l=/(%[0-9A-Z]{2})+/g,c=0;c<u.length;c++){var d=u[c].split("="),_=d.slice(1).join("=");'"'===_.charAt(0)&&(_=_.slice(1,-1));try{var p=d[0].replace(l,decodeURIComponent);if(_=r.read?r.read(_,p):r(_,p)||_.replace(l,decodeURIComponent),this.json)try{_=JSON.parse(_)}catch(t){}if(t===p){a=_;break}t||(a[p]=_)}catch(t){}}return a}}return n.set=n,n.get=function(e){return n.call(n,e)},n.getJSON=function(){return n.apply({json:!0},[].slice.call(arguments))},n.defaults={},n.remove=function(t,r){n(t,"",e(r,{expires:-1}))},n.withConverter=t,n}((function(){}))}))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return t=t||"litix.io",(e=e||"").match(/^[a-z0-9]+$/)?"https://"+e+"."+t:"https://img.litix.io/a.gif"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),i=function(){var e=n.default.navigator,t=e&&(e.connection||e.mozConnection||e.webkitConnection);return t&&t.type};t.default=function(){var e=void 0;switch(i()){case"cellular":e="cellular";break;case"ethernet":e="wired";break;case"wifi":e="wifi";break;case void 0:break;default:e="other"}return e}},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(0)),o=n(r(4)),a=n(r(59)),s=n(r(1)),u=n(r(17)),l=!!i.default.XMLHttpRequest&&"withCredentials"in new i.default.XMLHttpRequest,c={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:5e3},d=function(e,t){this._beaconUrl=e||"https://img.litix.io",this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=(0,s.default)({},c,t)};d.prototype.queueEvent=function(e,t){var r=(0,s.default)({},t);return l?(this._eventQueue.length<=this._options.maxQueueLength||"eventrateexceeded"===e)&&(this._eventQueue.push(r),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength):(a.default.send(this._beaconUrl,r),!0)},d.prototype.flushEvents=function(){l&&(this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending())},d.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.destroyed=!0,e?this._clearBeaconQueue():this.flushEvents(),i.default.clearTimeout(this._sendTimeout)},d.prototype._clearBeaconQueue=function(){var e=i.default.navigator,t=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,r=this._eventQueue.slice(t);if(t>0&&(0,s.default)(r[r.length-1],(0,u.default)({mux_view_message:"event queue truncated"})),e.sendBeacon)e.sendBeacon(this._beaconUrl,JSON.stringify({events:r}));else if(i.default.XMLHttpRequest){var n=new i.default.XMLHttpRequest;n.open("POST",this._beaconUrl),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify({events:r}))}else a.default.send(this._beaconUrl,r[r.length-1])},d.prototype._sendBeaconQueue=function(){var e=this;if(i.default.XMLHttpRequest&&!this._postInFlight){var t=new i.default.XMLHttpRequest,r=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0,t.onreadystatechange=function(){4===t.readyState&&(200!==t.status?(e._eventQueue=r.concat(e._eventQueue),e._failureCount+=1,o.default.info("Error sending beacon: "+t.status),o.default.info(t.responseText)):e._failureCount=0,e._postInFlight=!1)},t.open("POST",this._beaconUrl),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify({events:r}))}},d.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var e=Math.pow(2,this._failureCount-1);return(1+(e*=Math.random()))*this._options.baseTimeBetweenBeacons},d.prototype._startBeaconSending=function(){var e=this;i.default.clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=i.default.setTimeout((function(){e._eventQueue.length&&e._sendBeaconQueue(),e._startBeaconSending()}),this._getNextBeaconTime()))},t.default=d},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(15)),o=n(r(0)),a={send:function(e,t){function r(){n.src=s+(a?"&rc="+a:"")}var n=new Image,a=0,s=e+"?"+i.default.stringify(t);return n.addEventListener("error",(function(){a>3||o.default.setTimeout((function(){a++,r()}),5e3*a)})),r(),n}};t.default=a},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=0,t=0,r=0,n=0,i=0,o=0,a=0;this.on("requestcompleted",(function(o,a){var s=a.request_start,u=a.request_response_start,l=a.request_response_end,c=a.request_bytes_loaded;n++;var d=void 0,_=void 0;if(u?(d=u-s,_=l-u):_=l-s,_>0&&c>0){var p=c/_*8e3;i++,t+=c,r+=_,this.data.view_min_request_throughput=Math.min(this.data.view_min_request_throughput||1/0,p),this.data.view_average_request_throughput=t/r*8e3,this.data.view_request_count=n,d>0&&(e+=d,this.data.view_max_request_latency=Math.max(this.data.view_max_request_latency||0,d),this.data.view_average_request_latency=e/i)}})),this.on("requestfailed",(function(e,t){n++,o++,this.data.view_request_count=n,this.data.view_request_failed_count=o})),this.on("requestcanceled",(function(e,t){n++,a++,this.data.view_request_count=n,this.data.view_request_canceled_count=a}))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==n(Symbol.iterator)?function(e){return n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};t.default=function(e,t,r){var n=(0,s.findMediaElement)(t),c=o(n,3),d=c[0],_=c[1],p=c[2],f=e.log,h=e.utils.getComputedStyle,v=e.utils.secondsToMs;if(!d)return f.error("No element was found with the `"+_+"` query selector.");if("video"!==p&&"audio"!==p)return f.error("The element of `"+_+"` was not a media element.");(r=(0,a.default)({automaticErrorTracking:!0},r)).data=(0,a.default)({player_software:"HTML5 Video Element",player_software_version:"No Versions",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:"4.2.3"},r.data),r.getPlayheadTime=function(){return v(d.currentTime)},r.getStateData=function(){var e=this.hlsjs&&this.hlsjs.url,t=this.dashjs&&i("function"===this.dashjs.getSource)&&this.dashjs.getSource();return{player_is_paused:d.paused,player_playhead_time:v(d.currentTime),player_width:parseInt(h(d,"width")),player_height:parseInt(h(d,"height")),player_autoplay_on:d.autoplay,player_preload_on:d.preload,video_poster_url:d.poster,video_source_url:e||t||d.currentSrc,video_source_duration:v(d.duration),video_source_height:d.videoHeight,video_source_width:d.videoWidth}},d.mux=d.mux||{},d.mux.deleted=!1,d.mux.emit=function(t,r){e.emit(_,t,r)};var y=function(){f.error("The monitor for this video element has already been destroyed.")};d.mux.destroy=function(){Object.keys(d.mux.listeners).forEach((function(e){d.removeEventListener(e,d.mux.listeners[e],!1)})),delete d.mux.listeners,d.mux.destroy=y,d.mux.swapElement=y,d.mux.emit=y,d.mux.addHLSJS=y,d.mux.addDashJS=y,d.mux.removeHLSJS=y,d.mux.removeDashJS=y,d.mux.deleted=!0,e.emit(_,"destroy")},d.mux.swapElement=function(t){var r=(0,s.findMediaElement)(t),n=o(r,3),i=n[0],u=n[1],l=n[2];return i?"video"!==l&&"audio"!==l?e.log.error("The element of `"+u+"` was not a media element."):(i.muxId=d.muxId,delete d.muxId,i.mux=i.mux||{},i.mux.listeners=(0,a.default)({},d.mux.listeners),delete d.mux.listeners,Object.keys(i.mux.listeners).forEach((function(e){d.removeEventListener(e,i.mux.listeners[e],!1),i.addEventListener(e,i.mux.listeners[e],!1)})),i.mux.swapElement=d.mux.swapElement,i.mux.destroy=d.mux.destroy,delete d.mux,void(d=i)):e.log.error("No element was found with the `"+u+"` query selector.")},d.mux.addHLSJS=function(t){e.addHLSJS(_,t)},d.mux.addDashJS=function(t){e.addDashJS(_,t)},d.mux.removeHLSJS=function(){e.removeHLSJS(_)},d.mux.removeDashJS=function(){e.removeDashJS(_)},e.init(_,r),e.emit(_,"playerready"),d.paused||(e.emit(_,"play"),d.readyState>2&&e.emit(_,"playing")),d.mux.listeners={},u.forEach((function(t){("error"!==t||r.automaticErrorTracking)&&(d.mux.listeners[t]=function(){var r={};if("error"===t){if(!d.error)return;r.player_error_code=d.error.code,r.player_error_message=l[d.error.code]||d.error.message}e.emit(_,t,r)},d.addEventListener(t,d.mux.listeners[t],!1))}))};var a=function(e){return e&&e.__esModule?e:{default:e}}(r(1)),s=r(12),u=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],l={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"}},function(e,t,r){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(63)),o=n(r(2)),a=n(r(64)),s=n(r(65)),u=n(r(1)),l=n(r(8)),c=r(5),d=n(r(3)),_={};_.safeCall=i.default,_.safeIncrement=o.default,_.getComputedStyle=a.default,_.secondsToMs=s.default,_.assign=u.default,_.headersStringToObject=l.default,_.extractHostnameAndDomain=c.extractHostnameAndDomain,_.extractHostname=c.extractHostname,_.now=d.default.now,t.default=_},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){var o=i;if(e&&"function"==typeof e[t])try{o=e[t].apply(e,r)}catch(e){n.default.info("safeCall error",e)}return o};var n=function(e){return e&&e.__esModule?e:{default:e}}(r(4))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e&&t&&n.default&&"function"==typeof n.default.getComputedStyle){var r=void 0;return i&&i.has(e)&&(r=i.get(e)),r||(r=n.default.getComputedStyle(e,null),i&&i.set(e,r)),r.getPropertyValue(t)}};var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),i=void 0;n.default&&n.default.WeakMap&&(i=new WeakMap)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Math.floor(1e3*e)}}])},"object"==(void 0===r?"undefined":n(r))&&"object"==(void 0===t?"undefined":n(t))?t.exports=i():"object"==(void 0===r?"undefined":n(r))?r.mux=i():e.mux=i()}()},{}],31:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AudioProcessor=void 0;var n=e("tslib"),i=e("@js-sdk/common/es5/debug_tools").logging.forTag("playback.audio_processor"),o=function(){function e(e){this._audioContext=null,this._mediaElementSource=null,this._gainNode=null,this._nodes=[],(null==e?void 0:e.disable)?i.info("AudioProcessor disabled"):(this._audioContext=(null==e?void 0:e.audioContext)||("undefined"!=typeof AudioContext?new AudioContext:null),this._audioContext?(this._gainNode=this._audioContext.createGain(),this._buildNodePipeline(null==e?void 0:e.nodes)):i.warn("The AudioContext API is not supported. Any future operation related to `AudioProcessor` will be skipped."))}return e.create=function(t){return new e(t)},e.prototype._setMediaElementSource=function(e){var t;this._audioContext&&(this._mediaElementSource&&(i.info("Disconnecting previous media element source"),this._mediaElementSource.disconnect()),i.info("Creating new media element source"),this._mediaElementSource=this._audioContext.createMediaElementSource(e)||null,this._mediaElementSource.connect(null!==(t=this._nodes[0])&&void 0!==t?t:this._audioContext.destination))},e.prototype._buildNodePipeline=function(e){var t;if(void 0===e&&(e=[]),this._audioContext){i.info("Disconnecting previous nodes");for(var r=0,o=this._nodes;r<o.length;r++){(c=o[r]).disconnect()}for(var a=n.__spreadArray([this._gainNode],e),s=null,u=0,l=a;u<l.length;u++){var c=l[u];s&&s.connect(c),s=c}null===(t=a[a.length-1])||void 0===t||t.connect(this._audioContext.destination),i.info("Node pipeline built"),this._nodes=a}},e.prototype.setPlayer=function(e){var t;e&&((null===(t=this._mediaElementSource)||void 0===t?void 0:t.mediaElement)!==e?this._setMediaElementSource(e):i.info("The new player is the same as the current player"))},e.prototype.getPlayer=function(){var e;return(null===(e=this._mediaElementSource)||void 0===e?void 0:e.mediaElement)||null},e.prototype.setAudioGain=function(e){if(void 0===e&&(e=0),!this._gainNode)return i.info("The default gain node is not available"),!1;var t=Math.pow(10,e/20);return this._gainNode.gain.value=t,i.info("Main gain set to",t),!0},e.prototype.getAudioContext=function(){return this._audioContext},e.prototype.resume=function(){return this._audioContext&&"running"!==this._audioContext.state?this._audioContext.resume():Promise.resolve()},e.prototype.suspend=function(){return this._audioContext&&"suspended"!==this._audioContext.state?this._audioContext.suspend():Promise.resolve()},e.prototype.destroy=function(){var e;this._audioContext&&(null===(e=this._mediaElementSource)||void 0===e||e.connect(this._audioContext.destination)),this._nodes=[],this._audioContext=null,this._gainNode=null,this._mediaElementSource=null,i.info("The AudioProcessor is destroyed")},e}();r.AudioProcessor=o},{"@js-sdk/common/es5/debug_tools":9,tslib:227}],32:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BandwidthEstimator=void 0;var n=e("./moving_average"),i=function(){function e(e){void 0===e&&(e=4e5),this._totalBytes=0,this._overrideBitrate=0,this._currentBandwidth=e,this._short=new n.MovingAverage(2),this._long=new n.MovingAverage(5),this._init()}return e.prototype._init=function(){if("undefined"!=typeof navigator){var e=navigator;e.connection&&e.connection.downlink&&(this._currentBandwidth=1e6*e.connection.downlink,this._onConnectionChange=this._onConnectionChange.bind(this),e.connection.addEventListener("change",this._onConnectionChange))}},e.prototype._onConnectionChange=function(e){var t=e.target.downlink||0;this._setBandwidth(t)},e.prototype._setBandwidth=function(e){this._currentBandwidth=1e6*e},e.prototype.getBandwidthEstimate=function(){if(this._overrideBitrate)return this._overrideBitrate;if(this._totalBytes<128e3)return this._currentBandwidth;var e=this._short.getEstimate(),t=this._long.getEstimate();return Math.min(e,t)},e.prototype.sample=function(e,t){if(!(e<16e3)){var r=t/1e3,n=8*e/r;this._totalBytes+=e,this._short.sample(r,n),this._long.sample(r,n)}},e.prototype.overrideBitrate=function(e){this._overrideBitrate=e<=0?0:e},e}();r.BandwidthEstimator=i},{"./moving_average":68}],33:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BufferManager=void 0;var n,i=e("tslib"),o=e("@spotify-internal/emitter/es5"),a=e("@spotify-internal/transport/es5"),s=e("@js-sdk/common/es5/monotonic_now"),u=e("../enums/event"),l=e("./media_source_manager"),c=e("./buffer_fill_operation");!function(e){e[e.AUDIO=12]="AUDIO",e[e.VIDEO=20]="VIDEO"}(n||(n={}));var d=function(e){function t(t,r,i){var o,a,s;void 0===r&&(r={}),void 0===i&&(i={});var c=e.call(this)||this;c._bufferTarget={audio:n.AUDIO,video:n.VIDEO},c._currentFillOperation=null,c._bufferedSegmentInfos=null,c._cachedBufferedSegmentInfo=null,c._tracker=t;var d=i.customSourceBufferParams,_=i.noInit,p=i.disableBufferAbort;return c._bufferTarget.audio=(null===(a=i.bufferTarget)||void 0===a?void 0:a.audio)||n.AUDIO,c._bufferTarget.video=(null===(s=i.bufferTarget)||void 0===s?void 0:s.video)||n.VIDEO,c._mediaSourceManager=l.MediaSourceManager.create({mimeTypes:r,noInit:_,customSourceBufferParams:d,disableBufferAbort:p}),c.proxyEmitAll(c._mediaSourceManager,((o={})[u.Event.BUFFER_SOURCE_OPEN]=u.Event.BUFFER_SOURCE_OPEN,o[u.Event.BUFFER_SOURCE_CLOSE]=u.Event.BUFFER_SOURCE_CLOSE,o[u.Event.BUFFER_QUOTA_EXCEEDED]=u.Event.BUFFER_QUOTA_EXCEEDED,o[u.Event.BUFFER_UPDATE_END]=u.Event.BUFFER_UPDATE_END,o)),c}return i.__extends(t,e),t.create=function(e,r,n){return void 0===r&&(r={}),void 0===n&&(n={}),new t(e,r,n)},t.prototype._trackBufferedSegment=function(e,t,r){var n=this._bufferedSegmentInfos;n||(n=new Array(r),this._bufferedSegmentInfos=n);var i={timeStart:e.timeStart,timeEnd:e.timeEnd,index:e.index,audio:t.audio?{profileId:t.audio.profileId,mimeType:t.audio.mimeType}:void 0,video:t.video?{profileId:t.video.profileId,mimeType:t.video.mimeType,resolution:t.video.resolution}:void 0};n[e.index]=i},t.prototype._trackBufferingProgress=function(e){e.audio&&e.audio.buffer&&this._tracker.trackBytesDownloaded(e.audio.buffer.byteLength),e.video&&e.video.buffer&&this._tracker.trackBytesDownloaded(e.video.buffer.byteLength)},t.prototype._trackBufferURLs=function(e){var t,r,n,i,o,a;null!==(null===(t=e.audio)||void 0===t?void 0:t.bandwidth)&&this._tracker.trackBufferURL((null===(r=e.audio)||void 0===r?void 0:r.bufferURL)||"",{bandwidth:(null===(n=e.audio)||void 0===n?void 0:n.bandwidth)||0}),null!==(null===(i=e.video)||void 0===i?void 0:i.bandwidth)&&this._tracker.trackBufferURL((null===(o=e.video)||void 0===o?void 0:o.bufferURL)||"",{bandwidth:(null===(a=e.video)||void 0===a?void 0:a.bandwidth)||0})},t.prototype.dequeueUpdates=function(){this._mediaSourceManager.dequeueUpdates()},t.prototype.abort=function(e){var t;void 0===e&&(e=!1),null===(t=this._currentFillOperation)||void 0===t||t.abort(),this._currentFillOperation=null,this._mediaSourceManager.abort(e)},t.prototype.getMediaSource=function(){return this._mediaSourceManager.getMediaSource()},t.prototype.destroy=function(){this._mediaSourceManager.destroy()},t.prototype.checkBufferHealth=function(e,t,r){var n,i=this,o=this._currentFillOperation;if(r||"started"!==(null==o?void 0:o.status)){var s=this._mediaSourceManager,l=s.getMediaSource();if(l&&"closed"!==l.readyState){var d=t;if(d>=l.duration){var _=e.getFinalSegment();_&&(d=_.timeStart)}var p=function(e,t){var r,n=null===(r=e.sourceBuffers[e.sourceBuffers.length-1])||void 0===r?void 0:r.buffered;if(n)for(var i=0;i<n.length;i++){var o=n.start(i),a=n.end(i);if(o<=t&&t<=a)return{start:o,end:a}}return null}(l,d);if(!p||e.getSegmentAfterTime(p.end)||"ended"!==l.readyState){var f="video"===e.getMediaType()?this._bufferTarget.video:this._bufferTarget.audio,h=null!==(n=null==p?void 0:p.end)&&void 0!==n?n:d,v=h-d;if(!(v>f)){var y=h+(f-v);if(!o||"started"!==o.status||o.timeStart<h||o.timeEnd>y){null==o||o.abort();var m=s.getPlayId();this._currentFillOperation=new c.BufferFillOperation({timeStart:h,timeEnd:y,getBufferedTimeRanges:function(){var e,t;return null!==(t=null===(e=l.sourceBuffers[l.sourceBuffers.length-1])||void 0===e?void 0:e.buffered)&&void 0!==t?t:null},getBufferSetForSegment:function(t,r){return e.getBufferSetForSegment(t,r).then((function(e){return i._trackBufferingProgress(e),i._trackBufferURLs(e),e}),(function(t){return m===s.getPlayId()&&t.code!==a.TransportErrors.HTTP_REQUEST_ABORTED&&i.emit(u.Event.BUFFER_APPEND_ERROR,{error:t,canPlayNext:!0,track:e.toLogJSON()}),Promise.reject(t)}))},getSegmentsForRange:function(t,r){return void 0===r&&(r=1/0),e.getSegmentsForRange(t,r)},appendBufferData:function(t,r,n){return s.appendBufferData(t,r,m,n).then((function(n){return i._trackBufferedSegment(r,t,e.getSegmentsCount()),r.isFinal&&-1===(null==n?void 0:n.indexOf(!1))&&i._mediaSourceManager.endOfStream(m),n}))},prioritizeFirst:!p}),this._currentFillOperation.start()}}}}}},t.prototype.isPositionInCurrentFillRange=function(e,t){var r=this._currentFillOperation;if("started"!==(null==r?void 0:r.status))return!1;var n=t+("video"===e.getMediaType()?this._bufferTarget.video:this._bufferTarget.audio);return r.timeStart>=t||r.timeEnd>=n},t.prototype.recreate=function(e){this._mediaSourceManager.recreate({mimeTypes:e}),this._bufferedSegmentInfos=null,this._cachedBufferedSegmentInfo=null},t.prototype.injectInitSegment=function(e){var t=this._mediaSourceManager,r=t.getMediaSource();if(!r||"closed"===r.readyState)return Promise.resolve(!1);var n=e.getInitSegment();if(!n)return Promise.resolve(!1);var i=s.monotonicNow(),o=t.getPlayId();return e.getInitBufferSet().then((function(e){return t.appendBufferData(e,n,o,i)})).then((function(){return!0}))},t.prototype.setDuration=function(e){return this._mediaSourceManager.setDuration(e)},t.prototype.setPlayId=function(e){this._mediaSourceManager.setPlayId(e)},t.prototype.getBufferTarget=function(){return this._bufferTarget},t.prototype.getBufferedSegmentInfoForTime=function(e){var t=this._bufferedSegmentInfos;if(!(null==t?void 0:t.length))return null;var r=0,n=this._cachedBufferedSegmentInfo;if(n&&n.timeStart<=e){if(n.timeEnd>=e)return n;var i=t[n.index+1];if(i&&i.timeStart<=e&&i.timeEnd>=e)return this._cachedBufferedSegmentInfo=i,i;e>=n.timeEnd&&(r=n.index+1)}for(var o=t.length;r<o;r++){var a=t[r];if(a&&a.timeStart<=e&&a.timeEnd>=e)return this._cachedBufferedSegmentInfo=a,a}return this._cachedBufferedSegmentInfo=null,null},t}(o.EventEmitter);r.BufferManager=d},{"../enums/event":81,"./buffer_fill_operation":34,"./media_source_manager":67,"@js-sdk/common/es5/monotonic_now":15,"@spotify-internal/emitter/es5":109,"@spotify-internal/transport/es5":188,tslib:227}],34:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BufferFillOperation=void 0;var n=e("@spotify-internal/transport/es5"),i=e("@js-sdk/common/es5/debug_tools"),o=e("@js-sdk/common/es5/monotonic_now"),a=i.logging.forTag("playback.buffer_fill_operation"),s=function(){function e(e){var t,r=this;this._batchSize=1,this._prioritizeFirst=!1,this._segmentsToAppend=[],this._abortController=n.createAbortControllerLike(),this.status="pending",this.timeStart=e.timeStart,this.timeEnd=e.timeEnd,this.done=new Promise((function(e){r._resolveDone=e})),this._getBufferedTimeRanges=e.getBufferedTimeRanges,this._getBufferSetForSegment=e.getBufferSetForSegment,this._getSegmentsForRange=e.getSegmentsForRange,this._appendBufferData=e.appendBufferData,this._batchSize=null!==(t=e.batchSize)&&void 0!==t?t:1,this._prioritizeFirst=!!e.prioritizeFirst}return e.prototype._filterBufferedSegments=function(e){var t=this._getBufferedTimeRanges(),r=[];if(null==t?void 0:t.length)e:for(var n=0,i=e;n<i.length;n++){for(var o=i[n],a=t.length;a--;){var s=t.start(a),u=t.end(a);if(s<=o.timeStart&&(u>=o.timeEnd||u+1e-5>o.timeEnd))continue e}r.push(o)}else r=e;return r},e.prototype._fill=function(e,t){var r,i=this;if(void 0===t&&(t=!1),!e.aborted){var s=this._segmentsToAppend,u=s.length,l=s.splice(0,t?1:Math.max(1,this._batchSize));if(!l.length)return this.status="ended",void(null===(r=this._resolveDone)||void 0===r||r.call(this));a.log("Segments to download: "+l.length+"/"+u);var c=o.monotonicNow();Promise.all(l.map((function(t){return i._getBufferSetForSegment(t,e).then((function(r){return e.aborted?Promise.resolve([!1]):i._appendBufferData(r,t,c)}))}))).then((function(t){var r,n;if(!e.aborted){if(-1!==[].concat.apply([],t).indexOf(!1))return i.status="failed",null===(r=i._resolveDone)||void 0===r||r.call(i),a.warn("Fill operation "+i.timeStart+"-"+i.timeEnd+" append failed."),void i._clear();i._segmentsToAppend.length?i._fill(e):(i.status="ended",null===(n=i._resolveDone)||void 0===n||n.call(i),i._clear())}}),(function(e){var t;e.code!==n.TransportErrors.HTTP_REQUEST_ABORTED?(i.status="failed",null===(t=i._resolveDone)||void 0===t||t.call(i),i._clear(),a.warn("Fill operation "+i.timeStart+"-"+i.timeEnd+" failed.","QuotaExceededError"===e.name?"Exceeded buffer quota":e)):i.status="aborted"}))}},e.prototype._clear=function(){this._segmentsToAppend=[]},e.prototype.start=function(){var e;if(this._abortController.signal.aborted||"pending"!==this.status)return this.done;this.status="started",a.log("Starting fill operation for range",this.timeStart,this.timeEnd);var t=this._getSegmentsForRange(this.timeStart,this.timeEnd);return this._segmentsToAppend=this._filterBufferedSegments(t),this._segmentsToAppend.length?(this._fill(this._abortController.signal,this._prioritizeFirst),this.done):(a.warn("Fill operation ended early: all segments are buffered."),this.status="ended",null===(e=this._resolveDone)||void 0===e||e.call(this),this.done)},e.prototype.abort=function(){var e;return"aborted"===this.status||("started"===this.status&&a.info("Fill operation "+this.timeStart+"-"+this.timeEnd+" aborted."),this.status="aborted",null===(e=this._resolveDone)||void 0===e||e.call(this),this._abortController.abort(),this._clear()),this},e}();r.BufferFillOperation=s},{"@js-sdk/common/es5/debug_tools":9,"@js-sdk/common/es5/monotonic_now":15,"@spotify-internal/transport/es5":188}],35:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CDNURLTracker=void 0;var n=function(){function e(){this._version="1.0.0",this._map={}}return e.prototype.clear=function(){this._map={}},e.prototype.track=function(e,t){var r=this._map[e];r||(r={url:e,segments:0,bandwidths:[],totalBandwidth:0},this._map[e]=r),r.segments+=1,r.bandwidths.push(t.bandwidth),r.totalBandwidth+=t.bandwidth},e.prototype.toJSON=function(){var e=[];for(var t in this._map)if(this._map[t]){var r=this._map[t];r&&e.push({url:t,segments:r.segments,avg_bw:parseFloat((r.totalBandwidth/r.bandwidths.length).toFixed(7))})}return{version:this._version,urls:e}},e}();r.CDNURLTracker=n},{}],36:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AdManifestContent=r.convertTrackingDataResponse=void 0;var n=e("tslib"),i=e("@js-sdk/common/es5/monotonic_now"),o=e("../../typedefs"),a=e("../../enums/errors"),s=e("../../error/file"),u=e("../../error/ad_manifest"),l=e("./base");r.convertTrackingDataResponse=function(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n=r;t[n]={urls:e[n]}}return t};var c=function(e){function t(t){var r=e.call(this,t)||this;return r._loaded=!1,r._playableContentSorted=[],r._mimeType="",r._manifestURL="",r._adURL="",r._product="",r._audioFiles=[],r._videoFiles=[],r._trackingData=null,r.strategy=o.PlaybackStrategy.URL,r._abrManager=t.abrManager,r._transport=t.transport,r._manifestURL=t.manifestURL,r._preloadedManifest=t.preloadedManifest,r._hasNonFatalErrors=!1,r._getManifest=r._getManifest.bind(r),r._parseManifest=r._parseManifest.bind(r),r._getPlayableContent=r._getPlayableContent.bind(r),r}return n.__extends(t,e),t.prototype._isPlayable=function(e,t){return""!==document.createElement(t).canPlayType(e)},t.prototype._parseManifest=function(e){if(!(null==e?void 0:e.manifest))throw new u.AdManifestError(a.Errors.STORAGE_TRACK_MANIFEST_EMPTY,"Received empty manifest.");var t=e.manifest;this._videoFiles=t.video_files,this._audioFiles=t.audio_files,this._contentMetadata=t.metadata,this._videoManifestId=t.video_manifest_id,this._product=t.product,this._trackingData=r.convertTrackingDataResponse(t.tracking_events)},t.prototype._getManifest=function(e){if(this._preloadedManifest)return e&&(e.manifestLatency=0),Promise.resolve(this._preloadedManifest);var t=i.monotonicNow(),r=this._manifestURL;return this._transport.request(r,{responseType:"json",authorize:!0,retry:{condition:function(e,t){var r=e.getStatusFamily();return 429===e.status||r===t.SERVER_ERROR||r===t.CONNECTION_ERROR}}}).then((function(n){var o;if(200!==n.status)return(o=new u.AdManifestError(a.Errors.AD_MANIFEST_REQUEST_FAILED_WITH_STATUS,"Ad manifest request failed with status code "+n.status)).debug.manifestURL=r,o.status=n.status,Promise.reject(o);if(!n.body)return(o=new u.AdManifestError(a.Errors.AD_MANIFEST_INVALID,"Received empty manifest.")).debug.manifestURL=r,o.status=n.status,Promise.reject(o);e&&(e.manifestLatency=i.monotonicDuration(t));var s=n.body;return Promise.resolve(s)}))},t.prototype._getPlayableContent=function(){var e=this,t="video"===this._product;if(!t||!this._videoManifestId){var r=t?this._videoFiles:this._audioFiles;if(!r.length)throw new s.FileError(a.Errors.FILE_NOT_RESOLVED,"Manifest's "+(t?"video_files":"audio_files")+" array is empty.");var n=r.filter((function(t){return e._isPlayable(t.type,e.getMediaType())}));if(!n.length)throw new s.FileError(a.Errors.FILE_FORMAT_NOT_SUPPORTED,"No playable content found.");this._playableContentSorted=n.sort((function(e,t){return t.bitrate-e.bitrate}))}},t.prototype.load=function(e){var t=this;return void 0===e&&(e={resolveLatency:0,manifestLatency:0}),this._loaded?(e.resolveLatency=0,e.manifestLatency=0,Promise.resolve(this)):this._getManifest(e).then(this._parseManifest).then(this._getPlayableContent).then((function(){return t._loaded=!0,Promise.resolve(t)}))},t.prototype.unload=function(){this._adURL=""},t.prototype.isProtected=function(){return!1},t.prototype.getMediaTypeMimeTypes=function(){var e;return(e={})[this._mediaType]=this._mimeType,e},t.prototype.getURL=function(){if(""!==this._adURL)return this._adURL;for(var e=this._abrManager.getBandwidthEstimate(),t=this._playableContentSorted[this._playableContentSorted.length-1],r=0,n=this._playableContentSorted;r<n.length;r++){var i=n[r];if(i.bitrate<=e){t=i;break}}return t&&(this._adURL=t.url,this._mimeType=t.type),this._adURL},t.prototype.getLoadingApproach=function(){return{approach:"src"}},t.prototype.getManifestId=function(){return this._videoManifestId},t.prototype.getTrackingEvents=function(){if(!this._trackingData)throw new s.FileError(a.Errors.FILE_NOT_RESOLVED,"Cannot return Tracking Events: File not resolved.");return this._trackingData},t.prototype.getTrackingEventData=function(e){var t=this._trackingData?this._trackingData[e]:null;return t?{tracking_event:e,urls:t.urls}:null},t}(l.Content);r.AdManifestContent=c},{"../../enums/errors":80,"../../error/ad_manifest":92,"../../error/file":95,"../../typedefs":104,"./base":40,"@js-sdk/common/es5/monotonic_now":15,tslib:227}],37:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AudioManifestContent=void 0;var n=e("tslib"),i=e("@js-sdk/common/es5/monotonic_now"),o=e("../../enums/audio_file_codec"),a=e("../../enums/media_format"),s=e("../../enums/audio_file_format"),u=e("../../enums/key_system"),l=e("../../enums/errors"),c=e("../../error/file"),d=e("./base"),_=e("../eme/keysystem_setting"),p=e("./helpers/eme");var f=function(e){function t(t){var r=e.call(this,t)||this;if(r._loaded=!1,r._lastResolveToken=0,r._fallbackURLs=[],r._contentSegments=[],r._duration=0,r._segmentLength=0,r._protection="cenc",r._fileId=t.fileId,r._resolver=t.resolver,r._keySystem=t.keySystem,r._keySystemSettings=_.KeySystemSetting[r._keySystem],r._fileFormat=t.fileFormat,r._disableCache=t.disableCache,r._preloadedManifest=t.preloadedManifest,r._preresolvedURL=t.preresolvedURL,r._fileFormat)r._mimeType=o.AudioFileMimeType[r._fileFormat];else switch(r._mediaFormat){case a.MediaFormat.MP3:r._mimeType=o.AudioFileMimeType[s.AudioFileFormat.MP3_160];break;case a.MediaFormat.MP4:case a.MediaFormat.MP4_DUAL:case a.MediaFormat.MP4_CBCS:r._mimeType=o.AudioFileMimeType[s.AudioFileFormat.MP4_128];break;default:throw new TypeError("Unknown audio format "+r._mediaFormat)}return r}return n.__extends(t,e),t.prototype._getCDNURLs=function(e){var t=this;if(this._preresolvedURL)return this._currentURL=this._preresolvedURL,this._fallbackURLs=[],e&&(e.resolveLatency=0),Promise.resolve(!0);var r=this._fileId;clearTimeout(this._lastResolveToken);var n=function(){return t._lastResolveTime=i.monotonicNow(),t._resolver.getCDNURL(r,t._fileFormat).then((function(r){return e&&t._lastResolveTime&&(e.resolveLatency=i.monotonicDuration(t._lastResolveTime)),r}))},o=this._lastResolveTime?i.monotonicDuration(this._lastResolveTime):1/0;return(o<1001?new Promise((function(e,r){t._lastResolveToken=setTimeout((function(){n().then(e,r)}),1001-o)})):n()).then((function(e){return t._fallbackURLs=e.uris,t._currentURL=t._fallbackURLs.shift(),!0})).catch((function(e){return e&&(e.track=t.toLogJSON()),Promise.reject(e)}))},t.prototype._getManifest=function(e){if(this._preloadedManifest)return e&&(e.manifestLatency=0),Promise.resolve(this._preloadedManifest);var t=i.monotonicNow();return this._resolver.getManifest(this._fileId).then((function(r){return e&&(e.manifestLatency=i.monotonicDuration(t)),r}))},t.prototype._calculateSegments=function(e){var t=e.offset;this._initSegment={index:-1,init:!0,cacheBufferSet:!this._disableCache,timeStart:0,timeEnd:0,byteRanges:{audio:{start:0,end:t-1}}};for(var r=e.segments,n=e.timescale,i=r.length,o=new Array(i),a=0,s=0,u=0,l=i;u<l;u++){var c=r[u];if(null==c?void 0:c.length){var d=c[0],_=c[1],p=_/n,f={index:u,init:!1,cacheBufferSet:!u&&!this._disableCache,timeStart:a,timeEnd:a+p,byteRanges:{audio:{start:t,end:t+(d-1)}}};o[u]=f,t+=d,s+=_,a+=p,Math.floor(p)>this._segmentLength&&(this._segmentLength=Math.floor(p))}}o[o.length-1].isFinal=!0,this._contentSegments=o,this._duration=s/n},t.prototype._calculateSegmentsV1=function(e){var t=e.offset;this._initSegment={index:-1,init:!0,cacheBufferSet:!this._disableCache,timeStart:0,timeEnd:0,byteRanges:{audio:{start:0,end:t-1}}};for(var r=e.references,n=e.timescale,i=r.length,o=new Array(i),a=0,s=0,u=0,l=i;u<l;u++){var c=r[u];if(c){var d=c.duration/n,_={index:u,init:!1,cacheBufferSet:!u&&!this._disableCache,timeStart:s,timeEnd:s+d,byteRanges:{audio:{start:t,end:t+(c.size-1)}}};o[u]=_,t+=c.size,a+=c.duration,s+=d,Math.floor(d)>this._segmentLength&&(this._segmentLength=Math.floor(d))}}o[o.length-1].isFinal=!0,this._contentSegments=o,this._duration=a/n},t.prototype.load=function(e){var t=this;return void 0===e&&(e={resolveLatency:0,manifestLatency:0}),this._loaded?(e.resolveLatency=0,e.manifestLatency=0,Promise.resolve(this)):Promise.all([this._getCDNURLs(e),this._getManifest(e)]).then((function(e){var r,n,i=e[0],o=e[1];if(t._loaded=!0,!i||!o)return t;if(t._keySystem===u.KeySystem.INVALID_SPOTIFY_KEY)return t._pssh=new Uint8Array(0),t;var a=t._keySystemSettings.pssh_field.audio,s=function(e,t){return t.hasOwnProperty(e)}(a,o)?o[a]:null;if(!s&&"pssh_widevine"===a&&"pssh"in o&&(s=null!==(r=o.pssh)&&void 0!==r?r:null),!s)return(n=new c.FileError(l.Errors.FILE_FORMAT_NOT_SUPPORTED,"KeySystem does not support the file format.")).track=t.toLogJSON(),Promise.reject(n);if(t._protection=o.protection||"cenc",t._pssh=p.decodePSSH(s),"segments"in o&&o.segments)t._calculateSegments(o);else{if(!("references"in o)||!o.references)return(n=new c.FileError(l.Errors.FILE_MALFORMED_SEEKTABLE,"Malformed seektable.")).track=t.toLogJSON(),Promise.reject(n);t._calculateSegmentsV1(o)}return t}))},t.prototype.isProtected=function(){return!!this._protection&&!!this._pssh},t.prototype.getMediaTypeMimeTypes=function(){return{audio:this._mimeType}},t}(d.Content);r.AudioManifestContent=f},{"../../enums/audio_file_codec":77,"../../enums/audio_file_format":78,"../../enums/errors":80,"../../enums/key_system":82,"../../enums/media_format":84,"../../error/file":95,"../eme/keysystem_setting":50,"./base":40,"./helpers/eme":45,"@js-sdk/common/es5/monotonic_now":15,tslib:227}],38:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AudioManifestHLSContent=void 0;var n=e("tslib"),i=e("../../typedefs"),o=e("../../error/file"),a=e("./audio_manifest_content"),s=e("../helpers/hls"),u=e("../.."),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._hlsURL=null,t.strategy=i.PlaybackStrategy.URL,t}return n.__extends(t,e),t.prototype.unload=function(){this._hlsURL&&URL.revokeObjectURL(this._hlsURL),this._hlsURL=null},t.prototype.getURL=function(){var e,t,r=this._currentURL,n=this._initSegment;if(!r||!n)throw new o.FileError(u.Errors.FILE_NOT_RESOLVED,"Cannot return HLS Manifest URL: File not resolved.");this.unload();var i={url:r,byteStart:null===(e=n.byteRanges.audio)||void 0===e?void 0:e.start,byteEnd:null===(t=n.byteRanges.audio)||void 0===t?void 0:t.end},a=this._contentSegments.map((function(e){var t,n;return{url:r,duration:e.timeEnd-e.timeStart,byteStart:null===(t=e.byteRanges.audio)||void 0===t?void 0:t.start,byteEnd:null===(n=e.byteRanges.audio)||void 0===n?void 0:n.end}})),l="undefined"==typeof MediaSource?s.createProtectedManifestURL:s.createProtectedManifestDataURL;return this._hlsURL=l({assetID:this._fileId,targetDuration:10,map:i,segments:a}),this._hlsURL},t.prototype.getLoadingApproach=function(){return{approach:"source",type:s.HLS_MIME_TYPE}},t}(a.AudioManifestContent);r.AudioManifestHLSContent=l},{"../..":102,"../../error/file":95,"../../typedefs":104,"../helpers/hls":61,"./audio_manifest_content":37,tslib:227}],39:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AudioManifestMSEContent=void 0;var n=e("tslib"),i=e("../../typedefs"),o=e("../../enums/errors"),a=e("../../error/file"),s=e("../../error/fragment"),u=function(e){function t(t){var r=e.call(this,t)||this;return r._profileId=""+Date.now(),r._lastFetchedBuffer=null,r.strategy=i.PlaybackStrategy.MSE,r._transport=t.transport,r._abrManager=t.abrManager,r._parseSegmentResponse=r._parseSegmentResponse.bind(r),r}return n.__extends(t,e),t.prototype._parseSegmentResponse=function(e,t){var r=this,n=e.metadata,i=n.requestURL,a=n.segment,u=n.byteRangeHeader,l=n.expectedLength,c=a.timeStart+"-"+a.timeEnd;switch(e.status){case 0:if(e.offline)return Promise.reject(new s.FragmentError(o.Errors.FRAGMENT_OFFLINE_REQUEST_FAILED_WITH_ZERO,"Request failed with status 0.",0,{time_range:c,byte_range:u}));var d=new s.FragmentError(o.Errors.FRAGMENT_ONLINE_REQUEST_FAILED_WITH_ZERO,"Request failed with status 0.",0),_=!1;return this._currentURL!==i?_=!0:this._fallbackURLs.length&&this._currentURL===i&&(_=!0,this._currentURL=this._fallbackURLs.shift()),d.debug.has_fallback=_,_?this.getBufferSetForSegment(a,t):Promise.reject(d);case 200:case 206:var p=e.body;if(!p)return Promise.reject(new s.FragmentError(o.Errors.FRAGMENT_REQUEST_EMPTY_RESPONSE,"Empty response for successful buffer.",e.status,{time_range:c,byte_range:u}));if(p.byteLength!==l)return Promise.reject(new s.FragmentError(o.Errors.FRAGMENT_REQUEST_UNEXPECTED_LENGTH,"Received buffer of unexpected length.",e.status,{time_range:c,byte_range:u,received_length:p.byteLength,expected_length:l}));var f={audio:{profileId:this._profileId,bufferURL:i,byteStart:a.byteRanges.audio.start,byteEnd:a.byteRanges.audio.end,buffer:p,mimeType:this._mimeType,bandwidth:8e3*p.byteLength/e.timing.completed}};return a.cacheBufferSet&&p&&p.byteLength&&(a.bufferSet=f),this._abrManager.sample(p.byteLength,e.timing.completed),Promise.resolve(f);case 403:return this._getCDNURLs().then((function(){return r.getBufferSetForSegment(a,t)}));default:_=!1;return this._currentURL!==i?_=!0:this._fallbackURLs.length&&this._currentURL===i&&(_=!0,this._currentURL=this._fallbackURLs.shift()),_?this.getBufferSetForSegment(a,t):Promise.reject(new s.FragmentError(o.Errors.FRAGMENT_REQUEST_FAILED_WITH_STATUS,"Buffer request failed with status "+e.status,e.status,{time_range:c,byte_range:u}))}},t.prototype.unload=function(){this._lastFetchedBuffer=null,this._disableCache&&(this._initSegment&&(this._initSegment.bufferSet=null),this._contentSegments[0]&&(this._contentSegments[0].bufferSet=null))},t.prototype.getCalculatedDuration=function(){return this._duration},t.prototype.getSegmentLength=function(){return this._segmentLength},t.prototype.getSegmentsCount=function(){return this._contentSegments.length},t.prototype.getInitSegment=function(){return this._initSegment},t.prototype.getSegmentForTime=function(e){var t,r;if(!(null===(t=this._contentSegments)||void 0===t?void 0:t.length))return null;if(0===e||.01===e)return null!==(r=this._contentSegments[0])&&void 0!==r?r:null;for(var n=0,i=this._contentSegments;n<i.length;n++){var o=i[n];if(o.timeStart<=e&&o.timeEnd>=e)return o}return null},t.prototype.getSegmentAfterTime=function(e){var t,r;if(!(null===(t=this._contentSegments)||void 0===t?void 0:t.length))return null;if(0===e||.01===e)return null!==(r=this._contentSegments[1])&&void 0!==r?r:null;for(var n=0,i=this._contentSegments;n<i.length;n++){var o=i[n];if(o.timeStart>e)return o}return null},t.prototype.getSegmentsForRange=function(e,t){var r;void 0===t&&(t=1/0);var n=[];if(null===(r=this._contentSegments)||void 0===r?void 0:r.length)for(var i=0,o=this._contentSegments;i<o.length;i++){var a=o[i];a.timeStart<=t&&a.timeEnd>=e&&n.push(a)}return n},t.prototype.getFinalSegment=function(){var e,t;return null!==(t=null===(e=this._contentSegments)||void 0===e?void 0:e[this._contentSegments.length-1])&&void 0!==t?t:null},t.prototype.getInitBufferSet=function(e){var t,r;if(!this._initSegment)throw new a.FileError(o.Errors.FILE_NOT_RESOLVED,"Cannot return the init bufferset: file not resolved.");return(null===(r=null===(t=this._initSegment.bufferSet)||void 0===t?void 0:t.audio)||void 0===r?void 0:r.buffer.byteLength)?Promise.resolve(this._initSegment.bufferSet):(this._initBufferPromise||(this._initBufferPromise=this.getBufferSetForSegment(this._initSegment,e).then((function(e){var t;if(!(null===(t=e.audio)||void 0===t?void 0:t.buffer.byteLength))throw new Error("Empty initialization segment buffer");return e}))),this._initBufferPromise)},t.prototype.getBufferSetForSegment=function(e,t){var r,n=this;if((null===(r=this._lastFetchedBuffer)||void 0===r?void 0:r.segment)===e)return Promise.resolve(this._lastFetchedBuffer.bufferSet);if(e.bufferSet)return Promise.resolve(e.bufferSet);if(!this._currentURL)return Promise.reject(new a.FileError(o.Errors.FILE_NOT_RESOLVED,"Cannot fetch buffer: No resolved URL"));var i=e.byteRanges.audio,s=i.start+"-"+i.end,u=i.end+1-i.start,l=this._currentURL;return(e.init?Promise.resolve(null):this.getInitBufferSet(t)).then((function(r){return Promise.all([r,n._transport.request(l,{method:"GET",responseType:"arraybuffer",headers:{Range:"bytes="+s},signal:t,timing:!0,metadata:{requestURL:l,segment:e,byteRangeHeader:s,expectedLength:u},retry:{condition:function(e,t){if(0===e.status)return e.offline;var r=e.getStatusFamily();return 429===e.status||r===t.CONNECTION_ERROR||r===t.SERVER_ERROR||!(r!==t.SUCCESS||!e.body)&&e.body.byteLength!==u}}}).then((function(e){return n._parseSegmentResponse(e,t)}))])})).then((function(t){var r,i=t[0],o=t[1];return(null===(r=null==i?void 0:i.audio)||void 0===r?void 0:r.buffer)&&o.audio&&(o.audio.initBuffer=i.audio.buffer),n._lastFetchedBuffer={segment:e,bufferSet:o},o}))},t}(e("./audio_manifest_content").AudioManifestContent);r.AudioManifestMSEContent=u},{"../../enums/errors":80,"../../error/file":95,"../../error/fragment":96,"../../typedefs":104,"./audio_manifest_content":37,tslib:227}],40:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Content=void 0;var n=function(){function e(e){this._mediaType=e.mediaType,this._fileId=e.fileId,this._uri=e.uri,this._audioGain=e.audioGain,this._logData=e.logData,this._hasNonFatalErrors=!!e.hasNonFatalErrors,this._disableCache=e.disableCache,this._keySystem=e.keySystem,this._licenseEndpoint=e.licenseEndpoint,this._mediaFormat=e.mediaFormat,this._mediator=e.mediator,this._noAuth=e.noAuth,this._contentMetadata=e.contentMetadata}return e.prototype.getFileId=function(){return this._fileId},e.prototype.getAudioGain=function(){return this._audioGain},e.prototype.getMediaType=function(){return this._mediaType},e.prototype.getLogData=function(){return this._logData},e.prototype.setLogData=function(e){this._logData=e},e.prototype.toLogJSON=function(){return{uri:this._uri,fileId:this._fileId,mediaFormat:this._mediaFormat,mediaURL:this._mediaURL}},e.prototype.hasNonFatalErrors=function(){return this._hasNonFatalErrors},e.prototype.getContentMetadata=function(){return this._contentMetadata||{}},e.prototype.getInitParams=function(){return this.isProtected()?{initDataType:this._protection,initData:this._pssh}:null},e.prototype.getKeySystem=function(){var e;return null!==(e=this._keySystem)&&void 0!==e?e:null},e.prototype.getLicenseEndpoint=function(){var e;return null!==(e=this._licenseEndpoint)&&void 0!==e?e:null},e}();r.Content=n},{}],41:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.canHaveTracking=r.canHaveAdaptations=r.canHaveResolution=r.canHaveProfiles=r.canHaveSubtitles=void 0,r.canHaveSubtitles=function(e){return!!e&&"getSubtitles"in e&&"getSubtitleLanguages"in e},r.canHaveProfiles=function(e){return!!e&&"getMediaProfileInfo"in e},r.canHaveResolution=function(e){return!!e&&"setVideoResolution"in e},r.canHaveAdaptations=function(e){return!!e&&"getCurrentBitrates"in e&&"canLowerBitrate"in e&&"adaptToBandwidth"in e},r.canHaveTracking=function(e){return!!e&&"getTrackingEventData"in e&&"getTrackingEvents"in e}},{}],42:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DirectorManifestContent=r.getProfileBitrate=r.getProfileMimeType=void 0;var n=e("tslib"),i=e("@js-sdk/common/es5/monotonic_now"),o=e("../../enums/errors"),a=e("../../error/file"),s=e("./base"),u=e("./helpers/eme"),l=e("../helpers/preferred_profiles");r.getProfileMimeType=function(e){if(e){var t=e.__effective_codec||("audio_codec"in e?e.audio_codec:e.video_codec);return e.mime_type+';codecs="'+t+'"'}},r.getProfileBitrate=function(e){return e?"audio_bitrate"in e?e.audio_bitrate:e.video_bitrate:0};var c=function(e){function t(t){var r=e.call(this,t)||this;return r._supportedFormats={audio:[],video:[]},r._baseURL="",r._fallbackURLs=[],r._loaded=!1,r._initTemplate="",r._segmentTemplate="",r._segmentLength=0,r._assetID="",r._segments=[],r._duration=0,r._videoProfiles={selected:null,available:[]},r._audioProfiles={selected:null,available:[]},r._subtitleLanguages=[],r._subtitleTemplate="",r._trackingData=null,r._resolver=t.resolver,r._keySystem=t.keySystem,r._keySystemSettings=t.keySystemSettings,r._disallowProfile=t.disallowProfile,r._supportedFormats=t.supportedFormats,r._videoResolution=t.videoResolution,r._allowMixedAVC1Codecs=t.allowMixedAVC1Codecs,r._trackingData=t.trackingData,r._contentMetadata=t.metadata,r}return n.__extends(t,e),t.prototype._calculateSegments=function(e){this._duration=e.end_time_millis/1e3;var t=this._segmentLength;this._initSegment={index:-1,init:!0,cacheBufferSet:!1,timeStart:-1,timeEnd:-1,byteRanges:{}};for(var r=[],n=0,i=0;n<this._duration;i++,n+=t)r.push({index:i,cacheBufferSet:!n&&!this._disableCache,timeStart:n,timeEnd:n+t,byteRanges:{}});r[r.length-1].isFinal=!0,this._segments=r},t.prototype._parseManifest=function(e){var t,r,n,i,s=e.contents[0];if(!s)return(i=new a.FileError(o.Errors.FILE_MALFORMED_SEEKTABLE,"Malformed seektable: no contents.")).track=this.toLogJSON(),Promise.reject(i);this._fallbackURLs=e.base_urls.slice(),this._baseURL=null!==(t=this._fallbackURLs.shift())&&void 0!==t?t:"",this._initTemplate=e.initialization_template,this._segmentTemplate=e.segment_template,this._segmentLength=s.segment_length;var c=void 0;if(null===(r=s.encryption_infos)||void 0===r?void 0:r.length){for(var d=s.encryption_infos,_=this._keySystemSettings.commonName,p=void 0,f=0,h=d.length;f<h;f++){var v=d[f];if(v&&v.key_system===_){c=f,p=v.encryption_data,this._licenseEndpoint="@webgate"+v.license_server_endpoint;break}}if(!p)return(i=new a.FileError(o.Errors.FILE_FORMAT_NOT_SUPPORTED,"KeySystem does not support the file format.")).track=this.toLogJSON(),Promise.reject(i);switch(this._keySystemSettings.commonName){case"widevine":case"playready":this._protection="cenc";try{this._pssh=u.decodePSSH(p)}catch(e){return(i=new a.FileError(o.Errors.FILE_MALFORMED_PSSH,"Invalid PSSH value.")).track=this.toLogJSON(),Promise.reject(i)}break;case"fairplay":this._protection="cbcs",this._pssh=new Uint8Array(0);try{this._assetID=s.encoding_id}catch(e){return(i=new a.FileError(o.Errors.FILE_MALFORMED_PSSH,"Invalid PSSH value.")).track=this.toLogJSON(),Promise.reject(i)}break;default:return(i=new a.FileError(o.Errors.FILE_FORMAT_NOT_SUPPORTED,"KeySystem does not support the file format.")).track=this.toLogJSON(),Promise.reject(i)}}return this._videoProfiles.available=l.getPreferredProfiles({codec:"video_codec",formats:this._supportedFormats.video,profiles:s.profiles,encryptionIndex:c,disallowProfile:this._disallowProfile,preferredVideoResolution:this._videoResolution,allowMixedAVC1Codecs:this._allowMixedAVC1Codecs}),this._audioProfiles.available=l.getPreferredProfiles({codec:"audio_codec",formats:this._supportedFormats.audio,profiles:s.profiles,encryptionIndex:c,disallowProfile:this._disallowProfile}),this._calculateSegments(e),this._subtitleLanguages=e.subtitle_language_codes||[],(null===(n=e.subtitle_base_urls)||void 0===n?void 0:n.length)&&e.subtitle_template?this._subtitleTemplate=""+e.subtitle_base_urls[0]+e.subtitle_template:this._subtitleTemplate="",Promise.resolve()},t.prototype.load=function(e){var t=this;if(void 0===e&&(e={resolveLatency:0,manifestLatency:0}),this._loaded)return e.resolveLatency=0,e.manifestLatency=0,Promise.resolve(this);if(!this._fileId)throw new TypeError("Missing: provide either fileId or resolvedURL");var r=i.monotonicNow();return this._resolver.getManifest(this._fileId,this._noAuth).then((function(n){return e.resolveLatency=0,e.manifestLatency=i.monotonicDuration(r),t._parseManifest(n)})).then((function(){return t._loaded=!0,t}))},t.prototype.isProtected=function(){return!!this._protection&&!!this._pssh},t.prototype.setVideoResolution=function(e){this._videoResolution=e},t.prototype.getMediaProfileInfo=function(){return{audio:this._audioProfiles,video:this._videoProfiles}},t.prototype.getSubtitles=function(){var e=this;return this._subtitleLanguages.map((function(t){return{lang:t,url:e._subtitleTemplate.replace("{{language_code}}",t)}}))},t.prototype.getSubtitleLanguages=function(){return this._subtitleLanguages},t.prototype.getCurrentBitrates=function(){var e,t,r,n;return{audio:null!==(t=null===(e=this._audioProfiles.selected)||void 0===e?void 0:e.audio_bitrate)&&void 0!==t?t:0,video:null!==(n=null===(r=this._videoProfiles.selected)||void 0===r?void 0:r.video_bitrate)&&void 0!==n?n:0}},t.prototype.getTrackingEvents=function(){return this._trackingData},t.prototype.getTrackingEventData=function(e){var t=this._trackingData?this._trackingData[e]:null;return t?{tracking_event:e,urls:t.urls}:null},t}(s.Content);r.DirectorManifestContent=c},{"../../enums/errors":80,"../../error/file":95,"../helpers/preferred_profiles":62,"./base":40,"./helpers/eme":45,"@js-sdk/common/es5/monotonic_now":15,tslib:227}],43:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DirectorManifestHLSContent=void 0;var n=e("tslib"),i=e("../../typedefs"),o=e("../../enums/key_system"),a=e("../../enums/errors"),s=e("../../error/file"),u=e("../helpers/hls"),l=e("./director_manifest_content"),c=function(e){function t(t){var r=e.call(this,t)||this;return r._hlsURLs=[],r.strategy=i.PlaybackStrategy.URL,r._keySystem===o.KeySystem.FAIRPLAY&&(r._supportedFormats.audio.push({mimeType:"audio/mp2t",codec:"mp4a.40.2"}),r._supportedFormats.video.push({mimeType:"video/mp2t",codec:"avc1.4d402a"})),r}return n.__extends(t,e),t.prototype._getHLSURLForProfile=function(e,t){for(var r=this._duration,n=this._segmentLength,i=this._segmentTemplate,o=[],a=0;a<r;a+=n){var s=a+n>r?r-a:n,l=i.replace("{{profile_id}}",e.id.toString(10)).replace("{{segment_timestamp}}",a.toString(10)).replace("{{file_type}}",e.file_type);o.push({duration:s,url:""+this._baseURL+l})}var c=("undefined"==typeof MediaSource?u.createProtectedManifestURL:u.createProtectedManifestDataURL)({assetID:this._assetID,targetDuration:n,map:t?{url:t}:void 0,segments:o});return this._hlsURLs.push(c),c},t.prototype.load=function(t){var r=this;return void 0===t&&(t={resolveLatency:0,manifestLatency:0}),e.prototype.load.call(this,t).then((function(){var e,t;return r._audioProfiles.selected=null!==(e=r._audioProfiles.available[0])&&void 0!==e?e:null,r._videoProfiles.selected=null!==(t=r._videoProfiles.available[0])&&void 0!==t?t:null,r}))},t.prototype.getURL=function(){var e,t;if(!this._baseURL)throw new s.FileError(a.Errors.FILE_NOT_RESOLVED,"Cannot return HLS Manifest URL: File not resolved.");this.unload();var r=[],n=this._audioProfiles.available[0];if(n){var i="ts"!==n.file_type?this._resolver.getInitSegmentURLs(this._baseURL,this._initTemplate,n,void 0).audio:"";r.push('#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="audio",LANGUAGE="eng",NAME="English",AUTOSELECT=YES,URI="'+this._getHLSURLForProfile(n,i)+'"')}for(var o=0,l=this._videoProfiles.available;o<l.length;o++){var c=l[o],d=(null!==(e=null==n?void 0:n.max_bitrate)&&void 0!==e?e:0)+c.max_bitrate,_=(null!==(t=null==n?void 0:n.audio_bitrate)&&void 0!==t?t:0)+c.video_bitrate,p="ts"!==c.file_type?this._resolver.getInitSegmentURLs(this._baseURL,this._initTemplate,void 0,c).video:"";r.push("#EXT-X-STREAM-INF:BANDWIDTH="+d+",AVERAGE-BANDWIDTH="+_+",RESOLUTION="+c.video_width+"x"+c.video_height+',CODECS="'+((null==n?void 0:n.audio_codec)?n.audio_codec+", "+c.video_codec:c.video_codec)+'"'+((null==n?void 0:n.audio_codec)?',AUDIO="audio"':"")+"\n"+this._getHLSURLForProfile(c,p))}var f="#EXTM3U\n"+r.join("\n"),h=("undefined"==typeof MediaSource?u.createHLSBlobURL:u.createHLSDataURL)(f);return this._hlsURLs.push(h),h},t.prototype.unload=function(){for(var e=0,t=this._hlsURLs;e<t.length;e++){var r=t[e];URL.revokeObjectURL(r)}this._hlsURLs=[]},t.prototype.getMediaTypeMimeTypes=function(){var e,t;return{audio:l.getProfileMimeType(null===(e=this._audioProfiles.available)||void 0===e?void 0:e[0]),video:l.getProfileMimeType(null===(t=this._videoProfiles.available)||void 0===t?void 0:t[0])}},t.prototype.getLoadingApproach=function(){return{approach:"source",type:u.HLS_MIME_TYPE}},t.prototype.adaptToBandwidth=function(){return Promise.resolve(!1)},t.prototype.canLowerBitrate=function(){return!1},t}(l.DirectorManifestContent);r.DirectorManifestHLSContent=c},{"../../enums/errors":80,"../../enums/key_system":82,"../../error/file":95,"../../typedefs":104,"../helpers/hls":61,"./director_manifest_content":42,tslib:227}],44:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DirectorManifestMSEContent=void 0;var n=e("tslib"),i=e("@js-sdk/common/es5/monotonic_now"),o=e("../../typedefs"),a=e("../../enums/content_mediator_event"),s=e("../../enums/errors"),u=e("../../error/file"),l=e("../../error/fragment"),c=e("./director_manifest_content"),d=function(e){function t(t){var r=e.call(this,t)||this;return r._initSegmentBuffers={},r.strategy=o.PlaybackStrategy.MSE,r._transport=t.transport,r._abrManager=t.abrManager,r._parseSegmentResponse=r._parseSegmentResponse.bind(r),r}return n.__extends(t,e),t.prototype._isQualityMatched=function(e,t,r){var n,i,a,s;if(this._videoResolution){var u=null!==(n=this._videoResolution.max)&&void 0!==n?n:o.MAX_SAFE_INTEGER,l=null!==(i=this._videoResolution.min)&&void 0!==i?i:0;if(r){var c=null!==(a=this._videoResolution.start)&&void 0!==a?a:u;return e.video_resolution<=c}return e.video_resolution>=l&&e.video_resolution<=u}var d=null!==(s=null==t?void 0:t.audio_bitrate)&&void 0!==s?s:0,_=this._abrManager.getBandwidthEstimate();return e.video_bitrate+d<_-1e5},t.prototype._updateVariants=function(e){var t,r=this._audioProfiles.available[0];this._audioProfiles.selected=null!=r?r:null;var n=this._videoProfiles,i=n.selected,o=null,s=n.available,u=s.length;if(u){for(;u--;){var l=s[u];if(l&&this._isQualityMatched(l,r,!!e)){o=l;break}}o||(o=s[0]),this._videoProfiles.selected=o,(null==i?void 0:i.id)!==o.id&&(null===(t=this._mediator)||void 0===t||t.emit(a.ContentMediatorEvent.VIDEO_PROFILE_CHANGED,{profile:{type:"video",mimeType:o.mime_type,codec:o.video_codec,bitrate:o.video_bitrate,height:o.video_height,width:o.video_width,resolution:o.video_resolution}}))}},t.prototype._constructSegmentURL=function(e,t,r){if(!t&&!r)throw new Error("Both audioProfile and videoProfile is null");return e.init?this._resolver.getInitSegmentURLs(this._baseURL,this._initTemplate,t,r):this._resolver.getSegmentURLs(this._baseURL,this._segmentTemplate,e.timeStart,t,r)},t.prototype._parseSegmentResponse=function(e){var t,r,n,i,o=e.metadata,u=o.segment,d=o.profile,_=o.timeStart,p=o.loggingURL,f=c.getProfileMimeType(d),h=c.getProfileBitrate(d),v="video_resolution"in d?d.video_resolution:void 0,y=u.timeStart+"-"+u.timeEnd,m="video_resolution"in d?"video":"audio";switch(e.status){case 0:var E=new l.FragmentError(s.Errors.FRAGMENT_REQUEST_FAILED_WITH_ZERO,"Request failed with status 0.",0,{time_range:y,mimeType:f,resolution:v,bitrate:h});return null===(t=this._mediator)||void 0===t||t.emit(a.ContentMediatorEvent.FRAGMENT_FETCH_ERROR,{media_type:"video",segment_type:m,url:p,start_time:_,init:u.init,error:E}),Promise.reject(E);case 200:case 206:var g=e.body;if(!(null==g?void 0:g.byteLength)){var R=new l.FragmentError(s.Errors.FRAGMENT_REQUEST_EMPTY_RESPONSE,"Empty response for successful buffer.",e.status,{time_range:y,mimeType:f,resolution:v,bitrate:h});return null===(r=this._mediator)||void 0===r||r.emit(a.ContentMediatorEvent.FRAGMENT_FETCH_ERROR,{media_type:"video",segment_type:m,url:p,start_time:_,init:u.init,error:R}),Promise.reject(R)}var T=g.byteLength,I=8e3*T/e.timing.completed;return null===(n=this._mediator)||void 0===n||n.emit(a.ContentMediatorEvent.FRAGMENT_FETCHED,{media_type:"video",segment_type:m,url:p,init:u.init,byte_length:T,start_time:_,end_time:Date.now(),resolution:v,bandwidth:I}),Promise.resolve({profileId:this._fileId+"-"+d.id,bufferURL:p,byteStart:0,byteEnd:T-1,buffer:g,mimeType:f,resolution:v,bitrate:h,bandwidth:I})}var S=new l.FragmentError(s.Errors.FRAGMENT_REQUEST_FAILED_WITH_STATUS,"Buffer request failed with status "+e.status,e.status,{time_range:y,mimeType:f,resolution:v,bitrate:h});return null===(i=this._mediator)||void 0===i||i.emit(a.ContentMediatorEvent.FRAGMENT_FETCH_ERROR,{media_type:"video",segment_type:m,url:p,init:u.init,start_time:_,error:S}),Promise.reject(S)},t.prototype._fetchBufferData=function(e,t,r,n,i){return this._transport.request(e,{method:"GET",responseType:"arraybuffer",timing:!0,signal:i,retry:{condition:function(e,t){if(0===e.status)return!0;var r=e.getStatusFamily();return 429===e.status||r===t.CONNECTION_ERROR||r===t.SERVER_ERROR}},metadata:{timeStart:Date.now(),segment:t,profile:r,loggingURL:n}}).then(this._parseSegmentResponse)},t.prototype._fetchInitSegmentBuffers=function(e,t,r){var n,o=this,a=this._initSegment;if(!a)return Promise.reject(new u.FileError(s.Errors.FILE_NOT_RESOLVED,"Cannot fetch Init Segment buffers: File not resolved."));try{n=this._constructSegmentURL(a,e,t)}catch(e){return Promise.reject(e)}var l=this._initSegmentBuffers,c=0,d=0,_=i.monotonicNow(),p=function(e){d+=e,--c||(o._abrManager.sample(d,i.monotonicDuration(_)),o._updateVariants())},f=Promise.resolve(null);e&&((null==(h=l[e.id])?void 0:h.buffer.byteLength)?f=Promise.resolve(h):(null==n?void 0:n.audio)&&(c++,f=this._fetchBufferData(n.audio,a,e,n.audioLogging,r).then((function(t){return l[e.id]=t,p(t.buffer.byteLength),t}))));var h,v=Promise.resolve(null);t&&((null==(h=l[t.id])?void 0:h.buffer.byteLength)?v=Promise.resolve(h):(null==n?void 0:n.video)&&(c++,v=this._fetchBufferData(n.video,a,t,n.videoLogging,r).then((function(e){return l[t.id]=e,p(e.buffer.byteLength),e}))));return Promise.all([f,v]).then((function(e){return{audio:e[0],video:e[1]}}))},t.prototype._fetchBufferSetForSegment=function(e,t,r,n){var o,a=this;try{o=this._constructSegmentURL(e,t,r)}catch(e){return Promise.reject(e)}return this._fetchInitSegmentBuffers(t,r,n).then((function(s){var u=0,l=0,c=i.monotonicNow(),d=function(e){l+=e,--u||(a._abrManager.sample(l,i.monotonicDuration(c)),a._updateVariants())},_=null;!e.init&&(null==o?void 0:o.audio)&&(u++,_=a._fetchBufferData(o.audio,e,t,o.audioLogging,n).then((function(e){return d(e.buffer.byteLength),e})));var p=null;return!e.init&&(null==o?void 0:o.video)&&(u++,p=a._fetchBufferData(o.video,e,r,o.videoLogging,n).then((function(e){return d(e.buffer.byteLength),e}))),Promise.all([s,_,p])})).then((function(t){var r,n,i,o=t[0],a=t[1],s=t[2];return e.init?i={audio:null!==(r=o.audio)&&void 0!==r?r:void 0,video:null!==(n=o.video)&&void 0!==n?n:void 0}:(i={audio:null!=a?a:void 0,video:null!=s?s:void 0},e.cacheBufferSet&&(e.bufferSet=i),i.audio&&(null==o?void 0:o.audio)&&(i.audio.initBuffer=o.audio.buffer),i.video&&(null==o?void 0:o.video)&&(i.video.initBuffer=o.video.buffer)),i})).catch((function(e){return Promise.reject(e)}))},t.prototype.load=function(t){var r=this;return void 0===t&&(t={resolveLatency:0,manifestLatency:0}),e.prototype.load.call(this,t).then((function(){return r._updateVariants(!0),r}))},t.prototype.adaptToBandwidth=function(){return this._updateVariants(),Promise.resolve(!0)},t.prototype.canLowerBitrate=function(){var e,t=this._videoProfiles.available[0];return(null===(e=this._videoProfiles.selected)||void 0===e?void 0:e.id)!==(null==t?void 0:t.id)},t.prototype.getMediaTypeMimeTypes=function(){return{audio:c.getProfileMimeType(this._audioProfiles.selected),video:c.getProfileMimeType(this._videoProfiles.selected)}},t.prototype.unload=function(){this._initSegment&&(this._initSegmentBuffers={}),this._segments.forEach((function(e){e.bufferSet=null}))},t.prototype.getCalculatedDuration=function(){return this._duration},t.prototype.getSegmentLength=function(){return this._segmentLength},t.prototype.getSegmentsCount=function(){return this._segments.length},t.prototype.getInitSegment=function(){return this._initSegment},t.prototype.getInitBufferSet=function(){var e,t,r=null!==(e=this._audioProfiles.selected)&&void 0!==e?e:void 0,n=null!==(t=this._videoProfiles.selected)&&void 0!==t?t:void 0;return this._fetchInitSegmentBuffers(r,n).then((function(e){var t,r;return{audio:null!==(t=e.audio)&&void 0!==t?t:void 0,video:null!==(r=e.video)&&void 0!==r?r:void 0}}))},t.prototype.getSegmentForTime=function(e){var t;if(!(null===(t=this._segments)||void 0===t?void 0:t.length))return null;if(0===e||.01===e)return this._segments[0];for(var r=0,n=this._segments;r<n.length;r++){var i=n[r];if(i.timeStart<=e&&i.timeEnd>=e)return i}return null},t.prototype.getSegmentAfterTime=function(e){var t;if(!(null===(t=this._segments)||void 0===t?void 0:t.length))return null;if(0===e||.01===e)return this._segments[1];for(var r=0,n=this._segments;r<n.length;r++){var i=n[r];if(i.timeStart>e)return i}return null},t.prototype.getSegmentsForRange=function(e,t){var r,n=[];if(null===(r=this._segments)||void 0===r?void 0:r.length)for(var i=0,o=this._segments;i<o.length;i++){var a=o[i];a.timeStart<=t&&a.timeEnd>=e&&n.push(a)}return n},t.prototype.getFinalSegment=function(){var e,t;return null!==(t=null===(e=this._segments)||void 0===e?void 0:e[this._segments.length-1])&&void 0!==t?t:null},t.prototype.getBufferSetForSegment=function(e,t){var r,n;if(!e)return Promise.reject(new TypeError("No segment provided"));var i=this._audioProfiles.selected,o=this._videoProfiles.selected,a=null===(n=null===(r=e.bufferSet)||void 0===r?void 0:r.video)||void 0===n?void 0:n.resolution;return e.bufferSet&&(!o||a&&a>=o.video_resolution)?Promise.resolve(e.bufferSet):this._fetchBufferSetForSegment(e,null!=i?i:void 0,null!=o?o:void 0,t)},t}(c.DirectorManifestContent);r.DirectorManifestMSEContent=d},{"../../enums/content_mediator_event":79,"../../enums/errors":80,"../../error/file":95,"../../error/fragment":96,"../../typedefs":104,"./director_manifest_content":42,"@js-sdk/common/es5/monotonic_now":15,tslib:227}],45:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.decodePSSH=void 0;var n=e("@js-sdk/common/es5/encoding");r.decodePSSH=function(e){for(var t=n.Base64.decode(e),r=new Uint8Array(t.length),i=0,o=t.length;i<o;i++)r[i]=t.charCodeAt(i);return r}},{"@js-sdk/common/es5/encoding":13}],46:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createContent=void 0;var n=e("tslib"),i=e("../../enums/errors"),o=e("../../enums/media_format"),a=e("../../enums/key_system"),s=e("../../error/playback"),u=e("../eme/keysystem_setting"),l=e("./url_content"),c=e("./audio_manifest_hls_content"),d=e("./audio_manifest_mse_content"),_=e("./director_manifest_hls_content"),p=e("./director_manifest_mse_content"),f=e("./storage_url_content"),h=e("./ad_manifest_content");function v(e,t){var r;return{mediaType:e.mediaType,logData:e.logData,audioGain:e.audioGain,uri:e.uri,fileId:e.fileId,mediaFormat:e.format,hasNonFatalErrors:null!==(r=e.hasNonFatalErrors)&&void 0!==r?r:e.isAd,disableCache:t.disableCache,keySystem:t.keySystem,licenseEndpoint:e.licenseEndpoint,mediator:t.mediator,noAuth:e.noAuth,mimeType:e.mimeType}}function y(e,t,r){if(!e.fileId)return Promise.reject(new s.PlaybackError(i.Errors.INVALID_TRACK,"Invalid "+e.format+" Track: No fileId."));var o=n.__assign(n.__assign({},v(e,t)),{transport:t.transport,abrManager:t.abrManager,supportedFormats:t.supportedFormats,fileId:e.fileId,keySystemSettings:u.KeySystemSetting[t.keySystem],resolver:t.videoResolver,disallowProfile:t.disallowProfile,allowMixedAVC1Codecs:t.allowMixedAVC1Codecs,trackingData:(null==r?void 0:r.trackingData)||null,metadata:null==r?void 0:r.metadata});return t.keySystem===a.KeySystem.FAIRPLAY?new _.DirectorManifestHLSContent(o).load(t.measures):new p.DirectorManifestMSEContent(o).load(t.measures)}r.createContent=function(e,t){var r,_,p,m,E=v(e,t);switch(e.format){case o.MediaFormat.MP3:return(R=null!==(r=e.url)&&void 0!==r?r:e.resolvedURL)?new l.URLContent(n.__assign(n.__assign({},E),{url:R})).load():e.fileId?new f.StorageURLContent(n.__assign(n.__assign({},E),{fileId:e.fileId,resolver:t.audioResolver})).load():Promise.reject(new s.PlaybackError(i.Errors.INVALID_TRACK,"Invalid "+e.format+" Track: No url or fileId."));case o.MediaFormat.GENERIC_MEDIA:return(R=null!==(_=e.url)&&void 0!==_?_:e.resolvedURL)?new l.URLContent(n.__assign(n.__assign({},E),{url:R})).load():Promise.reject(new s.PlaybackError(i.Errors.INVALID_TRACK,"Invalid "+e.format+" Track: No url."));case o.MediaFormat.MP4:case o.MediaFormat.MP4_DUAL:case o.MediaFormat.MP4_CBCS:case o.MediaFormat.MP4_FLAC:if(!e.fileId)return Promise.reject(new s.PlaybackError(i.Errors.INVALID_TRACK,"Invalid "+e.format+" Track: No fileId."));var g=n.__assign(n.__assign({},E),{transport:t.transport,abrManager:t.abrManager,fileId:e.fileId,keySystemSettings:u.KeySystemSetting[t.keySystem],resolver:t.audioResolver,fileFormat:e.fileFormat,preloadedManifest:e.preloadedManifest,preresolvedURL:null!==(p=e.url)&&void 0!==p?p:e.resolvedURL});return t.keySystem===a.KeySystem.FAIRPLAY?new c.AudioManifestHLSContent(g).load(t.measures):new d.AudioManifestMSEContent(g).load(t.measures);case o.MediaFormat.MANIFEST_ID:return y(e,t);case o.MediaFormat.AD_MANIFEST:var R;if(!(R=null!==(m=e.url)&&void 0!==m?m:e.resolvedURL))return Promise.reject(new s.PlaybackError(i.Errors.INVALID_TRACK,"Invalid "+e.format+" Track: No url."));var T=n.__assign(n.__assign({},E),{abrManager:t.abrManager,transport:t.transport,manifestURL:R,preloadedManifest:e.preloadedManifest});return new h.AdManifestContent(T).load(t.measures).then((function(r){var i=r.getManifestId();if(!i)return r;var a=n.__assign(n.__assign({},e),{fileId:i,format:o.MediaFormat.MANIFEST_ID}),s={trackingData:r.getTrackingEvents(),metadata:r.getContentMetadata()};return y(a,t,s)}));default:return Promise.reject(new s.PlaybackError(i.Errors.INVALID_TRACK,"Cannot create PlayableContent: Invalid MediaFormat."))}}},{"../../enums/errors":80,"../../enums/key_system":82,"../../enums/media_format":84,"../../error/playback":99,"../eme/keysystem_setting":50,"./ad_manifest_content":36,"./audio_manifest_hls_content":38,"./audio_manifest_mse_content":39,"./director_manifest_hls_content":43,"./director_manifest_mse_content":44,"./storage_url_content":47,"./url_content":48,tslib:227}],47:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StorageURLContent=void 0;var n=e("tslib"),i=e("@js-sdk/common/es5/monotonic_now"),o=e("../../typedefs"),a=function(e){function t(t){var r=e.call(this,t)||this;return r._url="",r.strategy=o.PlaybackStrategy.URL,r._fileId=t.fileId,r._resolver=t.resolver,r}return n.__extends(t,e),t.prototype._getCDNURLs=function(e){var t=this._fileId,r=i.monotonicNow();return this._resolver.getCDNURL(t).then((function(t){return e&&(e.resolveLatency=i.monotonicDuration(r)),t}))},t.prototype.load=function(e){var t=this;return void 0===e&&(e={resolveLatency:0,manifestLatency:0}),this._getCDNURLs(e).then((function(e){return t._url=e.uri,t}))},t.prototype.unload=function(){},t.prototype.isProtected=function(){return!1},t.prototype.getMediaTypeMimeTypes=function(){return{audio:"audio/mp3"}},t.prototype.getURL=function(){return this._url},t.prototype.getLoadingApproach=function(){return{approach:"source",type:"audio/mp3"}},t}(e("./base").Content);r.StorageURLContent=a},{"../../typedefs":104,"./base":40,"@js-sdk/common/es5/monotonic_now":15,tslib:227}],48:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.URLContent=void 0;var n=e("tslib"),i=e("../../typedefs"),o=e("../../enums/errors"),a=e("../../error/file");var s=function(e){function t(t){var r=e.call(this,t)||this;return r.strategy=i.PlaybackStrategy.URL,r._url=t.url,r._mimeType=t.mimeType,r}return n.__extends(t,e),t.prototype.load=function(){var e,t;if(this._mimeType&&!(e=this._mimeType,t=this.getMediaType(),""!==document.createElement(t).canPlayType(e)))throw new a.FileError(o.Errors.FILE_FORMAT_NOT_SUPPORTED,"Content is not playable.");return Promise.resolve(this)},t.prototype.unload=function(){},t.prototype.isProtected=function(){return!1},t.prototype.getMediaTypeMimeTypes=function(){var e,t;return"video"===this._mediaType?{video:null!==(e=this._mimeType)&&void 0!==e?e:"video/mp4"}:{audio:null!==(t=this._mimeType)&&void 0!==t?t:"audio/mp3"}},t.prototype.getURL=function(){return this._url},t.prototype.getLoadingApproach=function(){return{approach:"src"}},t}(e("./base").Content);r.URLContent=s},{"../../enums/errors":80,"../../error/file":95,"../../typedefs":104,"./base":40,tslib:227}],49:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.EMEConfigs=void 0;var n=e("tslib");r.EMEConfigs=[{label:"video-hw-all",robustness:{audio:"SW_SECURE_CRYPTO",video:"HW_SECURE_ALL"}},{label:"video-hw-decode",robustness:{audio:"SW_SECURE_CRYPTO",video:"HW_SECURE_DECODE"}},{label:"video-hw-crypto",robustness:{audio:"SW_SECURE_CRYPTO",video:"HW_SECURE_CRYPTO"}},{label:"video-sw-decode",robustness:{audio:"SW_SECURE_CRYPTO",video:"SW_SECURE_DECODE"}},{label:"video-sw-crypto",robustness:{audio:"SW_SECURE_CRYPTO",video:"SW_SECURE_CRYPTO"}},{label:"video-no-robustness",robustness:{audio:"",video:""}},{label:"audio-flac-sw-crypto",robustness:{audio:"SW_SECURE_CRYPTO"},includesOpus:!1},{label:"audio-flac-no-robustness",robustness:{audio:""},includesOpus:!1},{label:"audio-sw-crypto",robustness:{audio:"SW_SECURE_CRYPTO"},includesFlac:!1,includesOpus:!1},{label:"audio-no-robustness",robustness:{audio:""},includesFlac:!1,includesOpus:!1}].map((function(e){var t=e.label,r=e.robustness,i=e.includesFlac,o=void 0===i||i,a=e.includesOpus,s=void 0===a||a,u=n.__spreadArray(n.__spreadArray(n.__spreadArray([],o?[{contentType:'audio/mp4; codecs="flac"',robustness:r.audio}]:[]),[{contentType:'audio/mp4; codecs="mp4a.40.2"',robustness:r.audio},{contentType:'audio/mp4; codecs="mp4a.40.5"',robustness:r.audio}]),s?[{contentType:'audio/webm; codecs="opus"',robustness:r.audio}]:[]),l=[{contentType:'video/mp4; codecs="avc1.64002a"',robustness:r.video},{contentType:'video/mp4; codecs="avc1.4d402a"',robustness:r.video},{contentType:'video/mp4; codecs="avc1.4d401f"',robustness:r.video},{contentType:'video/webm; codecs="vp9"',robustness:r.video},{contentType:'video/webm; codecs="vp8"',robustness:r.video}];return{label:t,initDataTypes:["cenc"],audioCapabilities:void 0!==r.audio?u:[],videoCapabilities:void 0!==r.video?l:[],distinctiveIdentifier:"optional",persistentState:"optional",sessionTypes:["temporary"]}}))},{tslib:227}],50:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.KeySystemSetting=void 0;var i=e("../../enums/key_system");r.KeySystemSetting=((n={})[i.KeySystem.WIDEVINE]={commonName:"widevine",licenseServer:"https://@webgate/widevine-license",withCertificate:!0,pssh_field:{audio:"pssh_widevine",video:"encryption_data"}},n[i.KeySystem.PLAYREADY]={commonName:"playready",licenseServer:"https://@webgate/playready-license",withCertificate:!1,pssh_field:{audio:"pssh_playready",video:"encryption_data"}},n[i.KeySystem.PLAYREADY_HARDWARE]={commonName:"playready",licenseServer:"https://@webgate/playready-license",withCertificate:!1,pssh_field:{audio:"pssh_playready",video:"encryption_data"}},n[i.KeySystem.FAIRPLAY]={commonName:"fairplay",licenseServer:"https://@webgate/fairplay-license",withCertificate:!0,pssh_field:{audio:"pssh_fairplay",video:"asset_id"}},n[i.KeySystem.INVALID_SPOTIFY_KEY]={commonName:"spotify-invalid",licenseServer:"https://@webgate",withCertificate:!1,pssh_field:{audio:"pssh_invalid",video:"encryption_data"}},n)},{"../../enums/key_system":82}],51:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.EMEManager=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@js-sdk/common/es5/debug_tools"),a=e("@js-sdk/common/es5/promise_resolver"),s=e("@js-sdk/common/es5/monotonic_now"),u=e("../../enums/event"),l=e("../../enums/errors"),c=e("../../enums/key_system"),d=e("../../error/eme"),_=e("../../error/capping"),p=e("./polyfills"),f=e("./keysystem_setting"),h=e("./configs"),v=e("../helpers/eme"),y=/([^;]+)(?:;\s?codecs="(.*)")?/,m=o.logging.forTag("playback.eme_manager"),E={EMPTY:"-no-robustness",SW_CRYPTO:"-sw-crypto",SW_DECODE:"-sw-decode",HW_CRYPTO:"-hw-crypto",HW_DECODE:"-hw-decode",HW_ALL:"-hw-all"};function g(e,t){for(var r,n=[],i=new RegExp('codecs="('+t.join("|")+')"'),o=0,a=e;o<a.length;o++){var s=a[o];i.test(null!==(r=s.contentType)&&void 0!==r?r:"")||n.push(s)}return n.length?n:null}function R(e,t){var r,i,o,a,s=t.audio,u=t.video;if(!(null==s?void 0:s.length)&&!(null==u?void 0:u.length))return e;var l=e.audioCapabilities,c=e.videoCapabilities;return(null==s?void 0:s.length)&&(null===(r=e.audioCapabilities)||void 0===r?void 0:r.length)&&!(l=null!==(i=g(e.audioCapabilities,s))&&void 0!==i?i:void 0)||(null==u?void 0:u.length)&&(null===(o=e.videoCapabilities)||void 0===o?void 0:o.length)&&!(c=null!==(a=g(e.videoCapabilities,u))&&void 0!==a?a:void 0)?null:n.__assign(n.__assign({},e),{audioCapabilities:l,videoCapabilities:c})}var T=function(e){function t(t){var r,n=e.call(this)||this;return n._unauthServerCertificateBase="",n._disallowCodecs={},n._keySystemDeferred=a.createPromiseResolver(),n._configuration=a.createPromiseResolver(),n._keySystemSettings=null,n._keySessions=[],n._configs=[],n._pendingCertificateRequest=null,n._certificate=null,n._transport=t.transport,n._emeImpl=t.emeImpl,n._noServerCertificate=!!t.noServerCertificate,n._precacheServerCertificate=null===(r=t.precacheServerCertificate)||void 0===r||r,n._unauthServerCertificateBase=t.unauthServerCertificateBase||"https://spclient.wg.spotify.com",n._configFilter=function(e){var t=["--ensure-no-match--"];if(null==e?void 0:e.length)for(var r=e.length;r--;){var n=e[r];n&&E.hasOwnProperty(n)&&t.push(E[n])}return new RegExp("("+t.join("|")+")$")}(t.disallowRobustnessValues||[]),n._disallowCodecs=t.disallowCodecs,n._preferredKeySystems=t.preferredKeySystems||[c.KeySystem.WIDEVINE,c.KeySystem.PLAYREADY,c.KeySystem.PLAYREADY_HARDWARE,c.KeySystem.FAIRPLAY],n}return n.__extends(t,e),t.create=function(e){return new Promise((function(r){var i=p.install();if(!i)throw d.EMEError.fatal(l.Errors.EME_API_NOT_SUPPORTED,"Platform does not support navigator.requestMediaKeySystemAccess");r(new t(n.__assign(n.__assign({},e),{emeImpl:i})).init())}))},t.prototype._prepareConfiguration=function(e){var t=e.getConfiguration();m.info("KeySystem configured as",t.label),t.audioCapabilities&&t.audioCapabilities.length||this._appendProbableMediaCapabilities(e.keySystem,t);var r={keySystem:e.keySystem,keySystemImpl:this._emeImpl,audioFormats:this._parseCapabilities(t.audioCapabilities),videoFormats:this._parseCapabilities(t.videoCapabilities)};return this._keySystemSettings=f.KeySystemSetting[e.keySystem],this._configuration.resolve(r),r},t.prototype._parseCapabilities=function(e){var t;if(!e)return[];for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n];if(null==o?void 0:o.contentType){var a=null!==(t=o.contentType.match(y))&&void 0!==t?t:[],s=a[1],u=a[2];s&&r.push({contentType:o.contentType,mimeType:s,codec:null!=u?u:""})}}return r},t.prototype._appendProbableMediaCapabilities=function(e,t){var r=v.getMediaKeySystemConfiguration(this._configs,(function(t){return(-1===t.indexOf("webm")||e!==c.KeySystem.PLAYREADY&&e!==c.KeySystem.PLAYREADY_HARDWARE)&&!!MediaSource.isTypeSupported(t)}));r&&(t.audioCapabilities=r.audioCapabilities,t.videoCapabilities=r.videoCapabilities)},t.prototype._trySetServerCertificate=function(e,t){var r=this,n=this._certificate;return(n&&n.expiry>Date.now()?Promise.resolve(n):this._requestServerCertificate(e)).then((function(e){return t.setServerCertificate(e.contents)})).then((function(){return r})).catch((function(e){return m.warn("Error from setting server certificate",e),r}))},t.prototype._cacheServerCertificate=function(e){var t=this,r="";switch(e){case c.KeySystem.FAIRPLAY:r="fairplay";break;case c.KeySystem.WIDEVINE:r="widevine";break;default:return Promise.resolve(this)}return this._requestServerCertificate(this._unauthServerCertificateBase+"/"+r+"-license",!1).then((function(){return t}),(function(e){return m.warn("Cannot precache server certificate",e),t}))},t.prototype._requestServerCertificate=function(e,t){var r=this;return void 0===t&&(t=!0),this._pendingCertificateRequest?this._pendingCertificateRequest:this._transport.request(e+"/v1/application-certificate",{authorize:t,responseType:"arraybuffer",parseResponseHeaders:!0,retry:{condition:function(e,t){return e.getStatusFamily()===t.SERVER_ERROR}}}).then((function(e){var t;if(!e.body)throw new TypeError("Response body is invalid");r._pendingCertificateRequest=null;var n=3600,i=null===(t=e.headers)||void 0===t?void 0:t.get("cache-control");if(i){var o=i.match(/(?:^|,|\s)max-age=(\d+)(?:,|$)/);o&&o[1]&&(n=1e3*parseInt(o[1],10))}return r._certificate={expiry:Date.now()+(n-600),contents:e.body},r._certificate}))},t.prototype._extractPlayReadyChallenge=function(e,t){var r,n=null,i=new Uint16Array(e),o=String.fromCharCode.apply(null,i);if(-1===o.indexOf("PlayReadyKeyMessage"))return m.info("Using unextracted PlayReady message."),e;var a=(new DOMParser).parseFromString(o,"application/xml"),s=a.getElementsByTagName("Challenge")[0],c=null===(r=null==s?void 0:s.childNodes[0])||void 0===r?void 0:r.nodeValue;if(c)try{n=atob(c);var _=a.getElementsByTagName("name"),p=a.getElementsByTagName("value");if(_.length!==p.length)throw new d.EMEError(l.Errors.EME_HEADER_KEY_VALUE_MISMATCH,"Mismatched header <name>/<value> pair in key message")}catch(e){this.emit(u.Event.EME_LICENSE_REQUEST_ERROR,{signal:t,error:e}),n=null}else this.emit(u.Event.EME_LICENSE_REQUEST_ERROR,{signal:t,error:new d.EMEError(l.Errors.EME_HEADER_KEY_VALUE_MISMATCH,"Mismatched header <name>/<value> pair in key message")});return n},t.prototype._onMessage=function(e,t){e.timeMap.generate.end=s.monotonicNow();var r="message"in t?t.message:null,n="messageType"in t?t.messageType:void 0;if(m.info("Got EME message event with type",n),r&&e.keySystem===c.KeySystem.PLAYREADY&&(r=this._extractPlayReadyChallenge(r,e.signal)),r)if(e.licenseServer){e.timeMap.request.start=s.monotonicNow();var i=e.licenseServer;e.keySystem===c.KeySystem.FAIRPLAY&&(i=i+(-1!==i.indexOf("?")?"&":"?")+"assetId=hex"),this._transport.request(i,{method:"POST",payload:r,responseType:"arraybuffer",retry:{condition:function(e,t){return 400!==e.status&&402!==e.status&&403!==e.status&&(!e.body||e.getStatusFamily()!==t.SUCCESS)}}}).then(this._handleLicenseResponse.bind(this,e))}else m.info("Ignoring message event: no licenseServer url");else m.info("Ignoring message event: no valid request payload")},t.prototype._handleLicenseResponse=function(e,t){var r,n=this,i=function(t){e.licenseServer&&(t.licenseServer=e.licenseServer),n.emit(u.Event.EME_LICENSE_REQUEST_ERROR,{signal:e.signal,error:t})};if(e.timeMap.request.end=s.monotonicNow(),200!==t.status){var o;try{if(t.body){var a=new Uint8Array(t.body),c=String.fromCharCode.apply(String,a);o=JSON.parse(c).errorMsg}}catch(e){}402===t.status?this.emit(u.Event.EME_LICENSE_REQUEST_CAPPED,{signal:e.signal,error:new _.CappingError(l.Errors.CAPPING_USER_IS_CAPPED,"User is capped.")}):400===t.status&&"widevine error"===o?((r=d.EMEError.fatal(l.Errors.EME_LICENSE_REQUEST_WIDEVINE_ERROR,"Widevine license server failed to parse request.")).status=t.status,r.shouldRefreshEndpoint=!0,i(r)):((r=new d.EMEError(l.Errors.EME_LICENSE_REQUEST_FAILED_WITH_STATUS,"License request failed ("+(o||"unknown")+")")).status=t.status,r.shouldRefreshEndpoint=400===t.status||403===t.status,i(r))}else{if(!t.body)return(r=new d.EMEError(l.Errors.EME_LICENSE_REQUEST_EMPTY_RESPONSE,"Empty license response body")).status=t.status,void i(r);try{e.timeMap.update.start=s.monotonicNow(),e.keySession.update(t.body).catch((function(e){i(new d.EMEError(l.Errors.EME_LICENSE_UPDATE_FAILED,e.message||"License update failed."))})),m.info("KeySession updated.")}catch(e){var p=e.message;i(new d.EMEError(l.Errors.EME_LICENSE_UPDATE_FAILED,p||"License update failed."))}}},t.prototype._selectKeySystem=function(e){for(var t=this._preferredKeySystems,r=0,n=t.length;r<n;r++){var i=t[r];if(i&&i in e)return e[i]}return null},t.prototype._testMediaKeys=function(e){return new Promise((function(t){t(e.createMediaKeys())})).then((function(t){if(!t)return Promise.reject(d.EMEError.fatal(l.Errors.EME_MEDIA_KEYS_NOT_SUPPORTED,"Cannot create MediaKeys from KeySystemAccess"));e.keySystem===c.KeySystem.FAIRPLAY&&t.setServerCertificate(new ArrayBuffer(0));try{if(!t.createSession())throw new Error("")}catch(e){var r=e.message;return Promise.reject(d.EMEError.fatal(l.Errors.EME_MEDIA_KEY_SESSION_NOT_SUPPORTED,r||"Cannot create MediaKeySession from KeySystemAccess"))}return Promise.resolve(e)}),(function(e){return m.error(e.name),Promise.reject(d.EMEError.fatal(l.Errors.EME_MEDIA_KEYS_NOT_SUPPORTED,e.message||"Unknown error"))}))},t.prototype._saveSession=function(e){this._keySessions.push(e)},t.prototype.destroySessions=function(){for(var e=[],t=0,r=this._keySessions;t<r.length;t++){var n=r[t];try{var i=n.keySession;if(!i)continue;n.onMessageListener&&i.removeEventListener(u.Event.KEY_SESSION_MESSAGE,n.onMessageListener),n.onKeyStatusChangeListener&&i.removeEventListener(u.Event.KEY_SESSION_STATUSES_CHANGE,n.onKeyStatusChangeListener);var o=Promise.resolve(i.close()).catch((function(e){m.warn("Failed to close KeySession",e)}));e.push(o),n.keySession=null,n.onMessageListener=null,n.onKeyStatusChangeListener=null,m.info("Closed KeySession")}catch(e){m.warn("Failed to close KeySession",e)}}return this._keySessions=[],Promise.all(e)},t.prototype.init=function(){for(var e=[],t=0,r=h.EMEConfigs;t<r.length;t++){var n=r[t];if(!n.label||!this._configFilter.test(n.label)){if(this._disallowCodecs){var i=R(n,this._disallowCodecs);if(!i)continue;n=i}e.push(n)}}return this._configs=e,this.requestMediaKeySystemAccess()},t.prototype.requestMediaKeySystemAccess=function(){var e=this,t=this._keySystemDeferred,r={},n=[];for(var i in c.KeySystem)if(Object.prototype.hasOwnProperty.call(c.KeySystem,i)){var o=i;n.push(navigator.requestMediaKeySystemAccess(c.KeySystem[o],this._configs).then((function(e){r[e.keySystem]=e})).catch((function(){})))}return Promise.all(n).then((function(){return e._selectKeySystem(r)})).then((function(t){return t?(m.info("Supported keySystem: ",t.keySystem),e._testMediaKeys(t)):Promise.reject(new d.EMEError(l.Errors.EME_NO_SUPPORTED_KEYSYSTEM,"No supported keysystem was found."))})).then((function(r){return e._prepareConfiguration(r),t.resolve(r),e._precacheServerCertificate?e._cacheServerCertificate(r.keySystem):e})).catch((function(r){var n=r.code||l.Errors.EME_NO_SUPPORTED_KEYSYSTEM,i=r.message||"No supported keysystem";return t.reject(d.EMEError.fatal(n,i)),t.promise.then((function(){return e}))}))},t.prototype.createMediaKeys=function(e){var t=this;return this._keySystemDeferred.promise.then((function(e){return e.createMediaKeys()})).then((function(r){return t.setMediaKeys(e,r)})).then((function(){return t._configuration.promise.then((function(){var r=t._keySystemSettings;return r&&!t._noServerCertificate&&r.withCertificate?t._trySetServerCertificate(r.licenseServer,e.mediaKeys):t}))}))},t.prototype.setMediaKeys=function(e,t){var r=this;return e.setMediaKeys(t).then((function(){if(!e.mediaKeys)throw new d.EMEError(l.Errors.EME_PLAYER_MEDIA_KEYS_SETTING_FAILED,"Failed to set MediaKeys on HTMLMediaElement");return r}))},t.prototype.removeMediaKeys=function(e){var t=e.mediaKeys;return Promise.resolve(e.setMediaKeys(null)).then((function(){return t}))},t.prototype.getKeySystemInfo=function(){return this._configuration.promise},t.prototype.getKeySystemImpl=function(){return this._emeImpl},t.prototype.createSessionWithParams=function(e){var t=this;return new Promise((function(r,n){m.info("Creating KeySession",e.keySystem);var i=e.mediaKeys.createSession(),o={generate:{start:null,end:null},request:{start:null,end:null},update:{start:null,end:null}},a=t._keySystemSettings&&t._keySystemSettings.licenseServer||void 0,c=t._onMessage.bind(t,{keySystem:e.keySystem,keySession:i,licenseServer:e.licenseServer||a,signal:e.signal,timeMap:o});i.addEventListener(u.Event.KEY_SESSION_MESSAGE,c);var _=function(){m.info("KeyStatus change"),o.update.end=s.monotonicNow();var e=function(e){return null!==e.start&&null!==e.end?s.monotonicDuration(e.start,e.end):0};r({elapsed:{generate:e(o.generate),request:e(o.request),update:e(o.update)}})};return i.addEventListener(u.Event.KEY_SESSION_STATUSES_CHANGE,_),t._saveSession({keySession:i,onMessageListener:c,onKeyStatusChangeListener:_}),m.info("Generating KeySession request",e.keySystem),o.generate.start=s.monotonicNow(),Promise.resolve(i.generateRequest(e.initDataType,e.initData.buffer)).catch((function(e){if(e){var t;switch(e.name){case"NotSupportedError":t=l.Errors.EME_NOT_SUPPORTED_ERROR;break;case"InvalidStateError":t=l.Errors.EME_INVALID_STATE_ERROR;break;default:t=l.Errors.EME_UNKNOWN_ERROR}n(new d.EMEError(t,e.message||"Unknown error message."))}}))}))},t}(i.EventEmitter);r.EMEManager=T},{"../../enums/errors":80,"../../enums/event":81,"../../enums/key_system":82,"../../error/capping":93,"../../error/eme":94,"../helpers/eme":60,"./configs":49,"./keysystem_setting":50,"./polyfills":53,"@js-sdk/common/es5/debug_tools":9,"@js-sdk/common/es5/monotonic_now":15,"@js-sdk/common/es5/promise_resolver":16,"@spotify-internal/emitter/es5":109,tslib:227}],52:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.emitEncrypted=void 0,r.emitEncrypted=function(e){var t=document.createEvent("Event");t.initEvent("encrypted",!1,!1),t.initDataType="cenc",t.initData=e.initData,t.fromPolyfill=!0,this.dispatchEvent(t)}},{}],53:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.install=void 0;var n=e("@js-sdk/common/es5/debug_tools"),i=e("./ms_ie"),o=e("./v0_1b"),a=e("./safari"),s=n.logging.forTag("eme_polyfills.tester");r.install=function(){return"undefined"!=typeof navigator&&(null===navigator||void 0===navigator?void 0:navigator.requestMediaKeySystemAccess)&&"undefined"==typeof WebKitMediaKeys&&"undefined"!=typeof MediaKeySystemAccess&&(null===MediaKeySystemAccess||void 0===MediaKeySystemAccess?void 0:MediaKeySystemAccess.prototype.getConfiguration)?(s.log("Using native EME implementation."),"native"):"undefined"!=typeof HTMLMediaElement&&(null===HTMLMediaElement||void 0===HTMLMediaElement?void 0:HTMLMediaElement.prototype.webkitGenerateKeyRequest)?(s.log('Detected "webkit" Prefixed EME v0.1b. Polyfilling.'),o.setup("webkit"),"v0.1b-webkit"):"undefined"!=typeof HTMLMediaElement&&(null===HTMLMediaElement||void 0===HTMLMediaElement?void 0:HTMLMediaElement.prototype.generateKeyRequest)?(s.log("Detected Unprefixed EME v0.1b. Polyfilling."),o.setup(),"v0.1b"):"undefined"!=typeof MSMediaKeys?(s.log("Detected MS IE EME. Polyfilling."),i.setup(),"ms-ie"):"function"==typeof WebKitMediaKeys?(s.log("Detected Safari EME. Polyfilling."),a.setup(),"safari"):(s.warn("Detected no EME APIs."),null)}},{"./ms_ie":55,"./safari":56,"./v0_1b":57,"@js-sdk/common/es5/debug_tools":9}],54:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LicenseRequestEvent=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("../../../enums/event"),a=function(e){function t(t){var r=e.call(this,o.Event.KEY_SESSION_MESSAGE,null)||this;return r.messageType="license-request",r.message=t,r}return n.__extends(t,e),t}(i.EmittedEvent);r.LicenseRequestEvent=a},{"../../../enums/event":81,"@spotify-internal/emitter/es5":109,tslib:227}],55:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@js-sdk/common/es5/promise_resolver"),a=e("../../../enums/errors"),s=e("../../../enums/event"),u=e("../../../error/eme"),l=e("./emit_encrypted"),c=e("./license_request_event"),d=function(e){function t(t){var r=e.call(this)||this;return r._nativeKeySession=null,r._lastUpdateDeferred=o.createPromiseResolver(),r._lastGenerateDeferred=o.createPromiseResolver(),r.addEventListener=r.addListener,r.removeEventListener=r.removeListener,r._nativeMediaKeys=t,r._onKeyMessage=r._onKeyMessage.bind(r),r._onKeyAdded=r._onKeyAdded.bind(r),r._onKeyError=r._onKeyError.bind(r),r}return n.__extends(t,e),t.prototype._attach=function(){var e=this._nativeKeySession;e&&(e.addEventListener(s.Event.MS_KEY_ADDED,this._onKeyAdded),e.addEventListener(s.Event.MS_KEY_ERROR,this._onKeyError),e.addEventListener(s.Event.MS_KEY_MESSAGE,this._onKeyMessage))},t.prototype._detach=function(){var e=this._nativeKeySession;e&&(e.removeEventListener(s.Event.MS_KEY_ADDED,this._onKeyAdded),e.removeEventListener(s.Event.MS_KEY_ERROR,this._onKeyError),e.removeEventListener(s.Event.MS_KEY_MESSAGE,this._onKeyMessage))},t.prototype._onKeyMessage=function(e){e.message&&e.message.buffer&&(this.emitEvent(new c.LicenseRequestEvent(e.message.buffer)),this._lastGenerateDeferred&&(this._lastGenerateDeferred.resolve(!0),this._lastGenerateDeferred=null))},t.prototype._onKeyAdded=function(){this._lastUpdateDeferred&&(this._lastUpdateDeferred.resolve(!0),this._lastUpdateDeferred=null),this._lastGenerateDeferred&&(this._lastGenerateDeferred.resolve(!0),this._lastGenerateDeferred=null),this.emit(s.Event.KEY_SESSION_STATUSES_CHANGE,null)},t.prototype._onKeyError=function(){var e=this._nativeKeySession&&this._nativeKeySession.error;this._lastGenerateDeferred&&(this._lastGenerateDeferred.reject(e),this._lastGenerateDeferred=null),this._lastUpdateDeferred&&(this._lastUpdateDeferred.reject(e),this._lastUpdateDeferred=null),this.emit(s.Event.KEY_SESSION_STATUSES_CHANGE,null)},t.prototype.generateRequest=function(e,t){var r=this;return new Promise((function(e,n){r._lastGenerateDeferred&&(r._lastGenerateDeferred.resolve=e,r._lastGenerateDeferred.reject=n),r._nativeKeySession=r._nativeMediaKeys.createSession("audio/mp4",new Uint8Array(t),null),r._attach()}))},t.prototype.update=function(e){var t=this;return new Promise((function(r,n){t._lastGenerateDeferred&&(t._lastGenerateDeferred.resolve=r,t._lastGenerateDeferred.reject=n),t._nativeKeySession&&t._nativeKeySession.update(new Uint8Array(e))}))},t.prototype.close=function(){var e=this;return new Promise((function(t){e._nativeKeySession&&e._nativeKeySession.close(),e._detach(),t(!0)}))},t}(i.EventEmitter),_=function(){function e(e){this._lastBoundSetter=null,this.shouldRefreshPerTrack=!0,this._nativeMediaKeys=new MSMediaKeys(e)}return e.prototype.attach=function(e){var t=this;return new Promise((function(r){if(e.readyState>=1)return e.msSetMediaKeys(t._nativeMediaKeys),void r();var n=function r(){e.removeEventListener(s.Event.MEDIA_LOADEDMETADATA,r),t._lastBoundSetter=null,e.msSetMediaKeys(t._nativeMediaKeys)};t._lastBoundSetter=n,e.addEventListener(s.Event.MEDIA_LOADEDMETADATA,n),e.addEventListener(s.Event.MS_NEEDKEY,l.emitEncrypted),r()}))},e.prototype.detach=function(e){this._lastBoundSetter&&(e.removeEventListener(s.Event.MS_NEEDKEY,l.emitEncrypted),e.removeEventListener(s.Event.MEDIA_LOADEDMETADATA,this._lastBoundSetter),this._lastBoundSetter=null)},e.prototype.setServerCertificate=function(){return Promise.reject(new u.EMEError(a.Errors.EME_CANNOT_SET_CERTIFICATE_FOR_PLATFORM,"Cannot set server certificate on this platform."))},e.prototype.createSession=function(){return new d(this._nativeMediaKeys)},e}();function p(e){var t=this.mediaKeys;return t&&t!==e&&t.detach(this),delete this.mediaKeys,this.mediaKeys=e,e&&e.attach(this),Promise.resolve()}var f=function(){function e(e,t){if(this._configuration=null,this.keySystem=e,!this._checkConfig(t))throw new u.EMEError(a.Errors.EME_NO_SUPPORTED_CONFIGURATION,"No supported configurations")}return e.prototype._checkConfig=function(e){for(var t,r,n=this.keySystem,i=0,o=e;i<o.length;i++){var a=o[i],s={initDataTypes:a.initDataTypes,audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",sessionTypes:["temporary"],label:a.label},u=void 0;if(a.audioCapabilities&&a.audioCapabilities.length&&s.audioCapabilities){u=!1;for(var l=0,c=a.audioCapabilities;l<c.length;l++){var d=null===(t=(f=c[l]).contentType)||void 0===t?void 0:t.split(";")[0];MSMediaKeys.isTypeSupported(n,d)&&(s.audioCapabilities.push(f),u=!0)}}if(a.videoCapabilities&&a.videoCapabilities.length&&s.videoCapabilities){u=!1;for(var _=0,p=a.videoCapabilities;_<p.length;_++){var f;d=null===(r=(f=p[_]).contentType)||void 0===r?void 0:r.split(";")[0];MSMediaKeys.isTypeSupported(n,d)&&(s.videoCapabilities.push(f),u=!0)}}if(u)return this._configuration=s,!0}return!1},e.prototype.getConfiguration=function(){return this._configuration},e.prototype.createMediaKeys=function(){var e=this;return new Promise((function(t){t(new _(e.keySystem))}))},e}();r.setup=function(){navigator.requestMediaKeySystemAccess=function(e,t){return new Promise((function(r){r(new f(e,t))}))};var e=HTMLMediaElement.prototype;delete e.mediaKeys,e.setMediaKeys=p}},{"../../../enums/errors":80,"../../../enums/event":81,"../../../error/eme":94,"./emit_encrypted":52,"./license_request_event":54,"@js-sdk/common/es5/promise_resolver":16,"@spotify-internal/emitter/es5":109,tslib:227}],56:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=void 0;var n=e("tslib"),i=e("@js-sdk/common/es5/debug_tools"),o=e("@spotify-internal/emitter/es5"),a=e("@js-sdk/common/es5/promise_resolver"),s=e("../../../enums/errors"),u=e("../../../enums/event"),l=e("../../../error/eme"),c=e("./emit_encrypted"),d=e("./license_request_event"),_=i.logging.forTag("eme_polyfill.safari");var p=function(e){function t(t,r){var n=e.call(this)||this;return n._attached=!1,n._nativeKeySession=null,n._lastGenerateResolver=a.createPromiseResolver(),n._lastUpdateResolver=a.createPromiseResolver(),n.addEventListener=n.addListener,n.removeEventListener=n.removeListener,n._nativeMediaKeys=t,n._serverCertificate=r,n._onKeyMessage=n._onKeyMessage.bind(n),n._onKeyAdded=n._onKeyAdded.bind(n),n._onKeyError=n._onKeyError.bind(n),n}return n.__extends(t,e),t.prototype._attach=function(){if(!this._attached){var e=this._nativeKeySession;e?(e.addEventListener(u.Event.WEBKIT_KEY_MESSAGE,this._onKeyMessage),e.addEventListener(u.Event.WEBKIT_KEY_ADDED,this._onKeyAdded),e.addEventListener(u.Event.WEBKIT_KEY_ERROR,this._onKeyError)):_.warn("Tried to attach with no WebKitMediaKeySession")}},t.prototype._detach=function(){if(this._attached){var e=this._nativeKeySession;e?(e.removeEventListener(u.Event.WEBKIT_KEY_MESSAGE,this._onKeyMessage),e.removeEventListener(u.Event.WEBKIT_KEY_ADDED,this._onKeyAdded),e.removeEventListener(u.Event.WEBKIT_KEY_ERROR,this._onKeyError)):_.warn("Tried to detach with no WebKitMediaKeySession")}},t.prototype._onKeyMessage=function(e){e.message&&e.message.buffer&&(this.emitEvent(new d.LicenseRequestEvent(e.message.buffer)),this._lastGenerateResolver&&(this._lastGenerateResolver.resolve(!0),this._lastGenerateResolver=null))},t.prototype._onKeyAdded=function(){this._lastUpdateResolver&&(this._lastUpdateResolver.resolve(!0),this._lastUpdateResolver=null),this.emit(u.Event.KEY_SESSION_STATUSES_CHANGE,null)},t.prototype._onKeyError=function(){var e=this._nativeKeySession&&this._nativeKeySession.error,t=new l.EMEError(s.Errors.EME_MEDIA_KEY_SESSION_SAFARI_ERROR,e&&e.message||"MediaKeySession Safari Error");e&&(t.debug.errorCode=e.code,t.debug.systemCode=e.systemCode),this._lastGenerateResolver?(this._lastGenerateResolver.reject(t),this._lastGenerateResolver=null):this._lastUpdateResolver&&(this._lastUpdateResolver.reject(t),this._lastUpdateResolver=null)},t.prototype._rebuildInitData=function(e){var t=new Uint8Array(e);if(new DataView(t.buffer).getUint32(0,!0)+4!==t.byteLength)throw new l.EMEError(s.Errors.EME_INIT_DATA_MALFORMED,"Malformed init data");var r=function(e){for(var t=Math.floor(e.byteLength/2),r=new Uint16Array(t),n=new DataView(e.buffer),i=0;i<t;i++)r[i]=n.getUint16(2*i,!0);return String.fromCharCode.apply(null,r)}(t.slice(4)).match(/^skd:\/\/([0-9a-fA-F]+)/);if(!(null==r?void 0:r[1]))throw new l.EMEError(s.Errors.EME_INIT_DATA_MALFORMED,"Invalid content ID");var n=r[1],i=new Uint8Array(function(e){for(var t=new Uint8Array(2*e.length),r=new DataView(t.buffer),n=e.split(""),i=0,o=n.length;i<o;i++){var a=n[i].charCodeAt(0);r.setUint16(2*i,a,!0)}return t.buffer}(n)),o=this._serverCertificate,a=new Uint8Array(t.byteLength+4+i.byteLength+4+o.byteLength),u=0;a.set(t,u),u+=t.byteLength;var c=new DataView(a.buffer);return c.setUint32(u,i.byteLength,!0),u+=4,a.set(i,u),u+=i.byteLength,c.setUint32(u,o.byteLength,!0),u+=4,a.set(o,u),a},t.prototype.generateRequest=function(e,t){var r=this;return new Promise((function(e,n){r._lastGenerateResolver={resolve:e,reject:n};try{var i=r._rebuildInitData(t);r._nativeKeySession=r._nativeMediaKeys.createSession("video/mp4",new Uint8Array(i),null),r._attach()}catch(e){r._lastGenerateResolver=null,n(e)}}))},t.prototype.update=function(e){var t=a.createPromiseResolver();if(this._lastUpdateResolver=t,!this._nativeKeySession)return _.warn("Tried to update with no WebKitMediaKeySession"),t.promise;try{this._nativeKeySession.update(new Uint8Array(e))}catch(e){t.reject(e)}return t.promise},t.prototype.close=function(){var e=this;return new Promise((function(t){e._detach(),t(!0)}))},t}(o.EventEmitter),f=function(){function e(e){this._lastBoundSetter=null,this._serverCertificate=null,this.shouldRefreshPerTrack=!0,this._nativeMediaKeys=new WebKitMediaKeys(e)}return e.prototype.attach=function(e){var t=this;return new Promise((function(r){if(e.readyState>=1)return e.webkitSetMediaKeys(t._nativeMediaKeys),void r();var n=function r(){e.removeEventListener(u.Event.MEDIA_LOADEDMETADATA,r),t._lastBoundSetter=null,e.webkitSetMediaKeys(t._nativeMediaKeys)};t._lastBoundSetter=n,e.addEventListener(u.Event.MEDIA_LOADEDMETADATA,n),e.addEventListener(u.Event.WEBKIT_NEEDKEY,c.emitEncrypted),r()}))},e.prototype.detach=function(e){e.removeEventListener(u.Event.WEBKIT_NEEDKEY,c.emitEncrypted),this._lastBoundSetter&&(e.removeEventListener(u.Event.MEDIA_LOADEDMETADATA,this._lastBoundSetter),this._lastBoundSetter=null)},e.prototype.setServerCertificate=function(e){return this._serverCertificate=new Uint8Array(e),Promise.resolve(!0)},e.prototype.createSession=function(){if(!this._serverCertificate)throw new l.EMEError(s.Errors.EME_INVALID_STATE_ERROR,"The server certificate is not available");return new p(this._nativeMediaKeys,this._serverCertificate)},e}(),h=function(){function e(e,t){this.keySystem=e;var r=this._checkConfig(t);if(!r)throw new l.EMEError(s.Errors.EME_NO_SUPPORTED_CONFIGURATION,"No supported configurations");this._configuration=r}return e.prototype._checkConfig=function(e){for(var t=this.keySystem,r=!1,n=0,i=e;n<i.length;n++){var o=i[n],a={initDataTypes:o.initDataTypes,audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",sessionTypes:["temporary"]};if(o.audioCapabilities)for(var s=0,u=o.audioCapabilities;s<u.length;s++){if((_=u[s]).contentType){var l=_.contentType.split(";")[0];WebKitMediaKeys.isTypeSupported(t,l)&&(a.audioCapabilities.push(_),r=!0)}}if(o.videoCapabilities)for(var c=0,d=o.videoCapabilities;c<d.length;c++){var _;if((_=d[c]).contentType){l=_.contentType.split(";")[0];WebKitMediaKeys.isTypeSupported(t,l)&&(a.videoCapabilities.push(_),r=!0)}}if(r)return a}return null},e.prototype.getConfiguration=function(){return this._configuration},e.prototype.createMediaKeys=function(){var e=this;return new Promise((function(t){t(new f(e.keySystem))}))},e}();function v(e){var t=this.mediaKeys;return t&&t!==e&&t.detach(this),delete this.mediaKeys,this.mediaKeys=e,e?e.attach(this):Promise.resolve()}r.setup=function(){navigator.requestMediaKeySystemAccess=function(e,t){return new Promise((function(r){r(new h(e,t))}))};var e=HTMLMediaElement.prototype;delete e.mediaKeys,e.setMediaKeys=v}},{"../../../enums/errors":80,"../../../enums/event":81,"../../../error/eme":94,"./emit_encrypted":52,"./license_request_event":54,"@js-sdk/common/es5/debug_tools":9,"@js-sdk/common/es5/promise_resolver":16,"@spotify-internal/emitter/es5":109,tslib:227}],57:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=void 0;var n=e("tslib"),i=e("@js-sdk/common/es5/debug_tools"),o=e("@spotify-internal/emitter/es5"),a=e("@js-sdk/common/es5/promise_resolver"),s=e("../../../enums/errors"),u=e("../../../enums/event"),l=e("../../../error/eme"),c=e("./emit_encrypted"),d=e("./license_request_event"),_=i.logging.forTag("eme_polyfill.v0_1b"),p=function(e){function t(t,r,n){var i=e.call(this)||this;return i._mediaElement=null,i._lastUpdateDeferred=null,i._lastGenerateResolver=null,i.sessionId=null,i._keySystem=t,i._mediaElement=r,i._prefix=n,i.addEventListener=i.addListener,i.removeEventListener=i.removeListener,i}return n.__extends(t,e),t.prototype._addPrefix=function(e){return this._prefix?this._prefix+e.replace(/\b[a-z]/,(function(e){return e.toUpperCase()})):e},t.prototype.generateComplete=function(e){this.emitEvent(new d.LicenseRequestEvent(e)),this._lastGenerateResolver&&(this._lastGenerateResolver.resolve(!0),this._lastGenerateResolver=null)},t.prototype.updateComplete=function(){this._lastUpdateDeferred&&(this._lastUpdateDeferred.resolve(!0),this._lastUpdateDeferred=null),this.emit(u.Event.KEY_SESSION_STATUSES_CHANGE,null)},t.prototype.handleErrorEvent=function(e){var t=new l.EMEError(s.Errors.EME_MEDIA_KEY_SESSION_V0_1B_ERROR,"MediaKeySession v0.1b Error");t.debug.errorCode=e.errorCode,t.debug.systemCode=e.systemCode,!e.sessionId&&this._lastGenerateResolver?(this._lastGenerateResolver.reject(t),this._lastGenerateResolver=null):e.sessionId&&this._lastUpdateDeferred?(this._lastUpdateDeferred.reject(t),this._lastUpdateDeferred=null):this.emit(u.Event.KEY_SESSION_STATUSES_CHANGE,null)},t.prototype.generateRequest=function(e,t){var r=this;return this._mediaElement?new Promise((function(e,n){r._lastGenerateResolver={resolve:e,reject:n};try{r._mediaElement[r._addPrefix("generateKeyRequest")](r._keySystem,new Uint8Array(t))}catch(e){n(e),r._lastGenerateResolver=null}})):Promise.reject(new ReferenceError("InvalidState: Media keys are not attached."))},t.prototype.update=function(e){if(!this._mediaElement)return Promise.reject(new ReferenceError("InvalidState: Media keys are not attached."));if(this._lastUpdateDeferred){var t=this.update.bind(this,e);return this._lastUpdateDeferred.promise.then(t,t)}var r=a.createPromiseResolver();this._lastUpdateDeferred=r;try{this._mediaElement[this._addPrefix("addKey")](this._keySystem,new Uint8Array(e),null,this.sessionId)}catch(e){r.reject(e),this._lastUpdateDeferred=null}return r.promise},t.prototype.close=function(){if(this.sessionId&&this._mediaElement)try{this._mediaElement[this._addPrefix("cancelKeyRequest")](this._keySystem,this.sessionId)}catch(e){_.warn("Could not close keysession",e)}return Promise.resolve(!0)},t}(o.EventEmitter),f=function(){function e(e,t){void 0===t&&(t=""),this._mediaElement=null,this._waitingForSessionIds=[],this._sessionMap={},this.shouldRefreshPerTrack=!0,this._keySystem=e,this._prefix=t,this._onKeyMessage=this._onKeyMessage.bind(this),this._onKeyAdded=this._onKeyAdded.bind(this),this._onKeyError=this._onKeyError.bind(this)}return e.prototype.attach=function(e){this._mediaElement=e;var t=this._prefix;e.addEventListener(t+u.Event.V0_1B_NEEDKEY,c.emitEncrypted);var r=e.addEventListener.bind(e);r(t+u.Event.V0_1B_KEY_ADDED,this._onKeyAdded),r(t+u.Event.V0_1B_KEY_ERROR,this._onKeyError),r(t+u.Event.V0_1B_KEY_MESSAGE,this._onKeyMessage)},e.prototype.detach=function(e){this._mediaElement=null;var t=this._prefix;e.removeEventListener(t+u.Event.V0_1B_NEEDKEY,c.emitEncrypted);var r=e.removeEventListener.bind(e);r(t+u.Event.V0_1B_KEY_ADDED,this._onKeyAdded),r(t+u.Event.V0_1B_KEY_ERROR,this._onKeyError),r(t+u.Event.V0_1B_KEY_MESSAGE,this._onKeyMessage)},e.prototype._getSession=function(e){var t=this._sessionMap[e];if(t)return t;var r=this._waitingForSessionIds.shift();return r?(r.sessionId=e,this._sessionMap[e]=r,r):null},e.prototype._onKeyMessage=function(e){var t=this._getSession(e.sessionId);t?t.generateComplete(e.message):_.warn("Got keymessage without session.")},e.prototype._onKeyAdded=function(e){var t=this._getSession(e.sessionId);t?t.updateComplete():_.warn("Got keyadded without session.")},e.prototype._onKeyError=function(e){var t=this._getSession(e.sessionId);t?t.handleErrorEvent(e):_.warn("Got keyerror without session.")},e.prototype.setServerCertificate=function(){return Promise.reject(new l.EMEError(s.Errors.EME_CANNOT_SET_CERTIFICATE_FOR_PLATFORM,"Cannot set server certificate on this platform."))},e.prototype.createSession=function(){var e=new p(this._keySystem,this._mediaElement,this._prefix);return this._waitingForSessionIds.push(e),e},e}();function h(e){var t=this.mediaKeys;return t&&t!==e&&t.detach(this),delete this.mediaKeys,this.mediaKeys=e,e&&e.attach(this),Promise.resolve()}var v=function(){function e(e,t,r){if(this._configuration=null,this.keySystem=e,this._prefix=r,!this._checkConfig(t))throw new l.EMEError(s.Errors.EME_NO_SUPPORTED_CONFIGURATION,"No supported configurations")}return e.prototype._checkConfig=function(e){for(var t,r,n=this.keySystem,i=document.createElement("video"),o=0,a=e;o<a.length;o++){var s=a[o],u={initDataTypes:s.initDataTypes,audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",sessionTypes:["temporary"],label:s.label},l=!1;if(s.audioCapabilities&&s.audioCapabilities.length&&u.audioCapabilities){l=!1;for(var c=0,d=s.audioCapabilities;c<d.length;c++){(h=null===(t=(f=d[c]).contentType)||void 0===t?void 0:t.split(";")[0])&&i.canPlayType(h,n)&&(u.audioCapabilities.push(f),l=!0)}}if(s.videoCapabilities&&s.videoCapabilities.length&&u.videoCapabilities){l=!1;for(var _=0,p=s.videoCapabilities;_<p.length;_++){var f,h;(h=null===(r=(f=p[_]).contentType)||void 0===r?void 0:r.split(";")[0])&&i.canPlayType(h,n)&&(u.videoCapabilities.push(f),l=!0)}}if(l)return this._configuration=u,!0}return!1},e.prototype.getConfiguration=function(){return this._configuration},e.prototype.createMediaKeys=function(){var e=this;return new Promise((function(t){t(new f(e.keySystem,e._prefix))}))},e}();r.setup=function(e){navigator.requestMediaKeySystemAccess=function(t,r){return new Promise((function(n){n(new v(t,r,e))}))};var t=HTMLMediaElement.prototype;delete t.mediaKeys,t.setMediaKeys=h}},{"../../../enums/errors":80,"../../../enums/event":81,"../../../error/eme":94,"./emit_encrypted":52,"./license_request_event":54,"@js-sdk/common/es5/debug_tools":9,"@js-sdk/common/es5/promise_resolver":16,"@spotify-internal/emitter/es5":109,tslib:227}],58:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isAVC1CompatibleCodec=void 0;var n=/avc1\.(([0-9a-f]{2})[0-9a-f]{2}([0-9a-f]{2}))/;r.isAVC1CompatibleCodec=function(e,t){var r=e.toLowerCase().match(n),i=t.toLowerCase().match(n);if(!r||!i)return!1;var o=r[1],a=r[2],s=r[3],u=i[1],l=i[2],c=i[3];return o===u||"4d"===a&&"4d"===l&&parseInt(s,16)>=parseInt(c,16)}},{}],59:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.clearChildElements=r.collectionToArray=void 0;var n=Array.prototype.slice;r.collectionToArray="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){return n.call(e)},r.clearChildElements=function(e,t){for(var n=0,i=r.collectionToArray(e.getElementsByTagName(t));n<i.length;n++){var o=i[n];e.removeChild(o)}}},{}],60:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.toFormatInfo=r.getMediaKeySystemConfiguration=void 0,r.getMediaKeySystemConfiguration=function(e,t){for(var r,n,i=0,o=e;i<o.length;i++){var a=o[i],s={audioCapabilities:[],videoCapabilities:[]},u=void 0,l=!1;if(null===(r=a.audioCapabilities)||void 0===r?void 0:r.length){l=!1;for(var c=0,d=a.audioCapabilities;c<d.length;c++){(u=(f=d[c]).contentType)&&(t(u)&&(s.audioCapabilities.push(f),l=!0))}}if(null===(n=a.videoCapabilities)||void 0===n?void 0:n.length){l=!1;for(var _=0,p=a.videoCapabilities;_<p.length;_++){var f;(u=(f=p[_]).contentType)&&(t(u)&&(s.videoCapabilities.push(f),l=!0))}}if(l)return s}return null};var n=/([^;]+)(?:;\s?codecs="(.*)")?/;r.toFormatInfo=function(e){var t,r=null!==(t=e.match(n))&&void 0!==t?t:[],i=r[1],o=void 0===i?"unknown":i,a=r[2];return{mimeType:o,codec:void 0===a?"unknown":a,contentType:e}}},{}],61:[function(e,t,r){"use strict";function n(e){var t,r=function(e){return e.map((function(e){if(e.byteEnd&&void 0!==e.byteStart){var t=""+(1+e.byteEnd-e.byteStart);return t+="@"+e.byteStart,"#EXTINF:"+e.duration+",\n#EXT-X-BYTERANGE:"+t+"\n"+e.url}return"#EXTINF:"+e.duration+",\n"+e.url})).join("\n")}(e.segments),n=e.assetID?'#EXT-X-KEY:METHOD=SAMPLE-AES,URI="skd://'+e.assetID+'",KEYFORMATVERSIONS="1",KEYFORMAT="com.apple.streamingkeydelivery"':"",i=e.map?'#EXT-X-MAP:URI="'+e.map.url+'"':"";return(null===(t=e.map)||void 0===t?void 0:t.byteEnd)&&void 0!==e.map.byteStart&&(i+=',BYTERANGE="'+(1+e.map.byteEnd)+"@"+e.map.byteStart+'"'),"#EXTM3U\n#EXT-X-VERSION:6\n#EXT-X-TARGETDURATION:"+Math.floor(e.targetDuration)+"\n#EXT-X-MEDIA-SEQUENCE:0\n#EXT-X-PLAYLIST-TYPE:VOD\n"+(i?n+"\n"+i:n)+"\n"+r+"\n#EXT-X-ENDLIST"}function i(e){return"data:application/vnd.apple.mpegurl;base64,"+btoa(e)}function o(e){var t=new Blob([e],{type:r.HLS_MIME_TYPE});return URL.createObjectURL(t)}Object.defineProperty(r,"__esModule",{value:!0}),r.createProtectedManifestDataURL=r.createProtectedManifestURL=r.createHLSBlobURL=r.createHLSDataURL=r.createProtectedManifest=r.HLS_MIME_TYPE=void 0,r.HLS_MIME_TYPE="application/vnd.apple.mpegurl",r.createProtectedManifest=n,r.createHLSDataURL=i,r.createHLSBlobURL=o,r.createProtectedManifestURL=function(e){return o(n(e))},r.createProtectedManifestDataURL=function(e){return i(n(e))}},{}],62:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getPreferredProfiles=r.sortProfiles=void 0;var n=e("tslib"),i=e("./codec_compatibility");function o(e,t){return e.sort((function(e,r){return"video_bitrate"in e&&"video_bitrate"in r?t?e.video_resolution===r.video_resolution?e.video_bitrate-r.video_bitrate:e.video_resolution-r.video_resolution:e.video_bitrate-r.video_bitrate:e.max_bitrate-r.max_bitrate}))}function a(e,t){return void 0!==t&&Array.isArray(e.encryption_indices)&&-1===e.encryption_indices.indexOf(t)}function s(e,t){return!!t&&t(n.__assign({mimeType:e.mime_type},function(e){return"video_codec"in e}(e)?{type:"video",codec:e.video_codec,bitrate:e.video_bitrate,height:e.video_height,width:e.video_width,resolution:e.video_resolution}:{type:"audio",codec:e.audio_codec,bitrate:e.audio_bitrate}))}function u(e){return"audio_codec"in e?e.audio_codec:e.video_codec}r.sortProfiles=o,r.getPreferredProfiles=function(e){for(var t=e.codec,r=e.formats,n=e.profiles,l=e.encryptionIndex,c=e.disallowProfile,d=e.preferredVideoResolution,_=e.allowMixedAVC1Codecs,p=0,f=r;p<f.length;p++){for(var h=f[p],v=[],y="spotify/unknown-mimeType",m="unknown-codec",E=0,g=n;E<g.length;E++){var R=g[E],T=u(R);!(t in R)||a(R,l)||s(R,c)||("unknown-codec"!==m||R.mime_type!==h.mimeType||T!==h.codec&&!i.isAVC1CompatibleCodec(h.codec,T)?R.mime_type===y&&(T===m||_&&i.isAVC1CompatibleCodec(m,T))&&(v.push(R),R.__effective_codec=m):(y=h.mimeType,m=_?h.codec:T,v.push(R),R.__effective_codec=h.codec))}if(v.length)return o(v,d)}return[]}},{"./codec_compatibility":58,tslib:227}],63:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createInitialBandwidthSampler=void 0;var n=e("@js-sdk/common/es5/monotonic_now"),i=function(){function e(e,t){this._transport=e,this._abrManager=t}return e.prototype._fetch=function(e,t){var r=n.monotonicNow();return this._transport.request(e,{responseType:"arraybuffer",headers:{Range:t}}).then((function(e){return e.ok&&e.body?{bytes:e.body.byteLength,time:n.monotonicNow()-r}:null}))},e.prototype.sample=function(){var e=this,t="https://web-sdk-assets.spotifycdn.com/bandwidth_sampling_data?no-cache="+Math.random();return this._fetch(t,"bytes=0-0").then((function(){return e._fetch(t,"bytes=0-")})).then((function(t){t&&e._abrManager.sample(t.bytes,t.time)}))},e}();r.createInitialBandwidthSampler=function(e,t){return new i(e,t)}},{"@js-sdk/common/es5/monotonic_now":15}],64:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LicenseURLResolver=void 0;var n=e("@spotify-internal/transport/es5"),i=e("@spotify-internal/transport/es5/enums/status_family"),o=e("../enums/errors"),a=e("../error/license"),s=function(){function e(e){var t=this;this._sdk={name:"",version:""},this._securityLevel=null,this._urls={},e.sdk&&(this._sdk=e.sdk),e.securityLevel&&(this._securityLevel=e.securityLevel),this._transport=e.transport,this._useTestLicenseServer=!!e.useTestLicenseServer,this._transport.on(this._transport.EVENT_CONNECTION_ID,(function(){t._urls={}}))}return e.prototype.getFallbackLicenseURL=function(e,t){switch(e){case"com.widevine.alpha":return"@webgate/"+(this._useTestLicenseServer?"widevine-license-test":"widevine-license")+"/v1/"+t+"/license";case"com.microsoft.playready":return"@webgate/playready-license/v1/"+t+"/license/{contentId}";case"com.apple.fps.1_0":return"@webgate/fairplay-license/v1/"+t+"/license";default:return}},e.prototype.get=function(e,t){var r=this,s=e+":"+t,u=this._urls[s];if(u&&u.expires>Date.now()+6e4)return Promise.resolve(u.uri);var l=this._useTestLicenseServer?"&use_test_license_server=true":"",c="@webgate/melody/v1/license_url?keysystem="+e+"&mediatype="+t+"&sdk_name="+this._sdk.name+"&sdk_version="+this._sdk.version+l;return this._transport.request(c,{responseType:"json",signal:n.createAbortSignalWithTimeout(1e3),retry:{condition:function(e){var t=e.getStatusFamily();return 429===e.status||t===i.StatusFamily.SERVER_ERROR||t===i.StatusFamily.CONNECTION_ERROR}}}).then((function(n){var u,l=n.body;if(l&&200===n.status)return l.expires*=1e3,l.uri="@webgate/"+l.uri,r._securityLevel&&(l.uri+=[-1!==l.uri.indexOf("?")?"&":"?","sl=",r._securityLevel].join("")),r._urls[s]=l,l.uri;if(l)if(400===n.status&&l&&"deprecated-version"===l.code)u=a.LicenseError.fatal(o.Errors.LICENSE_RESOLVER_DEPRECATED_VERSION,"This version of the SDK is no longer supported. Please upgrade");else if(n.getStatusFamily()===i.StatusFamily.SERVER_ERROR){var c=r.getFallbackLicenseURL(e,t);if(c)return c;u=new a.LicenseError(o.Errors.LICENSE_RESOLVER_CANT_RESOLVE_URL,"Unsupported keysystem "+e)}else u=new a.LicenseError(o.Errors.LICENSE_RESOLVER_CANT_RESOLVE_URL,"License URL endpoint responded with status "+n.status);else u=a.LicenseError.fatal(o.Errors.LICENSE_RESOLVE_INVALID_RESPONSE,"License URL endpoint responded with invalid response");return u.status=n.status,Promise.reject(u)}),(function(i){var s;if(i.code===n.TransportErrors.HTTP_REQUEST_TIMEOUT){var u=r.getFallbackLicenseURL(e,t);if(u)return u;s=new a.LicenseError(o.Errors.LICENSE_RESOLVER_CANT_RESOLVE_URL,"Unsupported keysystem "+e)}return s=new a.LicenseError(o.Errors.LICENSE_RESOLVER_CANT_RESOLVE_URL,"License URL endpoint request failed"),Promise.reject(s)}))},e.prototype.remove=function(e,t){this._urls[e+":"+t]=null},e}();r.LicenseURLResolver=s},{"../enums/errors":80,"../error/license":97,"@spotify-internal/transport/es5":188,"@spotify-internal/transport/es5/enums/status_family":176}],65:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createLogSender=void 0;var n=e("@js-sdk/logger/es5"),i=function(){function e(e){this._melodyLogger=new n.MelodyLogger(e)}return e.prototype.logTrackStreamVerification=function(e){return this._melodyLogger.sendLog("/v1/msg/batch",{type:"track_stream_verification",message:e},{batch:!0})},e.prototype.logJSSDKPlaybackStats=function(e){return this._melodyLogger.sendLog("/v1/msg/batch",{type:"jssdk_playback_stats",message:e},{batch:!0})},e.prototype.logJSSDKPlaybackStart=function(e){return this._melodyLogger.sendLog("/v1/msg/batch",{type:"jssdk_playback_start",message:e},{batch:!0})},e.prototype.logJSSDKError=function(e){return this._melodyLogger.sendLog("/v1/msg/batch",{type:"jssdk_error",message:e},{batch:!0})},e.prototype.logJSSDKWarning=function(e){return this._melodyLogger.sendLog("/v1/msg/batch",{type:"jssdk_warning",message:e},{batch:!0})},e.prototype.logJSSDKClientEvent=function(e){return this._melodyLogger.sendLog("/v1/msg/batch",{type:"client_event",message:e},{batch:!0})},e}();r.createLogSender=function(e){return new i(e)}},{"@js-sdk/logger/es5":28}],66:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Logger=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@js-sdk/logger/es5"),a=e("@js-sdk/common/es5/debug_tools"),s=e("../../enums/event"),u=e("../../enums/errors"),l=e("../../error/logging"),c=e("../../version"),d=a.logging.forTag("playback.logger"),_=function(e){function t(t){var r=e.call(this)||this;return r._currentTrackingData=null,r._sequenceId=0,r._sequenceSessionStorage={},r._sessionId="0",r._transport=t.transport,r._logSender=t.logSender,r._player=t.player,r._init(),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._init=function(){var e=this._player;e.on(s.Event.PLAYER_LOAD,this._onPlayerLoad.bind(this)),e.on(s.Event.PLAYER_ERROR,this._onError.bind(this,!1)),e.on(s.Event.PLAYER_WARNING,this._onError.bind(this,!0)),e.on(s.Event.PLAYER_PRELOADING_ERROR,this._onError.bind(this,!1)),e.on(s.Event.PLAYER_TRACKING_DATA_CREATED,this._onTrackingDataCreated.bind(this)),e.on(s.Event.PLAYER_TRACKING_DATA_FINALIZED,this._onTrackingDataFinalized.bind(this)),e.on(s.Event.PLAYER_PLAYBACK_START,this._onPlaybackStart.bind(this)),e.on(s.Event.PLAYER_LOG_CLIENT_EVENT,this._logClientEvent.bind(this))},t.prototype._emitError=function(e,t){this.emit(s.Event.LOGGER_ERROR,{error:e,trackingData:t})},t.prototype._onError=function(e,t){var r,n,i,o=t.data,a=this._currentTrackingData;if(a&&!a.noLog){var s=o.error,l=null!==(r=null==s?void 0:s.debug)&&void 0!==r?r:{};l.position="position"in o?o.position:0;var c={track:o.track||{},debug:l,preloading:"preloading"in o&&!!o.preloading,session_id:this._sessionId,playback_id:a.playbackId||null,player_play_id:"playId"in o?o.playId:null,http_status_code:null!==(n=null==s?void 0:s.status)&&void 0!==n?n:null,license_server:null!==(i=null==s?void 0:s.licenseServer)&&void 0!==i?i:null};this._logError(s.code||u.Errors.UNKNOWN,s,c,a,e)}},t.prototype._onPlayerLoad=function(e){var t=e.data.logData;if(t)if(t.impressionURLs)for(var r=0,n=t.impressionURLs;r<n.length;r++){var i=n[r];this._logImpression(i)}else t.impressionURL&&this._logImpression(t.impressionURL)},t.prototype._onPlaybackStart=function(e){var t=e.data.trackingData;t.noLog||t.noStats||this._logPlaybackStart(t)},t.prototype._onTrackingDataCreated=function(e){var t=e.data.trackingData;t.noLog?this._currentTrackingData=null:(this._currentTrackingData=t,this._setSessionId(),t.noTSV||this._setSequenceId())},t.prototype._setSessionId=function(){this._sessionId=this._transport.getInitTime().toString()},t.prototype._setSequenceId=function(){this._sessionId&&(this._sequenceId=this._getSequenceId(this._sessionId))},t.prototype._onTrackingDataFinalized=function(e){var t=e.data.trackingData;if(!t.noLog){var r=this._sessionId!==this._transport.getInitTime().toString();if(r&&this._setSessionId(),t.playbackId&&!t.noTSV){if(r&&this._setSequenceId(),!t.playIntended&&!t.played)return void this._rollbackSequenceId(this._sessionId);this._logTrackStreamVerification(t)}t.noStats||this._logPlaybackStats(t)}},t.prototype._logTrackStreamVerification=function(e){var t=this,r={play_track:e.currentTrackUri,playback_id:e.playbackId,ms_played:e.msPlayed,ms_nominal_played:e.msNominalPlayed,session_id:this._sessionId,sequence_id:this._sequenceId,next_playback_id:e.nextPlaybackId,playback_service:e.playbackService};d.debug("Logged TrackStreamVerification",r),this._logSender.logTrackStreamVerification(r).catch((function(n){var i=new l.LoggingError(u.Errors.TSV_SENDING_FAILED,n.message||"Unknown reason.");t._logError(i.code,n,r,e,!1),t._emitError(i,e)}))},t.prototype._logPlaybackStats=function(e){var t=this,r={play_track:e.currentTrackUri,file_id:e.fileId,playback_id:e.playbackId,internal_play_id:e.internalPlayId,memory_cached:e.memoryCached,persistent_cached:e.persistentCached,audio_format:e.audioCodec||"",video_format:e.videoCodec||"",manifest_id:e.fileId,protected:e.isProtected,key_system:e.keySystem,key_system_impl:e.keySystemImpl,urls_json:JSON.stringify(e.urls),start_time:e.loadTime,end_time:e.stopTime,external_start_time:e.externalLoadTime,ms_play_latency:e.msPlayLatency,ms_init_latency:e.msInitLatency,ms_head_latency:e.msHeadLatency,ms_manifest_latency:e.msManifestLatency,ms_resolve_latency:e.msResolveLatency,ms_license_session_latency:e.msLicenseSessionLatency,ms_license_generation_latency:e.msLicenseGenerationLatency,ms_license_request_latency:e.msLicenseRequestLatency,ms_license_update_latency:e.msLicenseUpdateLatency,ms_played:e.msPlayed,ms_nominal_played:e.msNominalPlayed,ms_file_duration:e.msFileDuration,ms_actual_duration:e.msActualDuration,ms_metadata_duration:e.msMetadataDuration,ms_start_position:e.startPosition,ms_end_position:e.position,ms_initial_rebuffer:e.msInitialRebuffering,ms_seek_rebuffer:e.msSeekRebuffering,ms_seek_rebuffer_longest:e.maxMsSeekRebuffering,ms_stall_rebuffer:e.msStalled,ms_stall_rebuffer_longest:e.maxMsStalled,n_stalls:e.nStalls,n_rendition_upgrade:e.nRenditionUpgrade,n_rendition_downgrade:e.nRenditionDowngrade,bps_bandwidth_max:e.bpsBandwidthMax,bps_bandwidth_min:e.bpsBandwidthMin,bps_bandwidth_avg:e.bpsBandwidthAvg,n_seekback:e.nSeeksBackward,n_seekforward:e.nSeeksForward,start_bitrate:e.startBitrate||e.bitrate||0,audio_quality:e.audioQuality,time_weighted_bitrate:e.timeWeightedBitrate,reason_start:e.reasonStart,reason_end:e.reasonEnd,initially_paused:!e.playIntended,had_error:e.hadError,n_warnings:e.nWarnings,n_navigator_offline:e.nOffline,session_id:this._sessionId,sequence_id:this._sequenceId,client_id:e.clientId,correlation_id:e.correlationId,n_dropped_video_frames:e.droppedVideoFrames,n_total_video_frames:e.totalVideoFrames,resolution_max:e.maxResolution||0,resolution_min:e.minResolution||0,total_bytes:e.totalBytes,strategy:e.strategy};d.info("Logging PlaybackStats"),this._logSender.logJSSDKPlaybackStats(r).catch((function(n){var i=new l.LoggingError(u.Errors.PLAYBACK_STATS_SENDING_FAILED,n.message||"Unknown reason.");t._logError(i.code,n,r,e,!1),t._emitError(i,e)}))},t.prototype._logPlaybackStart=function(e){var t=this,r={play_track:e.currentTrackUri,file_id:e.fileId,playback_id:e.playbackId,session_id:this._sessionId,ms_start_position:e.startPosition,initially_paused:!e.playIntended,client_id:e.clientId,correlation_id:e.correlationId};d.info("Logging PlaybackStart"),this._logSender.logJSSDKPlaybackStart(r).catch((function(n){var i=new l.LoggingError(u.Errors.PLAYBACK_START_SENDING_FAILED,n.message||"Unknown reason.");t._logError(i.code,n,r,e,!1),t._emitError(i,e)}))},t.prototype._getSequenceId=function(e){var t=this._sequenceSessionStorage[e];return t||(t=0),t+1>=9007199254740991&&(t=0),this._sequenceSessionStorage[e]=t+1,t},t.prototype._rollbackSequenceId=function(e){var t=this._sequenceSessionStorage[e];t&&(this._sequenceSessionStorage[e]=Math.max(t-1,0))},t.prototype._logImpression=function(e){this._transport.request(e,{forget:!0}).catch((function(e){d.warn("Unable to send impression request",e)}))},t.prototype._logClientEvent=function(e){var t={source:e.data.source||o.LogValues.EMPTY,source_version:c.default.tagged||o.LogValues.UNKNOWN,event:e.data.event||o.LogValues.EMPTY,json_data:JSON.stringify(e.data.payload||{})};this._logSender.logJSSDKClientEvent(t).catch((function(e){return d.warn("Failed to log client event",t,e)}))},t.prototype._logError=function(e,t,r,n,i){var a={source:"playback",source_version:c.default.tagged||o.LogValues.UNKNOWN,type:e||o.LogValues.UNKNOWN,message:t&&t.message||o.LogValues.EMPTY,stack:'""',json_data:JSON.stringify(r||{}),json_data_version:"1.0.0",client_id:n.clientId,correlation_id:n.correlationId};i?this._logSender.logJSSDKWarning(a).catch((function(e){return d.warn("Failed to log warning",a,e)})):this._logSender.logJSSDKError(a).catch((function(e){return d.warn("Failed to log error",a,e)}))},t}(i.EventEmitter);r.Logger=_},{"../../enums/errors":80,"../../enums/event":81,"../../error/logging":98,"../../version":105,"@js-sdk/common/es5/debug_tools":9,"@js-sdk/logger/es5":28,"@spotify-internal/emitter/es5":109,tslib:227}],67:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MediaSourceManager=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@js-sdk/common/es5/promise_resolver"),a=e("@js-sdk/common/es5/debug_tools"),s=e("@js-sdk/common/es5/monotonic_now"),u=e("../enums/event"),l=a.logging.forTag("playback.media_source_manager");function c(e){if(!e)return"";var t=[];for(var r in e)if(e.hasOwnProperty(r)){var n=e[r]?'="'+e[r]+'"':"";t.push(""+r+n)}return t.length?"; "+t.join("; "):""}var d=function(e){function t(t){var r=e.call(this)||this;r._mediaSource=null,r._sourceBuffers={},r._currentInitSegments={},r._updateQueue=[],r._playId=0,r._lastBufferClearTime=s.monotonicNow(),r._customSourceBufferParams="";var n=t.mimeTypes,i=t.customSourceBufferParams,o=t.disableBufferAbort;return r._mimeTypes=n,r._customSourceBufferParams=c(i),r._disableBufferAbort=!!o,r._onSourceOpen=r._onSourceOpen.bind(r),r._onSourceClose=r._onSourceClose.bind(r),r._onUpdateEnd=r._onUpdateEnd.bind(r),r.dequeueUpdates=r.dequeueUpdates.bind(r),t.noInit||r._init(),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._init=function(){this._mediaSource=new MediaSource,this._mediaSource.addEventListener(u.Event.MEDIA_SOURCE_OPEN,this._onSourceOpen),this._mediaSource.addEventListener(u.Event.MEDIA_SOURCE_CLOSE,this._onSourceClose),this._sourceBuffers={},this._currentInitSegments={}},t.prototype._onSourceOpen=function(){var e;l.info("MediaSource opened.");var t=this._mediaSource;if(0===(null===(e=null==t?void 0:t.sourceBuffers)||void 0===e?void 0:e.length)&&"open"===(null==t?void 0:t.readyState)){var r=this._mimeTypes;l.info("Creating source buffers for MIME types",r);for(var n=0,i=["video","audio"];n<i.length;n++){var o=r[i[n]];if(o){var a=o+this._customSourceBufferParams,s=t.addSourceBuffer(a);s.addEventListener(u.Event.SOURCE_BUFFER_UPDATE_END,this._onUpdateEnd),this._sourceBuffers[o]=s}}}this.dequeueUpdates(),this.emit(u.Event.BUFFER_SOURCE_OPEN,null)},t.prototype._onSourceClose=function(){l.info("MediaSource closed."),this._destroySourceBuffers(),this.emit(u.Event.BUFFER_SOURCE_CLOSE,null)},t.prototype._destroySourceBuffers=function(){var e=this._mediaSource;if(e){var t=e.sourceBuffers;if(t.length)for(var r=0,n=t.length;r<n;r++){var i=t[r];if(i){i.removeEventListener(u.Event.SOURCE_BUFFER_UPDATE_END,this._onUpdateEnd);try{e.removeSourceBuffer(i),l.info("Removed source buffer")}catch(e){l.warn("Failed to remove sourcebuffer",e)}}}this._sourceBuffers={},this._currentInitSegments={}}},t.prototype._onUpdateEnd=function(){this.dequeueUpdates(),this.emit(u.Event.BUFFER_UPDATE_END,null)},t.prototype._endUpdate=function(e){var t;this._isUpdating()?this._updateQueue.push(e):"open"===(null===(t=this._mediaSource)||void 0===t?void 0:t.readyState)&&(l.info("Signals end of stream."),this._mediaSource.endOfStream(),e.resolve&&e.resolve(!0))},t.prototype._durationUpdate=function(e){this._isUpdating()?this._updateQueue.push(e):(this._mediaSource&&(this._mediaSource.duration=e.duration),e.resolve&&e.resolve(!0))},t.prototype._isUpdating=function(){if(!this._mediaSource)return!1;for(var e=this._mediaSource.sourceBuffers,t=0,r=e.length;t<r;t++){var n=e[t];if(n&&n.updating)return!0}return!1},t.prototype._appendUpdate=function(e){var t,r,n=this,i=this._sourceBuffers[e.mimeType];if(i&&!i.updating){var o=e.buffer;if(e.segment.init&&this._currentInitSegments[e.mimeType]===e.profileId)return null===(t=e.resolve)||void 0===t||t.call(e,!0),void Promise.resolve().then(this.dequeueUpdates);if(e.initBuffer&&e.buffer&&this._currentInitSegments[e.mimeType]!==e.profileId){var a=new Uint8Array(e.initBuffer.byteLength+e.buffer.byteLength);a.set(new Uint8Array(e.initBuffer),0),a.set(new Uint8Array(e.buffer),e.initBuffer.byteLength),o=a.buffer}try{i.appendBuffer(o)}catch(t){var s=!1;return"QuotaExceededError"===t.name?(l.warn("Failed to append buffer: exceeded quota."),s=!0,this.emitSync(u.Event.BUFFER_QUOTA_EXCEEDED,null)):l.warn("Failed to append buffer",t),void new Promise((function(e){s?setTimeout(e,1e3):e()})).then((function(){var r;null===(r=e.reject)||void 0===r||r.call(e,t),n.dequeueUpdates()})).then((function(){e.init&&n._updateQueue.push(e)}))}var c=o.byteLength>e.buffer.byteLength;(e.segment.init||c)&&(this._currentInitSegments[e.mimeType]=e.profileId),null===(r=e.resolve)||void 0===r||r.call(e,!0),c?l.info("Injected combined init segment and playable segment ("+e.mimeType+", "+e.profileId+")"):e.init&&l.info("Injected individual init segment ("+e.mimeType+", "+e.profileId+")")}else this._updateQueue.push(e)},t.prototype._abortUpdate=function(e){var t;null===(t=e.resolve)||void 0===t||t.call(e,!1),Promise.resolve().then(this.dequeueUpdates)},t.prototype.dequeueUpdates=function(){var e=this._updateQueue.shift();e&&this.tryUpdate(e)},t.prototype.tryUpdate=function(e){if(e.playId!==this._playId)return l.info("Try update dropped: playId has changed"),void this._abortUpdate(e);if(e.timestamp<this._lastBufferClearTime)return l.info("Try update dropped: update is older than the last clear"),void this._abortUpdate(e);var t=this._mediaSource;t&&"open"!==t.readyState&&"ended"!==t.readyState?this._updateQueue.push(e):"end"===e.type?this._endUpdate(e):"duration"===e.type?this._durationUpdate(e):"append"===e.type&&this._appendUpdate(e)},t.prototype.appendBufferData=function(e,t,r,n){void 0===n&&(n=s.monotonicNow());var i=[];if(e.audio){var a=o.createPromiseResolver();this.tryUpdate({playId:r,timestamp:n,segment:t,type:"append",profileId:e.audio.profileId,buffer:e.audio.buffer,initBuffer:e.audio.initBuffer,mimeType:e.audio.mimeType,init:!!t.init,resolve:a.resolve,reject:a.reject}),i.push(a.promise)}if(e.video){var u=o.createPromiseResolver();this.tryUpdate({playId:r,timestamp:n,segment:t,type:"append",profileId:e.video.profileId,buffer:e.video.buffer,initBuffer:e.video.initBuffer,mimeType:e.video.mimeType,init:!!t.init,resolve:u.resolve,reject:u.reject}),i.push(u.promise)}return Promise.all(i)},t.prototype.endOfStream=function(e){this._mediaSource&&"ended"!==this._mediaSource.readyState&&this.tryUpdate({playId:e,timestamp:s.monotonicNow(),type:"end"})},t.prototype.abort=function(e){if(void 0===e&&(e=!1),this._lastBufferClearTime=s.monotonicNow(),this._disableBufferAbort)l.info("MediaSource abort skipped; action disabled.");else{var t=this._mediaSource;if(t)for(var r=t.sourceBuffers,n=0,i=r.length;n<i;n++){var o=r[n];if("open"===t.readyState&&o)try{o.abort();var a=o.buffered;if(e&&a.length){var u=a.start(0),c=a.end(a.length-1);o.remove(u,c),l.info("Cleared buffer range",u,c)}}catch(e){l.warn("MediaSourceManager.clear failed.",e)}}this._currentInitSegments={}}},t.prototype.destroy=function(){var e=this._mediaSource;e&&(l.info("Source destroyed"),e.removeEventListener("sourceopen",this._onSourceOpen),e.removeEventListener("sourceclose",this._onSourceClose),this._destroySourceBuffers(),this._mediaSource=null)},t.prototype.recreate=function(e){this.abort(),this.destroy(),this._mimeTypes=e.mimeTypes,e.customSourceBufferParams&&(this._customSourceBufferParams=c(e.customSourceBufferParams)),this._init()},t.prototype.setDuration=function(e){var t=this;return new Promise((function(r){t.tryUpdate({playId:t._playId,timestamp:s.monotonicNow(),type:"duration",duration:e,resolve:r})}))},t.prototype.getMediaSource=function(){return this._mediaSource},t.prototype.setPlayId=function(e){this._playId=e},t.prototype.getPlayId=function(){return this._playId},t}(i.EventEmitter);r.MediaSourceManager=d},{"../enums/event":81,"@js-sdk/common/es5/debug_tools":9,"@js-sdk/common/es5/monotonic_now":15,"@js-sdk/common/es5/promise_resolver":16,"@spotify-internal/emitter/es5":109,tslib:227}],68:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MovingAverage=void 0;var n=function(){function e(e){if(this._estimate=0,this._totalWeight=0,e<0)throw new TypeError("Halflife must be set to a positive value.");this._weightingDecrease=Math.exp(Math.log(.5)/e)}return e.prototype.sample=function(e,t){var r=Math.pow(this._weightingDecrease,e),n=t*(1-r)+r*this._estimate;isNaN(n)||(this._estimate=n,this._totalWeight+=t)},e.prototype.getEstimate=function(){return this._estimate/1-Math.pow(this._weightingDecrease,this._totalWeight)},e}();r.MovingAverage=n},{}],69:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.MuxReporter=r.CONTENT_TYPES=r.MuxEvents=r.extractHostname=r.codeToMuxError=r.MuxErrors=void 0;var i,o=e("tslib"),a=e("@js-sdk/common/es5/promise_resolver"),s=e("../enums/event"),u=e("../enums/errors"),l=e("../version");!function(e){e[e.ABORTED=101]="ABORTED",e[e.NETWORK=102]="NETWORK",e[e.MEDIA_DECODING=103]="MEDIA_DECODING",e[e.SRC_NOT_SUPPORTED=104]="SRC_NOT_SUPPORTED",e[e.EME=105]="EME",e[e.GENERIC=100]="GENERIC"}(i=r.MuxErrors||(r.MuxErrors={}));var c,d=((n={})[u.Errors.MEDIA_ABORTED]=i.ABORTED,n[u.Errors.MEDIA_DECODING_ERROR]=i.MEDIA_DECODING,n[u.Errors.MEDIA_NOT_SUPPORTED]=i.SRC_NOT_SUPPORTED,n[u.Errors.MEDIA_NETWORK_ERROR]=i.NETWORK,n);function _(e){var t=d[e];return/_REQUEST_|_RESPONSE$/.test(e)?t=i.NETWORK:t||(t=/^EME_/.test(e)?i.EME:i.GENERIC),t}function p(e){var t,r=e.match(/^https?:\/\/([^\/]+@)?([^\/?#]+)/);return null!==(t=null==r?void 0:r[2])&&void 0!==t?t:""}r.codeToMuxError=_,r.extractHostname=p,function(e){e.READY="playerready",e.VIDEO_CHANGE="videochange",e.PLAY="play",e.PLAYING="playing",e.PAUSE="pause",e.TIMEUPDATE="timeupdate",e.SEEKING="seeking",e.SEEKED="seeked",e.ERROR="error",e.ENDED="ended",e.RENDITION_CHANGE="renditionchange",e.REQUEST_COMPLETED="requestcompleted",e.REQUEST_FAILED="requestfailed",e.REQUEST_CANCELED="requestcanceled"}(c=r.MuxEvents||(r.MuxEvents={})),r.CONTENT_TYPES={music_video:"Music Video",vodcast:"Video Podcast"};var f={player_is_paused:!0,player_width:0,player_height:0,video_source_height:0,video_source_width:0,player_is_fullscreen:void 0,player_autoplay_on:void 0,player_preload_on:void 0,video_source_url:void 0,video_source_mime_type:void 0,video_source_duration:void 0,video_poster_url:void 0,player_language_code:void 0},h=function(){function e(e){this._playerId="spotify-playback-"+Date.now(),this._currentContentInfo=null,this._readyDeferred=a.createPromiseResolver(),this._isMuxInitialized=!1,this._muxInitData=null,this._player=e.player,this._mux=e.mux,this._getPlayheadTime=this._getPlayheadTime.bind(this),this._getStateData=this._getStateData.bind(this),this._init(e)}return e.create=function(t){return new e(t)},e.prototype._init=function(e){var t=this;Promise.all([Promise.resolve(e.deviceInfo)]).then((function(r){var n,i,a=r[0];t._muxInitData={data:o.__assign({env_key:e.envKey||"2qbjhhcl4u87btjbo7dh8vi2n",player_name:null!==(i=null==a?void 0:a.platform_name)&&void 0!==i?i:null==a?void 0:a.platform,player_version:null==a?void 0:a.version,viewer_device_manufacturer:null==a?void 0:a.brand,viewer_device_category:null==a?void 0:a.type,viewer_device_name:null==a?void 0:a.model,player_software_name:e.sdk||"spotify-playback",player_software_version:e.sdkVersion||l.default.version,player_mux_plugin_name:"spotify-playback-mux-reporter",player_mux_plugin_version:l.default.version},e.muxCustomDimensions),getPlayheadTime:t._getPlayheadTime,getStateData:t._getStateData},t._player.addListeners(((n={})[s.Event.PLAYER_BEFORE_LOAD]=t._onBeforeLoad.bind(t),n[s.Event.PLAYER_PLAY]=t._onPlay.bind(t),n[s.Event.PLAYER_PLAYING]=t._onPlaying.bind(t),n[s.Event.PLAYER_PAUSED]=t._onPause.bind(t),n[s.Event.PLAYER_PROGRESS]=t._onProgress.bind(t),n[s.Event.PLAYER_SEEKING]=t._onSeeking.bind(t),n[s.Event.PLAYER_POSITION_CHANGED]=t._onPositionChanged.bind(t),n[s.Event.PLAYER_ERROR]=t._onError.bind(t),n[s.Event.PLAYER_ENDED]=t._onEnded.bind(t),n[s.Event.PLAYER_DURATION_CHANGED]=t._onDurationChanged.bind(t),n[s.Event.PLAYER_VIDEO_RESIZED]=t._onVideoResized.bind(t),n[s.Event.PLAYER_VIDEO_PROFILE_CHANGED]=t._onVideoProfileChanged.bind(t),n[s.Event.PLAYER_FRAGMENT_FETCHED]=t._onFragmentFetched.bind(t),n[s.Event.PLAYER_FRAGMENT_FETCH_ERROR]=t._onFragmentFetchError.bind(t),n[s.Event.PLAYER_VIDEO_MANIFEST_RESOLVED]=t._onVideoManifestResolved.bind(t),n[s.Event.PLAYER_VIDEO_MANIFEST_RESOLVE_FAILED]=t._onVideoManifestResolveFailed.bind(t),n))})).then(this._readyDeferred.resolve,this._readyDeferred.reject)},e.prototype._getPlayheadTime=function(){return this._player.getPlayerPosition()},e.prototype._getStateData=function(){return this._currentContentInfo?o.__assign(o.__assign({},this._currentContentInfo.stateData),{player_language_code:this._player.getActiveSubtitleLanguage()}):null},e.prototype._onDurationChanged=function(e){this._currentContentInfo&&(this._currentContentInfo.stateData.video_source_duration=e.data.duration)},e.prototype._onVideoResized=function(e){this._currentContentInfo&&(this._currentContentInfo.stateData.player_width=e.data.width,this._currentContentInfo.stateData.player_height=e.data.height)},e.prototype._onBeforeLoad=function(e){var t=e.data,n=t.track,i=t.options,a=t.logData,s=!!this._currentContentInfo;if("video"!==n.mediaType||(null==a?void 0:a.noLog)||(null==a?void 0:a.noMuxEvents))return s&&this._mux.emit(this._playerId,c.VIDEO_CHANGE,{}),void(this._currentContentInfo=null);var u={video_id:n.fileId,video_title:(null==a?void 0:a.displayTitle)||void 0,video_series:(null==a?void 0:a.displayGroup)||void 0,video_duration:(null==a?void 0:a.displayDuration)||void 0};"episode"===n.logData.uriType?u.video_content_type=r.CONTENT_TYPES.vodcast:"track"===n.logData.uriType&&(u.video_content_type=r.CONTENT_TYPES.music_video);var l=o.__assign({},f);this._currentContentInfo={track:n,options:i,videoData:u,stateData:l},!this._isMuxInitialized&&this._muxInitData?(this._mux.init(this._playerId,this._muxInitData),this._mux.emit(this._playerId,c.READY),this._isMuxInitialized=!0):s&&this._mux.emit(this._playerId,c.VIDEO_CHANGE,u)},e.prototype._onPlay=function(){var e,t;if(this._currentContentInfo){var r=this._currentContentInfo.stateData,n=this._player.getPlayerState(),i=n.media_info,o=(null===(t=null===(e=this._currentContentInfo)||void 0===e?void 0:e.options)||void 0===t?void 0:t.autoplay)||!1,a=n.player_element,s=a.width,u=a.height,l=a.src,d=a.poster;r.player_is_paused=!n.playing,r.player_width=s||0,r.player_height=u||0,r.video_source_height=i.video_height||0,r.video_source_width=i.video_width||0,r.player_autoplay_on=o,r.video_source_url=l,r.video_source_mime_type=i.video_format,r.video_source_duration=n.duration,r.video_poster_url=d,this._mux.emit(this._playerId,c.PLAY,this._currentContentInfo.videoData)}},e.prototype._onPlaying=function(){this._currentContentInfo&&(this._currentContentInfo.stateData.player_is_paused=!1,this._mux.emit(this._playerId,c.PLAYING))},e.prototype._onPause=function(){this._currentContentInfo&&(this._currentContentInfo.stateData.player_is_paused=!0,this._mux.emit(this._playerId,c.PAUSE))},e.prototype._onProgress=function(e){this._currentContentInfo&&this._mux.emit(this._playerId,c.TIMEUPDATE,{player_playhead_time:e.data.position})},e.prototype._onSeeking=function(){this._currentContentInfo&&this._mux.emit(this._playerId,c.SEEKING)},e.prototype._onPositionChanged=function(){this._currentContentInfo&&this._mux.emit(this._playerId,c.SEEKED)},e.prototype._onError=function(e){var t,r,n=null===(r=null===(t=e.data)||void 0===t?void 0:t.error)||void 0===r?void 0:r.code;this._currentContentInfo&&n&&this._mux.emit(this._playerId,c.ERROR,{player_error_code:_(n),player_error_message:n})},e.prototype._onEnded=function(){this._currentContentInfo&&this._mux.emit(this._playerId,c.ENDED)},e.prototype._onVideoProfileChanged=function(e){if(this._currentContentInfo){var t=e.data.profile,r=this._currentContentInfo.stateData;r.video_source_height=t.height||0,r.video_source_width=t.width||0,r.video_source_mime_type=t.mimeType,this._mux.emit(this._playerId,c.RENDITION_CHANGE,{video_source_bitrate:t.bitrate,video_source_width:t.width,video_source_height:t.height})}},e.prototype._onFragmentFetched=function(e){var t=e.data;if(this._currentContentInfo||"video"===t.media_type){var r=t.segment_type+(t.init?"_init":"");this._mux.emit(this._playerId,c.REQUEST_COMPLETED,{request_type:r,request_hostname:p(t.url),request_start:t.start_time,request_response_end:t.end_time,request_bytes_loaded:t.byte_length})}},e.prototype._onFragmentFetchError=function(e){var t=e.data;if(this._currentContentInfo||"video"===t.media_type){var r=t.segment_type+(t.init?"_init":"");this._mux.emit(this._playerId,c.REQUEST_FAILED,{request_type:r,request_hostname:p(t.url),request_start:t.start_time,request_error:t.error.code,request_error_code:t.error.status,request_error_text:""})}},e.prototype._onVideoManifestResolved=function(e){var t=e.data;this._currentContentInfo&&this._mux.emit(this._playerId,c.REQUEST_COMPLETED,{request_type:"manifest",request_hostname:p(t.url),request_start:t.start_time,request_response_end:t.end_time,request_bytes_loaded:t.manifest_size})},e.prototype._onVideoManifestResolveFailed=function(e){var t=e.data;this._currentContentInfo&&this._mux.emit(this._playerId,c.REQUEST_FAILED,{request_type:"manifest",request_hostname:p(t.url),request_start:t.start_time,request_error:t.error.code,request_error_code:t.error.status,request_error_text:""})},e.prototype.ready=function(){return this._readyDeferred.promise},e}();r.MuxReporter=h},{"../enums/errors":80,"../enums/event":81,"../version":105,"@js-sdk/common/es5/promise_resolver":16,tslib:227}],70:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.Player=void 0;var i=e("tslib"),o=e("@spotify-internal/emitter/es5"),a=e("@spotify-internal/transport/es5"),s=e("@spotify-internal/linkedlist/es5"),u=e("@js-sdk/common/es5/debug_tools"),l=e("@js-sdk/common/es5/monotonic_now"),c=e("../typedefs"),d=e("../enums/event"),_=e("../enums/key_system"),p=e("../enums/errors"),f=e("../enums/operation_result"),h=e("../enums/media_format"),v=e("../enums/content_mediator_event"),y=e("../error/playback"),m=e("./eme/manager"),E=e("./eme/configs"),g=e("./helpers/eme"),R=e("./subtitle_manager"),T=e("./helpers/dom"),I=e("./statistics"),S=e("./audio_processor"),P=e("./buffer"),b=e("./content_types"),A=e("./content_types/capabilities"),L=u.logging.forTag("playback.player"),C=/^blob:/,O=((n={})[h.MediaFormat.MP4]=!0,n[h.MediaFormat.MP4_DUAL]=!0,n[h.MediaFormat.MP4_CBCS]=!0,n[h.MediaFormat.MP4_FLAC]=!0,n[h.MediaFormat.MP3]=!1,n[h.MediaFormat.MANIFEST_ID]=!0,n[h.MediaFormat.AD_MANIFEST]=!0,n[h.MediaFormat.GENERIC_MEDIA]=!0,n),N={start:d.Event.REPORTING_START,creative_view:d.Event.REPORTING_CREATIVE_VIEW,first_quartile:d.Event.REPORTING_FIRST_QUARTILE,midpoint:d.Event.REPORTING_MIDPOINT,third_quartile:d.Event.REPORTING_THIRD_QUARTILE,complete:d.Event.REPORTING_COMPLETE,pause:d.Event.REPORTING_PAUSE,resume:d.Event.REPORTING_RESUME,error:d.Event.REPORTING_ERROR},D={audio:2,video:2};function M(e){return Math.ceil(1e3*e)}function k(e){return e/1e3}function U(e){return document.createElement(e)}var w=function(e){function t(t){var r,n,i,a,u,l=e.call(this)||this;l._cubicVolume=!1,l._player=null,l._emeManager=null,l._mediator=new o.EventEmitter,l._currentContent=null,l._upcomingContent=null,l._preloadingTracks={},l._playId=0,l._abortController=null,l._loaded=!1,l._licenseRequested=!1,l._playerActivated=!1,l._pauseToken=0,l._syntheticEndedToken=0,l._activeMimeTypes={},l._playerVolume=1,l._muted=!1,l._playerSpeed=1,l._fatalOnNextError=!1,l._canPreloadEmitted=!1,l._lastTimeUpdatePostion=0,l._rebuffering=!1,l._preferredBitrate=0,l._disableLicensePrefetch=!1,l._allowMixedAVC1Codecs=!0,l._disableBufferingBeforeLicense=!1,l._rebufferTarget=D,l._currentPlayingProfile=null,l._audioResolver=t.audioResolver,l._clearBufferOnSeek=!!t.clearBufferOnSeek,l._createPlayer=t.createPlayer||U,l._cubicVolume=t.cubicVolume,l._disableCache=!!t.disableCache,l._licenseURLResolver=t.licenseURLResolver,l._newBufferPerTrack=!!t.newBufferPerTrack,l._newElementPerTrack=!!t.newElementPerTrack,l._newMediaKeysPerTrack=t.newMediaKeysPerTrack,l._rebufferOnQuotaExceeded=!!t.rebufferOnQuotaExceeded,l._disableLicensePrefetch=!!t.disableLicensePrefetch,l._synthesizeEnded=!!t.synthesizeEnded,l._tracker=t.tracker,l._transport=t.transport,l._videoPlayerContainer=t.videoPlayerContainer,l._audioPlayerContainer=t.audioPlayerContainer,l._playerContainerManager=t.playerContainerManager||{inject:l._defaultPlayerContainerInjector.bind(l),eject:l._defaultPlayerContainerEjector.bind(l)},l._allowMixedAVC1Codecs=null===(r=t.allowMixedAVC1Codecs)||void 0===r||r,l._videoResolver=t.videoResolver,l._abrManager=t.abrManager,l._initialBandwidthSampler=t.initialBandwidthSampler,l._emeManager=t.disallowProtectedTracks?null:t.emeManager||null,l._disallowProfile=t.disallowProfile,l._disableBufferingBeforeLicense=!!t.disableBufferingBeforeLicense,l._cache=new s.LRUCache(t.trackCacheSize||2),l._subtitleManager=new R.SubtitleManager({language:t.preferredSubtitleLanguage||navigator.language,player:l._player}),l._videoResolution=t.videoResolution,L.info("Setting Player track cache to:",t.trackCacheSize||2),l._bufferManager=P.BufferManager.create(l._tracker,void 0,{disableBufferAbort:!!t.disableBufferAbort,reinjectInitsOnAbort:!!t.reinjectInitsOnAbort,noInit:!0,customSourceBufferParams:t.customSourceBufferParams,bufferTarget:t.bufferTarget}),l._statistics=I.Statistics.create({bandwidthEstimator:l._abrManager}),l._newKeySystemAccessPerTrack=t.newKeySystemAccessPerTrack,l._loadingTimeout=t.loadingTimeout;var c=l._bufferManager.getBufferTarget();return l._rebufferTarget={audio:Math.min(null!==(i=null===(n=t.rebufferTarget)||void 0===n?void 0:n.audio)&&void 0!==i?i:D.audio,c.audio),video:Math.min(null!==(u=null===(a=t.rebufferTarget)||void 0===a?void 0:a.video)&&void 0!==u?u:D.video,c.video)},l._audioProcessor=S.AudioProcessor.create(t.audioProcessorOptions),l._preloadThreshold=t.preloadThreshold||10,l._onCanPlay=l._onCanPlay.bind(l),l._onCanPlayThrough=l._onCanPlayThrough.bind(l),l._onTimeUpdate=l._onTimeUpdate.bind(l),l._onDurationChange=l._onDurationChange.bind(l),l._onPlay=l._onPlay.bind(l),l._onPlaying=l._onPlaying.bind(l),l._onPause=l._onPause.bind(l),l._onSeeking=l._onSeeking.bind(l),l._onEncrypted=l._onEncrypted.bind(l),l._onEnded=l._onEnded.bind(l),l._onError=l._onError.bind(l),l._onRequiresDuration=l._onRequiresDuration.bind(l),l._onQuotaExceeded=l._onQuotaExceeded.bind(l),l._onLoadedMetadata=l._onLoadedMetadata.bind(l),l._onWaiting=l._onWaiting.bind(l),l._onFragmentFetched=l._onFragmentFetched.bind(l),l._onProfileChanged=l._onProfileChanged.bind(l),l._onPlayedThresholdReached=l._onPlayedThresholdReached.bind(l),l._onSyntheticEnded=l._onSyntheticEnded.bind(l),l._onLicenseRequestCapped=l._onLicenseRequestCapped.bind(l),l._onLicenseRequestError=l._onLicenseRequestError.bind(l),l._onNavigatorOffline=l._onNavigatorOffline.bind(l),l._onBufferError=l._onBufferError.bind(l),l._onBufferUpdateEnd=l._onBufferUpdateEnd.bind(l),l._emitWarning=l._emitWarning.bind(l),l._handleLoadingComplete=l._handleLoadingComplete.bind(l),l._onRateChange=l._onRateChange.bind(l),l._onVideoResize=l._onVideoResize.bind(l),l._setAudioGain=l._setAudioGain.bind(l),l._init(),l._getCacheKey=l._getCacheKey.bind(l),l}return i.__extends(t,e),t.create=function(e){var r=i.__assign({},e);return e.disallowProtectedTracks?t.createWithOptions(r):m.EMEManager.create({transport:e.transport,disallowRobustnessValues:e.disallowRobustnessValues,disallowCodecs:e.disallowCodecs,noServerCertificate:e.noServerCertificate,precacheServerCertificate:e.precacheServerCertificate,unauthServerCertificateBase:e.unauthServerCertificateBase,preferredKeySystems:e.preferredKeySystems}).then((function(e){r.emeManager=e;var n=new t(r);return r.preinitMediaElement?n._preinitMediaElement():n})).catch((function(n){if(e.enableWithoutEME)return t.createWithOptions(r);throw n}))},t.createWithOptions=function(e){return new Promise((function(r){var n=new t(e);r(e.preinitMediaElement?n._preinitMediaElement():n)}))},t.prototype._init=function(){var e,t,r,n,i,o,a,s,u=this;this._disableCache&&L.info("Cache disabled."),this._transport.on(this._transport.EVENT_CONNECTION_OFFLINE,this._onNavigatorOffline),this.proxyEmitAllSync(this._tracker,((e={})[d.Event.TRACKER_TRACKING_DATA_CREATED]=d.Event.PLAYER_TRACKING_DATA_CREATED,e[d.Event.TRACKER_TRACKING_DATA_FINALIZED]=d.Event.PLAYER_TRACKING_DATA_FINALIZED,e[d.Event.TRACKER_PLAYBACK_START]=d.Event.PLAYER_PLAYBACK_START,e[d.Event.TRACKER_LOG_CLIENT_EVENT]=d.Event.PLAYER_LOG_CLIENT_EVENT,e)),this._tracker.on(d.Event.TRACKER_PLAYED_THRESHOLD_REACHED,this._onPlayedThresholdReached),this._emeManager&&this._emeManager.addListeners(((t={})[d.Event.EME_LICENSE_REQUEST_CAPPED]=this._onLicenseRequestCapped,t[d.Event.EME_LICENSE_REQUEST_ERROR]=this._onLicenseRequestError,t)),this._bufferManager.addListeners(((r={})[d.Event.BUFFER_APPEND_ERROR]=this._onBufferError,r[d.Event.BUFFER_QUOTA_EXCEEDED]=this._onQuotaExceeded,r[d.Event.BUFFER_UPDATE_END]=this._onBufferUpdateEnd,r)),this._mediator.addListeners(((n={})[v.ContentMediatorEvent.FRAGMENT_FETCHED]=this._onFragmentFetched,n[v.ContentMediatorEvent.VIDEO_PROFILE_CHANGED]=this._onProfileChanged,n)),this.proxyEmitAll(this._mediator,((i={})[v.ContentMediatorEvent.FRAGMENT_FETCH_ERROR]=d.Event.PLAYER_FRAGMENT_FETCH_ERROR,i)),this.proxyEmitSync(this._subtitleManager,d.Event.PLAYER_DISPLAYED_CUES_CHANGED,d.Event.PLAYER_DISPLAYED_CUES_CHANGED),this.proxyEmit(this._subtitleManager,d.Event.PLAYER_SUBTITLE_LANGUAGES_LOADED,d.Event.PLAYER_SUBTITLE_LANGUAGES_LOADED),this.proxyEmitAll(this._videoResolver,((o={})[d.Event.VIDEO_MANIFEST_RESOLVED]=d.Event.PLAYER_VIDEO_MANIFEST_RESOLVED,o[d.Event.VIDEO_MANIFEST_RESOLVE_FAILED]=d.Event.PLAYER_VIDEO_MANIFEST_RESOLVE_FAILED,o)),this._tracker.addListeners(((a={})[d.Event.TRACKER_FIRST_QUARTILE]=function(){return u._emitReporting("first_quartile")},a[d.Event.TRACKER_MIDPOINT]=function(){return u._emitReporting("midpoint")},a[d.Event.TRACKER_THIRD_QUARTILE]=function(){return u._emitReporting("third_quartile")},a)),this.addListeners(((s={})[d.Event.PLAYER_PLAYBACK_START]=function(){u._emitReporting("start"),u._emitReporting("creative_view")},s[d.Event.PLAYER_ENDED]=function(){return u._emitReporting("complete")},s[d.Event.PLAYER_ERROR]=function(){return u._emitReporting("error")},s)),this._initialBandwidthSampler.sample().catch((function(){}))},t.prototype._onRateChange=function(){if(this._player){var e=this._player.playbackRate;0!==e&&this._tracker.trackSpeedChanged(e),this.emit(d.Event.PLAYER_PLAYBACK_SPEED_CHANGED,{playback_speed:e,playback_speed_selected:this._playerSpeed,rebuffering:this._rebuffering,position:M(this._player.currentTime)})}},t.prototype._onLicenseRequestError=function(e){if(!e.data.signal.aborted){var t=this._currentContent;if(t){var r=e.data.error,n=t.getKeySystem();r.shouldRefreshEndpoint&&n&&this._licenseURLResolver.remove(n,t.getMediaType()),this._emitError(r,!r.unrecoverable,t.toLogJSON())}}},t.prototype._onFragmentFetched=function(e){var t=e.data;this._tracker.trackFragment(t),this.emit(d.Event.PLAYER_FRAGMENT_FETCHED,t)},t.prototype._onProfileChanged=function(e){var t=e.data;this._tracker.trackProfileChanged(t.profile),this.emit(d.Event.PLAYER_VIDEO_PROFILE_CHANGED,t)},t.prototype._defaultPlayerContainerInjector=function(e,t){var r=this._getContainerElement("video"===t?this._videoPlayerContainer:this._audioPlayerContainer);r&&e.parentNode!==r&&(r.appendChild(e),"video"===t&&this.emit(d.Event.PLAYER_VIDEO_ELEMENT_APPENDED,null))},t.prototype._defaultPlayerContainerEjector=function(e,t,r){var n=this._getContainerElement("video"===t?this._videoPlayerContainer:this._audioPlayerContainer);n&&e.parentNode===n&&(this._newElementPerTrack||r!==t)&&(n.removeChild(e),"video"===t&&(this._subtitleManager.setPlayer(null),this.emit(d.Event.PLAYER_VIDEO_ELEMENT_REMOVED,null)))},t.prototype._onLicenseRequestCapped=function(e){e.data.signal.aborted||this._currentContent&&(this.pause(),this.emit(d.Event.PLAYER_CAPPED,null))},t.prototype._shouldNextErrorBeFatal=function(){var e=this._currentContent;if(!e)return!1;if(e.hasNonFatalErrors()||!e.isProtected())return!1;if(!this._player)return!1;var t=this._player.error;if(!(t&&t instanceof MediaError))return this._fatalOnNextError=!1,!1;switch(t.code){case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:case MediaError.MEDIA_ERR_DECODE:return!0;default:return!1}},t.prototype._onNavigatorOffline=function(){this._tracker.trackNavigatorOffline()},t.prototype._onBufferError=function(e){this._emitError(e.data.error,e.data.canPlayNext,e.data.track)},t.prototype._onBufferUpdateEnd=function(){var e;this._setRebufferingState(!0),this._rebuffering&&this._player&&(null===(e=this._currentContent)||void 0===e?void 0:e.strategy)===c.PlaybackStrategy.MSE&&this._bufferManager.checkBufferHealth(this._currentContent,this._player.currentTime)},t.prototype._addPlayerEvents=function(e){e.addEventListener(d.Event.MEDIA_TIMEUPDATE,this._onTimeUpdate),e.addEventListener(d.Event.MEDIA_PLAY,this._onPlay),e.addEventListener(d.Event.MEDIA_PLAYING,this._onPlaying),e.addEventListener(d.Event.MEDIA_PAUSE,this._onPause),e.addEventListener(d.Event.MEDIA_SEEKING,this._onSeeking),e.addEventListener(d.Event.MEDIA_ENCRYPTED,this._onEncrypted),e.addEventListener(d.Event.MEDIA_ENDED,this._onEnded),e.addEventListener(d.Event.MEDIA_ERROR,this._onError),e.addEventListener(d.Event.MEDIA_LOADEDMETADATA,this._onLoadedMetadata),e.addEventListener(d.Event.MEDIA_DURATIONCHANGE,this._onDurationChange),e.addEventListener(d.Event.MEDIA_WAITING,this._onWaiting),e.addEventListener(d.Event.MEDIA_CANPLAY,this._onCanPlay),e.addEventListener(d.Event.MEDIA_CANPLAYTHROUGH,this._onCanPlayThrough),e.addEventListener(d.Event.MEDIA_RATECHANGE,this._onRateChange),e.addEventListener(d.Event.INTERNAL_MEDIA_REQUIRES_DURATION,this._onRequiresDuration),e.addEventListener(d.Event.MEDIA_RESIZE,this._onVideoResize)},t.prototype._removePlayerEvents=function(e){e.removeEventListener(d.Event.MEDIA_TIMEUPDATE,this._onTimeUpdate),e.removeEventListener(d.Event.MEDIA_PLAY,this._onPlay),e.removeEventListener(d.Event.MEDIA_PLAYING,this._onPlaying),e.removeEventListener(d.Event.MEDIA_PAUSE,this._onPause),e.removeEventListener(d.Event.MEDIA_SEEKING,this._onSeeking),e.removeEventListener(d.Event.MEDIA_ENCRYPTED,this._onEncrypted),e.removeEventListener(d.Event.MEDIA_ENDED,this._onEnded),e.removeEventListener(d.Event.MEDIA_ERROR,this._onError),e.removeEventListener(d.Event.MEDIA_WAITING,this._onWaiting),e.removeEventListener(d.Event.MEDIA_CANPLAY,this._onCanPlay),e.removeEventListener(d.Event.MEDIA_RATECHANGE,this._onRateChange),e.removeEventListener(d.Event.MEDIA_CANPLAYTHROUGH,this._onCanPlayThrough),e.removeEventListener(d.Event.MEDIA_LOADEDMETADATA,this._onLoadedMetadata),e.removeEventListener(d.Event.MEDIA_DURATIONCHANGE,this._onDurationChange),e.removeEventListener(d.Event.INTERNAL_MEDIA_REQUIRES_DURATION,this._onRequiresDuration),e.removeEventListener(d.Event.MEDIA_RESIZE,this._onVideoResize)},t.prototype._recreateMediaElement=function(e,t,r,n){var i,o,a;if(n.aborted)return L.info("Recreate player dropped: operation aborted."),Promise.resolve(null);var s,u,l,d=this._player,_=Promise.resolve(null);if(d){if(!this._newElementPerTrack&&!("AUDIO"===d.tagName&&"video"===t)&&!(d===this._audioProcessor.getPlayer()&&!(null===(i=this._upcomingContent)||void 0===i?void 0:i.isProtected()))&&(s=d,u=e,l=!0,Object.keys(u).forEach((function(e){var t=u[e];'audio/mp2t;codecs="mp4a.40.2"'!==t&&t&&!s.canPlayType(t)&&(l=!1)})),l))return L.info("Reusing media element."),(!(e.audio===this._activeMimeTypes.audio&&e.video===this._activeMimeTypes.video)||this._newBufferPerTrack)&&r===c.PlaybackStrategy.MSE&&(L.info("Recreating buffer."),this._bufferManager.recreate(e),this._activeMimeTypes=e),Promise.resolve({player:d,mediaKeys:d.mediaKeys});this._removePlayerEvents(d),d.pause(),_=this._cleanMediaKeys(d),this._player=null,null===(o=this._playerContainerManager)||void 0===o||o.eject(d,"video"),null===(a=this._playerContainerManager)||void 0===a||a.eject(d,"audio")}L.info("Creating new media element for media type "+t+".");var p=this._createPlayer(t),f=this._playerVolume;return p.volume=this._cubicVolume?Math.pow(f,3):f,p.autoplay=!1,p.loop=!1,p.muted=this._muted,"playsInline"in p&&(p.playsInline=!0),this._player=p,this._playerActivated=!1,this._addPlayerEvents(p),r===c.PlaybackStrategy.MSE&&this._bufferManager.recreate(e),this._activeMimeTypes=e,_.then((function(e){return{player:p,mediaKeys:e}}))},t.prototype._getContainerElement=function(e){var t;if("string"==typeof e){var r=document.querySelector(e);if(r)return r;var n=new y.PlaybackError(p.Errors.PLAYER_CONTAINER_ELEMENT_NOT_FOUND,"Container element was not found in the DOM");return n.listPlayerIgnore=!0,this._emitWarning(n,null===(t=this._currentContent)||void 0===t?void 0:t.toLogJSON()),null}return e||null},t.prototype._onVideoResize=function(){if(this._player instanceof HTMLVideoElement){var e=this._player,t=e.videoWidth,r=e.videoHeight;this.emit(d.Event.PLAYER_VIDEO_RESIZED,{width:t,height:r})}},t.prototype._onDurationChange=function(){var e,t=this,r=null===(e=this._abortController)||void 0===e?void 0:e.signal,n=function(){if(t._player)if(null==r?void 0:r.aborted)L.info("Duration changed drop: operation aborted.");else{var e=M(t._player.duration),n=M(t._player.currentTime);t._tracker.setActualDuration(e),t.emit(d.Event.PLAYER_DURATION_CHANGED,{timestamp:Date.now(),position:n,duration:e})}};this._loaded?n():this.once(d.Event.PLAYER_LOAD,n)},t.prototype._onPlay=function(){var e;if(this._player&&this._currentContent){var t=M(this._player.currentTime);this._tracker.trackPlay(t,this._player.playbackRate),this.emit(d.Event.PLAYER_PLAY,{timestamp:Date.now(),position:t,logData:null!==(e=this._currentContent.getLogData())&&void 0!==e?e:null})}},t.prototype._onPlaying=function(){if(this._player){this._playerActivated=!0;var e=this._currentContent,t=M(this._player.currentTime);this._tracker.trackPlaying(t),this.emit(d.Event.PLAYER_PLAYING,{timestamp:Date.now(),position:t,logData:e?e.getLogData():null})}},t.prototype._onPause=function(){var e,t=this;if(this._player){var r=M(this._player.currentTime);this._tracker.trackPaused(r);var n=this._currentContent?this._currentContent.getLogData():null;this._pauseToken=setTimeout((function(){clearTimeout(t._syntheticEndedToken),t.emit(d.Event.PLAYER_PAUSED,{position:r,logData:n})}),10),this._player&&(null===(e=this._currentContent)||void 0===e?void 0:e.strategy)===c.PlaybackStrategy.MSE&&this._bufferManager.checkBufferHealth(this._currentContent,this._player.currentTime)}},t.prototype._onSeeking=function(){var e;this.emit(d.Event.PLAYER_SEEKING,null),this._setRebufferingState(),(null===(e=this._currentContent)||void 0===e?void 0:e.strategy)===c.PlaybackStrategy.MSE&&this._player&&!this._bufferManager.isPositionInCurrentFillRange(this._currentContent,this._player.currentTime)&&(L.log("Aborting buffer operations."),this._bufferManager.abort(this._clearBufferOnSeek)),this._lastTimeUpdatePostion=0,this._onTimeUpdate()},t.prototype._onRequiresDuration=function(){this._currentContent&&this._currentContent.isProtected()&&this._player&&(this._player.duration=this._currentContent.getCalculatedDuration())},t.prototype._onQuotaExceeded=function(){this._player&&this._rebufferOnQuotaExceeded&&(L.info("Exceeded quota: rebuffering current track."),this._bufferManager.abort(!0),this._player.currentTime=this._player.currentTime,this._onTimeUpdate())},t.prototype._onEncrypted=function(e){L.info("Got Encrypted event"),this._currentContent&&this.emitSync(d.Event.INTERNAL_ENCRYPTED,{initData:e.initData,fromPolyfill:!!e.fromPolyfill})},t.prototype._onEnded=function(){!this._currentContent||this._synthesizeEnded&&this._currentContent.isProtected()||(L.info("Native ended emitted."),this._emitEnded())},t.prototype._onSyntheticEnded=function(){this._synthesizeEnded&&this._currentContent&&this._currentContent.isProtected()&&(L.info("Synthetic ended emitted."),this._emitEnded())},t.prototype._onError=function(){var e,t,r,n;if(this._player){var i,o,a,s,u=this._player.error,l=!1,c=this._currentContent,d=!1;c&&(l=c.isProtected(),i=c.toLogJSON(),d=c.hasNonFatalErrors(),c.unload());var _=!0,f=!c||d||!this._fatalOnNextError,h=u&&u.msExtendedCode?"0x"+(u.msExtendedCode>>>0).toString(16).toUpperCase():null,v="data:"+((null==i?void 0:i.fileId)||"unknown");if(u instanceof MediaError){switch(u.code){case MediaError.MEDIA_ERR_ABORTED:o=p.Errors.MEDIA_ABORTED,a="Media aborted.";break;case MediaError.MEDIA_ERR_NETWORK:o=p.Errors.MEDIA_NETWORK_ERROR,a="Network error.";break;case MediaError.MEDIA_ERR_DECODE:o=p.Errors.MEDIA_DECODING_ERROR,a="Media decoding error.",_=f;break;case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:o=p.Errors.MEDIA_NOT_SUPPORTED,a="Media not supported.",_=f;break;default:o=p.Errors.PLAYER_MEDIA_ERROR,a="Media error.",s=!0}a+=" ("+(u.message||h||v||u.toString())+")"}else o=p.Errors.PLAYER_PLAYBACK_ERROR,a="Error message undefined",s=!0;this._bufferManager.abort(!0);var m=new y.PlaybackError(o,a);_||(m.unrecoverable=!0),m.listPlayerIgnore=d,m.debug.src_url=v,m.debug.protected=l,m.debug.extendedCode=h,m.debug.rawExCode=u&&u.msExtendedCode||null,m.debug.audio_profile=null===(t=null===(e=this._currentPlayingProfile)||void 0===e?void 0:e.audio)||void 0===t?void 0:t.id,m.debug.video_profile=null===(n=null===(r=this._currentPlayingProfile)||void 0===r?void 0:r.video)||void 0===n?void 0:n.id,s&&u&&(m.debug.nativeCode=u.code||null,m.debug.errorData=u),this._emitError(m,_,i)}},t.prototype._onLoadedMetadata=function(){this.emitSync(d.Event.INTERNAL_PLAYER_LOADED_METADATA,null)},t.prototype._onCanPlay=function(){this._setRebufferingState(),this.emitSync(d.Event.INTERNAL_PLAYER_CANPLAY,null),this.emit(d.Event.PLAYER_FIRST_BYTES,null)},t.prototype._onCanPlayThrough=function(){this._setRebufferingState(),this.emitSync(d.Event.INTERNAL_PLAYER_CANPLAYTHROUGH,null)},t.prototype._onWaiting=function(){var e,t=this;clearTimeout(this._syntheticEndedToken);var r=this._player;if(r&&this._currentContent){var n=r.seeking;this._setRebufferingState();var o=!!A.canHaveAdaptations(this._currentContent)&&this._currentContent.canLowerBitrate(),a=this._tracker;this.emit(d.Event.PLAYER_BUFFERING_START,i.__assign({position:M(r.currentTime),msPlayed:this._tracker.getMSPlayed(),canLowerBitrate:o,seeking:n},a.getStallsInformation()));var s=null===(e=this._abortController)||void 0===e?void 0:e.signal;this._getRebufferingLatency().then((function(e){(null==s?void 0:s.aborted)||(n||t._tracker.trackMsStalled(e),t.emit(d.Event.PLAYER_BUFFERING_END,i.__assign({position:M(r.currentTime),msPlayed:t._tracker.getMSPlayed(),canLowerBitrate:o,msStalled:e,seeking:n},a.getStallsInformation())))}))}},t.prototype._onPlayedThresholdReached=function(e){this._currentContent&&this._player&&this.emit(d.Event.PLAYER_PLAYED_THRESHOLD_REACHED,{played:e.data.played,threshold:e.data.threshold,position:M(this._player.currentTime)})},t.prototype._emitEnded=function(){this._currentContent&&"video"===this._currentContent.getMediaType()&&this.emit(d.Event.PLAYER_ENDED_VIDEO,null),clearTimeout(this._pauseToken),this.emit(d.Event.PLAYER_ENDED,null)},t.prototype._emitError=function(e,t,r){L.error("Player Error",e,r,t),this._tracker.setHadError(!0),!this._disableCache&&r&&r.fileId&&this._cache.remove(r.fileId),this.emit(d.Event.PLAYER_ERROR,{playId:this._playId,error:e,track:r,canPlayNext:t,position:this._player?M(this._player.currentTime):0})},t.prototype._emitWarning=function(e,t){L.warn("Player Warning",e,t,!0),this._tracker.trackWarning(),this.emit(d.Event.PLAYER_WARNING,{playId:this._playId,error:e,track:t,canPlayNext:!0,position:this._player?M(this._player.currentTime):0})},t.prototype._emitReporting=function(e){var t=this;if(A.canHaveTracking(this._currentContent)){var r=this._currentContent.getTrackingEventData(e);r&&0!==r.urls.length&&this.emitAndWait(N[e],r,(function(e){if(!e.defaultPrevented)for(var n=0,i=r.urls;n<i.length;n++){var o=i[n];t._transport.request(o,{forget:!0})}}))}},t.prototype._prepareMediaElement=function(e,t){var r=this;if(t.aborted||!this._upcomingContent)return L.info("Loading content dropped: operation aborted."),Promise.resolve(!1);var n=this._upcomingContent.getMediaTypeMimeTypes();return this._recreateMediaElement(n,this._upcomingContent.getMediaType(),this._upcomingContent.strategy,t).then((function(n){var i;if(!n||t.aborted)return L.info("Loading content dropped after recreate: operation aborted."),Promise.resolve(!1);var o=n.player,a=n.mediaKeys;if("VIDEO"===o.tagName&&(e.poster?o.poster=e.poster:o.removeAttribute("poster")),o.muted=!!e.muted,o.loop=!!e.loop,!r._emeManager||!(null===(i=r._upcomingContent)||void 0===i?void 0:i.isProtected()))return Promise.resolve(!0);var s=function(e){var t;return e.unrecoverable=!0,r._emitError(e,!1,null===(t=r._upcomingContent)||void 0===t?void 0:t.toLogJSON()),Promise.reject(e)};return!a||r._newMediaKeysPerTrack||void 0===r._newMediaKeysPerTrack&&!o.mediaKeys||(null==a?void 0:a.shouldRefreshPerTrack)?(L.info("Creating media keys"),r._emeManager.createMediaKeys(o).then((function(){return!0}),s)):o.mediaKeys!==a?(L.info("Reusing previous media keys"),r._emeManager.setMediaKeys(o,a).then((function(){return!0}),s)):Promise.resolve(!0)}))},t.prototype._isRebufferingTargetReached=function(){var e,t=this._player,r=this._currentContent;if(!t||!r)return!1;if(r.strategy!==c.PlaybackStrategy.MSE)return!0;var n=null!==(e=this._rebufferTarget[r.getMediaType()])&&void 0!==e?e:0;if(!n)return!0;for(var i=Math.max(t.currentTime,1),o=Math.min(n,Math.floor(t.duration-i)),a=t.buffered,s=0,u=a.length;s<u;s++){var l=a.start(s),d=a.end(s);if(l<=i&&i<=d&&o<=d-i)return!0}return!1},t.prototype._setPlaybackRate=function(){var e,t=this._player,r=this._currentContent;if(t&&r)if(r.strategy===c.PlaybackStrategy.MSE&&this._rebuffering)t.playbackRate=0;else{var n=(null===(e=this._loadingOptions)||void 0===e?void 0:e.useDefaultPlaybackSpeed)?1:this._playerSpeed;t.playbackRate=n,t.defaultPlaybackRate=n}},t.prototype._setRebufferingState=function(e){var t=this._rebuffering,r=!this._isRebufferingTargetReached();e&&r||(this._rebuffering=r,this._setPlaybackRate(),!t&&this._rebuffering?(L.log("Rebuffering start"),this.emit(d.Event.PLAYER_REBUFFERING_START,null)):t&&!this._rebuffering&&(L.log("Rebuffering end"),this._tracker.trackPlayLatency(),this.emit(d.Event.PLAYER_REBUFFERING_END,null)))},t.prototype._checkPlayingProfile=function(e,t){var r,n,i,o,a=this._currentPlayingProfile,s=!!t;if((null===(r=null==a?void 0:a.audio)||void 0===r?void 0:r.id)!==(null===(n=null==e?void 0:e.audio)||void 0===n?void 0:n.profileId)||(null===(i=null==a?void 0:a.video)||void 0===i?void 0:i.id)!==(null===(o=null==e?void 0:e.video)||void 0===o?void 0:o.profileId)){var u=e?{audio:e.audio?{id:e.audio.profileId,mimeType:e.audio.mimeType}:void 0,video:e.video?{id:e.video.profileId,mimeType:e.video.mimeType,resolution:e.video.resolution}:void 0}:null;this._currentPlayingProfile=u,s=!0}s&&this.emit(d.Event.PLAYER_PLAYING_PROFILE_CHANGED,{profile:this._currentPlayingProfile})},t.prototype._configureLoadingTimeout=function(e,t,r){var n=this,i=null!=r?r:this._loadingTimeout,o=new y.PlaybackError(p.Errors.PLAYER_TIMEOUT_ERROR,"Timeout: track could not be loaded within "+i+" ms.");return i?setTimeout((function(){e.aborted||(null==t||t.abort(),n._emitError(o,!0))}),i):void 0},t.prototype._handleLoadingComplete=function(e,t){var r;clearTimeout(t);var n=this._currentContent&&this._currentContent.getMediaType();return this._player&&n&&(null===(r=this._playerContainerManager)||void 0===r||r.inject(this._player,n)),this._upcomingContent=null,e},t.prototype._handleLoadingError=function(e,t,r,n,i){if(clearTimeout(n),this._upcomingContent=null,r.aborted)return Promise.resolve(!1);if(this._tracker.trackLoadFailed(),this.emit(d.Event.PLAYER_LOADING_FAILED,{uri:e,logData:t.logData}),i){var o=i.track||{uri:e,fileId:t.fileId,mediaFormat:t.format,deviceId:t.logData.deviceId};this._emitError(i,"StorageError"!==i.name||!!i.canPlayNext,o)}return Promise.reject(i)},t.prototype._handleLoadedMetadata=function(e,t,r){var n=this;if(e.aborted)L.info("LoadedMetadata operations dropped: operation aborted.");else{this._loaded=!0;var i=this._player;if(i){this._setRebufferingState(),this._bufferManager.dequeueUpdates();var o=r.position>i.duration?0:r.position;this._lastTimeUpdatePostion=0,(isNaN(i.currentTime)||i.currentTime<o)&&(L.info("Resetting initial position after metadata."),i.currentTime=o),this._tracker.trackLoadDone(M(i.currentTime)),this.emitSync(d.Event.PLAYER_LOAD,{autoplay:r.autoplay,position:M(o),logData:t}),Promise.resolve().then((function(){n._onTimeUpdate()}));var a=function(){i.currentTime<o&&(L.info("Resetting initial position after playable."),i.currentTime=o)};r.autoplay&&!i.error&&(a=function(){(i.currentTime<o&&(L.info("Resetting initial position after playable."),i.currentTime=o),e.aborted)?L.info("Play trigger dropped: operation aborted"):new Promise((function(e){return e(n._player&&n._player.play())})).then((function(){return n._audioProcessor.resume()})).catch((function(e){if(e){if("NotSupportedError"===e.name)return Promise.reject(e);if("NotAllowedError"===e.name)return n.emit(d.Event.PLAYER_AUTOPLAY_FAILED,null),Promise.reject(e)}return n._player?n._player.play():Promise.resolve()})).catch((function(){n._onPause()}))}),i.readyState>2?(L.info("Ready to play, triggering play."),a()):(L.info("Waiting to be playable."),this.once(d.Event.INTERNAL_PLAYER_CANPLAY,a))}}},t.prototype._handleCanPlayThrough=function(e){var t;e.aborted?L.info("CanPlayThrough operations dropped: operation aborted."):(this._tracker.trackCanPlayThrough(),(null===(t=this._currentContent)||void 0===t?void 0:t.strategy)!==c.PlaybackStrategy.MSE&&this._tracker.trackPlayLatency())},t.prototype._loadContent=function(e,t){if(t.aborted||!this._upcomingContent)return L.info("Loading content dropped: operation aborted."),Promise.resolve(!1);if(!this._player)throw new y.PlaybackError(p.Errors.PLAYER_INVALID_INTERNAL_STATE,"Cannot load content without an HTMLMediaElement");this._canPreloadEmitted=!1;var r=this._upcomingContent;this._upcomingContent=null,this._currentContent=r,this._setAudioGain(r),this._subtitleManager.setVideoContent(A.canHaveSubtitles(r)?r:null);var n=e.callback;n&&this.once(d.Event.PLAYER_LOAD,(function(){t.aborted?L.info("Load content event dropped: operation aborted."):n()})),this.once(d.Event.INTERNAL_PLAYER_LOADED_METADATA,this._handleLoadedMetadata.bind(this,t,this._currentContent.getLogData(),e)),this.once(d.Event.INTERNAL_PLAYER_CANPLAYTHROUGH,this._handleCanPlayThrough.bind(this,t));var i=e.position,o="getCalculatedDuration"in r?r.getCalculatedDuration():1/0;o&&i>o&&(i=e.position=0);try{this._player.currentTime=i}catch(e){L.warn("Cannot set initial position before loading.",e)}var a=e.playbackSpeed;return!e.useDefaultPlaybackSpeed&&a&&this.setPlaybackSpeed(a),this._tracker.setProtected(r.isProtected()),L.info("Detecting strategy for "+r.constructor.name),r.strategy===c.PlaybackStrategy.MSE?this._loadMSEContent(r,e,t):this._loadURLContent(r,e,t)},t.prototype._loadURLContent=function(e,t,r){var n,i,o,a=this;if(!this._player||!e)return Promise.reject(new y.PlaybackError(p.Errors.PLAYER_INVALID_INTERNAL_STATE,"Invalid playback state."));L.info("Loading URL content.");var s=e.getURL();if(!s)return Promise.reject(new y.PlaybackError(p.Errors.PLAYER_INVALID_INTERNAL_STATE,"Content not loaded."));if(e.isProtected()){L.info("URL content is protected");this.on(d.Event.INTERNAL_ENCRYPTED,(function e(t){t.data.fromPolyfill&&(a.removeListener(d.Event.INTERNAL_ENCRYPTED,e),a._requestLicense(r,{initData:t.data.initData}))}))}if("video"===e.getMediaType()&&A.canHaveProfiles(e)){var u=e.getMediaProfileInfo();this._tracker.trackVideoLoadStart({bitrate:null===(n=u.video.selected)||void 0===n?void 0:n.video_bitrate,audioProfile:null!==(i=u.audio.selected)&&void 0!==i?i:void 0,videoProfile:null!==(o=u.video.selected)&&void 0!==o?o:void 0})}this._tracker.trackBufferLoadStart(),this._tracker.trackBufferURL(s,{bandwidth:0});var l=e.getLoadingApproach();if("src"===l.approach)L.info("URL content loaded using src attribute"),this._player.src=s;else{L.info("URL content loaded using source element");var c=document.createElement("source");c.src=s,c.type=l.type,this._player.appendChild(c)}return this._player.load(),Promise.resolve(!0)},t.prototype._loadMSEContent=function(e,t,r){var n,i,o,a=this;if(!this._player||!e)return Promise.reject(new y.PlaybackError(p.Errors.PLAYER_INVALID_INTERNAL_STATE,"Invalid playback state."));if(L.info("Loading MSE Content: "+e.getFileId()),e.isProtected()){L.log("MSE content is protected");var s=function(){return a._requestLicense(r).then((function(){r.aborted||(a._licenseRequested=!0,a._disableBufferingBeforeLicense&&a._onTimeUpdate())}))};this._disableLicensePrefetch?this.once(d.Event.INTERNAL_ENCRYPTED,s):this._bufferManager.once(d.Event.BUFFER_SOURCE_OPEN,s)}var u=this._bufferManager,l=u.getMediaSource();if(!l)return Promise.reject(new y.PlaybackError(p.Errors.PLAYER_INVALID_INTERNAL_STATE,"No media source."));if("video"===e.getMediaType()&&A.canHaveProfiles(e)){var c=e.getMediaProfileInfo();this._tracker.trackVideoLoadStart({bitrate:null===(n=c.video.selected)||void 0===n?void 0:n.video_bitrate,audioProfile:null!==(i=c.audio.selected)&&void 0!==i?i:void 0,videoProfile:null!==(o=c.video.selected)&&void 0!==o?o:void 0})}return this._player.src=URL.createObjectURL(l),this._setPlaybackRate(),new Promise((function(n,i){u.once(d.Event.BUFFER_SOURCE_OPEN,(function(){a._tracker.trackBufferLoadStart(),a._getRebufferingLatency().then((function(e){r.aborted||a._tracker.trackInitialRebuffering(e)})),("video"===e.getMediaType()?u.setDuration(e.getCalculatedDuration()):Promise.resolve(!0)).then((function(){return e.isProtected()&&a._disableBufferingBeforeLicense?u.injectInitSegment(e):(a._bufferManager.checkBufferHealth(e,t.position,!0),!0)})).then(n,i)}))}))},t.prototype._getRebufferingLatency=function(){var e=this;return new Promise((function(t){if(e._player){var r=l.monotonicNow();e.once(d.Event.PLAYER_REBUFFERING_END,(function(){t(l.monotonicDuration(r))}))}else t(0)}))},t.prototype._requestLicense=function(e,t){var r=this;if(void 0===t&&(t={}),e.aborted){return L.info("Request license dropped: operation aborted."),Promise.resolve(!1)}if(!this._player||!this._currentContent||!this._emeManager)return Promise.resolve(!1);var n=l.monotonicNow(),i=this._player.mediaKeys,o=this._currentContent,a=o.getFileId(),s=o.getLogData(),u=o.toLogJSON(),c=o.getKeySystem();if(!c)return Promise.resolve(!1);var _,p=o.getLicenseEndpoint();if(p)_=Promise.resolve(p);else{if(!a)return Promise.reject(new TypeError("Missing: fileId or licenseEndpoint"));_=this._licenseURLResolver.get(c,o.getMediaType()).then((function(e){return e.replace(/\{contentId\}/,a)}))}var f=this._emeManager,h=this._tracker;return h.setKeySystem(c),h.setKeySystemImpl(f.getKeySystemImpl()),Promise.all([_,o.getInitParams()]).then((function(r){var o=r[0],a=r[1];if(!a)return Promise.resolve(!1);h.setLicenseSessionLatency(l.monotonicDuration(n));var s=a.initDataType,u=t.initData||a.initData;if(i&&u&&s){var d={keySystem:c,signal:e,initData:u,mediaKeys:i,licenseServer:o,initDataType:s};return f.createSessionWithParams(d)}return Promise.resolve(!1)})).then((function(t){if(e.aborted)return L.info("License tracking dropped: operation aborted."),Promise.resolve(!1);"boolean"!=typeof t&&"elapsed"in t&&(h.setLicenseGenerationLatency(t.elapsed.generate),h.setLicenseRequestLatency(t.elapsed.request),h.setLicenseUpdateLatency(t.elapsed.update));var i=l.monotonicDuration(n);return h.setKeyLatency(i),r.emit(d.Event.PLAYER_KEY_RECEIVED,{requestTime:i,logData:s}),L.info("License updated."),Promise.resolve(!0)})).catch((function(t){if(e.aborted)return Promise.resolve(!1);var n=!t||!("canPlayNext"in t)||t.canPlayNext;return r._emitError(t,!!n,u),Promise.reject(t)}))},t.prototype._onTimeUpdate=function(){var e;if(this._loaded&&(null===(e=this._player)||void 0===e?void 0:e.readyState)&&this._currentContent){var t=this._currentContent,r=this._player.seeking,n=this._player.currentTime;if(t.isProtected()&&this._disableBufferingBeforeLicense&&!this._licenseRequested)L.log("Dropping time update event: buffering before license disabled.");else if(r||!this._lastTimeUpdatePostion||this._lastTimeUpdatePostion!==n){if(this._lastTimeUpdatePostion=r?0:n,t.strategy===c.PlaybackStrategy.MSE){var i=this._bufferManager;i.checkBufferHealth(t,n,r);var o=i.getBufferedSegmentInfoForTime(n);this._checkPlayingProfile(o)}var a=this._player.duration,s=M(n),u=t.getLogData();r?(this._tracker.trackPositionChanged(s),this.emit(d.Event.PLAYER_POSITION_CHANGED,{position:s,logData:u})):(this._tracker.trackProgress(s,A.canHaveAdaptations(t)?t.getCurrentBitrates().video:0),this.emit(d.Event.PLAYER_PROGRESS,{timestamp:Date.now(),position:s,played:this._tracker.getMSPlayed(),interval:500,logData:u}));var l=a-n<=this._preloadThreshold;!this._canPreloadEmitted&&l?(this._canPreloadEmitted=!0,this.emit(d.Event.PLAYER_CAN_PRELOAD,null)):this._canPreloadEmitted&&!l&&(this._canPreloadEmitted=!1),clearTimeout(this._syntheticEndedToken),this._synthesizeEnded&&t.isProtected()&&this._isPlaying()&&(this._syntheticEndedToken=setTimeout(this._onSyntheticEnded,M(a-n)))}else L.warn("Dropping duplicate time update.")}},t.prototype._isPlaying=function(){return!!this._player&&!this._player.paused},t.prototype._cleanMediaKeys=function(e,t){return void 0===t&&(t=this._emeManager),t?t.removeMediaKeys(e).catch((function(e){return L.warn("Failed to remove current media keys.",e),null})):Promise.resolve(null)},t.prototype._checkKeySystemAccess=function(){if(!this._newKeySystemAccessPerTrack||!this._player||!this._emeManager)return Promise.resolve();var e=this._player,t=this._emeManager;return this._cleanMediaKeys(e,t).then((function(){return t.requestMediaKeySystemAccess()})).then((function(){})).catch((function(e){return L.warn("Failed to request new media key system access.",e),Promise.reject(e)}))},t.prototype._createContent=function(e,t,r){var n=this;return void 0===t&&(t={manifestLatency:0,resolveLatency:0}),void 0===r&&(r=!1),(this._emeManager?this._emeManager.getKeySystemInfo():this.getMediaConfig().then((function(e){return{keySystem:_.KeySystem.INVALID_SPOTIFY_KEY,audioFormats:e.formatsInfo.audio,videoFormats:e.formatsInfo.video}}))).then((function(r){return b.createContent(e,{transport:n._transport,abrManager:n._abrManager,supportedFormats:{audio:r.audioFormats,video:r.videoFormats},mediator:n._mediator,keySystem:r.keySystem,audioResolver:n._audioResolver,videoResolver:n._videoResolver,disableCache:n._disableCache,disallowProfile:n._disallowProfile,allowMixedAVC1Codecs:n._allowMixedAVC1Codecs,measures:t})})).then((function(i){if(r)return i;var o=n._tracker;o.setResolveLatency(t.resolveLatency),o.setManifestLatency(t.manifestLatency);var a=n._getCacheKey(e);return a&&n._cache.set(a,i),i}))},t.prototype._preinitMediaElement=function(){var e=this;if(this._player||!this._emeManager)return Promise.resolve(this);var t=a.createAbortControllerLike();return this._emeManager.getKeySystemInfo().then((function(r){var n,i,o={audio:null===(n=r.audioFormats[0])||void 0===n?void 0:n.contentType,video:null===(i=r.videoFormats[0])||void 0===i?void 0:i.contentType};return o.audio||o.video?e._recreateMediaElement(o,o.video?"video":"audio",r.keySystem===_.KeySystem.FAIRPLAY?c.PlaybackStrategy.URL:c.PlaybackStrategy.MSE,t.signal):null})).then((function(){return e}),(function(t){return L.warn("Cannot precreate media element:",null==t?void 0:t.message),e}))},t.prototype._setAudioGain=function(e){var t;null===(t=this._audioProcessor)||void 0===t||t.setAudioGain(e.getAudioGain())},t.prototype._getCacheKey=function(e){var t,r=e.fileId,n=e.url,i=e.format,o=null!==(t=null!=r?r:n)&&void 0!==t?t:null;return!this._disableCache&&O[i]?o:null},t.prototype._getContentPromise=function(e,t){var r=this,n=this._cache,i=this._getCacheKey(e);if(i){var o=this._preloadingTracks[i],a=n.get(i);if(o)return L.info("Waiting for preloading track.",i),o.then((function(e){return L.info("Preloading succeeded.",i),t.setResolveLatency(e.resolveLatency),t.setManifestLatency(e.manifestLatency),n.get(i)})).catch((function(){return L.info("Preloading failed, creating new track",i),r._createContent(e)}));if(a)return this._newKeySystemAccessPerTrack&&this._emeManager?this._emeManager.getKeySystemInfo().then((function(n){return n.keySystem===a.getKeySystem()?(L.info("Using cached track.",i,a),t.setMemoryCached(!0),a):(L.info("Mismatched keysystem for cached track. Creating new track",i),r._createContent(e))})):(L.info("Using cached track.",i,a),t.setMemoryCached(!0),Promise.resolve(a))}return L.info("Creating new content",i),this._createContent(e)},t.prototype.getMediaSource=function(){return this._bufferManager.getMediaSource()},t.prototype.load=function(e,t,r){var n,i,o,s,u,l,_,f=this,h=function(e,t){return null==t?void 0:t.hasOwnProperty(e)}(t.uriProperty,e)?t.uriProperty:"uri",v=e[h];if(L.info("load",v),!v)return Promise.reject(new y.PlaybackError(p.Errors.PLAYER_CANNOT_FIND_PLAYABLE_URI,"Cannot find a playable URI."));if(!e.logData)return Promise.reject(new Error("Invalid track: logging info not specified"));this.stop(e.logData,e.mediaType),this._loaded=!1,this._licenseRequested=!1,this._rebuffering=!0,this._currentContent=null,this._checkPlayingProfile(null,!0),this._subtitleManager.setVideoContent(null),t.muted&&this.setMuted(!0),this._preloadThreshold=t.preloadThreshold||this._preloadThreshold;var m=++this._playId;this._abortController=a.createAbortControllerLike();var E=this._abortController.signal,g=this._tracker;g.trackLoadStart(v,e.fileId,m.toString(),e.logData,e.metadata);var R=this._configureLoadingTimeout(E,this._abortController,t.loadingTimeout);void 0!==R&&E.addEventListener("abort",(function(){return clearTimeout(R)})),this.emit(d.Event.PLAYER_BEFORE_LOAD,{track:e,options:t,logData:e.logData,uri:v,timestamp:Date.now()}),this._bufferManager.setPlayId(m);var T=(null===(n=e.options)||void 0===n?void 0:n.useDefaultPlaybackSpeed)?1:null!==(o=null===(i=e.options)||void 0===i?void 0:i.playbackSpeed)&&void 0!==o?o:this._playerSpeed,I={position:k(t.position||0),autoplay:null===(s=t.autoplay)||void 0===s||s,poster:e.poster,useDefaultPlaybackSpeed:!!(null===(u=e.options)||void 0===u?void 0:u.useDefaultPlaybackSpeed),playbackSpeed:T,callback:r,muted:null!==(l=t.muted)&&void 0!==l&&l,loop:null!==(_=t.loop)&&void 0!==_&&_};return this._loadingOptions=I,g.setPlayIntended(I.autoplay),g.setPlayedThreshold(t.playedThreshold),this._checkKeySystemAccess().then((function(){return f._getContentPromise(e,g)})).then((function(t){if(g.trackStrategy(t.strategy),t.isProtected()&&!f._emeManager)throw new y.PlaybackError(p.Errors.DISALLOW_PROTECTED_TRACK_ERROR,"Protected tracks not supported");t.setLogData(e.logData),t.strategy===c.PlaybackStrategy.MSE&&g.setCalculatedDuration(M(t.getCalculatedDuration())),f._upcomingContent=t})).then((function(){return f._prepareMediaElement(I,E)})).then((function(){var e;f._subtitleManager.setPlayer(f._player),(null===(e=f._upcomingContent)||void 0===e?void 0:e.isProtected())&&(L.info("Attaching HTMLMediaElement to the audio processor"),f._audioProcessor.setPlayer(f._player))})).then((function(){return f._loadContent(I,E)})).then((function(e){return f._handleLoadingComplete(e,R)}),this._handleLoadingError.bind(this,v,e,E,R))},t.prototype.preload=function(e){var t=this,r=this._getCacheKey(e),n=this._cache;if(!r||n.get(r)||!this._emeManager)return Promise.resolve(null);var i=this._preloadingTracks,o=i[r];if(o)return o;L.info("Preloading track",r);var a={manifestLatency:0,resolveLatency:0},s=this._createContent(e,a,!0).then((function(e){if(e.strategy!==c.PlaybackStrategy.MSE)return e;var t=e.getSegmentForTime(0);return t?e.getBufferSetForSegment(t).then((function(){return e})):e})).then((function(e){return n.set(r,e),delete i[r],L.info("Cached",r),a})).catch((function(e){return delete i[r],L.warn("Preloading error",e),t.emit(d.Event.PLAYER_PRELOADING_ERROR,{error:e,track:e.track||null,canPlayNext:!("canPlayNext"in e)||e.canPlayNext,preloading:!0}),Promise.reject(e)}));return i[r]=s,s},t.prototype.togglePlay=function(){return this._isPlaying()?this.pause():this.resume()},t.prototype.setSubtitleLanguage=function(e){this._subtitleManager.setLanguage(e)},t.prototype.getSubtitleLanguages=function(){return this._subtitleManager.getAvailableLanguages()},t.prototype.getActiveSubtitleLanguage=function(){return this._subtitleManager.getActiveLanguage()},t.prototype.deactivateCueEvents=function(){this._subtitleManager.deactivateListeners()},t.prototype.activateCueEvents=function(){this._subtitleManager.activateListeners()},t.prototype.setVolume=function(e,t){if(!this.emitSync(d.Event.PLAYER_BEFORE_VOLUME_CHANGE,{volume:e,options:t}).defaultPrevented){if(e<0||e>1)throw new y.PlaybackError(p.Errors.PLAYER_ATTEMPTED_VOLUME_OUT_OF_RANGE,"Volume should be in range [0, 1]");this._playerVolume=e,this._player&&(this._muted&&e>0&&this.setMuted(!1),this._player.volume=this._cubicVolume?e*e*e:e)}},t.prototype.getVolume=function(){return this._playerVolume},t.prototype.getPlayerState=function(){var e,t,r,n,i=this._player,o=this._currentContent,a={src:(null==i?void 0:i.src)?"data:"+((null==o?void 0:o.getFileId())||"unknown"):void 0,height:(null==i?void 0:i.clientHeight)||0,width:(null==i?void 0:i.clientWidth)||0},s={};if(o){var u=o.getMediaTypeMimeTypes();s.audio_format=u.audio,s.video_format=u.video,"video"===o.getMediaType()&&i instanceof HTMLVideoElement&&(s.video_height=i.videoHeight,s.video_width=i.videoWidth,a.poster=i.poster)}var l=null;if(A.canHaveTracking(o)){var c=o.getTrackingEvents();c&&(l={mute:c.mute,unmute:c.unmute,rewind:c.rewind,fullscreen:c.fullscreen,accept_invitation_linear:c.accept_invitation_linear,close_linear:c.close_linear,exit_fullscreen:c.exit_fullscreen})}return{playing:null!==(e=!(null==i?void 0:i.paused))&&void 0!==e&&e,position:i?M(i.currentTime):0,duration:i?M(i.duration):0,volume:null!==(t=this._playerVolume)&&void 0!==t?t:1,muted:this._muted,loop:null!==(r=null==i?void 0:i.loop)&&void 0!==r&&r,playback_speed:null!==(n=null==i?void 0:i.playbackRate)&&void 0!==n?n:0,playback_speed_selected:this._playerSpeed,buffering:this._rebuffering,media_type:(null==o?void 0:o.getMediaType())||null,media_info:s,player_element:a,content_metadata:(null==o?void 0:o.getContentMetadata())||{},tracking_data:l}},t.prototype.getPlayerPosition=function(){return this._player?M(this._player.currentTime):0},t.prototype.seek=function(e){var t,r=this;if(this._player){var n=null===(t=this._abortController)||void 0===t?void 0:t.signal,i=function(){if(r._player&&!(null==n?void 0:n.aborted)){var t=k(e);t<0?t=0:t>=r._player.duration&&(t=r._player.duration),r._player.currentTime=t}else L.info("Seek dropped: operation aborted.")};this._loaded?i():this.once(d.Event.PLAYER_LOAD,i),this._getRebufferingLatency().then((function(e){(null==n?void 0:n.aborted)||r._tracker.trackSeekRebuffering(e)}))}},t.prototype.pause=function(){var e=this;return this._audioProcessor.suspend().then((function(){return e._player&&e._isPlaying()?(e._emitReporting("pause"),Promise.resolve(e._player.pause())):Promise.resolve()}))},t.prototype.resume=function(){var e=this;return this._audioProcessor.resume().then((function(){return e._player&&!e._isPlaying()?(e._emitReporting("resume"),Promise.resolve(e._player.play())):Promise.resolve()}))},t.prototype.stop=function(e,t){var r,n,i,o=[],a=e||{};this.emit(d.Event.PLAYER_BEFORE_STOP,{timestamp:Date.now(),logData:a}),null===(r=this._abortController)||void 0===r||r.abort(),this._tracker.trackStopped(this._player?M(this._player.currentTime):-1,e,this.getStatistics()||void 0),this._bufferManager.abort(!0),this._emeManager&&o.push(this._emeManager.destroySessions());var s=this._player;if(s){this._subtitleManager.clear(),this._fatalOnNextError=this._shouldNextErrorBeFatal(),this._fatalOnNextError&&L.warn("MediaError detected: next immediate media error will be fatal.");var u=s.src;if(u)C.test(u)&&URL.revokeObjectURL(u),s.removeAttribute("src");else{var l=T.collectionToArray(s.getElementsByTagName("source"));L.info("HTMLSourceElements to removed: "+l.length);for(var c=0,_=l;c<_.length;c++){var p=_[c];s.removeChild(p)}L.info("Releasing HLS URLs")}s.load()}null===(n=this._currentContent)||void 0===n||n.unload();var f=this._currentContent&&this._currentContent.getMediaType();return s&&f&&(null===(i=this._playerContainerManager)||void 0===i||i.eject(s,f,t),s.ownerDocument!==document&&document.adoptNode(s)),this.emit(d.Event.PLAYER_STOPPED,null),Promise.all(o).then((function(){return!0}))},t.prototype.setMuted=function(e){void 0===e&&(e=!0);var t=this._player;t&&(this._muted=e,t.muted=e,this.emitSync(d.Event.PLAYER_MUTED_CHANGED,{muted:e}))},t.prototype.hideSubtitles=function(){this._subtitleManager.hide()},t.prototype.showSubtitles=function(){this._subtitleManager.show()},t.prototype.areSubtitlesShown=function(){return this._subtitleManager.visible()},t.prototype.getKeySystemInfo=function(){return this._emeManager?this._emeManager.getKeySystemInfo():Promise.resolve(null)},t.prototype.getVideoVariants=function(){var e=this._currentContent;if("video"!==(null==e?void 0:e.getMediaType()))return[];var t=[];if(!A.canHaveProfiles(e))return t;for(var r=0,n=e.getMediaProfileInfo().video.available;r<n.length;r++){var i=n[r];t.push({width:i.video_width,height:i.video_height,bitrate:i.video_bitrate})}return t},t.prototype.setPreferredBitrate=function(e){return"number"!=typeof e?Promise.resolve(f.OperationResult.INVALID):(this._preferredBitrate=e,this._currentContent&&"video"===this._currentContent.getMediaType()&&e>0&&this._bufferManager.abort(!0),this._abrManager.overrideBitrate(e),Promise.resolve(f.OperationResult.SUCCESS))},t.prototype.getCurrentBandwidth=function(){return this._abrManager.getBandwidthEstimate()},t.prototype.setBackgrounded=function(e){this._abrManager.overrideBitrate(e?1e-32:this._preferredBitrate)},t.prototype.setVideoResolution=function(e){var t,r;this._videoResolution=i.__assign(i.__assign({},this._videoResolution),e),A.canHaveResolution(this._currentContent)&&(null===(r=(t=this._currentContent).setVideoResolution)||void 0===r||r.call(t,this._videoResolution))},t.prototype.activateElement=function(){var e;return this._playerActivated||!this._player||this._player.src?(this._audioProcessor.resume(),!1):(null===(e=this._player)||void 0===e||e.load(),this._playerActivated=!0,!0)},t.prototype.getMediaConfig=function(){var e=this;return void 0===this._mediaConfig?function(e,t){var r=t||U("video"),n=function(e){r.canPlayType("audio/mp3")&&(e.formats.audio.push("audio/mp3"),e.formatsInfo.audio.push({mimeType:"audio/mp3",codec:"mp3",contentType:'audio/mp3; codecs="mp3"'}),e.supports.unprotected_audio=!0)};if(e)return e.getKeySystemInfo().then((function(e){var t=e.audioFormats,r=e.videoFormats,o={supports:{protected_audio:!!t.length,unprotected_audio:!0,protected_video:!!r.length,unprotected_video:!0},formats:{audio:t.map((function(e){return e.contentType})),video:r.map((function(e){return e.contentType}))},formatsInfo:{audio:i.__spreadArray([],t),video:i.__spreadArray([],r)}};return o.keysystem=e.keySystem,o.keysystem_impl=e.keySystemImpl,n(o),o}));var o="undefined"!=typeof window&&window.MediaSource?function(e){return MediaSource.isTypeSupported(e)}:function(e){return"probably"===r.canPlayType(e)||"probably"===r.canPlayType(e.split(";")[0])},a=g.getMediaKeySystemConfiguration([E.EMEConfigs[0]],o),s=[],u=[],l=[],c=[];if(a){for(var d=a.audioCapabilities,_=a.videoCapabilities,p=0,f=d;p<f.length;p++){var h=f[p];s.push(h.contentType),l.push(g.toFormatInfo(h.contentType))}for(var v=0,y=_;v<y.length;v++){h=y[v];u.push(h.contentType),c.push(g.toFormatInfo(h.contentType))}}var m={supports:{protected_audio:!1,unprotected_audio:!!s.length,protected_video:!1,unprotected_video:!!u.length},formats:{audio:s,video:u},formatsInfo:{audio:l,video:c}};return n(m),Promise.resolve(m)}(this._emeManager,this._player).then((function(t){return e._mediaConfig=t,e._mediaConfig})):Promise.resolve(this._mediaConfig)},t.prototype.setPlaybackSpeed=function(e){return!(!isFinite(e)||e<=0)&&(this._playerSpeed=null!=e?e:1,this._setPlaybackRate(),!0)},t.prototype.getStatistics=function(){return this._player&&this._currentContent?this._statistics.getSample(this._player,this._currentContent):null},t.prototype.getAudioProcessor=function(){return this._audioProcessor},t}(o.EventEmitter);r.Player=w},{"../enums/content_mediator_event":79,"../enums/errors":80,"../enums/event":81,"../enums/key_system":82,"../enums/media_format":84,"../enums/operation_result":86,"../error/playback":99,"../typedefs":104,"./audio_processor":31,"./buffer":33,"./content_types":46,"./content_types/capabilities":41,"./eme/configs":49,"./eme/manager":51,"./helpers/dom":59,"./helpers/eme":60,"./statistics":71,"./subtitle_manager":73,"@js-sdk/common/es5/debug_tools":9,"@js-sdk/common/es5/monotonic_now":15,"@spotify-internal/emitter/es5":109,"@spotify-internal/linkedlist/es5":161,"@spotify-internal/transport/es5":188,tslib:227}],71:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Statistics=r.getBufferAvailability=void 0;var n=e("../typedefs"),i=e("./content_types/director_manifest_content"),o=e("./content_types/capabilities");function a(e,t){for(var r=e.length,n=0;n<r;n++)if(e.start(n)<=t&&t<=e.end(n))return 1e3*(e.end(n)-t);return 0}r.getBufferAvailability=a;var s=function(){function e(e){this.bandwidthEstimator=e.bandwidthEstimator}return e.create=function(t){return new e(t)},e.prototype.getSample=function(e,t){var r,s,u,l,c,d,_,p=this.bandwidthEstimator.getBandwidthEstimate(),f=a(e.buffered,e.currentTime);if("audio"===t.getMediaType()&&t.strategy===n.PlaybackStrategy.MSE){var h=null===(s=null===(r=t.getSegmentForTime(0))||void 0===r?void 0:r.bufferSet)||void 0===s?void 0:s.audio,v=null==h?void 0:h.bitrate;return{bandwidth:p,bufferAvailability:f,audio:{mimeType:null==h?void 0:h.mimeType,bitrate:v}}}if(o.canHaveProfiles(t)){var y=t.getMediaProfileInfo(),m=y.audio,E=y.video,g="getVideoPlaybackQuality"in e?e.getVideoPlaybackQuality():{creationTime:void 0,droppedVideoFrames:void 0,totalVideoFrames:void 0};return{bandwidth:p,bufferAvailability:f,video:{creationTime:g.creationTime,droppedVideoFrames:g.droppedVideoFrames,totalVideoFrames:g.totalVideoFrames,bitrate:null===(u=E.selected)||void 0===u?void 0:u.video_bitrate,availableBitrates:E.available.map((function(e){return e.video_bitrate})),height:null===(l=E.selected)||void 0===l?void 0:l.video_height,width:null===(c=E.selected)||void 0===c?void 0:c.video_width,resolution:null===(d=E.selected)||void 0===d?void 0:d.video_resolution,mimeType:i.getProfileMimeType(E.selected)},audio:{bitrate:null===(_=m.selected)||void 0===_?void 0:_.audio_bitrate,mimeType:i.getProfileMimeType(m.selected)}}}return null},e}();r.Statistics=s},{"../typedefs":104,"./content_types/capabilities":41,"./content_types/director_manifest_content":42}],72:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StorageResolve=void 0;var n=e("@js-sdk/common/es5/debug_tools"),i=e("../enums/errors"),o=e("../error/storage"),a=n.logging.forTag("playback.storage_resolve"),s=function(){function e(e){this._transport=e}return e.prototype._parseResponse=function(e,t){var r,n;if(200!==t.status)return(n=new o.StorageError(i.Errors.STORAGE_FAILED_WITH_STATUS,"Storage Resolve responded with "+t.status)).status=t.status,n.fileId=e,Promise.reject(n);var a=t.body;if(!(null===(r=null==a?void 0:a.cdnurl)||void 0===r?void 0:r.length))return(n=new o.StorageError(i.Errors.STORAGE_RETURNED_NO_TRACKS,"Storage Resolve returned no tracks for fileId "+e)).fileId=e,Promise.reject(n);var s={uri:a.cdnurl[0],uris:a.cdnurl,protection:"cenc"};return Promise.resolve(s)},e.prototype.getCDNURL=function(e,t){a.info("Requesting CDN URL for ",e);var r="files/audio/interactive",n="@webgate/storage-resolve/"+(t?"v2/"+r+"/"+t+"/"+e:r+"/"+e)+"?version=10000000&product=9&platform=39&alt=json";return this._transport.request(n,{responseType:"json",retry:{condition:function(e,t){var r=e.getStatusFamily();return 429===e.status||r===t.SERVER_ERROR||r===t.CONNECTION_ERROR}}}).then(this._parseResponse.bind(this,e))},e.prototype.getManifest=function(e){var t="https://seektables.scdn.co/seektable/"+e+".json";return a.info("Requesting JSON manifest for ",e),this._transport.request(t,{responseType:"json",retry:{condition:function(e,t){var r=e.getStatusFamily();return 429===e.status||r===t.SERVER_ERROR||r===t.CONNECTION_ERROR}}}).then((function(t){var r;return 200!==t.status?((r=new o.StorageError(i.Errors.STORAGE_TRACK_MANIFEST_FAILED,"Track manifest request failed with status code "+t.status)).debug.file_id=e,r.status=t.status,Promise.reject(r)):t.body?t.body:((r=new o.StorageError(i.Errors.STORAGE_TRACK_MANIFEST_EMPTY,"Received empty manifest.")).debug.file_id=e,r.status=t.status,Promise.reject(r))}))},e}();r.StorageResolve=s},{"../enums/errors":80,"../error/storage":100,"@js-sdk/common/es5/debug_tools":9}],73:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SubtitleManager=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("../enums/event"),a=e("../enums/subtitle_mode"),s=e("./helpers/dom");function u(e){var t=e;return{id:t.id,text:t.text}}var l=/^[A-Za-z]{2,4}([_-][A-Za-z]{4})?([_-]([A-Za-z]{2}|[0-9]{3}))?$|[A-Za-z]{2,3}-x-cc/,c=function(e){function t(t){var r=e.call(this)||this;return r._isVisible=!1,r._player=null,r._crossOrigin=null,r._currentVideoContent=null,r._unsubscribers=[],r._displayedCues=[],r._deactivateListeners=!1,r._activeLanguage=void 0,r._preferredLanguage=t.language.toLowerCase(),t.deactivateListeners&&(r._deactivateListeners=!0),r._onEnter=r._onEnter.bind(r),r._onExit=r._onExit.bind(r),r._onLoadedMetadata=r._onLoadedMetadata.bind(r),r.setPlayer(t.player),r}return n.__extends(t,e),t.prototype._subscribeToCueEvents=function(e){var t,r=this,n=e.track;if(!n)throw new Error("No track");if(null===(t=n.cues)||void 0===t?void 0:t.length){this._displayedCues=n.activeCues?Array.from(n.activeCues):[],this._emitDisplayedCues();for(var i=function(e){var t=n.cues[e];if(!t)return"continue";t.addEventListener("enter",o._onEnter),t.addEventListener("exit",o._onExit),o._unsubscribers.push((function(){t.removeEventListener("enter",r._onEnter),t.removeEventListener("exit",r._onExit)}))},o=this,a=0;a<n.cues.length;a++)i(a)}else{e.addEventListener("load",(function t(){r._subscribeToCueEvents(e),e.removeEventListener("load",t)}))}},t.prototype._unsubscribeFromCueEvents=function(){this._unsubscribers.forEach((function(e){return e()})),this._unsubscribers=[]},t.prototype._onEnter=function(e){var t=e.target;this._displayedCues.indexOf(t)>-1||(this._displayedCues.push(t),this._emitDisplayedCues())},t.prototype._onExit=function(e){var t=e.target,r=this._displayedCues.indexOf(t);r>-1&&(this._displayedCues.splice(r,1),this._emitDisplayedCues())},t.prototype._emitDisplayedCues=function(){this.emit(o.Event.PLAYER_DISPLAYED_CUES_CHANGED,{cues:this._displayedCues.map(u)})},t.prototype._updateVisibleState=function(){var e,t,r=this;if(this._player){var n=this.getActiveLanguage();Array.from(null!==(t=null===(e=this._player)||void 0===e?void 0:e.querySelectorAll("track"))&&void 0!==t?t:[]).forEach((function(e){e.style.visibility=r._isVisible?"visible":"hidden"}));for(var i=this._player.textTracks,o=0,s=i.length;o<s;o++){var u=i[o];u&&(u.language.toLowerCase()===n?u.mode=this._isVisible?a.SubtitleMode.SHOWING:a.SubtitleMode.HIDDEN:u.mode=a.SubtitleMode.DISABLED)}}},t.prototype._updateTextTracks=function(){var e=this._player;e&&(e.readyState>=1?this._switchActiveTextTrack():this._currentVideoContent&&e.addEventListener(o.Event.MEDIA_LOADEDMETADATA,this._onLoadedMetadata))},t.prototype._switchActiveTextTrack=function(){var e=this._player;if(e&&this._currentVideoContent){var t=this._updateActiveLanguage(),r=null,n=null;s.collectionToArray(e.getElementsByTagName("track")).forEach((function(e){e.default&&(r=e),e.srclang.toLowerCase()===t&&(n=e)})),r&&(r.default=!1,r.track.mode=a.SubtitleMode.DISABLED,this._unsubscribeFromCueEvents()),n&&(n.default=!0,n.track.mode=this._isVisible?a.SubtitleMode.SHOWING:a.SubtitleMode.HIDDEN,this._deactivateListeners||this._subscribeToCueEvents(n))}},t.prototype._onLoadedMetadata=function(){var e=this,t=this._player;if(t&&(s.clearChildElements(t,"track"),this._currentVideoContent)){t.crossOrigin="anonymous",this._updateActiveLanguage();for(var r=0,n=this._currentVideoContent.getSubtitles();r<n.length;r++){var i=n[r],o=i.lang,a=i.url,u=document.createElement("track");u.label=o+" subtitles",u.kind="subtitles",u.srclang=o,u.src=a,u.style.visibility=this._isVisible?"visible":"hidden",t.appendChild(u)}setTimeout((function(){return e._switchActiveTextTrack()}))}},t.prototype._updateActiveLanguage=function(){if(this._player&&this._currentVideoContent){for(var e=this._currentVideoContent.getSubtitleLanguages(),t=this._preferredLanguage.split("-")[0],r=null,n=0,i=e;n<i.length;n++){var o=i[n].toLowerCase();if(o===this._preferredLanguage)return this._activeLanguage=o,this._activeLanguage;o.split("-")[0]===t&&null===r&&(r=o)}return this._activeLanguage=null!=r?r:"en-us",this._activeLanguage}this._activeLanguage=void 0},t.prototype.getActiveLanguage=function(){if(this._player&&this._currentVideoContent)return this._activeLanguage},t.prototype.setVideoContent=function(e){var t;this._unsubscribeFromCueEvents(),this._displayedCues=[],this._currentVideoContent=e,e?this.emit(o.Event.PLAYER_SUBTITLE_LANGUAGES_LOADED,{languages:null!==(t=e.getSubtitleLanguages())&&void 0!==t?t:[]}):this.clear(),this._updateTextTracks()},t.prototype.setPlayer=function(e){var t,r="VIDEO"===(null==e?void 0:e.tagName)?e:null;this._player!==r&&this.clear(),this._player=r||null,this._crossOrigin=null!==(t=null==r?void 0:r.crossOrigin)&&void 0!==t?t:null,this._updateTextTracks()},t.prototype.getAvailableLanguages=function(){var e,t;return null!==(t=null===(e=this._currentVideoContent)||void 0===e?void 0:e.getSubtitleLanguages())&&void 0!==t?t:[]},t.prototype.setLanguage=function(e){if(!e.length)throw new TypeError("Argument `code` must be a non-empty string. Hide subtitles using `hideSubtitles()`.");if(!l.test(e))throw new TypeError("Argument `code` must be a valid BCP 47 formatted language code");this._preferredLanguage!==e.toLowerCase()&&(this._preferredLanguage=e.toLowerCase(),this._switchActiveTextTrack())},t.prototype.hide=function(){this._isVisible=!1,this._updateVisibleState()},t.prototype.show=function(){this._isVisible=!0,this._updateVisibleState()},t.prototype.deactivateListeners=function(){this._deactivateListeners||this._player&&(this._deactivateListeners=!0,this._unsubscribeFromCueEvents())},t.prototype.activateListeners=function(){this._deactivateListeners&&(this._deactivateListeners=!1,this._updateTextTracks())},t.prototype.areListenersActivated=function(){return!this._deactivateListeners},t.prototype.clear=function(){var e=this._player;e&&(this._unsubscribeFromCueEvents(),this._currentVideoContent=null,this._displayedCues=[],s.clearChildElements(e,"track"),e.removeEventListener(o.Event.MEDIA_LOADEDMETADATA,this._onLoadedMetadata),e.crossOrigin=this._crossOrigin)},t.prototype.visible=function(){return this._isVisible},t}(i.EventEmitter);r.SubtitleManager=c},{"../enums/event":81,"../enums/subtitle_mode":91,"./helpers/dom":59,"@spotify-internal/emitter/es5":109,tslib:227}],74:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Tracker=void 0;var n=e("tslib"),i=e("@js-sdk/common/es5/debug_tools"),o=e("@js-sdk/common/es5/monotonic_now"),a=e("@spotify-internal/emitter/es5"),s=e("../enums/event"),u=e("./tracking_data"),l=i.logging.forTag("playback.tracker"),c=function(e){function t(t){void 0===t&&(t={});var r=e.call(this)||this;return r._playedThreshold=31e3,r._playedThresholdReached=!1,r._trackingData=null,r._quartileTrackingEvents={firstEventFired:!1,midEventFired:!1,thirdEventFired:!1},r._playbackHistory=[],r._playedThreshold=t.playerThreshold||31e3,r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._checkPlayedThreshold=function(){var e=this._trackingData;!e||!this._playedThreshold||this._playedThresholdReached||e.msPlayed<this._playedThreshold||(this._playedThresholdReached=!0,this.emit(s.Event.TRACKER_PLAYED_THRESHOLD_REACHED,{played:e&&e.msPlayed||0,threshold:this._playedThreshold}))},t.prototype._checkPercentileThresholds=function(){var e=this._trackingData;if(e){var t=e.msActualDuration||e.msFileDuration;if(t){var r=Math.ceil(t/4);!this._quartileTrackingEvents.firstEventFired&&e.position>=r&&(this._quartileTrackingEvents.firstEventFired=!0,this.emit(s.Event.TRACKER_FIRST_QUARTILE,null)),!this._quartileTrackingEvents.midEventFired&&e.position>=2*r&&(this._quartileTrackingEvents.midEventFired=!0,this.emit(s.Event.TRACKER_MIDPOINT,null)),!this._quartileTrackingEvents.thirdEventFired&&e.position>=3*r&&(this._quartileTrackingEvents.thirdEventFired=!0,this.emit(s.Event.TRACKER_THIRD_QUARTILE,null))}}},t.prototype.getMSPlayed=function(){return this._trackingData?this._trackingData.msPlayed:0},t.prototype.getStallsInformation=function(){return this._trackingData?{nStalls:this._trackingData.nStalls,msTotalStalled:this._trackingData.msStalled}:{nStalls:0,msTotalStalled:0}},t.prototype.trackLoadStart=function(e,t,r,n,i){var a=u.TrackingData.create();this._trackingData=a,this._playedThresholdReached=!1,this._quartileTrackingEvents={firstEventFired:!1,midEventFired:!1,thirdEventFired:!1},a.fileId=null!=t?t:"",a.currentTrackUri=e,a.loadTime=Date.now(),a.loadStartMonotonic=o.monotonicNow(),a.internalPlayId=r,a.externalLoadTime=n.externalLoadTime||0,a.displayTrack=n.displayTrack||"",a.playbackId=n.playbackId||"",a.playContext=n.playContext||"",a.reasonStart=n.reason||"unknown",a.sourceStart=n.source||"unknown",a.clientId=n.clientId||"",a.correlationId=n.correlationId||"",a.playbackService=n.playbackService||"";var l=n.referrer||{};a.referrer=void 0!==l.name?l.name:"unknown",a.referrerVersion=void 0!==l.version?l.version:"unknown",a.referrerVendor=void 0!==l.vendor?l.vendor:"unknown";var c=n.format||{};c.codec&&(a.audioCodec=c.codec.toLowerCase()),c.bitrate&&(a.bitrate=c.bitrate),c.audioQuality&&(a.audioQuality=c.audioQuality),a.gaiaDevId=n.deviceId||"none",a.noLog=n.noLog||!1,a.noTSV=n.noTSV||!1,a.noStats=n.noStats||!1,a.contentMetadata=i,"number"==typeof(null==i?void 0:i.displayDuration)&&(a.msMetadataDuration=i.displayDuration),this.emit(s.Event.TRACKER_TRACKING_DATA_CREATED,{trackingData:a})},t.prototype.trackBufferLoadStart=function(){var e=this._trackingData;e&&(e.bufferLoadStartMonotonic=o.monotonicNow())},t.prototype.trackBytesDownloaded=function(e){var t=this._trackingData;t&&(t.totalBytes+=e)},t.prototype.trackLoadDone=function(e){var t=this._trackingData;t&&(t.bufferLoadStartMonotonic&&(t.msInitLatency=o.monotonicDuration(t.bufferLoadStartMonotonic)),t.localTimeMs=Date.now(),t.position=e,t.addStartSegment())},t.prototype.trackPlay=function(e,t){var r=this._trackingData;r&&(r.played||this.emit(s.Event.TRACKER_PLAYBACK_START,{trackingData:r}),r.played=!0,r.position=e,r.startPosition=e,r.addSpeedChange(t||1))},t.prototype.trackCanPlayThrough=function(){if(this._trackingData){var e=o.monotonicNow();this.trackHeadLatency(e)}},t.prototype.trackPlayLatency=function(e){void 0===e&&(e=o.monotonicNow());var t=this._trackingData;!t||t.nSeeksBackward||t.nSeeksForward||t.loadStartMonotonic&&(t.msPlayLatency=o.monotonicDuration(t.loadStartMonotonic,e))},t.prototype.trackHeadLatency=function(e){void 0===e&&(e=o.monotonicNow());var t=this._trackingData;t&&t.bufferLoadStartMonotonic&&(t.msHeadLatency=o.monotonicDuration(t.bufferLoadStartMonotonic,e))},t.prototype.trackBufferURL=function(e,t){var r=this._trackingData;r&&r.trackBufferURL(e,t)},t.prototype.trackNavigatorOffline=function(){var e=this._trackingData;e&&(e.nOffline+=1)},t.prototype.trackInitialRebuffering=function(e){var t=this._trackingData;t&&(t.msInitialRebuffering=e)},t.prototype.trackSeekRebuffering=function(e){var t=this._trackingData;t&&(e>t.maxMsSeekRebuffering&&(t.maxMsSeekRebuffering=e),t.msSeekRebuffering+=e)},t.prototype.trackMsStalled=function(e){var t=this._trackingData;t&&(e>t.maxMsStalled&&(t.maxMsStalled=e),t.msStalled+=e,t.nStalls++)},t.prototype.trackLoadFailed=function(){var e=this._trackingData;e&&(this.trackPlayLatency(),e.position=0,e.addStartSegment())},t.prototype.trackStopped=function(e,t,r){var i,o,a,u,c=this._trackingData;if(c&&!c.isFinalized()){if(c.stopTime=Date.now(),c.lastPlayPosition>=0&&e>=0&&c.lastPlayPosition<e){var d=e-c.lastPlayPosition;c.addMSPlayed(d)}c.addEndSegment(),c.sourceEnd=t.source||"unknown",c.reasonEnd=t.reason||"unknown",c.nextPlaybackId=t.playbackId||"",c.droppedVideoFrames=null!==(o=null===(i=null==r?void 0:r.video)||void 0===i?void 0:i.droppedVideoFrames)&&void 0!==o?o:0,c.totalVideoFrames=null!==(u=null===(a=null==r?void 0:r.video)||void 0===a?void 0:a.totalVideoFrames)&&void 0!==u?u:0,c.finalize(),l.info("Tracker data finalized.");var _=c.getPlaybackStats();this.emit(s.Event.TRACKER_TRACKING_DATA_FINALIZED,{trackingData:c,playbackStats:_}),""!==c.playbackId&&-1!==this._playbackHistory.indexOf(c.playbackId)&&this.emit(s.Event.TRACKER_LOG_CLIENT_EVENT,{source:"playback:tracker",event:"playback_id_reuse",payload:{playbackId:c.playbackId,playbackHistory:n.__spreadArray([],this._playbackHistory)}}),10===this._playbackHistory.length&&(this._playbackHistory=this._playbackHistory.slice(1)),this._playbackHistory.push(c.playbackId)}},t.prototype.trackPositionChanged=function(e){var t=this._trackingData;if(t){var r=t.position;e!==r&&(t.addEndSegment(),e>r?(t.nSeeksForward++,t.msSeeksForward+=e-r):e<r&&(t.nSeeksBackward++,t.msSeeksBackward+=r-e),t.position=e,t.lastPlayPosition=-1,t.addStartSegment())}},t.prototype.trackPlaying=function(e){var t=this._trackingData;if(t){if(t.lastPlayPosition>=0&&t.lastPlayPosition<e){var r=e-t.lastPlayPosition;t.addMSPlayed(r)}t.position=e,t.lastPlayPosition=e}},t.prototype.trackPaused=function(e){var t=this._trackingData;if(t){if(t.lastPlayPosition>=0&&t.lastPlayPosition<e){var r=e-t.lastPlayPosition;t.addMSPlayed(r)}t.position=e,t.lastPlayPosition=e}},t.prototype.trackProgress=function(e,t){var r=this._trackingData;if(null==r?void 0:r.played){var n=0;if(r.lastPlayPosition>=0){if((n=e-r.lastPlayPosition)<0)return void l.warn("Skipping msPlayed calculation: late progress event.");r.addMSPlayed(n)}this._checkPlayedThreshold(),r.position=e,r.lastPlayPosition=e,this._checkPercentileThresholds(),t&&r.trackBitrate(t,n)}},t.prototype.trackSpeedChanged=function(e){var t=this._trackingData;t&&t.addSpeedChange(e)},t.prototype.trackVideoLoadStart=function(e){var t=this._trackingData;t&&t.registerVideoVariant(e)},t.prototype.trackWarning=function(){var e=this._trackingData;e&&e.nWarnings++},t.prototype.trackOffline=function(){var e=this._trackingData;e&&e.nOffline++},t.prototype.trackStrategy=function(e){var t=this._trackingData;t&&(t.strategy=e)},t.prototype.setActualDuration=function(e){var t=this._trackingData;t&&(t.msActualDuration=e)},t.prototype.setKeySystem=function(e){var t=this._trackingData;t&&(t.keySystem=e)},t.prototype.setKeySystemImpl=function(e){var t=this._trackingData;t&&(t.keySystemImpl=e)},t.prototype.setManifestLatency=function(e){var t=this._trackingData;t&&(t.msManifestLatency=e)},t.prototype.setPlayIntended=function(e){var t=this._trackingData;t&&(t.playIntended=e)},t.prototype.setKeyLatency=function(e){var t=this._trackingData;t&&(t.msKeyLatency=e)},t.prototype.setMemoryCached=function(e){var t=this._trackingData;t&&(t.memoryCached=e)},t.prototype.setPersistentCached=function(e){var t=this._trackingData;t&&(t.persistentCached=e)},t.prototype.setProtected=function(e){var t=this._trackingData;t&&(t.isProtected=e)},t.prototype.setHadError=function(e){var t=this._trackingData;t&&(t.hadError=e)},t.prototype.setLicenseSessionLatency=function(e){var t=this._trackingData;t&&(t.msLicenseSessionLatency=e)},t.prototype.setLicenseGenerationLatency=function(e){var t=this._trackingData;t&&(t.msLicenseGenerationLatency=e)},t.prototype.setLicenseRequestLatency=function(e){var t=this._trackingData;t&&(t.msLicenseRequestLatency=e)},t.prototype.setLicenseUpdateLatency=function(e){var t=this._trackingData;t&&(t.msLicenseUpdateLatency=e)},t.prototype.setResolveLatency=function(e){var t=this._trackingData;t&&(t.msResolveLatency=e)},t.prototype.setCalculatedDuration=function(e){var t=this._trackingData;t&&(t.msFileDuration=e)},t.prototype.setPlayedThreshold=function(e){this._playedThreshold=e},t.prototype.trackFragment=function(e){var t=this._trackingData;if(t){var r=e.bandwidth,n=e.resolution;n&&((n<t.minResolution||!t.minResolution)&&(t.minResolution=n),n>t.maxResolution&&(t.maxResolution=n)),(r<t.bpsBandwidthMin||!t.bpsBandwidthMin)&&(t.bpsBandwidthMin=r),r>t.bpsBandwidthMax&&(t.bpsBandwidthMax=r),t.bpsBandwidthAvg=t.bpsBandwidthAvg?(t.bpsBandwidthAvg+r)/2:r}},t.prototype.trackProfileChanged=function(e){var t=this._trackingData;if(t){var r=e.bitrate;r<t.lastBitrate&&t.nRenditionDowngrade++,r>t.lastBitrate&&t.nRenditionUpgrade++,t.lastBitrate=r}},t}(a.EventEmitter);r.Tracker=c},{"../enums/event":81,"./tracking_data":75,"@js-sdk/common/es5/debug_tools":9,"@js-sdk/common/es5/monotonic_now":15,"@spotify-internal/emitter/es5":109,tslib:227}],75:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TrackingData=void 0;var n=e("../enums/errors"),i=e("../enums/key_system"),o=e("../error/tracking"),a=e("./cdn_url_tracker"),s=function(){function e(){this._bitrates={},this._isFinalized=!1,this._needsEndSegment=!1,this._segments=[],this._cdnURLTracker=new a.CDNURLTracker,this.currentSpeed=1,this.audioCodec=null,this.bitrate=0,this.audioQuality=void 0,this.urls={},this.currentTrackUri="",this.displayTrack="",this.externalLoadTime=0,this.fileId="",this.gaiaDevId="none",this.hadError=!1,this.internalPlayId="",this.isProtected=!1,this.keySystem="",this.keySystemImpl="",this.lastPlayPosition=-1,this.loadTime=0,this.localTimeMs=-1,this.maxContinuous=0,this.msInitialRebuffering=0,this.maxMsSeekRebuffering=0,this.maxMsStalled=0,this.memoryCached=!1,this.msActualDuration=0,this.msMetadataDuration=0,this.msFileDuration=0,this.msHeadLatency=null,this.msInitLatency=null,this.msKeyLatency=null,this.msLicenseGenerationLatency=null,this.msLicenseRequestLatency=null,this.msLicenseSessionLatency=null,this.msLicenseUpdateLatency=null,this.msManifestLatency=null,this.msPlayed=0,this.msNominalPlayed=0,this.msPlayedUnion=0,this.msPlayLatency=null,this.msResolveLatency=null,this.msSeekRebuffering=0,this.msSeeksBackward=0,this.msSeeksForward=0,this.nextPlaybackId="",this.nOffline=0,this.noLog=!1,this.noTSV=!1,this.noStats=!1,this.nWarnings=0,this.msStalled=0,this.nSeeksBackward=0,this.nSeeksForward=0,this.nSpeedChanges=0,this.nStalls=0,this.nRenditionUpgrade=0,this.nRenditionDowngrade=0,this.bpsBandwidthMax=0,this.bpsBandwidthMin=0,this.bpsBandwidthAvg=0,this.totalBandwidth=0,this.lastBitrate=0,this.persistentCached=!1,this.playbackId="",this.playContext="",this.played=!1,this.position=0,this.reasonEnd="unknown",this.reasonStart="unknown",this.referrer="unknown",this.referrerVendor="unknown",this.referrerVersion="unknown",this.sourceEnd="unknown",this.sourceStart="unknown",this.startPosition=0,this.stopTime=0,this.streamingRule="none",this.timeWeightedBitrate=0,this.totalBytes=0,this.playIntended=!1,this.videoCodec=null,this.clientId="unknown",this.correlationId="unknown",this.droppedVideoFrames=0,this.totalVideoFrames=0,this.maxResolution=0,this.minResolution=0,this.playbackService="",this.strategy=""}return e.create=function(){return new e},e.prototype._calculateUnion=function(){for(var e=this._segments.slice(0),t=0,r=0,n=0,i=0,o=0,a=0,s=this.maxContinuous;o<e.length;o++)o%2!=0&&void 0!==e[o-1]&&"start"===e[o-1].type&&(s=(a=e[o].time-e[o-1].time)>s?a:s);for(this.maxContinuous=s,e.sort((function(e,t){return e.time-t.time}));i<e.length;i++)"start"===e[i].type&&(0===r&&(n=i),++r),"end"===e[i].type&&0===--r&&(t+=e[i].time-e[n].time);return t},e.prototype._calculateWeightedBitrate=function(e){var t=this._bitrates,r=0;for(var n in t)n&&t.hasOwnProperty(n)&&e>0&&(r+=parseInt(n,10)*t[n]/e);return Math.round(r)},e.prototype.registerVideoVariant=function(e){var t=e.bitrate;t&&(this._bitrates[t]=this._bitrates[t]||0,this.startBitrate||(this.startBitrate=t)),e.audioProfile&&(this.audioCodec=e.audioProfile.audio_codec),e.videoProfile&&(this.videoCodec=e.videoProfile.video_codec,this.lastBitrate=e.videoProfile.video_bitrate,this.minResolution=e.videoProfile.video_resolution,this.maxResolution=e.videoProfile.video_resolution)},e.prototype.addStartSegment=function(){this._segments.push({type:"start",time:this.position}),this._needsEndSegment=!0},e.prototype.addEndSegment=function(){this._needsEndSegment&&(this._segments.push({type:"end",time:this.position}),this._needsEndSegment=!1)},e.prototype.addMSPlayed=function(e){if(e){if(e<0)throw new TypeError("Cannot add negative msPlayed value: "+e);this.msPlayed+=e/this.currentSpeed,this.msNominalPlayed+=e}},e.prototype.addSpeedChange=function(e){++this.nSpeedChanges,this.currentSpeed=e},e.prototype.trackBitrate=function(e,t){var r=e||"dummy";this._bitrates[r]=this._bitrates[r]||0,this._bitrates[r]+=t},e.prototype.trackBufferURL=function(e,t){var r=e.substring(0,5);"data:"!==r&&"blob:"!==r&&this._cdnURLTracker.track(e,t)},e.prototype.finalize=function(){if(this._isFinalized)throw new o.TrackingError(n.Errors.TRACK_DATA_ALREADY_FINALIZED,"TrackData already finalized.");this.msPlayedUnion=this._calculateUnion(),this.nSeeksBackward||this.nSeeksForward||this.nSpeedChanges||(this.msNominalPlayed=this.maxContinuous=this.msPlayedUnion,this.msPlayed=this.msNominalPlayed/this.currentSpeed,this.nSpeedChanges=0);var e=this.msPlayed;return this.timeWeightedBitrate=this._calculateWeightedBitrate(e),this.startBitrate||(this.startBitrate=this.bitrate),this.urls=this._cdnURLTracker.toJSON(),this._isFinalized=!0,!0},e.prototype.getURLsJSON=function(){var e,t;return null!==(t=null===(e=this._cdnURLTracker.toJSON().urls)||void 0===e?void 0:e.map((function(e){return e.url})))&&void 0!==t?t:[]},e.prototype.getPlaybackStats=function(){var e;switch(this.keySystem){case i.KeySystem.WIDEVINE:e="widevine";break;case i.KeySystem.PLAYREADY:case i.KeySystem.PLAYREADY_HARDWARE:e="playready";break;default:e="none"}return{ms_total_est:this.msActualDuration,ms_metadata_duration:this.msMetadataDuration,ms_manifest_latency:this.msManifestLatency||0,ms_latency:this.msPlayLatency||0,start_offset_ms:this.startPosition,ms_initial_buffering:this.msInitialRebuffering,ms_initial_rebuffer:this.msInitialRebuffering,ms_seek_rebuffering:this.msSeekRebuffering,ms_stalled:this.msStalled,max_ms_seek_rebuffering:this.maxMsSeekRebuffering,max_ms_stalled:this.maxMsStalled,n_stalls:this.nStalls,n_rendition_upgrade:this.nRenditionUpgrade,n_rendition_downgrade:this.nRenditionDowngrade,bps_bandwidth_max:this.bpsBandwidthMax,bps_bandwidth_min:this.bpsBandwidthMin,bps_bandwidth_avg:this.bpsBandwidthAvg,audiocodec:this.audioCodec?this.audioCodec.toLowerCase():void 0,videocodec:this.videoCodec?this.videoCodec.toLowerCase():void 0,start_bitrate:this.startBitrate||this.bitrate||void 0,full_screen:void 0,time_weighted_bitrate:this.timeWeightedBitrate,buffering_percentage:void 0,prefetched_bytes:void 0,prefetched_bytes_loaded:void 0,prefetched_initial_bitrate:void 0,key_system:e,ms_key_latency:this.msKeyLatency||0,total_bytes:this.totalBytes,local_time_ms:this.localTimeMs,ms_played_background:void 0,n_dropped_video_frames:this.droppedVideoFrames,n_total_video_frames:this.totalVideoFrames,resolution_max:this.maxResolution,resolution_min:this.minResolution,strategy:this.strategy}},e.prototype.isFinalized=function(){return this._isFinalized},e}();r.TrackingData=s},{"../enums/errors":80,"../enums/key_system":82,"../error/tracking":101,"./cdn_url_tracker":35}],76:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.VideoResolve=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("../enums/errors"),a=e("../enums/event"),s=e("../error/storage"),u=function(e){function t(t){var r=e.call(this)||this;return r._transport=t,r._parseManifestResponse=r._parseManifestResponse.bind(r),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._parseManifestResponse=function(e){var t,r=e.metadata.startTime;if(200!==e.status){var n=new s.StorageError(o.Errors.STORAGE_VIDEO_MANIFEST_FAILED,"Video manifest request failed with status "+e.status);return n.status=e.status,n.debug=e.body,this.emit(a.Event.VIDEO_MANIFEST_RESOLVE_FAILED,{url:e.url,error:n,start_time:r}),Promise.reject(n)}var i=e.body,u=null===(t=e.headers)||void 0===t?void 0:t.get("content-length");return this.emit(a.Event.VIDEO_MANIFEST_RESOLVED,{url:e.url,manifest_size:u?parseInt(u,10):JSON.stringify(i).length,start_time:r,end_time:Date.now()}),Promise.resolve(i)},t.prototype.getInitSegmentURLs=function(e,t,r,n){var i="";r&&(i=e+t.replace("{{profile_id}}",r.id.toString(10)).replace("{{file_type}}",r.file_type));var o="";return n&&(o=e+t.replace("{{profile_id}}",n.id.toString(10)).replace("{{file_type}}",n.file_type)),{audio:i,video:o,audioLogging:i,videoLogging:o}},t.prototype.getSegmentURLs=function(e,t,r,n,i){var o="";n&&(o=e+t.replace("{{profile_id}}",n.id.toString(10)).replace("{{file_type}}",n.file_type));var a="";return i&&(a=e+t.replace("{{profile_id}}",i.id.toString(10)).replace("{{file_type}}",i.file_type)),{audio:o.replace("{{segment_timestamp}}",r.toString()),video:a.replace("{{segment_timestamp}}",r.toString()),audioLogging:o,videoLogging:a}},t.prototype.getManifest=function(e,t){void 0===t&&(t=!1);var r=(t?"@webgate/manifests/v9/unauth/json/sources":"@webgate/manifests/v9/json/sources")+"/"+e+"/options/supports_drm";return this._transport.request(r,{authorize:!t,responseType:"json",parseResponseHeaders:!0,retry:{condition:function(e,t){var r=e.getStatusFamily();return 429===e.status||r===t.SERVER_ERROR||r===t.CONNECTION_ERROR}},metadata:{startTime:Date.now()}}).then(this._parseManifestResponse)},t}(i.EventEmitter);r.VideoResolve=u},{"../enums/errors":80,"../enums/event":81,"../error/storage":100,"@spotify-internal/emitter/es5":109,tslib:227}],77:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.AudioFileMimeType=void 0;var i=e("./audio_file_format");r.AudioFileMimeType=((n={})[i.AudioFileFormat.MP3_256]="audio/mp3",n[i.AudioFileFormat.MP3_320]="audio/mp3",n[i.AudioFileFormat.MP3_160]="audio/mp3",n[i.AudioFileFormat.MP3_96]="audio/mp3",n[i.AudioFileFormat.MP4_128]='audio/mp4; codecs="mp4a.40.2"',n[i.AudioFileFormat.MP4_256]='audio/mp4; codecs="mp4a.40.2"',n[i.AudioFileFormat.MP4_128_DUAL]='audio/mp4; codecs="mp4a.40.2"',n[i.AudioFileFormat.MP4_256_DUAL]='audio/mp4; codecs="mp4a.40.2"',n[i.AudioFileFormat.MP4_128_CBCS]='audio/mp4; codecs="mp4a.40.2"',n[i.AudioFileFormat.MP4_256_CBCS]='audio/mp4; codecs="mp4a.40.2"',n[i.AudioFileFormat.MP4_FLAC]='audio/mp4; codecs="flac"',n)},{"./audio_file_format":78}],78:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AudioFileFormat=void 0,function(e){e[e.MP3_256=3]="MP3_256",e[e.MP3_320=4]="MP3_320",e[e.MP3_160=5]="MP3_160",e[e.MP3_96=6]="MP3_96",e[e.MP4_128=10]="MP4_128",e[e.MP4_256=11]="MP4_256",e[e.MP4_128_DUAL=12]="MP4_128_DUAL",e[e.MP4_256_DUAL=13]="MP4_256_DUAL",e[e.MP4_128_CBCS=14]="MP4_128_CBCS",e[e.MP4_256_CBCS=15]="MP4_256_CBCS",e[e.MP4_FLAC=17]="MP4_FLAC"}(r.AudioFileFormat||(r.AudioFileFormat={}))},{}],79:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ContentMediatorEvent=void 0,function(e){e.FRAGMENT_FETCHED="fragment_fetched",e.FRAGMENT_FETCH_ERROR="fragment_fetch_error",e.VIDEO_PROFILE_CHANGED="video_profile"}(r.ContentMediatorEvent||(r.ContentMediatorEvent={}))},{}],80:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Errors=void 0,function(e){e.AD_MANIFEST_REQUEST_FAILED_WITH_STATUS="AD_MANIFEST_REQUEST_FAILED_WITH_STATUS",e.AD_MANIFEST_INVALID="AD_MANIFEST_INVALID",e.CAPPING_USER_IS_CAPPED="CAPPING_USER_IS_CAPPED",e.EME_API_NOT_SUPPORTED="EME_API_NOT_SUPPORTED",e.EME_MEDIA_KEYS_NOT_SUPPORTED="EME_MEDIA_KEYS_NOT_SUPPORTED",e.EME_MEDIA_KEY_SESSION_NOT_SUPPORTED="EME_MEDIA_KEY_SESSION_NOT_SUPPORTED",e.EME_NO_SUPPORTED_KEYSYSTEM="EME_NO_SUPPORTED_KEYSYSTEM",e.EME_PLAYER_MEDIA_KEYS_SETTING_FAILED="EME_PLAYER_MEDIA_KEYS_SETTING_FAILED",e.EME_ERROR_UNKNOWN="EME_ERROR_UNKNOWN",e.EME_LICENSE_REQUEST_EMPTY_RESPONSE="EME_LICENSE_REQUEST_EMPTY_RESPONSE",e.EME_LICENSE_REQUEST_FAILED_WITH_STATUS="EME_LICENSE_REQUEST_FAILED_WITH_STATUS",e.EME_LICENSE_REQUEST_WIDEVINE_ERROR="EME_LICENSE_REQUEST_WIDEVINE_ERROR",e.EME_LICENSE_UPDATE_FAILED="EME_LICENSE_UPDATE_FAILED",e.EME_HEADER_KEY_VALUE_MISMATCH="EME_HEADER_KEY_VALUE_MISMATCH",e.EME_HEADER_MISSING_CHALLENGE="EME_HEADER_MISSING_CHALLENGE",e.EME_INIT_DATA_MALFORMED="EME_INIT_DATA_MALFORMED",e.EME_CANNOT_SET_CERTIFICATE_FOR_PLATFORM="EME_CANNOT_SET_CERTIFICATE_FOR_PLATFORM",e.EME_MEDIA_KEY_SESSION_V0_1B_ERROR="EME_MEDIA_KEY_SESSION_V0_1B_ERROR",e.EME_MEDIA_KEY_SESSION_SAFARI_ERROR="EME_MEDIA_KEY_SESSION_SAFARI_ERROR",e.EME_NO_SUPPORTED_CONFIGURATION="EME_NO_SUPPORTED_CONFIGURATION",e.EME_NOT_SUPPORTED_ERROR="EME_NOT_SUPPORTED_ERROR",e.EME_INVALID_STATE_ERROR="EME_INVALID_STATE_ERROR",e.EME_UNKNOWN_ERROR="EME_UNKNOWN_ERROR",e.DISALLOW_PROTECTED_TRACK_ERROR="DISALLOW_PROTECTED_TRACK_ERROR",e.FILE_FORMAT_NOT_SUPPORTED="FILE_FORMAT_NOT_SUPPORTED",e.FILE_MALFORMED_SEEKTABLE="FILE_MALFORMED_SEEKTABLE",e.FILE_MALFORMED_PSSH="FILE_MALFORMED_PSSH",e.FILE_NOT_RESOLVED="FILE_NOT_RESOLVED",e.FRAGMENT_ONLINE_REQUEST_FAILED_WITH_ZERO="FRAGMENT_ONLINE_REQUEST_FAILED_WITH_ZERO",e.FRAGMENT_OFFLINE_REQUEST_FAILED_WITH_ZERO="FRAGMENT_OFFLINE_REQUEST_FAILED_WITH_ZERO",e.FRAGMENT_REQUEST_FAILED_WITH_ZERO="FRAGMENT_REQUEST_FAILED_WITH_ZERO",e.FRAGMENT_REQUEST_FAILED_WITH_STATUS="FRAGMENT_REQUEST_FAILED_WITH_STATUS",e.FRAGMENT_REQUEST_EMPTY_RESPONSE="FRAGMENT_REQUEST_EMPTY_RESPONSE",e.FRAGMENT_REQUEST_UNEXPECTED_LENGTH="FRAGMENT_REQUEST_UNEXPECTED_LENGTH",e.INVALID_TRACK="INVALID_TRACK",e.PLAYER_ATTEMPTED_VOLUME_OUT_OF_RANGE="PLAYER_ATTEMPTED_VOLUME_OUT_OF_RANGE",e.PLAYER_BUFFER_QUOTA_EXCEEDED="PLAYER_BUFFER_QUOTA_EXCEEDED",e.PLAYER_CANNOT_FIND_PLAYABLE_URI="PLAYER_CANNOT_FIND_PLAYABLE_URI",e.PLAYER_INVALID_INTERNAL_STATE="PLAYER_INVALID_INTERNAL_STATE",e.PLAYER_CONTAINER_ELEMENT_NOT_FOUND="PLAYER_CONTAINER_ELEMENT_NOT_FOUND",e.PLAYER_MEDIA_ERROR="PLAYER_MEDIA_ERROR",e.PLAYER_PLAYBACK_ERROR="PLAYER_PLAYBACK_ERROR",e.PLAYER_TIMEOUT_ERROR="PLAYER_TIMEOUT_ERROR",e.MEDIA_ABORTED="MEDIA_ABORTED",e.MEDIA_DECODING_ERROR="MEDIA_DECODING_ERROR",e.MEDIA_NETWORK_ERROR="MEDIA_NETWORK_ERROR",e.MEDIA_NOT_SUPPORTED="MEDIA_NOT_SUPPORTED",e.LICENSE_RESOLVE_INVALID_RESPONSE="LICENSE_RESOLVE_INVALID_RESPONSE",e.LICENSE_RESOLVER_CANT_RESOLVE_URL="LICENSE_RESOLVER_CANT_RESOLVE_URL",e.LICENSE_RESOLVER_DEPRECATED_VERSION="LICENSE_RESOLVER_DEPRECATED_VERSION",e.LIST_PLAYER_NO_TRACK_PLAYER="LIST_PLAYER_NO_TRACK_PLAYER",e.LIST_PLAYER_NO_LIST="LIST_PLAYER_NO_LIST",e.LIST_PLAYER_INVALID_ARGUMENT="LIST_PLAYER_INVALID_ARGUMENT",e.LIST_PLAYER_FORBIDDEN="LIST_PLAYER_FORBIDDEN",e.STORAGE_ERROR="STORAGE_ERROR",e.STORAGE_FAILED_WITH_STATUS="STORAGE_FAILED_WITH_STATUS",e.STORAGE_RETURNED_NO_TRACKS="STORAGE_RETURNED_NO_TRACKS",e.STORAGE_TRACK_MANIFEST_FAILED="STORAGE_TRACK_MANIFEST_FAILED",e.STORAGE_TRACK_MANIFEST_EMPTY="STORAGE_TRACK_MANIFEST_EMPTY",e.STORAGE_VIDEO_MANIFEST_FAILED="STORAGE_VIDEO_MANIFEST_FAILED",e.TRACK_DATA_ALREADY_FINALIZED="TRACK_DATA_ALREADY_FINALIZED",e.TSV_SENDING_FAILED="TSV_SENDING_FAILED",e.PLAYBACK_STATS_SENDING_FAILED="PLAYBACK_STATS_SENDING_FAILED",e.PLAYBACK_START_SENDING_FAILED="PLAYBACK_START_SENDING_FAILED",e.UNKNOWN="UNKNOWN"}(r.Errors||(r.Errors={}))},{}],81:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Event=void 0,function(e){e.KEY_SESSION_MESSAGE="message",e.KEY_SESSION_STATUSES_CHANGE="keystatuseschange",e.MEDIA_SOURCE_OPEN="sourceopen",e.MEDIA_SOURCE_CLOSE="sourceclose",e.SOURCE_BUFFER_UPDATE_END="updateend",e.MS_KEY_ADDED="mskeyadded",e.MS_KEY_ERROR="mskeyerror",e.MS_KEY_MESSAGE="mskeymessage",e.MS_NEEDKEY="msneedkey",e.WEBKIT_KEY_ADDED="webkitkeyadded",e.WEBKIT_KEY_ERROR="webkitkeyerror",e.WEBKIT_KEY_MESSAGE="webkitkeymessage",e.WEBKIT_NEEDKEY="webkitneedkey",e.V0_1B_KEY_ADDED="keyadded",e.V0_1B_KEY_ERROR="keyerror",e.V0_1B_KEY_MESSAGE="keymessage",e.V0_1B_NEEDKEY="needkey",e.MEDIA_CANPLAY="canplay",e.MEDIA_CANPLAYTHROUGH="canplaythrough",e.MEDIA_DURATIONCHANGE="durationchange",e.MEDIA_ENCRYPTED="encrypted",e.MEDIA_ENDED="ended",e.MEDIA_ERROR="error",e.MEDIA_LOADEDMETADATA="loadedmetadata",e.MEDIA_PAUSE="pause",e.MEDIA_PLAY="play",e.MEDIA_PLAYING="playing",e.MEDIA_SEEKING="seeking",e.MEDIA_TIMEUPDATE="timeupdate",e.MEDIA_WAITING="waiting",e.MEDIA_RATECHANGE="ratechange",e.MEDIA_RESIZE="resize",e.INTERNAL_ENCRYPTED="__encrypted",e.INTERNAL_PLAYER_CANPLAY="__canplay",e.INTERNAL_PLAYER_CANPLAYTHROUGH="__canplaythrough",e.INTERNAL_MEDIA_REQUIRES_DURATION="__requiresduration",e.INTERNAL_PLAYER_LOADED_METADATA="__loadedmetadata",e.BUFFER_APPEND_ERROR="append_error",e.BUFFER_STALLED="stalled",e.BUFFERING_START="buffering_start",e.BUFFERING_END="buffering_end",e.BUFFER_SOURCE_OPEN="source_open",e.BUFFER_SOURCE_CLOSE="source_close",e.BUFFER_UPDATE_END="update_end",e.BUFFER_QUOTA_EXCEEDED="quota_exceeded",e.EME_LICENSE_REQUEST_ERROR="license_request_error",e.EME_LICENSE_REQUEST_CAPPED="license_request_capped",e.LIST_PLAYER_AUTOPLAY_FAILED="player_autoplay_failed",e.LIST_PLAYER_BEFORE_LIST_CHANGE="before_list_change",e.LIST_PLAYER_BEFORE_NEXT="before_next",e.LIST_PLAYER_BEFORE_PLAYER_LOAD="before_player_load",e.LIST_PLAYER_BEFORE_PREVIOUS="before_previous",e.LIST_PLAYER_BEFORE_TRACK_LOAD="before_track_load",e.LIST_PLAYER_BEFORE_VOLUME_CHANGE="before_volume_change",e.LIST_PLAYER_BUFFER_STALLED="stalled",e.LIST_PLAYER_BUFFERING_START="buffering_start",e.LIST_PLAYER_BUFFERING_END="buffering_end",e.LIST_PLAYER_REBUFFERING_START="rebuffering_start",e.LIST_PLAYER_REBUFFERING_END="rebuffering_end",e.LIST_PLAYER_CAPPED="capped",e.LIST_PLAYER_CLEARED="cleared",e.LIST_PLAYER_DURATION_CHANGED="duration_changed",e.LIST_PLAYER_ERROR="error",e.LIST_PLAYER_ERROR_SYNC="error_sync",e.LIST_PLAYER_LIST_CHANGED="list_change",e.LIST_PLAYER_LIST_ENDED="list_ended",e.LIST_PLAYER_LOAD_VIDEO="load_video",e.LIST_PLAYER_MAX_LIST_ERRORS_REACHED="max_list_errors_reached",e.LIST_PLAYER_PAUSED="paused",e.LIST_PLAYER_PLAYED_THRESHOLD_REACHED="played_threshold_reached",e.LIST_PLAYER_PLAYER_LOAD="player_load",e.LIST_PLAYER_PLAYING="playing",e.LIST_PLAYER_POSITION_CHANGED="position_changed",e.LIST_PLAYER_PROGRESS="progress",e.LIST_PLAYER_REPEAT_MODE_CHANGED="repeat_mode_changed",e.LIST_PLAYER_SHUFFLE_CHANGED="shuffle_changed",e.LIST_PLAYER_STOPPED="stopped",e.LIST_PLAYER_STOPPED_VIDEO="stopped_video",e.LIST_PLAYER_TRACKING_DATA_CREATED="tracking_data_created",e.LIST_PLAYER_TRACKING_DATA_FINALIZED="tracking_data_finalized",e.LIST_PLAYER_TRACK_ENDED="track_ended",e.LIST_PLAYER_TRACK_LOADED="track_loaded",e.LIST_PLAYER_TRACK_TIMEOUT="track_timeout",e.LIST_PLAYER_TRACK_UNPLAYABLE="track_unplayable",e.LIST_PLAYER_DATA_CREATED="tracking_data_created",e.LIST_PLAYER_DATA_FINALIZED="tracking_data_finalized",e.LIST_PLAYER_VOLUME_CHANGED="volume_changed",e.LIST_PLAYER_VIDEO_ELEMENT_APPENDED="video_element_appended",e.LIST_PLAYER_VIDEO_ELEMENT_REMOVED="video_element_removed",e.LIST_PLAYER_VIDEO_PROFILE_CHANGED="video_profile_changed",e.LIST_PLAYER_SEEK_HANDLED="list_player_seek_handled",e.LIST_PLAYER_DISPLAYED_CUES_CHANGED="displayed_cues_changed",e.LIST_PLAYER_PLAYBACK_SPEED_CHANGED="playback_speed_changed",e.LIST_PLAYER_MUTED_CHANGED="muted_changed",e.LIST_PLAYER_SUBTITLE_LANGUAGES_LOADED="subtitle_languages_loaded",e.LIST_PLAYER_PLAYING_PROFILE_CHANGED="playing_profile_changed",e.LOGGER_ERROR="error",e.PLAYER_AUTOPLAY_FAILED="player_autoplay_failed",e.PLAYER_BEFORE_LOAD="before_load",e.PLAYER_BEFORE_STOP="before_stop",e.PLAYER_BEFORE_VOLUME_CHANGE="before_volume_change",e.PLAYER_BUFFER_STALLED="stalled",e.PLAYER_BUFFERING_START="buffering_start",e.PLAYER_BUFFERING_END="buffering_end",e.PLAYER_CAN_PRELOAD="can_preload",e.PLAYER_CAPPED="capped",e.PLAYER_DURATION_CHANGED="duration_changed",e.PLAYER_ENDED="ended",e.PLAYER_ENDED_VIDEO="ended_video",e.PLAYER_ERROR="error",e.PLAYER_WARNING="warning",e.PLAYER_LOG_CLIENT_EVENT="log_client_event",e.PLAYER_FIRST_BYTES="first_bytes",e.PLAYER_KEY_RECEIVED="key",e.PLAYER_LOAD="load",e.PLAYER_LOAD_VIDEO="load_video",e.PLAYER_LOADING_FAILED="loading_failed",e.PLAYER_MUTED_CHANGED="muted_changed",e.PLAYER_PAUSED="paused",e.PLAYER_PLAY="play",e.PLAYER_PLAYING="playing",e.PLAYER_POSITION_CHANGED="position_changed",e.PLAYER_PRELOADING_ERROR="preloading_error",e.PLAYER_PROGRESS="progress",e.PLAYER_REBUFFERING_START="rebuffering_start",e.PLAYER_REBUFFERING_END="rebuffering_end",e.PLAYER_STALLED="stalled",e.PLAYER_STOPPED="stopped",e.PLAYER_STOPPED_VIDEO="stopped_video",e.PLAYER_PLAYED_THRESHOLD_REACHED="played_threshold_reached",e.PLAYER_TIMEOUT="timeout",e.PLAYER_PLAYBACK_START="playback_start",e.PLAYER_TRACKING_DATA_CREATED="tracking_data_created",e.PLAYER_TRACKING_DATA_FINALIZED="tracking_data_finalized",e.PLAYER_VIDEO_ELEMENT_APPENDED="video_element_appended",e.PLAYER_VIDEO_ELEMENT_REMOVED="video_element_removed",e.PLAYER_VIDEO_PROFILE_CHANGED="video_profile_changed",e.PLAYER_DISPLAYED_CUES_CHANGED="displayed_cues_changed",e.PLAYER_SEEKING="seeking",e.PLAYER_FRAGMENT_FETCHED="fragment_fetched",e.PLAYER_FRAGMENT_FETCH_ERROR="fragment_fetch_error",e.PLAYER_VIDEO_MANIFEST_RESOLVED="video_manifest_resolved",e.PLAYER_VIDEO_MANIFEST_RESOLVE_FAILED="video_manifest_resolve_failed",e.PLAYER_PLAYBACK_SPEED_CHANGED="playback_speed_changed",e.PLAYER_SUBTITLE_LANGUAGES_LOADED="subtitle_languages_loaded",e.PLAYER_VIDEO_RESIZED="resize",e.PLAYER_PLAYING_PROFILE_CHANGED="playing_profile_changed",e.PLAYER_MANAGER_READY="ready",e.TRACKER_PLAYBACK_START="playback_start",e.TRACKER_PLAYED_THRESHOLD_REACHED="played_threshold_reached",e.TRACKER_TRACKING_DATA_CREATED="tracking_data_created",e.TRACKER_TRACKING_DATA_FINALIZED="tracking_data_finalized",e.TRACKER_FIRST_QUARTILE="tracking_first_quartile",e.TRACKER_MIDPOINT="tracking_midpoint",e.TRACKER_THIRD_QUARTILE="tracking_third_quartile",e.TRACKER_LOG_CLIENT_EVENT="tracker_log_client_event",e.VIDEO_MANIFEST_RESOLVED="video_manifest_resolved",e.VIDEO_MANIFEST_RESOLVE_FAILED="video_manifest_resolve_failed",e.ABR_MANAGER_BITRATE_CHANGE="bitrate_change",e.REPORTING_START="reporting_start",e.REPORTING_CREATIVE_VIEW="reporting_creative_view",e.REPORTING_FIRST_QUARTILE="reporting_first_quartile",e.REPORTING_MIDPOINT="reporting_midpoint",e.REPORTING_THIRD_QUARTILE="reporting_third_quartile",e.REPORTING_COMPLETE="reporting_complete",e.REPORTING_PAUSE="reporting_pause",e.REPORTING_RESUME="reporting_resume",e.REPORTING_ERROR="reporting_error"}(r.Event||(r.Event={}))},{}],82:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.KeySystem=void 0,function(e){e.WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready",e.PLAYREADY_HARDWARE="com.microsoft.playready.hardware",e.FAIRPLAY="com.apple.fps.1_0",e.INVALID_SPOTIFY_KEY="com.spotify.invalid"}(r.KeySystem||(r.KeySystem={}))},{}],83:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ListConstants=void 0,function(e){e.NULL_VALUE="NULL_VALUE",e.LIST_START="LIST_START",e.LIST_END="LIST_END",e.FORBIDDEN="FORBIDDEN",e.IGNORE="IGNORE",e.PAUSE="PAUSE"}(r.ListConstants||(r.ListConstants={}))},{}],84:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MediaFormat=void 0,function(e){e.MP3="MP3",e.MP4="MP4",e.MP4_DUAL="MP4_DUAL",e.MP4_CBCS="MP4_CBCS",e.MP4_FLAC="MP4_FLAC",e.MANIFEST_ID="MANIFEST_ID",e.AD_MANIFEST="AD_MANIFEST",e.GENERIC_MEDIA="GENERIC_MEDIA"}(r.MediaFormat||(r.MediaFormat={}))},{}],85:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MediaCodec=void 0,function(e){e.AAC_LC="mp4a.40.2",e.AAC_HE="mp4a.40.5",e.FLAC="flac",e.OPUS="opus",e.VP9="vp9",e.VP8="vp8",e.H264_31="avc1.4d401f"}(r.MediaCodec||(r.MediaCodec={}))},{}],86:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.OperationResult=void 0,function(e){e.SUCCESS="RESULT_SUCCESS",e.INVALID="RESULT_INVALID",e.FORBIDDEN="RESULT_FORBIDDEN",e.OUT_OF_BOUNDS="RESULT_OUT_OF_BOUNDS",e.NO_LIST="RESULT_NO_LIST",e.NO_TRACK="RESULT_NO_TRACK",e.LIST_END="RESULT_LIST_END",e.INVALID_TRACK="RESULT_INVALID_TRACK",e.CANCELLED="CANCELLED",e.NO_TRACK_PLAYER="NO_TRACK_PLAYER"}(r.OperationResult||(r.OperationResult={}))},{}],87:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PlaybackQuality=void 0,function(e){e.UNKNOWN="UNKNOWN",e.DEFAULT="DEFAULT",e.LOW="LOW",e.NORMAL="NORMAL",e.HIGH="HIGH",e.VERY_HIGH="VERY_HIGH",e.HIFI="HIFI"}(r.PlaybackQuality||(r.PlaybackQuality={}))},{}],88:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Reason=void 0,function(e){e.APPLOAD="appload",e.BACK_BUTTON="backbtn",e.CAPPED="capped",e.CLICK_ROW="clickrow",e.CLICK_SIDE="clickside",e.END_PLAY="endplay",e.FORWARD_BUTTON="fwdbtn",e.LOGOUT="logout",e.PLAY_BUTTON="playbtn",e.POPUP="popup",e.REMOTE="remote",e.SEEK="seek",e.TRACK_DONE="trackdone",e.TRACK_ERROR="trackerror",e.UNEXPECTED_EXIT="unexpected-exit",e.UNEXPECTED_EXIT_WHILE_PAUSE="unexpected-exit-while-pause",e.UNKNOWN="unknown",e.URI_OPEN="uriopen"}(r.Reason||(r.Reason={}))},{}],89:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RepeatMode=void 0,function(e){e.NONE="NONE",e.CONTEXT="CONTEXT",e.TRACK="TRACK"}(r.RepeatMode||(r.RepeatMode={}))},{}],90:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Robustness=void 0,function(e){e.EMPTY="EMPTY",e.SW_CRYPTO="SW_CRYPTO",e.SW_DECODE="SW_DECODE",e.HW_CRYPTO="HW_CRYPTO",e.HW_DECODE="HW_DECODE",e.HW_ALL="HW_ALL"}(r.Robustness||(r.Robustness={}))},{}],91:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SubtitleMode=void 0,function(e){e.SHOWING="showing",e.HIDDEN="hidden",e.DISABLED="disabled"}(r.SubtitleMode||(r.SubtitleMode={}))},{}],92:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AdManifestError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this)||this;return n.status=-1,n.debug={},n.canPlayNext=!0,n.unrecoverable=!1,n.name="AdManifestError",n.code=t,n.message=r,n}return n.__extends(t,e),t.fatal=function(e,r){var n=new t(e,r);return n.unrecoverable=!1,n.canPlayNext=!0,n},t}(Error);r.AdManifestError=i},{tslib:227}],93:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CappingError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.name="CappingError",n.message=r,n.code=t,n}return n.__extends(t,e),t}(Error);r.CappingError=i},{tslib:227}],94:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.EMEError=void 0;var n=e("tslib"),i=e("../enums/errors"),o=function(e){function t(t,r){void 0===t&&(t=i.Errors.EME_ERROR_UNKNOWN);var n=e.call(this,r)||this;return n.status=-1,n.licenseServer="",n.shouldRefreshEndpoint=!1,n.unrecoverable=!1,n.debug={},n.code=t,n.message=r,n.name="EMEError",n}return n.__extends(t,e),t.fatal=function(e,r){void 0===e&&(e=i.Errors.EME_ERROR_UNKNOWN);var n=new t(e,r);return n.unrecoverable=!0,n},t}(Error);r.EMEError=o},{"../enums/errors":80,tslib:227}],95:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FileError=void 0;var n=e("tslib"),i=e("../enums/errors"),o=function(e){function t(t,r){void 0===t&&(t=i.Errors.STORAGE_ERROR),void 0===r&&(r="File Error");var n=e.call(this,r)||this;return n.canPlayNext=!0,n.debug={},n.code=t,n.message=r,n.name="FileError",n}return n.__extends(t,e),t}(Error);r.FileError=o},{"../enums/errors":80,tslib:227}],96:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FragmentError=void 0;var n=e("tslib"),i=function(e){function t(t,r,n,i){void 0===i&&(i={});var o=e.call(this,r)||this;return o.code=t,o.message=r,o.status=n,o.debug=i,o.name="FragmentError",o}return n.__extends(t,e),t}(Error);r.FragmentError=i},{tslib:227}],97:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LicenseError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this)||this;return n.status=-1,n.debug={},n.canPlayNext=!0,n.unrecoverable=!1,n.name="LicenseError",n.code=t,n.message=r,n}return n.__extends(t,e),t.fatal=function(e,r){var n=new t(e,r);return n.unrecoverable=!0,n.canPlayNext=!1,n},t}(Error);r.LicenseError=i},{tslib:227}],98:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LoggingError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.debug={},n.name="LoggingError",n.message=r,n.code=t,n}return n.__extends(t,e),t}(Error);r.LoggingError=i},{tslib:227}],99:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PlaybackError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this)||this;return n.unrecoverable=!1,n.listPlayerIgnore=!1,n.debug={},n.name="PlaybackError",n.code=t,n.message=r,n}return n.__extends(t,e),t.fatal=function(e,r){var n=new t(e,r);return n.unrecoverable=!0,n},t}(Error);r.PlaybackError=i},{tslib:227}],100:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StorageError=void 0;var n=e("tslib"),i=e("../enums/errors"),o=function(e){function t(t,r){void 0===t&&(t=i.Errors.STORAGE_ERROR),void 0===r&&(r="Storage Error");var n=e.call(this,r)||this;return n.status=-1,n.fileId="",n.debug={},n.canPlayNext=!0,n.code=t,n.message=r,n.name="StorageError",n}return n.__extends(t,e),t}(Error);r.StorageError=o},{"../enums/errors":80,tslib:227}],101:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TrackingError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.debug={},n.name="TrackingError",n.message=r,n.code=t,n}return n.__extends(t,e),t}(Error);r.TrackingError=i},{tslib:227}],102:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createPlayer=r.ListPlayer=r.Robustness=r.RepeatMode=r.PlaybackQuality=r.Reason=r.OperationResult=r.MediaFormat=r.MediaCodec=r.ListConstants=r.KeySystem=r.PlaybackEvent=r.Errors=r.AudioFileFormat=void 0;var n=e("tslib"),i=e("@js-sdk/mux-embed-ts/dist/mux"),o=e("@js-sdk/common/es5/debug_tools"),a=e("./_internal/player"),s=e("./_internal/logging/logger"),u=e("./_internal/storage_resolve"),l=e("./_internal/tracker"),c=e("./_internal/video_resolve"),d=e("./_internal/license_url_resolver"),_=e("./_internal/logging/log_sender"),p=e("./_internal/mux_reporter"),f=e("./_internal/bandwidth_estimator"),h=e("./_internal/initial_bandwidth_sampler"),v=e("./enums/audio_file_format");Object.defineProperty(r,"AudioFileFormat",{enumerable:!0,get:function(){return v.AudioFileFormat}});var y=e("./enums/errors");Object.defineProperty(r,"Errors",{enumerable:!0,get:function(){return y.Errors}});var m=e("./enums/event");Object.defineProperty(r,"PlaybackEvent",{enumerable:!0,get:function(){return m.Event}});var E=e("./enums/key_system");Object.defineProperty(r,"KeySystem",{enumerable:!0,get:function(){return E.KeySystem}});var g=e("./enums/list_constants");Object.defineProperty(r,"ListConstants",{enumerable:!0,get:function(){return g.ListConstants}});var R=e("./enums/media_types");Object.defineProperty(r,"MediaCodec",{enumerable:!0,get:function(){return R.MediaCodec}});var T=e("./enums/media_format");Object.defineProperty(r,"MediaFormat",{enumerable:!0,get:function(){return T.MediaFormat}});var I=e("./enums/operation_result");Object.defineProperty(r,"OperationResult",{enumerable:!0,get:function(){return I.OperationResult}});var S=e("./enums/reason");Object.defineProperty(r,"Reason",{enumerable:!0,get:function(){return S.Reason}});var P=e("./enums/playback_quality");Object.defineProperty(r,"PlaybackQuality",{enumerable:!0,get:function(){return P.PlaybackQuality}});var b=e("./enums/repeat_mode");Object.defineProperty(r,"RepeatMode",{enumerable:!0,get:function(){return b.RepeatMode}});var A=e("./enums/robustness");Object.defineProperty(r,"Robustness",{enumerable:!0,get:function(){return A.Robustness}});var L=e("./listplayer");Object.defineProperty(r,"ListPlayer",{enumerable:!0,get:function(){return L.ListPlayer}});var C=o.logging.forTag("playback.init");r.createPlayer=function(e){return new Promise((function(t,r){var o,v,y,m,E,g,R,T,I,S,P;if(e.transport){if("undefined"!=typeof window)("boolean"==typeof window.isSecureContext?window.isSecureContext:function(){if("undefined"==typeof window||!window.location)return!1;var e=window.location;if("https"===e.protocol||"file"===e.protocol)return!0;var t=e.hostname;return!!/^127(\.[0-255]){3}$|^locahost\.?$|\.localhost\.?$/.test(t)}())||null===(o=window.console)||void 0===o||o.warn("%cDRM might not be available from unsecure contexts","background: #222; color: #bada55; font-size: 40px");if(!e.playerContainerManager||"function"==typeof(null===(v=e.playerContainerManager)||void 0===v?void 0:v.eject)&&"function"==typeof(null===(y=e.playerContainerManager)||void 0===y?void 0:y.inject)){var b=e.transport,A=(e.sdkId||"").split(":"),L=A[0],O=void 0===L?"":L,N=A[1],D=void 0===N?"":N,M=new f.BandwidthEstimator,k=n.__assign(n.__assign({},e),{abrManager:M,initialBandwidthSampler:h.createInitialBandwidthSampler(b,M),tracker:l.Tracker.create(),audioResolver:new u.StorageResolve(b),videoResolver:new c.VideoResolve(b),licenseURLResolver:new d.LicenseURLResolver({transport:b,sdk:{name:O,version:D},securityLevel:e.securityLevel,useTestLicenseServer:e.useTestLicenseServer}),newBufferPerTrack:null===(m=e.newBufferPerTrack)||void 0===m||m,preinitMediaElement:null===(E=e.preinitMediaElement)||void 0===E||E,audioProcessorOptions:n.__assign(n.__assign({},e.audioProcessorOptions),{disable:null!==(R=null===(g=e.audioProcessorOptions)||void 0===g?void 0:g.disable)&&void 0!==R?R:!!e.createPlayer})});e.unauthenticatedLogs&&!(null===(T=e.loggerOptions)||void 0===T?void 0:T.endpoint)&&(e.loggerOptions=n.__assign(n.__assign({},e.loggerOptions),{endpoint:"https://spclient.wg.spotify.com/melody/unauth"})),(null===(I=null==e?void 0:e.loggerOptions)||void 0===I?void 0:I.deviceInfo)||Promise.all([null===(S=e.loggerOptions)||void 0===S?void 0:S.platform,null===(P=e.loggerOptions)||void 0===P?void 0:P.clientVersion]).then((function(t){var r=t[0],i=t[1];e.loggerOptions=n.__assign(n.__assign({},e.loggerOptions),{deviceInfo:{platform:r,version:i}})})),a.Player.create(k).then((function(t){var r=n.__assign({disableMux:!0},e.loggerOptions),o=_.createLogSender(n.__assign(n.__assign({},r),{transport:b,sdkId:e.sdkId,platform:Promise.resolve(r.deviceInfo).then((function(e){var t;return null!==(t=null==e?void 0:e.platform)&&void 0!==t?t:""})),clientVersion:Promise.resolve(r.deviceInfo).then((function(e){var t;return null!==(t=null==e?void 0:e.version)&&void 0!==t?t:""}))})),a=s.Logger.create({transport:b,player:t,logSender:o});return r.disableMux||p.MuxReporter.create({player:t,mux:i,envKey:null==r?void 0:r.muxEnvKey,sdk:O,sdkVersion:D,deviceInfo:r.deviceInfo,muxCustomDimensions:r.muxCustomDimensions}).ready().then((function(){return C.info("MuxReporter ready")}),(function(e){return C.error("Failed to instantiate MuxReporter",null==e?void 0:e.message)})),{player:t,logger:a}})).then(t,r)}else r(new TypeError("Both inject and eject PlayerContainerManager functions must be present."))}else r(new TypeError("Argument transport is required."))}))}},{"./_internal/bandwidth_estimator":32,"./_internal/initial_bandwidth_sampler":63,"./_internal/license_url_resolver":64,"./_internal/logging/log_sender":65,"./_internal/logging/logger":66,"./_internal/mux_reporter":69,"./_internal/player":70,"./_internal/storage_resolve":72,"./_internal/tracker":74,"./_internal/video_resolve":76,"./enums/audio_file_format":78,"./enums/errors":80,"./enums/event":81,"./enums/key_system":82,"./enums/list_constants":83,"./enums/media_format":84,"./enums/media_types":85,"./enums/operation_result":86,"./enums/playback_quality":87,"./enums/reason":88,"./enums/repeat_mode":89,"./enums/robustness":90,"./listplayer":103,"@js-sdk/common/es5/debug_tools":9,"@js-sdk/mux-embed-ts/dist/mux":30,tslib:227}],103:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ListPlayer=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@js-sdk/common/es5/promise_resolver"),a=e("./enums/errors"),s=e("./enums/operation_result"),u=e("./enums/repeat_mode"),l=e("./enums/list_constants"),c=e("./enums/reason"),d=e("./enums/event"),_=e("./error/playback");function p(e){return"uri"in e}var f=function(e){function t(t){var r=e.call(this)||this;if(r._trackPlayerPromise=o.createPromiseResolver(),r._maxListErrors=5,r._uid=0,r._loadedList=null,r._loadedOptions=null,r._currentTrack=null,r._currentTrackOptions=null,r._listPlayCount=0,r._listErrorCount=0,r._shuffled=!1,r._repeatMode=u.RepeatMode.NONE,r._currentSeqId=0,!t.trackPlayer)throw new TypeError("Argument `options.trackPlayer` not found.");return t.maxListErrors&&(r._maxListErrors=t.maxListErrors),r._setListOptions=r._setListOptions.bind(r),r._replaceCurrentList=r._replaceCurrentList.bind(r),r._handleCapped=r._handleCapped.bind(r),r._handlePlaying=r._handlePlaying.bind(r),r._handlePaused=r._handlePaused.bind(r),r._handleEnded=r._handleEnded.bind(r),r._handleCanPreload=r._handleCanPreload.bind(r),r._handleError=r._handleError.bind(r),r._handlePositionChanged=r._handlePositionChanged.bind(r),r._handleDurationChanged=r._handleDurationChanged.bind(r),r._handleTimeout=r._handleTimeout.bind(r),r._handlePlayerInitError=r._handlePlayerInitError.bind(r),r._handleProgress=r._handleProgress.bind(r),r._handlePlayedThresholdReached=r._handlePlayedThresholdReached.bind(r),r._handleBeforeLoad=r._handleBeforeLoad.bind(r),r._init(t.trackPlayer),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._init=function(e){var t=this;this._trackPlayerPromise.promise.catch((function(){})),Promise.resolve(e).then((function(e){t._attachPlayerEvents(e),t._trackPlayerPromise.resolve(e)})).catch(this._handlePlayerInitError)},t.prototype._attachPlayerEvents=function(e){var t,r,n;e.addListeners(((t={})[d.Event.PLAYER_CAN_PRELOAD]=this._handleCanPreload,t[d.Event.PLAYER_CAPPED]=this._handleCapped,t[d.Event.PLAYER_ENDED]=this._handleEnded,t[d.Event.PLAYER_ERROR]=this._handleError,t[d.Event.PLAYER_PAUSED]=this._handlePaused,t[d.Event.PLAYER_PLAYING]=this._handlePlaying,t[d.Event.PLAYER_TIMEOUT]=this._handleTimeout,t[d.Event.PLAYER_POSITION_CHANGED]=this._handlePositionChanged,t[d.Event.PLAYER_DURATION_CHANGED]=this._handleDurationChanged,t[d.Event.PLAYER_PROGRESS]=this._handleProgress,t[d.Event.PLAYER_BEFORE_LOAD]=this._handleBeforeLoad,t[d.Event.PLAYER_PLAYED_THRESHOLD_REACHED]=this._handlePlayedThresholdReached,t)),this.proxyEmitAllSync(e,((r={})[d.Event.PLAYER_BEFORE_VOLUME_CHANGE]=d.Event.LIST_PLAYER_BEFORE_VOLUME_CHANGE,r[d.Event.PLAYER_LOAD]=d.Event.LIST_PLAYER_PLAYER_LOAD,r[d.Event.REPORTING_START]=d.Event.REPORTING_START,r[d.Event.REPORTING_CREATIVE_VIEW]=d.Event.REPORTING_CREATIVE_VIEW,r[d.Event.REPORTING_FIRST_QUARTILE]=d.Event.REPORTING_FIRST_QUARTILE,r[d.Event.REPORTING_MIDPOINT]=d.Event.REPORTING_MIDPOINT,r[d.Event.REPORTING_THIRD_QUARTILE]=d.Event.REPORTING_THIRD_QUARTILE,r[d.Event.REPORTING_COMPLETE]=d.Event.REPORTING_COMPLETE,r[d.Event.REPORTING_PAUSE]=d.Event.REPORTING_PAUSE,r[d.Event.REPORTING_RESUME]=d.Event.REPORTING_RESUME,r[d.Event.REPORTING_ERROR]=d.Event.REPORTING_ERROR,r)),this.proxyEmitAll(e,((n={})[d.Event.PLAYER_AUTOPLAY_FAILED]=d.Event.LIST_PLAYER_AUTOPLAY_FAILED,n[d.Event.PLAYER_TRACKING_DATA_CREATED]=d.Event.LIST_PLAYER_TRACKING_DATA_CREATED,n[d.Event.PLAYER_TRACKING_DATA_FINALIZED]=d.Event.LIST_PLAYER_TRACKING_DATA_FINALIZED,n[d.Event.PLAYER_BUFFER_STALLED]=d.Event.LIST_PLAYER_BUFFER_STALLED,n[d.Event.PLAYER_BUFFERING_START]=d.Event.LIST_PLAYER_BUFFERING_START,n[d.Event.PLAYER_BUFFERING_END]=d.Event.LIST_PLAYER_BUFFERING_END,n[d.Event.PLAYER_REBUFFERING_START]=d.Event.LIST_PLAYER_REBUFFERING_START,n[d.Event.PLAYER_REBUFFERING_END]=d.Event.LIST_PLAYER_REBUFFERING_END,n[d.Event.PLAYER_VIDEO_ELEMENT_APPENDED]=d.Event.LIST_PLAYER_VIDEO_ELEMENT_APPENDED,n[d.Event.PLAYER_VIDEO_ELEMENT_REMOVED]=d.Event.LIST_PLAYER_VIDEO_ELEMENT_REMOVED,n[d.Event.PLAYER_DISPLAYED_CUES_CHANGED]=d.Event.LIST_PLAYER_DISPLAYED_CUES_CHANGED,n[d.Event.LIST_PLAYER_VIDEO_PROFILE_CHANGED]=d.Event.PLAYER_VIDEO_PROFILE_CHANGED,n[d.Event.LIST_PLAYER_PLAYBACK_SPEED_CHANGED]=d.Event.PLAYER_PLAYBACK_SPEED_CHANGED,n[d.Event.LIST_PLAYER_MUTED_CHANGED]=d.Event.PLAYER_MUTED_CHANGED,n[d.Event.LIST_PLAYER_SUBTITLE_LANGUAGES_LOADED]=d.Event.PLAYER_SUBTITLE_LANGUAGES_LOADED,n[d.Event.PLAYER_PLAYING_PROFILE_CHANGED]=d.Event.LIST_PLAYER_PLAYING_PROFILE_CHANGED,n))},t.prototype._translatePosition=function(e){var t,r,n;return null!==(n=null===(r=null===(t=this._loadedList)||void 0===t?void 0:t.translatePosition)||void 0===r?void 0:r.call(t,e))&&void 0!==n?n:e},t.prototype._translateDuration=function(e){var t,r,n,i=isNaN(e)?0:e;return null!==(n=null===(r=null===(t=this._loadedList)||void 0===t?void 0:t.translateDuration)||void 0===r?void 0:r.call(t,i))&&void 0!==n?n:i},t.prototype._handleProgress=function(e){var t=e.data;this.emit(d.Event.LIST_PLAYER_PROGRESS,n.__assign(n.__assign({},t),{position:this._translatePosition(t.position)}))},t.prototype._handleBeforeLoad=function(e){var t=e.data;this.emit(d.Event.LIST_PLAYER_BEFORE_PLAYER_LOAD,n.__assign(n.__assign({},t),{options:n.__assign(n.__assign({},t.options),{position:this._translatePosition(t.options.position)})}))},t.prototype._handlePlayerInitError=function(e){this._trackPlayerPromise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_NO_TRACK_PLAYER,e.message||"Track player promise was rejected."))},t.prototype._handleCapped=function(){var e=this._currentTrack;e&&this.emit(d.Event.LIST_PLAYER_CAPPED,{uid:this._uid,track:e,options:this._currentTrackOptions,list:this._loadedList})},t.prototype._handlePlaying=function(e){var t=this._currentTrack;t&&this.emit(d.Event.LIST_PLAYER_PLAYING,{uid:this._uid,track:t,options:this._currentTrackOptions,list:this._loadedList,position:this._translatePosition(e.data.position)})},t.prototype._handlePaused=function(e){var t=this._currentTrack;t&&this.emit(d.Event.LIST_PLAYER_PAUSED,{uid:this._uid,track:t,options:this._currentTrackOptions,list:this._loadedList,position:this._translatePosition(e.data.position)})},t.prototype._handleCanPreload=function(){this._preloadUpcomingTrack().catch((function(){}))},t.prototype._handleEnded=function(){var e=this._currentTrack;e&&(this.emit(d.Event.LIST_PLAYER_TRACK_ENDED,{uid:this._uid,track:e,options:this._currentTrackOptions,list:this._loadedList}),this.next(c.Reason.TRACK_DONE))},t.prototype._handleTimeout=function(){var e=this._currentTrack;e&&(this.emit(d.Event.LIST_PLAYER_TRACK_TIMEOUT,{uid:this._uid,track:e,options:this._currentTrackOptions,list:this._loadedList}),this.next(c.Reason.TRACK_ERROR))},t.prototype._handlePositionChanged=function(e){var t=this._currentTrack;t&&this.emit(d.Event.LIST_PLAYER_POSITION_CHANGED,{uid:this._uid,track:t,options:this._currentTrackOptions,list:this._loadedList,position:this._translatePosition(e.data.position)})},t.prototype._handleDurationChanged=function(e){var t=this._currentTrack;t&&this.emit(d.Event.LIST_PLAYER_DURATION_CHANGED,{uid:this._uid,track:t,options:this._currentTrackOptions,list:this._loadedList,position:this._translatePosition(e.data.position),duration:this._translateDuration(e.data.duration)})},t.prototype._handlePlayedThresholdReached=function(e){var t=this._currentTrack;t&&this.emit(d.Event.LIST_PLAYER_PLAYED_THRESHOLD_REACHED,{uid:this._uid,track:t,options:this._currentTrackOptions,list:this._loadedList,threshold:e.data.threshold,position:this._translatePosition(e.data.position)})},t.prototype._handleError=function(e){var t=this._currentTrack,r=e.data;if(t){r.position=this._translatePosition(e.data.position),this.emit(d.Event.LIST_PLAYER_ERROR,r),this.emitSync(d.Event.LIST_PLAYER_ERROR_SYNC,r);var n=!!r.error&&r.error.listPlayerIgnore;n||this._listErrorCount++,r.canPlayNext&&(n||this._listErrorCount<=this._maxListErrors?this.next(c.Reason.TRACK_ERROR):this.emit(d.Event.LIST_PLAYER_MAX_LIST_ERRORS_REACHED,{count:this._listErrorCount,threshold:this._maxListErrors}))}},t.prototype._handleTrackLoaded=function(e){this.emitSync(d.Event.LIST_PLAYER_TRACK_LOADED,e)},t.prototype._incrementSeqId=function(){return this._currentSeqId>=9007199254740991?this._currentSeqId=0:this._currentSeqId+=1,this._currentSeqId},t.prototype._getTrackPlayer=function(){return this._trackPlayerPromise.promise},t.prototype._setListIndex=function(e,t){var r=t.index&&-1!==t.index?t.index:0;return Promise.all([e,t,e.startAt(r)])},t.prototype._setListOptions=function(e){var t=e[0],r=e[1];e[2];return Promise.all([t.setShuffle(!!this._shuffled),t.setRepeatMode(this._repeatMode)]).then((function(){return[t,r]}))},t.prototype._replaceCurrentList=function(e){var t=e[0],r=e[1];return this.emitSync(d.Event.LIST_PLAYER_BEFORE_LIST_CHANGE,{newList:t,newOptions:r,oldList:this._loadedList,oldOptions:this._loadedOptions}),this._loadedList=t,this._loadedOptions=r,this._listPlayCount=0,this._listErrorCount=0,this.emit(d.Event.LIST_PLAYER_LIST_CHANGED,{list:t,options:r}),s.OperationResult.SUCCESS},t.prototype._changeTrack=function(e,t,r){var n=this;if(this._currentSeqId!==r)return Promise.resolve(s.OperationResult.CANCELLED);this.emitSync(d.Event.LIST_PLAYER_BEFORE_TRACK_LOAD,{list:this._loadedList,newTrack:e,oldTrack:this._currentTrack}),this._uid++;var i=++this._listPlayCount,o=this._loadedOptions,a=!0,u=0,l=3e4,_=!1,p=!1,f=void 0;o&&(1===i?(a=!o.paused,u=o.initialPosition||o.position||0):u=o.position||0,_=o.muted||!1,p=o.loop||!1);var h=t===c.Reason.TRACK_DONE;if(e.options){var v=e.options;void 0!==v.paused&&(a=!v.paused),void 0!==v.position&&(u=v.position),void 0!==v.playedThreshold&&(l=v.playedThreshold),void 0!==v.loadingTimeout&&(f=v.loadingTimeout),void 0!==v.muted&&(_=v.muted),void 0!==v.loop&&(p=v.loop)}this._currentTrack=e,this._currentTrackOptions={reason:t,paused:!a,position:u,playedThreshold:l,muted:_,loop:p};var y=this._handleTrackLoaded.bind(this,{uid:this._uid,track:this._currentTrack,options:this._currentTrackOptions,list:this._loadedList});return this._getTrackPlayer().then((function(t){return n._currentSeqId!==r?s.OperationResult.CANCELLED:(Promise.resolve(t.load(e,{uriProperty:"playableURI",autoplay:a,position:u,playedThreshold:l,continuePrevious:h,loadingTimeout:f,muted:_,loop:p},y)).catch((function(){})),s.OperationResult.SUCCESS)}))},t.prototype._preloadUpcomingTrack=function(){var e=this,t=this._loadedList;return t?t.peekNext({reason:c.Reason.TRACK_DONE,listConstants:l.ListConstants}).then((function(t){return t===l.ListConstants.FORBIDDEN?s.OperationResult.FORBIDDEN:t===l.ListConstants.NULL_VALUE?s.OperationResult.INVALID:t===l.ListConstants.LIST_END?s.OperationResult.LIST_END:p(t)&&t.playable?e.preloadTrack(t):s.OperationResult.INVALID})):Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_NO_LIST,"Cannot perform operation; no list was loaded."))},t.prototype.preloadTrack=function(e){return this._getTrackPlayer().then((function(t){return t.preload(e).catch((function(){})),s.OperationResult.SUCCESS}))},t.prototype.activateElement=function(){return this._getTrackPlayer().then((function(e){return e.activateElement(),s.OperationResult.SUCCESS}))},t.prototype.load=function(e,t){var r=function(e){void 0===e&&(e={});var t={index:-1,position:0,initialPosition:0,playbackSpeed:1,duration:-1,paused:!1,reason:c.Reason.UNKNOWN,muted:!1,loop:!1};return void 0!==e.index&&(t.index=e.index),void 0!==e.position&&(t.position=e.position),void 0!==e.initialPosition&&(t.initialPosition=e.initialPosition),void 0!==e.duration&&(t.duration=e.duration),void 0!==e.paused&&(t.paused=e.paused),void 0!==e.playbackSpeed&&(t.playbackSpeed=e.playbackSpeed),void 0!==e.reason&&(t.reason=e.reason),void 0!==e.muted&&(t.muted=e.muted),void 0!==e.loop&&(t.loop=e.loop),t}(t||this._loadedOptions||{});return this._setListIndex(e,r).then(this._setListOptions).then(this._replaceCurrentList)},t.prototype.play=function(e,t){var r=this;return this.load(e,t).then((function(){if(r._loadedList!==e)return s.OperationResult.CANCELLED;var t=r._loadedOptions?r._loadedOptions.reason:c.Reason.UNKNOWN;return r.next(t)}))},t.prototype.canChangeTrack=function(){return this._loadedList?this._loadedList.peekNext({reason:c.Reason.FORWARD_BUTTON,listConstants:l.ListConstants}).then((function(e){return e!==l.ListConstants.FORBIDDEN})):Promise.resolve(!0)},t.prototype.next=function(e){var t=this;if(!e)return Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_INVALID_ARGUMENT,"The argument `reason` is required."));var r=this._loadedList;if(!r)return Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_NO_LIST,"Cannot perform operation; no list was loaded."));this.emitSync(d.Event.LIST_PLAYER_BEFORE_NEXT,{list:r,reason:e});var n=this._incrementSeqId(),i={reason:e,listConstants:l.ListConstants};return r.next(i).then((function(i){return t._currentSeqId!==n?s.OperationResult.CANCELLED:i===l.ListConstants.FORBIDDEN?s.OperationResult.FORBIDDEN:i===l.ListConstants.NULL_VALUE?t.next(e):i===l.ListConstants.LIST_END?(t.emit(d.Event.LIST_PLAYER_LIST_ENDED,{list:r,reason:c.Reason.END_PLAY}),t.clear(e),s.OperationResult.LIST_END):p(i)?i.playable?t._changeTrack(i,e,n):(t.emit(d.Event.LIST_PLAYER_TRACK_UNPLAYABLE,{track:i,list:r}),t.next(e)):s.OperationResult.INVALID}))},t.prototype.previous=function(e){var t=this;if(!e)return Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_INVALID_ARGUMENT,"The argument `reason` is required."));var r=this._loadedList;if(!r)return Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_NO_LIST,"Cannot perform operation; no list was loaded."));this.emitSync(d.Event.LIST_PLAYER_BEFORE_PREVIOUS,{list:r,reason:e});var n=this._incrementSeqId(),i={reason:e,listConstants:l.ListConstants};return r.previous(i).then((function(i){return t._currentSeqId!==n?s.OperationResult.CANCELLED:i===l.ListConstants.FORBIDDEN?s.OperationResult.FORBIDDEN:i===l.ListConstants.NULL_VALUE?t.previous(e):i===l.ListConstants.LIST_START?(t.emit(d.Event.LIST_PLAYER_LIST_ENDED,{list:r,reason:c.Reason.END_PLAY}),t.clear(e),s.OperationResult.LIST_END):p(i)?i.playable?t._changeTrack(i,e,n):(t.emit(d.Event.LIST_PLAYER_TRACK_UNPLAYABLE,{track:i,list:r}),t.previous(e)):s.OperationResult.INVALID}))},t.prototype.pause=function(){return this._loadedList?this._currentTrack?this._getTrackPlayer().then((function(e){return e.pause().then((function(){return s.OperationResult.SUCCESS})).catch((function(e){return"AbortError"===(null==e?void 0:e.name)?s.OperationResult.CANCELLED:s.OperationResult.FORBIDDEN}))})):Promise.resolve(s.OperationResult.SUCCESS):Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_NO_LIST,"Cannot perform operation; no list was loaded."))},t.prototype.resume=function(){return this._loadedList?this._currentTrack?this._getTrackPlayer().then((function(e){return e.resume().then((function(){return s.OperationResult.SUCCESS})).catch((function(e){return"AbortError"===(null==e?void 0:e.name)?s.OperationResult.CANCELLED:s.OperationResult.FORBIDDEN}))})):Promise.resolve(s.OperationResult.SUCCESS):Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_NO_LIST,"Cannot perform operation; no list was loaded."))},t.prototype.togglePlay=function(){return this._loadedList?this._currentTrack?this._getTrackPlayer().then((function(e){return e.togglePlay().then((function(){return s.OperationResult.SUCCESS})).catch((function(e){return"AbortError"===(null==e?void 0:e.name)?s.OperationResult.CANCELLED:s.OperationResult.FORBIDDEN}))})):Promise.resolve(s.OperationResult.SUCCESS):Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_NO_LIST,"Cannot perform operation; no list was loaded."))},t.prototype.stop=function(e){var t=this,r={reason:e||c.Reason.UNKNOWN},n=this._currentTrack;return n&&n.logData&&(r.source=n.logData.source,r.playbackService=n.logData.playbackService),this._incrementSeqId(),this._getTrackPlayer().then((function(e){return e.stop(r),t.emit(d.Event.LIST_PLAYER_STOPPED,{uid:t._uid,options:t._currentTrackOptions,list:t._loadedList}),s.OperationResult.SUCCESS}))},t.prototype.clear=function(e){var t=this;return this.stop(e).then((function(){return t._loadedList=null,t._loadedOptions=null,t._currentTrack=null,t._currentTrackOptions=null,t.emit(d.Event.LIST_PLAYER_CLEARED,null),s.OperationResult.SUCCESS}))},t.prototype.setShuffle=function(e){var t=!!e;if(this._shuffled!==t){this._shuffled=t,this.emit(d.Event.LIST_PLAYER_SHUFFLE_CHANGED,{player:this,shuffled:t});var r=this._loadedList;r&&r.setShuffle(this._shuffled)}return Promise.resolve(s.OperationResult.SUCCESS)},t.prototype.setRepeatMode=function(e){if(!(e in u.RepeatMode))return Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_INVALID_ARGUMENT,"The value of repeat mode is not a correct RepeatMode enum value"));if(this._repeatMode!==e){this._repeatMode=e,this.emit(d.Event.LIST_PLAYER_REPEAT_MODE_CHANGED,{player:this,repeatMode:e});var t=this._loadedList;t&&t.setRepeatMode(this._repeatMode)}return Promise.resolve(s.OperationResult.SUCCESS)},t.prototype.getVolume=function(){return this._getTrackPlayer().then((function(e){return e.getVolume()}))},t.prototype.setVolume=function(e,t){var r=this;return void 0===t&&(t=null),this._getTrackPlayer().then((function(n){return n.setVolume(e,{commandId:null!=t?t:void 0}),r.emit(d.Event.LIST_PLAYER_VOLUME_CHANGED,{volume:e,commandId:t}),s.OperationResult.SUCCESS}))},t.prototype.seek=function(e,t){var r,n,i=this;void 0===t&&(t=c.Reason.SEEK);var o=this._loadedList;if(!o)return Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_NO_LIST,"Cannot perform operation; no list was loaded."));if("function"==typeof o.allowSeeking&&!o.allowSeeking())return Promise.reject(new _.PlaybackError(a.Errors.LIST_PLAYER_FORBIDDEN,"The operation is not allowed."));var u=null!==(n=null===(r=o.handleSeek)||void 0===r?void 0:r.call(o,e,{reason:t,listConstants:l.ListConstants}))&&void 0!==n?n:e;return u===l.ListConstants.PAUSE?this.pause().then((function(t){return i.emit(d.Event.LIST_PLAYER_SEEK_HANDLED,{position:e,reason:u}),t})):u===l.ListConstants.IGNORE?(this.emit(d.Event.LIST_PLAYER_SEEK_HANDLED,{position:e,reason:u}),Promise.resolve(s.OperationResult.SUCCESS)):this._currentTrack?this._getTrackPlayer().then((function(e){return e.seek(u),s.OperationResult.SUCCESS})):Promise.resolve(s.OperationResult.SUCCESS)},t.prototype.getListConstants=function(){return l.ListConstants},t.prototype.getLoadedList=function(){return this._loadedList},t.prototype.getLoadedOptions=function(){return this._loadedOptions},t.prototype.getPlayerState=function(){var e=this;return this._getTrackPlayer().then((function(t){var r=t.getPlayerState();return n.__assign(n.__assign({},r),{position:e._translatePosition(r.position),duration:e._translateDuration(r.duration)})}))},t.prototype.getState=function(){var e=this;return this.getPlayerState().then((function(t){return{playbackState:t,track:e._currentTrack,list:e._loadedList,options:e._loadedOptions}}))},t.prototype.getMediaConfig=function(){return this._getTrackPlayer().then((function(e){return e.getMediaConfig()}))},t.prototype.hideSubtitles=function(){return this._getTrackPlayer().then((function(e){return e.hideSubtitles()})).then((function(){return s.OperationResult.SUCCESS}))},t.prototype.showSubtitles=function(){return this._getTrackPlayer().then((function(e){return e.showSubtitles()})).then((function(){return s.OperationResult.SUCCESS}))},t.prototype.areSubtitlesShown=function(){return this._getTrackPlayer().then((function(e){return e.areSubtitlesShown()}))},t.prototype.getSubtitleLanguages=function(){return this._getTrackPlayer().then((function(e){return e.getSubtitleLanguages()}))},t.prototype.getActiveSubtitleLanguage=function(){return this._getTrackPlayer().then((function(e){var t;return null!==(t=e.getActiveSubtitleLanguage())&&void 0!==t?t:null}))},t.prototype.deactivateCueEvents=function(){return this._getTrackPlayer().then((function(e){return e.deactivateCueEvents()})).then((function(){return s.OperationResult.SUCCESS}))},t.prototype.activateCueEvents=function(){return this._getTrackPlayer().then((function(e){return e.activateCueEvents()})).then((function(){return s.OperationResult.SUCCESS}))},t.prototype.getCurrentBandwidth=function(){return this._getTrackPlayer().then((function(e){return e.getCurrentBandwidth()}))},t.prototype.setSubtitleLanguage=function(e){return this._getTrackPlayer().then((function(t){return t.setSubtitleLanguage(e)})).then((function(){return s.OperationResult.SUCCESS}))},t.prototype.setPlaybackSpeed=function(e){return this._getTrackPlayer().then((function(t){return t.setPlaybackSpeed(e)})).then((function(e){return e?s.OperationResult.SUCCESS:s.OperationResult.FORBIDDEN}))},t.prototype.setMuted=function(e){return this._getTrackPlayer().then((function(t){return t.setMuted(e),s.OperationResult.SUCCESS}))},t.prototype.getStatistics=function(){return this._getTrackPlayer().then((function(e){return e.getStatistics()}))},t.prototype.getAudioProcessor=function(){return this._getTrackPlayer().then((function(e){return e.getAudioProcessor()}))},t}(i.EventEmitter);r.ListPlayer=f},{"./enums/errors":80,"./enums/event":81,"./enums/list_constants":83,"./enums/operation_result":86,"./enums/reason":88,"./enums/repeat_mode":89,"./error/playback":99,"@js-sdk/common/es5/promise_resolver":16,"@spotify-internal/emitter/es5":109,tslib:227}],104:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PlaybackStrategy=r.MAX_SAFE_INTEGER=void 0;e("./enums/content_mediator_event");r.MAX_SAFE_INTEGER=9007199254740991,function(e){e.URL="URL",e.MSE="MSE"}(r.PlaybackStrategy||(r.PlaybackStrategy={}))},{"./enums/content_mediator_event":79}],105:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default={tagged:"7.41.1-07ee66e5",version:"7.41.1",revision:"07ee66e5"}},{}],106:[function(e,t,r){(function(e){(function(){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.defer=void 0;var t,n="undefined"!=typeof window,i=[];function o(){var e,t=i.splice(0);if(t.length)for(var r=0,n=t.length;r<n;r++)try{null===(e=t[r])||void 0===e||e.call(t)}finally{}}n&&"function"==typeof window.postMessage?function(){var e=window.location.origin||"".concat(window.location.protocol,"//").concat(window.location.hostname);if(t=window.postMessage.bind(window,"@execute_deferreds",e),!window.__hasDeferredHandler){"function"==typeof Object.defineProperty?Object.defineProperty(window,"__hasDeferredHandler",{value:!0}):window.__hasDeferredHandler=!0;var r=function(t){t.origin!==e&&"@execute_deferreds"!==t.data||o()};window.addEventListener?window.addEventListener("message",r):window.attachEvent&&window.attachEvent("onmessage",r)}}():t="function"==typeof queueMicrotask?queueMicrotask.bind(null,o):"function"==typeof e?e.bind(null,o):setTimeout.bind(null,o,10);var a=function(e){var r=!i.length;i.push(e),r&&t()};r.defer=a,n&&("function"==typeof window.__modDefFn?r.defer=a=window.__modDefFn:"function"==typeof Object.defineProperty?Object.defineProperty(window,"__modDefFn",{value:a}):window.__modDefFn=a)}).call(this)}).call(this,e("timers").setImmediate)},{timers:226}],107:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.EmittedEvent=void 0;var n=function(){function e(e,t){this.defaultPrevented=!1,this.immediateStopped=!1,this.stopped=!1,this.type=e,this.data=t}return e.prototype.preventDefault=function(){this.defaultPrevented=!0},e.prototype.stopPropagation=function(){this.stopped=!0},e.prototype.stopImmediatePropagation=function(){this.immediateStopped=!0},e}();r.EmittedEvent=n},{}],108:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.EventEmitter=void 0;var n=e("./emitted_event"),i=e("./_internal/deferred");function o(e,t,r){for(var n=0,i=e.length;n<i;n++){var o=e[n];if((null==o?void 0:o.listener)===t&&o.options.once===r.once)return n}return-1}function a(e,t,r,n){if(void 0===n&&(n={}),!r)return!1;var i=e[t];return!i||!i.length||-1===o(i,r,n)}function s(e,t,r,n){if(void 0===n&&(n={}),t&&r){var i=e[t],o={listener:r,options:n};i?i.push(o):e[t]=[o]}}var u=function(){function e(){this._listeners={},this._metaListeners={add:{},remove:{}}}return e.prototype._dispatchFromStore=function(e,t){var r=t.type,n=e[r];if(n)for(var i=0,o=n=n.slice(0);i<o.length;i++){var a=o[i];if(a.listener.call(this,t),a.options.once&&this.removeListener(r,a.listener,a.options),t.immediateStopped)break}},e.prototype.createEvent=function(e,t){return new n.EmittedEvent(e,t)},e.prototype.on=function(e,t,r){if(void 0===r&&(r={}),!e)throw new TypeError("Argument `eventType` is required.");if(!t)return this;var i=this._listeners;if(a(i,e,t,r)){var o=this._metaListeners.add,u=o[e];if(u&&u.length){var l=new n.EmittedEvent(e,{listener:t,options:r});if(this._dispatchFromStore(o,l),l.defaultPrevented)return this}s(i,e,t,r)}return this},e.prototype.addListener=function(e,t,r){return void 0===r&&(r={}),this.on(e,t,r)},e.prototype.addListeners=function(e){for(var t in e)e.hasOwnProperty(t)&&this.on(t,e[t]);return this},e.prototype.once=function(e,t){return this.on(e,t,{once:!0})},e.prototype.removeListener=function(e,t,r){if(void 0===r&&(r={}),!e)throw new TypeError("Argument `eventType` is required.");if(!t)return this;var i=this._listeners[e];if(!i)return this;var a=o(i,t,r);if(-1===a)return this;var s=this._metaListeners.remove[e];if(s&&s.length){var u=new n.EmittedEvent(e,{listener:t,options:r});if(this._dispatchFromStore(this._metaListeners.remove,u),u.defaultPrevented)return this}return i.splice(a,1),this},e.prototype.removeListeners=function(e){for(var t in e)e.hasOwnProperty(t)&&this.removeListener(t,e[t]);return this},e.prototype.removeAllListeners=function(e){return e?this._listeners[e]=[]:this._listeners={},this},e.prototype.emit=function(e,t){var r=this;if(!e)throw new TypeError("Argument `eventType` is required.");var n=this.createEvent(e,t);return(0,i.defer)((function(){return r._dispatchFromStore(r._listeners,n)})),n},e.prototype.emitSync=function(e,t){if(!e)throw new TypeError("Argument `eventType` is required.");var r=this.createEvent(e,t);return this._dispatchFromStore(this._listeners,r),r},e.prototype.emitEvent=function(e){var t=this;return(0,i.defer)((function(){return t._dispatchFromStore(t._listeners,e)})),e},e.prototype.emitEventSync=function(e){return this._dispatchFromStore(this._listeners,e),e},e.prototype.emitAndWait=function(e,t,r){var n=this;if(!e)throw new TypeError("Argument `eventType` is required.");var o=this.createEvent(e,t);return(0,i.defer)((function(){n._dispatchFromStore(n._listeners,o),r.call(n,o)})),o},e.prototype.emitEventAndWait=function(e,t){var r=this;return(0,i.defer)((function(){r._dispatchFromStore(r._listeners,e),t.call(r,e)})),e},e.prototype.proxyEmit=function(e,t,r){var n=this;if(!e||"function"!=typeof e.on)throw new TypeError("Proxy source must be an EventEmitter");if(e===this)throw new ReferenceError("Cannot create recursive proxy.");if(!t||!r)throw new TypeError("Parameter sourceType and targetType are required.");var i=function(e){e.stopped||n.emitAndWait(r,e.data,(function(t){t.defaultPrevented&&e.preventDefault()}))};return e.on(t,i),i},e.prototype.proxyEmitSync=function(e,t,r){var n=this;if(!e||"function"!=typeof e.on)throw new TypeError("Proxy source must be an EventEmitter");if(e===this)throw new ReferenceError("Cannot create recursive proxy.");if(!t||!r)throw new TypeError("Parameter sourceType and targetType are required.");var i=function(e){if(!e.stopped){var t=n.createEvent(r,e.data);n.emitEventSync(t),t.defaultPrevented&&e.preventDefault()}};return e.on(t,i),i},e.prototype.proxyEmitAll=function(e,t){for(var r in t)t.hasOwnProperty(r)&&this.proxyEmit(e,r,t[r])},e.prototype.proxyEmitAllSync=function(e,t){for(var r in t)t.hasOwnProperty(r)&&this.proxyEmitSync(e,r,t[r])},e.prototype.onAddListener=function(e,t,r){void 0===r&&(r={});var n=this._metaListeners.add;return a(n,e,t,r)&&s(n,e,t,r),this},e.prototype.onRemoveListener=function(e,t,r){void 0===r&&(r={});var n=this._metaListeners.remove;return a(n,e,t,r)&&s(n,e,t,r),this},e}();r.EventEmitter=u},{"./_internal/deferred":106,"./emitted_event":107}],109:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Event=r.EmittedEvent=void 0;var n=e("tslib"),i=e("./emitted_event");Object.defineProperty(r,"EmittedEvent",{enumerable:!0,get:function(){return i.EmittedEvent}}),Object.defineProperty(r,"Event",{enumerable:!0,get:function(){return i.EmittedEvent}}),n.__exportStar(e("./eventemitter"),r)},{"./emitted_event":107,"./eventemitter":108,tslib:227}],110:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HarmonyClient=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@js-sdk/common/es5/debug_tools"),a=e("@spotify-internal/transport/es5/product_state_observer"),s=e("@spotify-internal/transport/es5"),u=e("@js-sdk/common/es5/user_agent/interpolate_ua"),l=e("@js-sdk/common/es5/promise_resolver"),c=e("../typedefs"),d=e("../enums/errors"),_=e("../enums/error_source"),p=e("../enums/manifest_format"),f=e("../error/harmony_error"),h=e("./device_descriptor"),v=e("../version"),y=e("./logging/transport_logger"),m=o.logging.forTag("harmonyclient"),E=/^[a-zA-Z0-9_%:-]{1,40}$/,g=function(e){function t(t){var r=e.call(this)||this;if(r._platformIdentifier=l.createPromiseResolver(),r._platformVersion=l.createPromiseResolver(),!t)throw new TypeError("Argument `options` is not defined.");if(!t.transport)throw new TypeError("No Transport instance provided");if(!t.transport.hasPlugin("dealer"))throw new TypeError("Transport has no Dealer plugin.");return r._transport=t.transport,r._deviceDescriptor=r._initDeviceDescriptor(t),r._logger=new y.Logger({transport:r._transport.toPublic(),sdkId:r.getSDKId(),platform:r._platformIdentifier.promise,clientVersion:r._platformVersion.promise}),r._productStateObserver=a.ProductStateObserver.create({transport:r._transport}),r._onConnected=r._onConnected.bind(r),r._onAuthenticated=r._onAuthenticated.bind(r),r._onConnectionError=r._onConnectionError.bind(r),r._onAuthenticationError=r._onAuthenticationError.bind(r),r._onShortSessionDisconnect=r._onShortSessionDisconnect.bind(r),r._attachListeners(),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.of=function(e){return e._client},t.prototype._createDeviceDescriptor=function(e,t){var r,i;if(void 0===t&&(t={}),(null==t?void 0:t.id)&&!E.test(t.id))throw f.HarmonyError.fatal(d.HarmonyErrors.HARMONY_INVALID_DESCRIPTOR_ID,"Invalid device id.");var o=t.capabilities||{},a={change_volume:null===(r=o.change_volume)||void 0===r||r,endsong_snooping:o.endsong_snooping,enable_play_token:!0,supports_file_media_type:!0,play_token_lost_behavior:e.playTokenLostBehavior||"pause",disable_connect:!!e.hidden,audio_podcasts:null===(i=o.audio_podcasts)||void 0===i||i,video_playback:o.video_playback,lossless_playback:o.lossless_playback,volume_steps:void 0!==o.volume_steps&&o.volume_steps>=0&&o.volume_steps<c.GAIA_VOLUME?o.volume_steps:void 0,manifest_formats:[p.ManifestFormat.FILE_IDS_MP3,p.ManifestFormat.FILE_URLS_MP3,p.ManifestFormat.MANIFEST_URLS_AUDIO_AD],video_ads:o.video_ads},s=h.DeviceDescriptor.create(n.__assign(n.__assign({},t),{capabilities:a}));return this._platformIdentifier.resolve(s.getPlatformIdentifier()),this._platformVersion.resolve(s.getPlatformVersion()),this.proxyEmit(s,"descriptor_changed","descriptor_changed"),s},t.prototype._initDeviceDescriptor=function(e){var t=this;return Promise.resolve(e.descriptor).then(this._createDeviceDescriptor.bind(this,e)).catch((function(e){return t._onError(_.HarmonyErrorSource.HARMONY,{error:e}),Promise.reject(e)}))},t.prototype._attachListeners=function(){var e=this,t=this._transport;t.on(s.TransportEvent.CONNECTED,this._onConnected),t.on(s.TransportEvent.AUTHENTICATED,this._onAuthenticated),t.on(s.TransportEvent.CONNECTION_FAILED,this._onConnectionError),t.on(s.TransportEvent.AUTHENTICATION_FAILED,this._onAuthenticationError),this.proxyEmit(t,s.TransportEvent.RECONNECTING,"reconnecting"),this.proxyEmit(t,s.TransportEvent.RECONNECTED,"reconnected"),this.proxyEmit(t,s.TransportEvent.LOGGED_OUT,"logged_out"),this.proxyEmitSync(t,s.TransportEvent.BEFORE_OFFLINE_DISCONNECT,"before_offline_disconnect"),this.proxyEmitSync(t,s.TransportEvent.BEFORE_ONLINE_DISCONNECT,"before_disconnect"),t.on(s.TransportEvent.SHORT_SESSION_DISCONNECTED,this._onShortSessionDisconnect.bind(this)),this.proxyEmit(this._productStateObserver,s.TransportEvent.PRODUCT_STATE_CHANGED,"product_state_changed"),this.on("before_disconnect",(function(t){var r=e._productStateObserver.deregister().catch((function(){}));t.data.awaitPromise(r)}))},t.prototype._onError=function(e,t){this.emit("error",{source:e,error:t.error}),t.error&&t.error.unrecoverable&&this.emit("unrecoverable_failure",{source:e,error:t.error})},t.prototype._onConnected=function(){this.emit("connected",null)},t.prototype._onAuthenticated=function(){this.emit("authenticated",null)},t.prototype._onConnectionError=function(e){this._onError(_.HarmonyErrorSource.TRANSPORT,{error:e.data.error}),this.emit("connection_error",e.data)},t.prototype._onAuthenticationError=function(e){this._onError(_.HarmonyErrorSource.TRANSPORT,{error:e.data.error}),this.emit("authentication_error",e.data)},t.prototype._onShortSessionDisconnect=function(e){this._logger.logClientEvent({source:"transport",source_version:v.default.tagged,source_vendor:"spotify",event:e.type,event_version:"1.0.0",json_data:{disconnectCount:e.data.disconnectCount,sessionLength:e.data.sessionLength}},"object").catch((function(t){return m.warn(e.type+" Logging Error:",t)}))},t.prototype.getVersionDescriptor=function(){return n.__assign({},v.default)},t.prototype.getSDKId=function(){return"harmony:"+v.default.tagged},t.prototype.getUntaggedSDKId=function(){return"harmony:"+v.default.version},t.prototype.getPlatformIdentifier=function(){return this._platformIdentifier.promise},t.prototype.getPlatformVersion=function(){return this._platformVersion.promise},t.prototype.getLogger=function(){return this._logger},t.prototype.logAppMetrics=function(e,t){if(!this._logger)throw new TypeError("Invalid logger instance");return this._logger.logMetrics(e,t)},t.prototype.request=function(e,t){return this._transport.request(e,t)},t.prototype.getPublicTransport=function(){return this._transport.toPublic()},t.prototype.getClientDescriptor=function(){return this._deviceDescriptor.then((function(e){return e.toJSON()}))},t.prototype.getDeviceDescriptor=function(){return this._deviceDescriptor},t.prototype.getUserInfo=function(){return this._transport.request("@webapi/v1/me",{responseType:"json"}).then((function(e){var t=e.body;if(200!==e.status){var r=new f.HarmonyError(d.HarmonyErrors.USER_INFO_REQUEST_FAILED_WITH_STATUS,"User info request failed with status "+e.status);return r.status=e.status,Promise.reject(r)}return t?{display_name:t.display_name,followers:t.followers,id:t.id,images:t.images,uri:t.uri}:Promise.reject(new f.HarmonyError(d.HarmonyErrors.USER_INFO_REQUEST_EMPTY_RESPONSE,"Unexpected empty response."))}))},t.prototype.getProductState=function(){return this._productStateObserver.getCurrentState()},t.prototype.setName=function(e){return this._deviceDescriptor.then((function(t){return t.setName(e)}))},t.prototype.setNameTemplate=function(e){return this.setName(u.interpolateUA(e))},t.prototype.setCapability=function(e,t){return this._deviceDescriptor.then((function(r){return r.setCapability(e,t)}))},t.prototype.notifyError=function(e,t){this._onError(e,{error:t})},t}(i.EventEmitter);r.HarmonyClient=g},{"../enums/error_source":138,"../enums/errors":139,"../enums/manifest_format":143,"../error/harmony_error":148,"../typedefs":154,"../version":160,"./device_descriptor":118,"./logging/transport_logger":122,"@js-sdk/common/es5/debug_tools":9,"@js-sdk/common/es5/promise_resolver":16,"@js-sdk/common/es5/user_agent/interpolate_ua":18,"@spotify-internal/emitter/es5":109,"@spotify-internal/transport/es5":188,"@spotify-internal/transport/es5/product_state_observer":195,tslib:227}],111:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.CloudPlaybackClient=void 0;var i=e("tslib"),o=e("@js-sdk/common/es5/debouncer"),a=e("@spotify-internal/transport/es5"),s=e("@js-sdk/common/es5/debug_tools"),u=e("@spotify-internal/emitter/es5"),l=e("@js-sdk/playback/es5"),c=e("@js-sdk/common/es5/promise_resolver"),d=e("@js-sdk/common/es5/monotonic_now"),_=e("../../enums/errors"),p=e("../../enums/manifest_format"),f=e("../../enums/error_source"),h=e("../../enums/hifi_status"),v=e("../../error/cloud_playback/client"),y=e("../../version"),m=e("./common"),E=e("./list"),g=Math.pow(2,53)-1,R=s.logging.forTag("cpclient");function T(){throw new Error("Not implemented")}var I={condition:function(e){var t=e.status;return 429===t||503===t},maxRetries:2},S={"/play":!0,"/skip_next":!0,"/skip_previous":!0,"/repeat":!0,"/shuffle":!0,"/event/play_progress":!0},P=((n={})[p.ManifestFormat.FILE_URLS_MP3]={mime_type:"audio/mp3"},n[p.ManifestFormat.FILE_URLS_EXTERNAL]={mime_type:"audio/mp3"},n[p.ManifestFormat.FILE_IDS_MP3]={mime_type:"audio/mp3"},n[p.ManifestFormat.FILE_IDS_MP4]={mime_type:'audio/mp4+file_id; codecs="mp4a.40.2"',key_system:l.KeySystem.WIDEVINE},n[p.ManifestFormat.FILE_IDS_MP4_DUAL]={mime_type:'audio/mp4+file_id; codecs="mp4a.40.2"',key_system:l.KeySystem.PLAYREADY},n[p.ManifestFormat.FILE_IDS_CBCS]={mime_type:'audio/mp4+file_id; codecs="mp4a.40.2"',key_system:l.KeySystem.FAIRPLAY},n[p.ManifestFormat.FILE_IDS_MP4FLAC]={mime_type:'audio/mp4+file_id; codecs="flac"',key_system:l.KeySystem.WIDEVINE},n[p.ManifestFormat.MANIFEST_IDS_VIDEO]={mime_type:"video/mp4+manifest_id"},n[p.ManifestFormat.MANIFEST_URLS_VIDEO_AD]={mime_type:""},n[p.ManifestFormat.MANIFEST_URLS_AUDIO_AD]={mime_type:""},n),b=function(e){function t(t){var r=e.call(this)||this;return r._currentList=null,r._deviceId=null,r._isDeregistering=!1,r._loading=!1,r._lastReportedPlayedAmount=0,r._trackingDataSenderPromises=[],r._registered=!1,r._lastCommandTimestamp=0,r._sequenceContext={sequence_id:Math.floor(Math.random()*g).toString(),event_number:0},r._currentPlayerState={playback_id:null,duration:0,current_position:0,paused:!0,playbackQuality:{audio_quality:l.PlaybackQuality.UNKNOWN,hifi_status:h.HiFiStatus.NONE},playback_speed:0},r._playbackSpeed={currentPlaybackSpeed:0,selectedPlaybackSpeed:1,isPlaybackSpeedRestricted:!1},r._deactivate=!1,r._connectionId=null,r._transport=t.transport,r._logger=t.logger,r._descriptorPromise=Promise.resolve(t.descriptor),r._endpoint=t.endpoint||"https://@webgate/cloud-playback/v1",r._listPlayer=t.listPlayer,r._currentVolume=t.initialVolume,r._handleConfigurationResponse=r._handleConfigurationResponse.bind(r),r._handleReportEventResponse=r._handleReportEventResponse.bind(r),r.register=r.register.bind(r),r._volumeDebouncer=new o.Debouncer(r._sendVolume.bind(r),{blockInitial:!0}),r._init(),r}return i.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._init=function(){var e,t=this;this._descriptorPromise.then((function(e){t._parseDescriptor(e),e.on("descriptor_changed",(function(){t._parseDescriptor(e)}))})),this._transport.on(this._transport.EVENT_CONNECTION_ID,this._onConnectionId.bind(this)),this._transport.matchMessages("hm://cloud-playback/v1/push",this._onMessage.bind(this)),this._listPlayer.addListeners(((e={})[l.PlaybackEvent.LIST_PLAYER_PLAYER_LOAD]=this._onPlayerLoad.bind(this),e[l.PlaybackEvent.LIST_PLAYER_VOLUME_CHANGED]=this._onVolumeChanged.bind(this),e[l.PlaybackEvent.LIST_PLAYER_PAUSED]=this._onPaused.bind(this),e[l.PlaybackEvent.LIST_PLAYER_ERROR]=this._onError.bind(this),e[l.PlaybackEvent.LIST_PLAYER_PLAYING]=this._onPlaying.bind(this),e[l.PlaybackEvent.LIST_PLAYER_PROGRESS]=this._onProgress.bind(this),e[l.PlaybackEvent.LIST_PLAYER_BEFORE_PLAYER_LOAD]=this._onBeforePlayerLoad.bind(this),e[l.PlaybackEvent.LIST_PLAYER_POSITION_CHANGED]=this._onPositionChanged.bind(this),e[l.PlaybackEvent.LIST_PLAYER_DURATION_CHANGED]=this._onDurationChanged.bind(this),e[l.PlaybackEvent.LIST_PLAYER_TRACKING_DATA_CREATED]=this._onTrackingDataCreated.bind(this),e[l.PlaybackEvent.LIST_PLAYER_TRACKING_DATA_FINALIZED]=this._onTrackingDataFinalized.bind(this),e[l.PlaybackEvent.LIST_PLAYER_PLAYBACK_SPEED_CHANGED]=this._onSpeedChanged.bind(this),e[l.PlaybackEvent.LIST_PLAYER_BEFORE_TRACK_LOAD]=this._onBeforeTrackLoad.bind(this),e))},t.prototype._onMessage=function(e){var t=e.payloads;Array.isArray(t)&&t.length&&this._performCommand(t[0])},t.prototype._handlePauseCommand=function(){this._listPlayer.pause()},t.prototype._handleResumeCommand=function(){this._listPlayer.resume()},t.prototype._handleStopCommand=function(){this._clearState()},t.prototype._onPaused=function(){if(this._currentPlayerState.paused=!0,"string"!=typeof this._descriptorId)throw new v.CloudPlaybackClientError(_.HarmonyErrors.HARMONY_INVALID_DESCRIPTOR_ID,"Descriptor ID is missing");var e={playback_descriptor_id:this._descriptorId};this._reportEvent(m.ReportingEvent.PAUSE,e),this._emitStateChanged()},t.prototype._onPlaying=function(){if(this._currentPlayerState.paused=!1,"string"!=typeof this._descriptorId)throw new v.CloudPlaybackClientError(_.HarmonyErrors.HARMONY_INVALID_DESCRIPTOR_ID,"Descriptor ID is missing");var e={playback_descriptor_id:this._descriptorId};this._reportEvent(m.ReportingEvent.RESUME,e),this._emitStateChanged()},t.prototype._onDurationChanged=function(e){this._currentPlayerState.duration!==e.data.duration&&(this._currentPlayerState.duration=e.data.duration,this._emitStateChanged())},t.prototype._onPositionChanged=function(e){if(!this._loading){var t=this._currentPlayerState.current_position;if(t!==e.data.position){if(this._currentPlayerState.current_position=e.data.position,"string"!=typeof this._descriptorId)throw new v.CloudPlaybackClientError(_.HarmonyErrors.HARMONY_INVALID_DESCRIPTOR_ID,"Descriptor ID is missing");var r={playback_descriptor_id:this._descriptorId,previous_position:t};this._reportEvent(m.ReportingEvent.POSITION_CHANGE,r),this._emitStateChanged()}}},t.prototype._onSpeedChanged=function(e){if(this._playbackSpeed.currentPlaybackSpeed=e.data.playback_speed,this._playbackSpeed.selectedPlaybackSpeed=e.data.playback_speed_selected,this._currentPlayerState.playback_speed=e.data.playback_speed,"string"!=typeof this._descriptorId)throw new v.CloudPlaybackClientError(_.HarmonyErrors.HARMONY_INVALID_DESCRIPTOR_ID,"Descriptor ID is missing");var t={playback_descriptor_id:this._descriptorId};this._reportEvent(m.ReportingEvent.PLAYBACK_SPEED_CHANGE,t),this._emitStateChanged()},t.prototype._onBeforeTrackLoad=function(e){var t,r;this._stateEventPositionAndDurationOverride={position:(null===(t=e.data.newTrack.options)||void 0===t?void 0:t.position)||0,duration:(null===(r=e.data.newTrack.metadata)||void 0===r?void 0:r.duration)||0}},t.prototype._onError=function(e){if("string"!=typeof this._descriptorId)throw new v.CloudPlaybackClientError(_.HarmonyErrors.HARMONY_INVALID_DESCRIPTOR_ID,"Descriptor ID is missing");var t=e.data.error.code,r=m.ErrorType.UNKNOWN;t===l.Errors.MEDIA_DECODING_ERROR&&(r=m.ErrorType.DECODING),t&&/^EME_/.test(t)&&(r=m.ErrorType.DRM);var n={playback_descriptor_id:this._descriptorId,error_type:r};this._reportEvent(m.ReportingEvent.PLAY_FAILURE,n)},t.prototype._onProgress=function(e){var t,r;if(this._currentPlayerState.current_position=e.data.position,"string"!=typeof this._descriptorId)throw new v.CloudPlaybackClientError(_.HarmonyErrors.HARMONY_INVALID_DESCRIPTOR_ID,"Descriptor ID is missing");var n=this._currentList,i=null==n?void 0:n.getReportingMarkers();if(n&&i){var o=e.data.played,a=i.checkin,s=i.periodic;if(a.length){if(a[0]&&o<a[0])return;if(this._currentPlayerState.playback_id!==(null===(t=null==n?void 0:n.getCurrentPlayState())||void 0===t?void 0:t.playable_item.playback.id))return;a.shift()}else if(s&&s>=o-this._lastReportedPlayedAmount)return;this._lastReportedPlayedAmount=o,R.debug("PLAY_PROGRESS report event is being sent.",{event_name:"PLAY_PROGRESS",current_player_state_playback_id:this._currentPlayerState.playback_id,current_play_state_playback_id:null===(r=null==n?void 0:n.getCurrentPlayState())||void 0===r?void 0:r.playable_item.playback.id}),this._reportEvent(m.ReportingEvent.PLAY_PROGRESS,{playback_descriptor_id:this._descriptorId})}},t.prototype._onBeforePlayerLoad=function(e){var t,r,n,i;this._loading=!0;var o=e.data,a=o.track,s=o.options,u=o.logData,l=a.metadata;this._descriptorId=l.descriptorId,this._lastReportedPlayedAmount=0,this._playbackSpeed.isPlaybackSpeedRestricted=!!(null===(t=a.options)||void 0===t?void 0:t.useDefaultPlaybackSpeed),this._playbackSpeed.currentPlaybackSpeed=this._playbackSpeed.isPlaybackSpeedRestricted?1:this._playbackSpeed.currentPlaybackSpeed||1,this._currentPlayerState={playback_id:null!==(r=null==u?void 0:u.playbackId)&&void 0!==r?r:"",duration:null!==(n=l.duration)&&void 0!==n?n:0,current_position:s.position,paused:!s.autoplay,playbackQuality:l.playbackQuality,playback_speed:this._playbackSpeed.currentPlaybackSpeed};var c={playback_descriptor_id:null!==(i=this._descriptorId)&&void 0!==i?i:""};this._reportEvent(m.ReportingEvent.ITEM_BEFORE_LOAD,c)},t.prototype._onPlayerLoad=function(e){if("string"!=typeof this._descriptorId)throw new v.CloudPlaybackClientError(_.HarmonyErrors.HARMONY_INVALID_DESCRIPTOR_ID,"Descriptor ID is missing");this._loading=!1,this._currentPlayerState.current_position=e.data.position;var t={playback_descriptor_id:this._descriptorId,initial_loading_stats:{}};this._reportEvent(m.ReportingEvent.ITEM_READY,t),this._emitStateChanged()},t.prototype._onTrackingDataCreated=function(){this._trackingDataSenderPromises.push(c.createPromiseResolver())},t.prototype._onTrackingDataFinalized=function(e){var t,r=e.data.trackingData,n=this._deactivate;this._deactivate=!1;var i=this._trackingDataSenderPromises[this._trackingDataSenderPromises.length-1],o={playback_descriptor_id:null===(t=r.contentMetadata)||void 0===t?void 0:t.descriptorId,playback_stats:{num_stalls:r.nStalls,file_id:r.fileId,urls:r.getURLsJSON()},deactivate:n},a=r.playbackId,s=r.position,u=r.msActualDuration,l=r.contentMetadata;this._reportEvent(m.ReportingEvent.ITEM_END,o,{playback_id:a,current_position:s,paused:!0,duration:u,playbackQuality:l?l.playbackQuality:this._currentPlayerState.playbackQuality,playback_speed:this._playbackSpeed.currentPlaybackSpeed}).then((function(){i&&i.resolve(!0)})).catch((function(){i&&i.resolve(!1)})),this._emitStateChanged()},t.prototype._logContentRequest=function(e,t,r){var n;return this._logger.logJSSDKContentRequest({http_status:r.status,ms_request_duration:d.monotonicDuration(t),n_retries:r.retries.count,playback_id:null===(n=r.body)||void 0===n?void 0:n.play_state.playable_item.playback.id,source:"cloud-playback-client",type:e}).catch((function(e){R.error("Cloud Playback logJSSDKContentRequest error",e)}))},t.prototype._cloudPlaybackRequest=function(e,t,r){void 0===e&&(e="");var n=this._endpoint+"/client/"+this._deviceId+e,i={method:a.Method[t],headers:{"Content-Type":"application/json"},authorize:!0,responseType:"json",retry:S[e]?void 0:I,payload:JSON.stringify(r)};return this._transport.request(n,i)},t.prototype._reportEvent=function(e,t,r){if(!this._registered){var n=new v.CloudPlaybackClientError(_.HarmonyErrors.CP_INVALID_STATE,"Cannot send report "+e+" when the device is not registered");return this._emitError(n),Promise.reject(n)}if(!this._deviceId){n=new v.CloudPlaybackClientError(_.HarmonyErrors.CP_NO_DEVICE_ID,"Device is not configured");return this._emitError(n),Promise.reject(n)}this._sequenceContext.event_number++;var o=r||this._currentPlayerState;o.sequence_context=this._sequenceContext;var a=i.__assign({timestamp:Date.now(),player_state:o},t);if(null===a.player_state.playback_id){n=new v.CloudPlaybackClientError(_.HarmonyErrors.CP_NO_PLAYBACK_ID,"Cannot report event when there is no playback id");return this._emitError(n,i.__assign({event:e},t),!0),Promise.resolve()}return this._cloudPlaybackRequest("/event/"+e,"POST",a).then(this._handleReportEventResponse)},t.prototype._handleReportEventResponse=function(e){var t,r,n,i;if(200!==e.status){var o=new v.CloudPlaybackClientError(_.HarmonyErrors.CP_REQUEST_FAILED_WITH_STATUS,"PlayLoad event failed with status "+e.status);return o.status=e.status,Promise.reject(o)}return(null===(t=e.body)||void 0===t?void 0:t.must_stop)&&this._listPlayer.stop(),(null===(r=e.body)||void 0===r?void 0:r.must_pause)&&this._listPlayer.pause(),(null===(n=e.body)||void 0===n?void 0:n.clear_preloaded)&&(null===(i=this._currentList)||void 0===i||i.clearPreload()),Promise.resolve()},t.prototype._performCommand=function(e){if(e.server_timestamp<this._lastCommandTimestamp)R.warn(e.type+" command ignored due to more recent command in execution.");else switch(this._lastCommandTimestamp=e.server_timestamp,e.type){case m.CommandType.PAUSE:this._handlePauseCommand();break;case m.CommandType.RESUME:this._handleResumeCommand();break;case m.CommandType.PLAY_STATE:this._handlePlayCommand(e);break;case m.CommandType.STOP:this._handleStopCommand();break;case m.CommandType.PLAYBACK_SPEED:this._handlePlaybackSpeedCommand(e);break;case m.CommandType.SEEK:this._handleSeekCommand(e);break;case m.CommandType.VOLUME:this._handleVolumeCommand(e);break;case m.CommandType.PLAY_STATE_CONTEXT:this._handlePlayStateContextCommand(e);break;case m.CommandType.LOGOUT:this._handleLogoutCommand();break;default:T()}},t.prototype._handlePlaybackSpeedCommand=function(e){var t=e.payload;this._listPlayer.setPlaybackSpeed(t.playback_speed)},t.prototype._handleSeekCommand=function(e){var t=e.payload;this._listPlayer.seek(t.seekTo)},t.prototype._handleVolumeCommand=function(e){var t=e.payload;this._listPlayer.setVolume(t.volume,"cpcommand-"+Date.now())},t.prototype._onVolumeChanged=function(e){if(this._registered)if(this._registrationInfo&&this._deviceId){this._currentVolume=e.data.volume,this._registrationInfo.clientInstanceInfo.volume=e.data.volume;var t={timestamp:Date.now(),volume:e.data.volume};this._volumeDebouncer.async(t)}else this._emitError(new v.CloudPlaybackClientError(_.HarmonyErrors.CP_NO_DEVICE_DESCRIPTOR,"No device descriptor"));else this._emitError(new v.CloudPlaybackClientError(_.HarmonyErrors.CP_INVALID_STATE,"Cannot update volume when the device is not registered"))},t.prototype._sendVolume=function(e){return this._cloudPlaybackRequest("/volume","POST",e)},t.prototype._handlePlayCommand=function(e){var t=this,r=e.payload;this._loading=!0;var n=E.CloudPlaybackList.create({client:this,initialPlayState:r,getCurrentBandwidth:function(){return t._listPlayer.getCurrentBandwidth()}});this._currentList=n,this._listPlayer.play(n,{reason:l.Reason.REMOTE})},t.prototype._handlePlayStateContextCommand=function(e){var t=e.payload,r=this._currentList;r&&(r.updatePlayStateContext(t.context),t.clear_preloaded&&r.clearPreload(),this._emitStateChanged())},t.prototype._handleLogoutCommand=function(){var e=this;this._clearState(),this.deregister().then((function(t){t&&e.emit("logout",null)}))},t.prototype._clearState=function(){var e=this,t=this._listPlayer;t.addListener(l.PlaybackEvent.LIST_PLAYER_CLEARED,(function r(){e._currentList=null,e._currentPlayerState={playback_id:null,duration:0,current_position:0,paused:!0,playbackQuality:{audio_quality:l.PlaybackQuality.UNKNOWN,hifi_status:h.HiFiStatus.NONE},playback_speed:0},e._playbackSpeed={currentPlaybackSpeed:0,isPlaybackSpeedRestricted:!1,selectedPlaybackSpeed:1},e.emit("state_cleared",null),t.removeListener(l.PlaybackEvent.LIST_PLAYER_CLEARED,r)})),t.clear(l.Reason.REMOTE)},t.prototype._emitStateChanged=function(){var e,t,r=this._currentPlayerState,n=r.current_position,i=r.duration;void 0!==this._stateEventPositionAndDurationOverride&&(n=this._stateEventPositionAndDurationOverride.position,i=this._stateEventPositionAndDurationOverride.duration,this._stateEventPositionAndDurationOverride=void 0),this.emit("state_changed",{playState:null!==(t=null===(e=this._currentList)||void 0===e?void 0:e.getCurrentPlayState())&&void 0!==t?t:null,position:n,paused:r.paused,duration:i,loading:this._loading,playbackId:r.playback_id||"",playbackQuality:r.playbackQuality,currentPlaybackSpeed:this._playbackSpeed.currentPlaybackSpeed,isPlaybackSpeedRestricted:this._playbackSpeed.isPlaybackSpeedRestricted,selectedPlaybackSpeed:this._playbackSpeed.selectedPlaybackSpeed})},t.prototype._onConnectionId=function(e){this._connectionId=e.data.id,this._isDeregistering||(this._registered=!1,this.register().catch((function(){})))},t.prototype._handleConfigurationResponse=function(e){T()},t.prototype._parseDescriptor=function(e){var t;if(this._registrationInfo)return!1;this._deviceId=e.getId();var r=e.toJSON(),n=r.capabilities.change_volume?r.capabilities.volume_steps||64:0,i={type:r.type.toUpperCase(),brand:r.brand,model:r.model,name:r.name,connect_disabled:r.capabilities.disable_connect,platform_identifier:r.platform_identifier,spotify_sdk:{identifier:"harmony",version:y.default.tagged},version:null!==(t=r.platform_version)&&void 0!==t?t:"",volume:this._currentVolume,volume_steps:n},o=["audio/track"];e.getCapability("audio_podcasts")&&o.push("audio/episode"),e.supportsVideoManifestFormats()&&o.push("video/episode");for(var a=[{mime_type:"audio/mp3"}],s=0,u=e.getManifestFormats();s<u.length;s++){var l=u[s],c=P[l];c&&""!==c.mime_type&&"audio/mp3"!==c.mime_type&&a.push(c)}return this._registrationInfo={clientInstanceInfo:i,supportedMediaContentTypes:o,supportedFileFormats:a},!0},t.prototype._emitError=function(e,t,r){void 0===t&&(t={}),void 0===r&&(r=!1),r||this.emit("error",{error:e,source:f.HarmonyErrorSource.CLOUD_PLAYBACK}),e.registration||this._logger.logJSSDKError({source:"cpapi-client",source_version:y.default.tagged,type:e.code,message:e&&e.message,stack:e&&e.stack,json_data:t,json_data_version:"1.0.0"},"object").catch((function(e){R.error("Cloud-Playback Logging Error",e)}))},t.prototype._sendConfigurationRequest=function(){var e=this;if(this._registered)return Promise.resolve(!0);var t=this._registrationInfo;if(!t||!this._deviceId)return Promise.reject(new v.CloudPlaybackClientError(_.HarmonyErrors.CP_NO_DEVICE_DESCRIPTOR,"No device descriptor"));if(!this._connectionId)return Promise.reject(new v.CloudPlaybackClientError(_.HarmonyErrors.CP_NO_CONNECTION_ID,"No connection id"));var r={client_instance_info:t.clientInstanceInfo,supported_media_content_types:t.supportedMediaContentTypes,supported_file_formats:t.supportedFileFormats,timestamp:Date.now(),push_channel:{type:"CONNECTION_ID",target:this._connectionId},display_item_window:{previous_items_size:2,next_items_size:2}};return this._cloudPlaybackRequest("","PUT",r).then((function(t){if(200===t.status)return!0;var r=403===t.status?new v.CloudPlaybackClientError(_.HarmonyErrors.CP_REGISTRATION_FAILED_NON_PREMIUM,"Cannot register to Cloud Playback with non-premium user"):new v.CloudPlaybackClientError(_.HarmonyErrors.CP_REGISTRATION_FAILED_WITH_STATUS,"Registration request failed with status "+t.status);return r.registration=!0,r.status=t.status,e._emitError(r),!1}))},t.prototype._handlePlayResponse=function(e){var t;return 200!==e.status?((t=new v.CloudPlaybackClientError(_.HarmonyErrors.CP_REQUEST_FAILED_WITH_STATUS,"PlayableItem request failed with status "+e.status)).status=e.status,Promise.reject(t)):e.body?Promise.resolve(e.body):((t=new v.CloudPlaybackClientError(_.HarmonyErrors.CP_NO_RESPONSE_BODY,"PlayableItem request returns empty body with status "+e.status)).status=e.status,Promise.reject(t))},t.prototype._deregisterFromService=function(){var e=this;if(!this._deviceId)return Promise.reject(new v.CloudPlaybackClientError(_.HarmonyErrors.CP_NO_DEVICE_ID,"Device is not configured"));this._isDeregistering=!0,this._registered=!1;var t={timestamp:Date.now()};return this._cloudPlaybackRequest("","DELETE",t).then((function(t){e._isDeregistering=!1;var r=2===t.getStatusFamily();return e._registered=!r,r}),(function(){return e._isDeregistering=!1,e._registered=!0,!1}))},t.prototype.register=function(){var e=this;return this._registered?Promise.resolve(!1):(this._registrationInfo?Promise.resolve(!0):this._descriptorPromise.then((function(t){return e._parseDescriptor(t)}))).then((function(){return e._sendConfigurationRequest()})).then((function(t){return t&&null!==e._deviceId&&(e._registered=t,e.emit("registered",{deviceId:e._deviceId})),e._registered}))},t.prototype.hasOptimisticUpdates=function(){return!0},t.prototype.skipNextPlayState=function(){var e=this;if(!this._registered)return Promise.reject(new v.CloudPlaybackClientError(_.HarmonyErrors.CP_INVALID_STATE,"Cannot skip next when the device is not registered"));if(!this._deviceId)return Promise.reject(new v.CloudPlaybackClientError(_.HarmonyErrors.CP_NO_DEVICE_ID,"Device is not configured"));var t=d.monotonicNow(),r={timestamp:Date.now(),reason:m.SkipReason.NEXTBUTTON};return this._cloudPlaybackRequest("/skip_next","POST",r).then((function(r){return e._logContentRequest("skip_next",t,r),e._handlePlayResponse(r)}))},t.prototype.skipPreviousPlayState=function(){var e=this;if(!this._registered)return Promise.reject(new v.CloudPlaybackClientError(_.HarmonyErrors.CP_INVALID_STATE,"Cannot skip previous when the device is not registered"));if(!this._deviceId)return Promise.reject(new v.CloudPlaybackClientError(_.HarmonyErrors.CP_NO_DEVICE_ID,"Device is not configured"));var t=d.monotonicNow(),r={timestamp:Date.now(),reason:m.SkipReason.PREVBUTTON};return this._cloudPlaybackRequest("/skip_previous","POST",r).then((function(r){return e._logContentRequest("skip_previous",t,r),e._handlePlayResponse(r)}))},t.prototype.getNextPlayState=function(){var e=this;if(!this._registered)return Promise.reject(new v.CloudPlaybackClientError(_.HarmonyErrors.CP_INVALID_STATE,"Cannot get next when the device is not registered"));if(!this._deviceId)return Promise.reject(new v.CloudPlaybackClientError(_.HarmonyErrors.CP_NO_DEVICE_ID,"Device is not configured"));var t=d.monotonicNow(),r="/get_next?timestamp="+Date.now();return this._currentPlayerState.playback_id&&(r=r+"&playbackId="+this._currentPlayerState.playback_id),this._cloudPlaybackRequest(r,"GET").then((function(r){return e._logContentRequest("get_next",t,r),e._handlePlayResponse(r)}))},t.prototype.stop=function(){return!!this._registered&&(this._deactivate=!0,this._clearState(),!0)},t.prototype.deregister=function(){var e=this;if(!this._registered)return Promise.resolve(!1);var t=Promise.all(this._trackingDataSenderPromises.map((function(e){return e.promise}))).then((function(e){return e.every((function(e){return e}))})).catch((function(){return!1}));return this._listPlayer.stop().catch((function(){})).then((function(){return Promise.race([t,(e=1e3,r=!1,new Promise((function(t){setTimeout((function(){return t(r)}),e)})))]);var e,r})).then((function(t){return t||R.warn("Some tracking data might not being sent."),e._deregisterFromService()}))},t}(u.EventEmitter);r.CloudPlaybackClient=b},{"../../enums/error_source":138,"../../enums/errors":139,"../../enums/hifi_status":141,"../../enums/manifest_format":143,"../../error/cloud_playback/client":146,"../../version":160,"./common":112,"./list":113,"@js-sdk/common/es5/debouncer":5,"@js-sdk/common/es5/debug_tools":9,"@js-sdk/common/es5/monotonic_now":15,"@js-sdk/common/es5/promise_resolver":16,"@js-sdk/playback/es5":102,"@spotify-internal/emitter/es5":109,"@spotify-internal/transport/es5":188,tslib:227}],112:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ErrorType=r.SkipReason=r.ReportingEvent=r.CommandType=r.RepeatMode=r.ImageMetadataSize=r.ItemMetadataContentType=void 0,function(e){e.TRACK="TRACK",e.EPISODE="EPISODE",e.MIXED="MIXED",e.AD="AD"}(r.ItemMetadataContentType||(r.ItemMetadataContentType={})),function(e){e.UNKNOWN="UNKNOWN",e.SMALL="SMALL",e.LARGE="LARGE",e.XLARGE="XLARGE"}(r.ImageMetadataSize||(r.ImageMetadataSize={})),function(e){e.OFF="OFF",e.TRACK="TRACK",e.CONTEXT="CONTEXT"}(r.RepeatMode||(r.RepeatMode={})),function(e){e.PLAY_STATE="PLAY_STATE",e.SEEK="SEEK",e.VOLUME="VOLUME",e.PAUSE="PAUSE",e.RESUME="RESUME",e.STOP="STOP",e.PLAY_STATE_CONTEXT="PLAY_STATE_CONTEXT",e.LOGOUT="LOGOUT",e.PLAYBACK_SPEED="PLAYBACK_SPEED"}(r.CommandType||(r.CommandType={})),function(e){e.PAUSE="pause",e.RESUME="resume",e.POSITION_CHANGE="position_change",e.ITEM_READY="item_ready",e.PLAY_PROGRESS="play_progress",e.PLAY_FAILURE="play_failure",e.ITEM_END="item_end",e.PLAYBACK_SPEED_CHANGE="playback_speed_change",e.ITEM_BEFORE_LOAD="item_before_load"}(r.ReportingEvent||(r.ReportingEvent={})),function(e){e.VOICE="VOICE",e.NEXTBUTTON="NEXTBUTTON",e.PREVBUTTON="PREVBUTTON"}(r.SkipReason||(r.SkipReason={})),function(e){e.UNKNOWN="UNKNOWN",e.DRM="DRM",e.MEDIA_CONTENT_TYPE="MEDIA_CONTENT_TYPE",e.DECODING="DECODING",e.PARSING="PARSING"}(r.ErrorType||(r.ErrorType={}))},{}],113:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CloudPlaybackList=r.parsePlayState=r.FLAC_BITRATE=void 0;var n=e("@js-sdk/playback/es5"),i=e("@spotify-internal/uri/es5"),o=e("../../enums/errors"),a=e("./common");r.FLAC_BITRATE=7e5;var s=/^https:\/\//;function u(e,t,o){for(var u,l,c,d,_,p=e.playable_item,f=p.playback,h=0,v=f.descriptors;h<v.length;h++){var y=v[h];"file_id"in y?c=y.file_id:(d=y.url,_=p.reporting.impression_urls);var m=e.context.current_item,E=m.content_type===a.ItemMetadataContentType.AD;if(d&&!s.test(d)&&(d=void 0),c||d){var g=void 0,R=void 0;if("audio/mp3"===y.file_format.mime_type)g=n.MediaFormat.MP3;else if("video/mp4+manifest_id"===y.file_format.mime_type)g=n.MediaFormat.MANIFEST_ID;else if('audio/mp4+file_id; codecs="flac"'===y.file_format.mime_type)g=n.MediaFormat.MP4_FLAC,R=n.AudioFileFormat.MP4_FLAC;else{if('audio/mp4+file_id; codecs="mp4a.40.2"'!==y.file_format.mime_type)continue;switch(y.file_format.key_system){case n.KeySystem.WIDEVINE:g=n.MediaFormat.MP4;break;case n.KeySystem.PLAYREADY:case n.KeySystem.PLAYREADY_HARDWARE:g=n.MediaFormat.MP4_DUAL;break;case n.KeySystem.FAIRPLAY:g=n.MediaFormat.MP4_CBCS;break;default:continue}}var T=!c&&void 0!==d,I=null!==(u=y.bitrate)&&void 0!==u?u:g===n.MediaFormat.MP4_FLAC?r.FLAC_BITRATE:128e3;if(g===n.MediaFormat.MANIFEST_ID||I<=o)return{uri:m.uri,fileId:c,resolvedURL:d,isAd:E,playable:!0,format:g,fileFormat:R,mediaType:"VIDEO"===y.media_type?"video":"audio",metadata:{duration:m.estimated_duration,descriptorId:y.id,playbackQuality:y.playback_quality},options:{position:f.start_position,paused:f.paused,useDefaultPlaybackSpeed:!i.isEpisodeURI(m.uri)},noManifest:T,logData:{format:{bitrate:I,audioQuality:y.playback_quality.audio_quality,codec:y.file_format.mime_type},noLog:!1,noTSV:E,playbackId:f.id,displayTrack:m.uri,playContext:e.context.uri,impressionURLs:_,reason:t.reason,deviceId:t.deviceId,playbackService:"cloud-playback"},audioGain:null===(l=null==y?void 0:y.loudness)||void 0===l?void 0:l.gain_factor}}}return n.ListConstants.NULL_VALUE}r.parsePlayState=u;var l=function(){function e(e){var t;this._currentPlayState=null,this._nextPlayState=null,this._currentStateIndex=null,this._pausedState=!1,this._initialPlaybackPosition=null,this._client=e.client,this._nextPlayState=null!==(t=e.initialPlayState)&&void 0!==t?t:null,this._getCurrentBandwidth=e.getCurrentBandwidth}return e._handleCloudPlaybackError=function(e,t){return(null==e?void 0:e.code)===o.HarmonyErrors.CP_INVALID_STATE?Promise.resolve(n.ListConstants.FORBIDDEN):404===(null==e?void 0:e.status)&&(null==t?void 0:t.reason)===n.Reason.TRACK_DONE?Promise.resolve(n.ListConstants.LIST_END):Promise.reject(e)},e.create=function(t){return new e(t)},e.prototype.startAt=function(){return Promise.resolve(n.OperationResult.SUCCESS)},e.prototype.setShuffle=function(){return Promise.resolve(n.OperationResult.SUCCESS)},e.prototype.setRepeatMode=function(){return Promise.resolve(n.OperationResult.SUCCESS)},e.prototype.next=function(t){var r=this;return this._getCurrentBandwidth().then((function(i){if(t.reason===n.Reason.FORWARD_BUTTON)return r._client.skipNextPlayState().then((function(e){return r._currentPlayState=e.play_state,r._nextPlayState=null,u(e.play_state,{reason:t.reason,deviceId:r._deviceId},i)})).catch(e._handleCloudPlaybackError);if(r._nextPlayState){var o=r._nextPlayState;return r._currentPlayState=o,r._nextPlayState=null,Promise.resolve(u(o,{reason:t.reason,deviceId:r._deviceId},i))}return r._client.getNextPlayState().then((function(e){return r._currentPlayState=e.play_state,r._nextPlayState=null,u(e.play_state,{reason:t.reason,deviceId:r._deviceId},i)})).catch((function(r){return e._handleCloudPlaybackError(r,t)}))}))},e.prototype.peekNext=function(t){var r=this;return this._getCurrentBandwidth().then((function(n){return r._nextPlayState?Promise.resolve(u(r._nextPlayState,{reason:t.reason,deviceId:r._deviceId},n)):r._client.getNextPlayState().then((function(e){return r._nextPlayState=e.play_state,u(e.play_state,{reason:t.reason,deviceId:r._deviceId},n)})).catch((function(r){return e._handleCloudPlaybackError(r,t)}))}))},e.prototype.previous=function(t){var r=this;return this._getCurrentBandwidth().then((function(n){return r._client.skipPreviousPlayState().then((function(e){return r._currentPlayState=e.play_state,r._nextPlayState=null,u(r._currentPlayState,{reason:t.reason,deviceId:r._deviceId},n)})).catch(e._handleCloudPlaybackError)}))},e.prototype.allowSeeking=function(){var e,t,r;return!(null===(r=null===(t=null===(e=this._currentPlayState)||void 0===e?void 0:e.context)||void 0===t?void 0:t.restrictions.seek)||void 0===r?void 0:r.length)},e.prototype.getCurrentTrack=function(){var e=this;return this._getCurrentBandwidth().then((function(t){return e._currentPlayState?u(e._currentPlayState,{reason:n.Reason.UNKNOWN,deviceId:e._deviceId},t):n.ListConstants.NULL_VALUE}))},e.prototype.getCurrentPlayState=function(){return this._currentPlayState},e.prototype.getReportingMarkers=function(){var e,t,r=null===(e=this._currentPlayState)||void 0===e?void 0:e.playable_item.reporting;return r?{checkin:r.checkin_markers,periodic:null!==(t=r.periodic_checking_interval)&&void 0!==t?t:0}:null},e.prototype.clearPreload=function(){return!!this._nextPlayState&&(this._nextPlayState=null,!0)},e.prototype.updatePlayStateContext=function(e){this._currentPlayState&&(this._currentPlayState.context=e)},e}();r.CloudPlaybackList=l},{"../../enums/errors":139,"./common":112,"@js-sdk/playback/es5":102,"@spotify-internal/uri/es5":216}],114:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CPPlaybackStateObserver=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@spotify-internal/uri/es5"),a=e("../../enums/repeat_mode"),s=e("../../enums/shuffle_mode"),u=e("../playback_state_observer"),l={timestamp:Date.now(),context:{uri:null,metadata:{}},duration:0,restrictions:{},disallows:{},track_window:{current_track:null,next_tracks:[],previous_tracks:[]},paused:!0,playback_speed:0,position:0,repeat_mode:a.RepeatMode.OFF,shuffle_mode:s.ShuffleMode.OFF,shuffle:!1,loading:!1,playback_id:null},c={pause:"disallow_pausing_reasons",resume:"disallow_resuming_reasons",seek:"disallow_seeking_reasons",skip_next:"disallow_skipping_next_reasons",skip_prev:"disallow_skipping_prev_reasons",toggle_repeat_context:"disallow_toggling_repeat_context_reasons",toggle_repeat_track:"disallow_toggling_repeat_track_reasons",toggle_shuffle:"disallow_toggling_shuffle_reasons",peek_next:"disallow_peeking_next_reasons",peek_prev:"disallow_peeking_prev_reasons"};var d=function(e){function t(t){var r=e.call(this)||this;return r._state=null,r._client=t,r._init(),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._init=function(){this._client.on("state_changed",this._onStateChanged.bind(this)),this._client.on("state_cleared",this._onStateCleared.bind(this))},t.prototype._onStateChanged=function(e){var t,r;if(null===e.data)return this._state=null,void this.emit("state_changed",{state:null});var i=null!==(t=this._state)&&void 0!==t?t:l,o={},d=i.shuffle,_=i.repeat_mode,p=i.restrictions,f=i.context,h=i.track_window,v=Date.now(),y=e.data,m=y.playState,E=y.position,g=y.paused,R=y.duration,T=y.loading,I=y.playbackQuality,S=y.playbackId,P=y.currentPlaybackSpeed,b=y.selectedPlaybackSpeed,A=y.isPlaybackSpeedRestricted;if(m){_=a.RepeatMode[m.context.options.repeat_mode],o=m.context.restrictions,d=m.context.options.shuffled,f={uri:m.context.uri,metadata:m.context.metadata?n.__assign({},m.context.metadata):{}};var L=this._parseTrack(m.context.current_item,R,null===(r=m.playable_item.playback.descriptors[0])||void 0===r?void 0:r.media_type);h=n.__assign(n.__assign({},h),{current_track:L,next_tracks:this._getTracks(m.context.next_items),previous_tracks:this._getTracks(m.context.previous_items)})}var C=g?0:P;p=u.parseRestrictions(function(e){var t={};for(var r in e)r&&(t[c[r]]=e[r]);return t}(o),g),this._state={timestamp:v,context:f,duration:R,paused:g,shuffle:d,shuffle_mode:s.getShuffleMode(d,{}),position:E,loading:T,repeat_mode:_,track_window:h,restrictions:p,disallows:u.parseDisallows(p),playback_id:S,playback_quality:I.audio_quality,playback_features:{hifi_status:I.hifi_status,playback_speed:{current:C,selected:b,restricted:A},signal_ids:[],modes:{}},playback_speed:C},this.emit("state_changed",{state:this._state})},t.prototype._onStateCleared=function(){this._state=null,this.emit("state_changed",{state:null})},t.prototype._parseTrack=function(e,t,r){var i,a,s,u=o.parseURI(e.uri),l="AUDIO"===r?"audio":"video",c=null===(i=e.images)||void 0===i?void 0:i.map((function(e){if(0===e.url.indexOf("spotify:image:")){var t=e.url.split(":").slice(-1)[0];return n.__assign(n.__assign({},e),{url:"https://i.scdn.co/image/"+t})}return e}));return{id:u?u.id:null,uri:e.uri,type:u&&u.type?u.type:"unknown",uid:e.uid,linked_from:{uri:null,id:null},media_type:l,track_type:l,name:e.name,duration_ms:t||e.estimated_duration,artists:e.artists,album:{name:null===(a=e.group)||void 0===a?void 0:a.name,uri:null===(s=e.group)||void 0===s?void 0:s.uri,images:c},is_playable:!0,metadata:{}}},t.prototype._getTracks=function(e){for(var t=[],r=0,n=e;r<n.length;r++){var i=n[r];this._parseTrack(i)&&t.push(this._parseTrack(i))}return t},t.prototype.getCurrentState=function(){var e=this._state;if(e&&!e.paused){var t=Date.now(),r=e.position+(t-e.timestamp);e.position=r,e.timestamp=t}return Promise.resolve(this._state?n.__assign({},this._state):null)},t}(i.EventEmitter);r.CPPlaybackStateObserver=d},{"../../enums/repeat_mode":144,"../../enums/shuffle_mode":145,"../playback_state_observer":126,"@spotify-internal/emitter/es5":109,"@spotify-internal/uri/es5":216,tslib:227}],115:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.PlayerAPIClient=r.targetDeviceToId=r.idToTargetDevice=r.RestrictionReasons=void 0;var i=e("tslib"),o=e("@spotify-internal/emitter/es5"),a=e("@spotify-internal/transport/es5/enums/method"),s=e("@js-sdk/common/es5/promise_resolver"),u=e("@spotify-internal/uri/es5"),l=e("../../typedefs"),c=e("../../enums/device_type"),d=e("../../enums/errors"),_=e("../../enums/disallow_transfer_reason"),p=e("../../enums/license"),f=e("../../error/connect_state/client"),h=e("../helpers/device"),v=e("../../utils/command_id"),y=/connect-state\/v1\/cluster$/,m=/^([a-zA-Z0-9_%:-]{1,40}).*$/;function E(e){var t,r,n;return!!e.track&&0===(null!==(n=null===(r=null===(t=e.restrictions)||void 0===t?void 0:t.disallow_transferring_playback_reasons)||void 0===r?void 0:r.length)&&void 0!==n?n:0)}var g;!function(e){e.NOT_PLAYING_LOCALLY="not_playing_locally",e.NOT_PLAYING_CONTEXT="not_playing_context",e.NOT_PLAYING_TRACK="not_playing_track",e.NOT_PLAYING_MEDIA="not_playing_media",e.NO_PREV_TRACK="no_prev_track",e.NO_NEXT_TRACK="no_next_track",e.NO_SPECIFIC_TRACK="no_specific_track",e.ALREADY_PAUSED="already_paused",e.NOT_PAUSED="not_paused",e.NARRATION="narration",e.PLAYER_CONTEXT_DISALLOW="context_player_disallow",e.MFT_DISALLOW="mft_disallow",e.AD_DISALLOW="ad_disallow",e.PROTOCOL_LIMITATIONS="protocol_limitations",e.UNKNOWN="unknown",e.ALREADY_PLAYING="already_playing",e.THROTTLED="throttled",e.ENDLESS_CONTEXT="endless_context"}(g=r.RestrictionReasons||(r.RestrictionReasons={}));var R=((n={})[g.AD_DISALLOW]=_.DisallowTransferReason.AD_PLAYING,n[g.NARRATION]=_.DisallowTransferReason.NARRATION,n);function T(e){if(!e)return{deviceId:null};var t=e.split("::a_"),r=t[0],n=t[1];return{deviceId:r,aliasId:n?parseInt(n,10):void 0}}r.idToTargetDevice=T,r.targetDeviceToId=function(e){return e.deviceId?e.aliasId?e.deviceId+"::a_"+e.aliasId:e.deviceId:null};var I=function(e){function t(t){var r=e.call(this)||this;return r._autoregister=!0,r._connectionId="",r._localDeviceId="",r._localObserverDeviceId=null,r._lastActiveDevice=null,r._lastKnownPlayerState=null,r._lastKnownDevices=[],r._localDevice=null,r._fetchedInitialState=!1,r._lastProcessedTimestamp=0,r._descriptor=t.descriptor,r._transport=t.transport,r._tracker=t.tracker,r._endpoint=t.endpoint||"@webgate/connect-state",r._autoregister=!("autoregister"in t)||!!t.autoregister,r._onConnectionId=r._onConnectionId.bind(r),r._onClusterMessage=r._onClusterMessage.bind(r),r._awaitResponseWithAck=r._awaitResponseWithAck.bind(r),r._transport.on(r._transport.EVENT_CONNECTION_ID,(function(e){r._onConnectionId(e.data.id)})),r._transport.matchMessages(y,r._onClusterMessage),r._descriptorPromise=Promise.resolve(r._descriptor).then((function(e){return r._localDeviceId=e.id||"",r._localObserverDeviceId=("hobs_"+r._localDeviceId).replace(m,"$1"),!0})),r}return i.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._onConnectionId=function(e){this._connectionId=e,this._autoregister&&this.register()},t.prototype._onClusterMessage=function(e){var t=e.payloads&&e.payloads[0];if(t){var r=t.ack_id;r&&this._tracker.trackCommandAcknowledged(r),this._parseCluster(t.cluster)}},t.prototype._resolveTargetDevice=function(e){var t=this;return this._descriptorPromise.then((function(){var r=t._localDeviceId,n=e;return n?n===l.LOCAL_DEVICE_ID?T(r):T(n):T(t._lastActiveDevice?t._lastActiveDevice.id:r)}))},t.prototype._makeEndpoint=function(e,t,r){var n=this;return this._descriptorPromise.then((function(){var i=n._localDeviceId;return n._endpoint+"/"+e+"/"+t+"/from/"+i+"/to/"+r}))},t.prototype._sendPlayerCommand=function(e,t,r){var n,o,s=this;void 0===t&&(t=null),void 0===r&&(r={}),r.endpoint=e;var u=(null===(n=r.logging_params)||void 0===n?void 0:n.command_id)||v.createCommandId();r.logging_params=i.__assign(i.__assign({},r.logging_params),{command_id:u});var l={command:r};return this._tracker.startTracking({commandId:u,commandType:e,interactionIds:null===(o=null==r?void 0:r.loggingParams)||void 0===o?void 0:o.interaction_ids,playOrigin:null==r?void 0:r.play_origin}),this._resolveTargetDevice(t).then((function(e){if(!e.deviceId)throw new f.PlayerAPIClientError(d.HarmonyErrors.CONNECTAPI_CLIENT_MISSING_DEVICE_ID,"Operation resulted in a null device id");!l.target_alias_id&&e.aliasId&&(l.target_alias_id=e.aliasId);var t=s._getTargetDeviceInfo(e.deviceId);return s._tracker.trackDeviceInfo(u,t),s._makeEndpoint("v1","player/command",e.deviceId)})).then((function(e){return s._sendRequest(a.Method.POST,e,l,u)})).then(this._awaitResponseWithAck.bind(this,u)).then((function(e){return s._tracker.logCommand(u),e})).catch((function(e){throw s._tracker.logCommand(u),e}))},t.prototype._sendConnectCommand=function(e,t,r){var n=this;void 0===t&&(t=null),void 0===r&&(r={});var i="volume"===e?a.Method.PUT:a.Method.POST,o="volume"===e||"logout"===e,s=(null==r?void 0:r.command_id)||v.createCommandId();return this._tracker.startTracking({commandId:s,commandType:e,interactionIds:r.interaction_id?[r.interaction_id]:void 0}),this._resolveTargetDevice(t).then((function(t){if(!t.deviceId)throw new f.PlayerAPIClientError(d.HarmonyErrors.CONNECTAPI_CLIENT_MISSING_DEVICE_ID,"Operation resulted in a null device id");t.aliasId&&(o?r.command_options={target_alias_id:t.aliasId}:r.target_alias_id||(r.target_alias_id=t.aliasId));var i=n._getTargetDeviceInfo(t.deviceId);return n._tracker.trackDeviceInfo(s,i),n._makeEndpoint("v1","connect/"+e,t.deviceId)})).then((function(e){return n._sendRequest(i,e,r,s)})).then(this._awaitResponseWithAck.bind(this,s)).then((function(e){return n._tracker.logCommand(s),e})).catch((function(e){throw n._tracker.logCommand(s),e}))},t.prototype._sendRequest=function(e,t,r,n){return this._tracker.trackRequestStart(n),this._transport.request(t,{method:e,headers:{"Content-Type":"application/json"},payload:r?JSON.stringify(r):void 0,responseType:"json",retry:{condition:function(e,t){var r=e.getStatusFamily();return r===t.SERVER_ERROR||r===t.CONNECTION_ERROR}}}).catch((function(e){return Promise.reject(e)}))},t.prototype._awaitResponseWithAck=function(e,t){var r,n;if(this._tracker.trackRequestComplete(e,t),404===t.status)return Promise.reject(new f.PlayerAPIClientError(d.HarmonyErrors.CONNECTAPI_CLIENT_NO_DEVICE,"No such device."));var i=null===(r=t.body)||void 0===r?void 0:r.ack_id;if(200===t.status&&i){if(!1!==(null===(n=this._localDevice)||void 0===n?void 0:n.hidden))return Promise.resolve(!0);var o=s.createPromiseResolver();return this._tracker.trackAcknowledgementRequired(e,i,o),o.promise}return Promise.resolve(202===t.status&&!i)},t.prototype._parseCluster=function(e){if(e){var t=parseInt(e.timestamp,10);this._lastProcessedTimestamp>t||(this._lastProcessedTimestamp=t,this._parseClusterDevices(e),this._parseClusterPlayerState(e))}},t.prototype._parseClusterDevices=function(e){var t,r,n=this._lastActiveDevice;this._lastActiveDevice=null,this._lastKnownDevices=[],this._localDevice=null;var i=[];for(var o in e.devices)e.devices.hasOwnProperty(o)&&i.push(o);if(i.sort(),i.length)for(var a=0,s=i;a<s.length;a++){o=s[a];var u=this._formatClusterDevice(e,o);(t=this._lastKnownDevices).push.apply(t,u);for(var l=0,c=u;l<c.length;l++){var d=c[l];d.is_active&&(this._lastActiveDevice=d),d.local&&(this._localDevice=d,this._deviceLicense=null===(r=e.devices[d.id])||void 0===r?void 0:r.license)}}if(!this._fetchedInitialState||!h.areDevicesEqual(this._lastActiveDevice,n)){var _=e.player_state,p=_&&E(_);this.emit("device_state_changed",{deviceState:this._lastActiveDevice,hasOrphanedState:!this._lastActiveDevice&&!!p,disappeared:!!n&&!this._lastActiveDevice})}this.emit("devices_changed",{devices:this._lastKnownDevices,localDevice:this._localDevice})},t.prototype._shouldDisallowTransfer=function(e,t){var r,n,i,o=e.player_state;if(!o)return null;var a=o.track,s=o.restrictions;if(a){var l=(null===(r=a.metadata)||void 0===r?void 0:r["media.type"])||(null===(n=a.metadata)||void 0===n?void 0:n.track_player),d=null===(i=u.parseURI(a.uri))||void 0===i?void 0:i.type;if(l&&"mixed"!==l||(l="audio"),-1===t.capabilities.supported_types.indexOf(l+"/"+d))return _.DisallowTransferReason.INCOMPATIBLE}if(s){var f=s.disallow_transferring_playback_reasons;if(null==f?void 0:f.length)for(var h=0,v=f;h<v.length;h++){var y=v[h];return R[y]?R[y]||null:_.DisallowTransferReason.UNSUPPORTED}}var m=e.active_device_id;if(!t.can_play||m===t.device_id)return _.DisallowTransferReason.UNAVAILABLE;var E=e.devices[m];return(null==E?void 0:E.license)!==p.License.TFT||t.license===p.License.TFT&&t.device_type!==c.DeviceType.SMARTPHONE?null:_.DisallowTransferReason.PREMIUM_REQUIRED},t.prototype._formatClusterDevice=function(e,t){var r=e.devices[t],n={};if(r&&Array.isArray(r.metadata))for(var o=0,a=r.metadata.length;o<a;o++){var s=r.metadata[o];n[s.type]=s.metadata}var u=r.capabilities,d=this._shouldDisallowTransfer(e,r),_={hidden:!1,id:r.device_id,client_id:r.client_id,is_active:r.device_id===e.active_device_id,is_controllable:!!u.is_controllable,is_observable:!!u.is_observable,local:r.device_id===this._localDeviceId,metadata:n,name:r.name,type:(r.device_type||c.DeviceType.UNKNOWN).toLowerCase(),brand:r.brand,model:r.model,version:r.device_software_version,volume:u.disable_volume?-1:r.volume/l.GAIA_VOLUME||0,capabilities:{supports_lossless_audio:!!u.supports_lossless_audio,supports_dj:!!u.supports_dj},is_alias:!1,is_alias_group:!1,playback_features:{hifi_status:u.supports_hifi},is_group:!!r.is_group,is_being_activated:!1,disallow_transfer_reason:d};if(!r.device_aliases)return[_];var p=[];for(var f in r.device_aliases)if(r.device_aliases.hasOwnProperty(f)){var h=r.device_aliases[f];if(h){var v=i.__assign(i.__assign({},_),{id:_.id+"::a_"+h.id,name:h.display_name,is_alias:!0,is_alias_group:r.is_group||h.is_group,is_active:_.is_active&&r.selected_alias_id===h.id,is_group:!!h.is_group});p.push(v)}}return p},t.prototype._parseClusterPlayerState=function(e){this._lastKnownPlayerState=null;var t=e.active_device_id,r=t&&e.devices[t],n=e.player_state;n&&n.track&&(r&&r.capabilities&&!r.capabilities.is_observable?n=null:(r||(n.is_paused=!0,n.restrictions&&(delete n.restrictions.disallow_resuming_reasons,n.restrictions.disallow_pausing_reasons=["already_paused"])),n.duration=parseInt(n.duration,10),n.position=parseInt(n.position,10),n.position_as_of_timestamp=parseInt(n.position_as_of_timestamp,10),n.timestamp=parseInt(n.timestamp,10),n.next_tracks=n.next_tracks||[],n.prev_tracks=n.prev_tracks||[]),this._lastKnownPlayerState=n);var i=!r&&!!this._lastKnownPlayerState;i&&n&&!E(n)&&(this._lastKnownPlayerState=null,i=!1),this.emit("player_state_changed",{playerState:this._lastKnownPlayerState,orphaned:i,isLocal:!!t&&t===this._localDeviceId})},t.prototype._register=function(){var e=this;this._fetchedInitialState=!1;var t=this._endpoint+"/v1/devices/"+this._localObserverDeviceId;return this._connectionId||Promise.reject(new f.PlayerAPIClientError(d.HarmonyErrors.CONNECTAPI_CLIENT_NO_CONNECTION_ID,"Cannot register: no connection id.")),this._transport.request(t,{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json","X-Spotify-Connection-Id":this._connectionId},payload:JSON.stringify({member_type:"CONNECT_STATE",device:{device_info:{capabilities:{can_be_player:!1,hidden:!0,needs_full_player_state:!0}}}}),responseType:"json"}).then((function(t){429===t.status?e.emit("max_subscriptions_reached",{error:new f.PlayerAPIClientError(d.HarmonyErrors.CONNECTAPI_MAX_SUBSCRIPTIONS_REACHED,"Max connections reached")}):200===t.status&&(e.emit("registered",null),t.body&&(e._parseCluster(t.body),e._fetchedInitialState=!0)),429!==t.status&&408!==t.status||(e._lastKnownDevices=e._lastKnownDevices.map((function(e){return e.is_being_activated=!1,e})),e._localDevice&&(e._localDevice.is_being_activated=!1),e.emit("devices_changed",{devices:e._lastKnownDevices,localDevice:e._localDevice}))}))},t.prototype._getTargetDeviceInfo=function(e){for(var t=null,r=0,n=this._lastKnownDevices;r<n.length;r++){var i=n[r];if(i.id===e){t=i;break}}return t},t.prototype.register=function(){return this._connectionId?this._descriptorPromise.then(this._register.bind(this)):Promise.reject(new f.PlayerAPIClientError(d.HarmonyErrors.CONNECTAPI_CLIENT_NO_CONNECTION_ID,"Cannot register: no connection id."))},t.prototype.deregister=function(){var e=this,t=this._endpoint+"/v1/devices/"+this._localObserverDeviceId;return this._transport.request(t,{method:"DELETE",responseType:"json"}).then((function(t){200===t.status&&e.emit("deregistered",null)}))},t.prototype.getDevices=function(){var e=this;return this._fetchedInitialState?Promise.resolve({devices:this._lastKnownDevices,localDevice:this._localDevice}):new Promise((function(t){e.once("device_state_changed",(function(){t({devices:e._lastKnownDevices,localDevice:e._localDevice})}))}))},t.prototype.getActiveDevice=function(){var e=this;return this._fetchedInitialState?Promise.resolve(this._lastActiveDevice):new Promise((function(t){e.once("device_state_changed",(function(e){t(e.data.deviceState)}))}))},t.prototype.getDeviceLicense=function(){return this._deviceLicense||null},t.prototype.getContextPlayerState=function(){var e=this;return this._fetchedInitialState?Promise.resolve(this._lastKnownPlayerState):new Promise((function(t){e.once("player_state_changed",(function(e){t(e.data.playerState)}))}))},t.prototype.play=function(e,t){return void 0===t&&(t=null),e?this._sendPlayerCommand("play",t,e):Promise.reject(new f.PlayerAPIClientError(d.HarmonyErrors.CONNECTAPI_CLIENT_INVALID_ARGUMENTS,"Descriptor is required for play commands"))},t.prototype.updateCurrentContext=function(e,t){var r=this;return void 0===e&&(e=null),this.getContextPlayerState().then((function(n){return n?n.session_id?n.context_url||t.forceNonUpdateable?r._sendPlayerCommand("update_context",e,{context:{url:t.contextURI?"context://"+t.contextURI:n.context_url||"context://"+n.context_uri},session_id:n.session_id}):Promise.resolve(!1):Promise.reject(new f.PlayerAPIClientError(d.HarmonyErrors.CONNECTAPI_CLIENT_NO_SESSION_ID,"The current state does not have a session id")):Promise.reject(new f.PlayerAPIClientError(d.HarmonyErrors.CONNECTAPI_CLIENT_NO_STATE,"Nothing playing"))}))},t.prototype.setQueue=function(e,t){return this._sendPlayerCommand("set_queue",t,e)},t.prototype.addToQueue=function(e,t){return this._sendPlayerCommand("add_to_queue",t,{track:e})},t.prototype.transfer=function(e,t){var r,n;void 0===t&&(t={}),this._lastKnownDevices=this._lastKnownDevices.map((function(t){return t.is_being_activated=t.id===e,t})),this._localDevice&&(this._localDevice.is_being_activated=e===l.LOCAL_DEVICE_ID),this.emit("devices_changed",{devices:this._lastKnownDevices,localDevice:this._localDevice});var i={restore_paused:"restore"};return"paused"in t&&(i.restore_paused=t.paused?"pause":"resume"),this._sendConnectCommand("transfer",e||l.LOCAL_DEVICE_ID,{transfer_options:i,interaction_id:null===(r=t.logging_params)||void 0===r?void 0:r.interaction_ids[0],command_id:null===(n=t.logging_params)||void 0===n?void 0:n.command_id})},t.prototype.pause=function(e,t){return this._sendPlayerCommand("pause",e,t)},t.prototype.resume=function(e,t){return this._sendPlayerCommand("resume",e,t)},t.prototype.togglePlay=function(e,t){var r=this;return this.getContextPlayerState().then((function(n){return n?n.is_paused?r.resume(e,t):r.pause(e,t):Promise.reject(new f.PlayerAPIClientError(d.HarmonyErrors.CONNECTAPI_CLIENT_NO_STATE,"Nothing playing"))}))},t.prototype.nextTrack=function(e,t){return this._sendPlayerCommand("skip_next",e,t)},t.prototype.previousTrack=function(e,t){return this._sendPlayerCommand("skip_prev",e,t)},t.prototype.seek=function(e,t){return isNaN(e)||e<0?Promise.reject(new f.PlayerAPIClientError(d.HarmonyErrors.CONNECTAPI_CLIENT_INVALID_POSITION,"Invalid position.")):this._sendPlayerCommand("seek_to",t,{value:e})},t.prototype.setShuffle=function(e,t,r){return this._sendPlayerCommand("set_shuffling_context",t,i.__assign({value:!!e},r))},t.prototype.toggleShuffle=function(e,t){var r=this;return this.getContextPlayerState().then((function(n){if(!n)return Promise.reject(new f.PlayerAPIClientError(d.HarmonyErrors.CONNECTAPI_CLIENT_NO_STATE,"Nothing playing"));var i=n.options&&n.options.shuffling_context;return r.setShuffle(!i,e,t)}))},t.prototype.setRepeatingContext=function(e,t){return this._sendPlayerCommand("set_repeating_context",t,{value:e})},t.prototype.setRepeatingTrack=function(e,t){return this._sendPlayerCommand("set_repeating_track",t,{value:!!e})},t.prototype.setOptions=function(e,t,r){return this._sendPlayerCommand("set_options",t,i.__assign(i.__assign({},e),r))},t.prototype.setVolume=function(e,t){if(isNaN(e)||e<0)return Promise.reject(new f.PlayerAPIClientError(d.HarmonyErrors.CONNECTAPI_CLIENT_INVALID_VOLUME,"Invalid volume."));var r=Math.round(e*l.GAIA_VOLUME);return this._sendConnectCommand("volume",t,{volume:r})},t.prototype.logout=function(e){return this._sendConnectCommand("logout",e)},t.prototype.sendCustomSignal=function(e,t){return this._sendPlayerCommand("signal",e,t)},t.prototype.playAsNextInQueue=function(e,t,r){return this._sendPlayerCommand("play_as_next_in_queue",t,i.__assign({tracks:e},r))},t}(o.EventEmitter);r.PlayerAPIClient=I},{"../../enums/device_type":136,"../../enums/disallow_transfer_reason":137,"../../enums/errors":139,"../../enums/license":142,"../../error/connect_state/client":147,"../../typedefs":154,"../../utils/command_id":156,"../helpers/device":121,"@js-sdk/common/es5/promise_resolver":16,"@spotify-internal/emitter/es5":109,"@spotify-internal/transport/es5/enums/method":173,"@spotify-internal/uri/es5":216,tslib:227}],116:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CommandTracker=r.CommandResult=void 0;var n,i=e("@js-sdk/common/es5/monotonic_now"),o=e("@spotify-internal/transport/es5/enums/status_family"),a=e("@js-sdk/common/es5/promise_resolver"),s=e("../../enums/errors"),u=e("../../error/connect_state/client");!function(e){e.SUCCESS="success",e.ACK_TIMEOUT="ack_timeout",e.HTTP_ERROR="http_error",e.SYSTEM_ERROR="system_error",e.PLAYER_ERROR="player_error",e.UNKNOWN_ERROR="unknown_error"}(n=r.CommandResult||(r.CommandResult={}));var l=function(){function e(e){this._commandDataMap={},this._orphanedAcknowledgements={},this._logger=e}return e.prototype.startTracking=function(e){var t=e.commandId,r=e.commandType,n=e.interactionIds,i=e.playOrigin;t&&(this._commandDataMap[t]={commandType:r,ackId:null,interactionIds:(n||[]).join(","),playOrigin:i?JSON.stringify(i):void 0,timings:{request:{start:null,end:null},acknowledgement:{start:null,end:null}}})},e.prototype.trackDeviceInfo=function(e,t){var r=this._commandDataMap[e];r&&t&&(r.deviceInfo={id:t.id,client_id:t.client_id,target_device_brand:t.brand,target_device_model:t.model})},e.prototype.trackRequestStart=function(e){var t=this._commandDataMap[e];if(t){var r=i.monotonicNow();t.timings.request.start=r,t.timings.acknowledgement.start=r}},e.prototype.trackRequestComplete=function(e,t){var r=this._commandDataMap[e];r&&(r.response=t,r.timings.request.end=i.monotonicNow())},e.prototype.trackAcknowledgementRequired=function(e,t,r){var n=this._commandDataMap[e],i=this._orphanedAcknowledgements[t];if(n)if(n.ackId=t,i)n.timings.acknowledgement.end=i.ackTimeMs,i.deferredPromise.resolve(!0),delete this._orphanedAcknowledgements[t];else{var o=setTimeout((function(){r.reject(new u.PlayerAPIClientError(s.HarmonyErrors.CONNECTAPI_CLIENT_ACK_TIMEOUT,"Command didn't receive an acknowledgement within 30000ms"))}),3e4);r.promise.then((function(e){return clearTimeout(o),e})),n.deferredPromise=r}},e.prototype.trackCommandAcknowledged=function(e){var t=this,r=i.monotonicNow();for(var n in this._commandDataMap)if(this._commandDataMap.hasOwnProperty(n)){var o=this._commandDataMap[n];if(o&&o.ackId===e)return o.deferredPromise&&o.deferredPromise.resolve(!0),void(o.timings.acknowledgement.end=r)}this._waitingOnCommands()&&(this._orphanedAcknowledgements[e]={deferredPromise:a.createPromiseResolver(),ackTimeMs:r},setTimeout((function(){t._orphanedAcknowledgements[e]&&delete t._orphanedAcknowledgements[e]}),6e4))},e.prototype.logCommand=function(e){var t,r=this,n=this._commandDataMap[e];if(!n)return Promise.resolve();var i=this._finalizeData(n),o=this._calculateTimings(n.timings),a=o.msAckDuration,s=o.msRequestLatency,u={command_id:e,command_type:n.commandType,ms_ack_duration:null!=a?a:null,ms_request_latency:s,interaction_ids:n.interactionIds,play_origin:n.playOrigin,result:i,http_response:n.httpResponse,http_status_code:null===(t=n.response)||void 0===t?void 0:t.status};n.deviceInfo&&(u.target_device_id=n.deviceInfo.id,u.target_device_brand=n.deviceInfo.target_device_brand,u.target_device_model=n.deviceInfo.target_device_model,u.target_device_client_id=n.deviceInfo.client_id);var l=function(){delete r._commandDataMap[e]};return this._logger.logJSSDKConnectCommand(u).then(l,l)},e.prototype._finalizeData=function(e){if(!e.response)return n.UNKNOWN_ERROR;var t=e.response.status,r=e.response.getStatusFamily();return 403===t?(e.response.body&&(e.httpResponse=JSON.stringify(e.response.body)),n.PLAYER_ERROR):200===t&&e.ackId&&null===e.timings.acknowledgement.end?n.ACK_TIMEOUT:r===o.StatusFamily.SUCCESS?n.SUCCESS:r===o.StatusFamily.CONNECTION_ERROR?n.SYSTEM_ERROR:t?(e.response.body&&(e.httpResponse=JSON.stringify(e.response.body)),n.HTTP_ERROR):n.UNKNOWN_ERROR},e.prototype._calculateTimings=function(e){var t={};return e.request.start&&e.request.end&&(t.msRequestLatency=i.monotonicDuration(e.request.start,e.request.end)),e.acknowledgement.start&&e.acknowledgement.end&&(t.msAckDuration=i.monotonicDuration(e.acknowledgement.start,e.acknowledgement.end)),t},e.prototype._waitingOnCommands=function(){var e=!1;for(var t in this._commandDataMap)if(this._commandDataMap.hasOwnProperty(t)){var r=this._commandDataMap[t];if(r&&!r.response){e=!0;break}}return e},e}();r.CommandTracker=l},{"../../enums/errors":139,"../../error/connect_state/client":147,"@js-sdk/common/es5/monotonic_now":15,"@js-sdk/common/es5/promise_resolver":16,"@spotify-internal/transport/es5/enums/status_family":176}],117:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HarmonyController=void 0;var n=e("tslib"),i=e("@spotify-internal/uri/es5"),o=e("@spotify-internal/emitter/es5"),a=e("@js-sdk/common/es5/debug_tools"),s=e("@js-sdk/common/es5/monotonic_now"),u=e("@js-sdk/playback/es5"),l=e("../enums/hifi_status"),c=e("../enums/repeat_mode"),d=e("../enums/shuffle_mode"),_=e("../enums/errors"),p=e("../enums/device_deactivated_reason"),f=e("../error/connect_state/client"),h=e("../error/track_playback/client"),v=e("./metadata_decorator"),y=e("./player_queue"),m=e("../utils/command_id"),E=e("./playback_state_observer"),g=a.logging.forTag("harmony.controller"),R={disallow_pausing_reasons:!0,disallow_peeking_next_reasons:!0,disallow_peeking_prev_reasons:!0,disallow_resuming_reasons:!0,disallow_seeking_reasons:!0,disallow_skipping_next_reasons:!0,disallow_skipping_prev_reasons:!0,disallow_toggling_repeat_context_reasons:!0,disallow_toggling_repeat_track_reasons:!0,disallow_toggling_shuffle_reasons:!0,disallow_transferring_playback_reasons:!0,disallow_setting_playback_speed_reasons:!0,disallow_setting_modes:!0,disallow_signals:!0,disallow_add_to_queue_reasons:!0,disallow_set_queue_reasons:!0,disallow_updating_context_reasons:!0,disallow_removing_from_context_tracks_reasons:!0,disallow_removing_from_next_tracks_reasons:!0,disallow_reordering_in_context_tracks_reasons:!0,disallow_reordering_in_next_tracks_reasons:!0,disallow_inserting_into_context_tracks_reasons:!0,disallow_inserting_into_next_tracks_reasons:!0,disallow_remote_control_reasons:!0},T={unknown:u.PlaybackQuality.UNKNOWN,default:u.PlaybackQuality.DEFAULT,low:u.PlaybackQuality.LOW,normal:u.PlaybackQuality.NORMAL,normalized:u.PlaybackQuality.NORMAL,high:u.PlaybackQuality.HIGH,veryhigh:u.PlaybackQuality.VERY_HIGH,hifi:u.PlaybackQuality.HIFI},I={on:l.HiFiStatus.ON,off:l.HiFiStatus.OFF,none:l.HiFiStatus.NONE};function S(e,t){if(!e)return[];for(var r=[],n=[i.URITypeMap.TRACK,i.URITypeMap.EPISODE],o=0,a=e.length;o<a;o++){var s=e[o];if(!s)throw new TypeError("Null value inside track array.");var u=void 0;if("string"==typeof s?(u=i.parseURI(s),s={uri:s}):u=i.parseURI(s.uri),!/^spotify:(meta:|delimiter)/.test(s.uri)){if(!u)throw new TypeError("Invalid uri string: "+u);if(-1===n.indexOf(u.type))throw new TypeError("Invalid track uri: "+s.uri)}s.metadata||(s.metadata={}),t&&t.queued&&(s.metadata.is_queued="true"),r.push(s)}return r}function P(e){if(e){if(/^.+:\/\//.test(e))return e;throw new TypeError("Invalid page url: "+e)}}var b=function(e){function t(t){var r=e.call(this)||this;return r._suppressed=!1,r._lastDeviceInfoData=null,r._state=null,r._lastPlayerState=null,r._isOrphanedState=!1,r._progressPosition=0,r._lastProgressMonotonicTime=s.monotonicNow(),r._trackingIntervalId=0,r._queue=null,r._client=t.client,r._serverTime=t.serverTime,r._version=t.version,r._playerClient=t.playerClient,r._disableProgress=!!t.disableProgress,r._transport=r._client.getPublicTransport(),r._decorate=!!t.decorateTrackWindow,r._metadataDecorator=new v.MetadataDecorator({transport:r._transport}),r._onClientBeforeDisconnect=r._onClientBeforeDisconnect.bind(r),r._onDeviceStateChanged=r._onDeviceStateChanged.bind(r),r._onPlayerStateChanged=r._onPlayerStateChanged.bind(r),r._onProgressTracking=r._onProgressTracking.bind(r),r._client.on("before_disconnect",r._onClientBeforeDisconnect),r.proxyEmit(r._playerClient,"max_subscriptions_reached","max_subscriptions_reached"),r.proxyEmit(r._playerClient,"devices_changed","devices_changed"),r.proxyEmit(r._playerClient,"registered","registered"),r.proxyEmit(r._playerClient,"deregistered","deregistered"),r._playerClient.on("device_state_changed",r._onDeviceStateChanged),r._playerClient.on("player_state_changed",r._onPlayerStateChanged),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._onClientBeforeDisconnect=function(e){e&&e.data.awaitPromise(this._playerClient.deregister().catch((function(){})))},t.prototype._onDeviceStateChanged=function(e){var t,r,n=this,i=e.data,o=i.deviceState,a=i.hasOrphanedState,s=!!(null===(r=null===(t=this._lastDeviceInfoData)||void 0===t?void 0:t.deviceInfo)||void 0===r?void 0:r.local);this._lastDeviceInfoData={deviceInfo:o,hasOrphanedState:a},s&&!(null==o?void 0:o.local)&&this._playerClient.getDevices().then((function(e){var t=e.localDevice,r=p.DeviceDeactivatedReason.STOPPED;a?t||(r=p.DeviceDeactivatedReason.LOCAL_PLAYER_DISABLED):r=p.DeviceDeactivatedReason.REMOTE_ACTIVATED,n.emit("device_deactivated",{reason:r})})).catch((function(e){g.warn("Device deactivation checking failed.",e)})),this._suppressed||this.emit("device_info_changed",this._lastDeviceInfoData)},t.prototype._startProgressTracking=function(){this._stopProgressTracking(),this._lastProgressMonotonicTime=s.monotonicNow(),this._onProgressTracking(),this._trackingIntervalId=setInterval(this._onProgressTracking,500)},t.prototype._stopProgressTracking=function(){this._trackingIntervalId&&(clearInterval(this._trackingIntervalId),this._trackingIntervalId=0)},t.prototype._onProgressTracking=function(){var e,t=s.monotonicNow(),r=(null===(e=this._lastPlayerState)||void 0===e?void 0:e.playback_speed)||1;this._progressPosition+=r*(t-this._lastProgressMonotonicTime),this.emit("progress",{position:this._progressPosition,timestamp:Date.now()}),this._lastProgressMonotonicTime=t},t.prototype._generatePlayOptions=function(e,t){var r,n={license:null!==(r=this._playerClient.getDeviceLicense())&&void 0!==r?r:""};if(!e)return n;if(("index"in e||"trackUID"in e||"trackURI"in e||"pageIndex"in e)&&(n.skip_to={track_uid:e.trackUID,track_index:e.index,track_uri:e.trackURI,page_index:e.pageIndex}),"initialOffset"in e&&(n.seek_to=e.initialOffset),"paused"in e&&(n.initially_paused=e.paused),"alwaysPlaySomething"in e&&(n.always_play_something=e.alwaysPlaySomething),t)return n;n.player_options_override={};var i=n.player_options_override;if("shuffle"in e&&(i.shuffling_context=e.shuffle),"repeatMode"in e)switch(e.repeatMode){case c.RepeatMode.CONTEXT:i.repeating_context=!0,i.repeating_track=!1;break;case c.RepeatMode.TRACK:i.repeating_track=!0,i.repeating_context=!1;break;case c.RepeatMode.OFF:i.repeating_track=!1,i.repeating_context=!1}return n},t.prototype._setFilterAndSort=function(e,t){t&&t.filter&&e.metadata&&(e.metadata["filtering.predicate"]=t.filter),t&&t.sort&&e.metadata&&(e.metadata["sorting.criteria"]=t.sort)},t.prototype._setMetadataOptions=function(e,t){if(t){var r=e.metadata||{};"autoplayCandidate"in t&&(r.autoplay_candidate=t.autoplayCandidate?"true":"false"),e.metadata=r}},t.prototype._generatePlayOrigin=function(e){if((null==e?void 0:e.featureClasses)&&!Array.isArray(e.featureClasses))throw new TypeError("PlayOptions playOrigin.featureClasses must be an array of strings.");return{feature_identifier:(null==e?void 0:e.featureIdentifier)||"harmony",feature_version:(null==e?void 0:e.featureVersion)||this._version,feature_classes:null==e?void 0:e.featureClasses,view_uri:null==e?void 0:e.viewURI,external_referrer:null==e?void 0:e.externalReferrer,referrer_identifier:null==e?void 0:e.referrerIdentifier,restriction_identifier:null==e?void 0:e.restrictionIdentifier}},t.prototype._generateLoggingParams=function(e){void 0===e&&(e={});var t=e.pageInstanceId,r=e.interactionId,n=e.commandId;try{return Promise.resolve({page_instance_ids:t?[t]:[],interaction_ids:r?[r]:[],command_id:m.getOrCreateCommandId(n)})}catch(e){return Promise.reject(e)}},t.prototype._parseRestrictions=function(e){var t={};for(var r in e.restrictions)e.restrictions.hasOwnProperty(r)&&R[r]?t[r]=e.restrictions[r]:R[r]&&(t[r]=[]);return t},t.prototype._onPlayerStateChanged=function(e){var t=this;this._isOrphanedState=e.data.orphaned,this._parsePlayerState(e.data.playerState).then((function(r){t._state=r,t._suppressed||t.emit("state_changed",{state:r?n.__assign({},r):null,orphaned:e.data.orphaned}),!t._disableProgress&&r&&(t._progressPosition=r.position,r.paused?t._stopProgressTracking():t._startProgressTracking())}))},t.prototype._isUsingPlayerService=function(e){var t,r,n,i=null===(r=null===(t=this._lastDeviceInfoData)||void 0===t?void 0:t.deviceInfo)||void 0===r?void 0:r.version,o=/\/(cloud|track)-playback$/.test(i||""),a=2===(null===(n=null==e?void 0:e.context_metadata)||void 0===n?void 0:n["player.arch"]);return o&&a},t.prototype._parsePlayerState=function(e){var t=this;return this._lastPlayerState=e,e?this._getTrackWindow(e).then((function(r){var o,a,s,l,c,_,p,f,h,v,y,m,g=!!(null===(o=e.options)||void 0===o?void 0:o.playback_speed)||!1;if(!g){var R=i.isEpisodeURI(e.track.uri)?"not_supported_by_device":"not_supported_by_content_type";e.restrictions=n.__assign({disallow_setting_playback_speed_reasons:[R]},e.restrictions)}var S=t._parseRestrictions(e),P=E.parseDisallows(S);return{context:{uri:e.context_uri||null,metadata:e.context_metadata||{}},timestamp:e.timestamp,duration:e.duration||r.current_track&&"uri"in r.current_track&&r.current_track.duration_ms||0,position:e.is_paused?e.position_as_of_timestamp:t._offsetPosition(e.timestamp,e.position_as_of_timestamp,e.playback_speed),playback_id:t._isUsingPlayerService(e)?null:e.playback_id,playback_quality:null!==(l=T[null!==(s=null===(a=e.playback_quality)||void 0===a?void 0:a.bitrate_level)&&void 0!==s?s:"unknown"])&&void 0!==l?l:u.PlaybackQuality.UNKNOWN,playback_features:{hifi_status:I[null!==(_=null===(c=e.playback_quality)||void 0===c?void 0:c.hifi_status)&&void 0!==_?_:"none"],playback_speed:{current:e.playback_speed,selected:null!==(f=null===(p=e.options)||void 0===p?void 0:p.playback_speed)&&void 0!==f?f:1,restricted:!g||!!(null==P?void 0:P.setting_playback_speed)},signal_ids:e.signals||[],modes:e.modes||{}},paused:!!e.is_paused,shuffle:!(!e.options||!e.options.shuffling_context),shuffle_mode:d.getShuffleMode(null===(h=e.options)||void 0===h?void 0:h.shuffling_context,null===(v=e.options)||void 0===v?void 0:v.modes),repeat_mode:t._getStateRepeatMode(e),restrictions:S,disallows:P,track_window:r,loading:null!==(m=null===(y=t._state)||void 0===y?void 0:y.loading)&&void 0!==m&&m,playback_speed:e.playback_speed}})):Promise.resolve(null)},t.prototype._offsetPosition=function(e,t,r,n){void 0===r&&(r=1);var i=t+((n||this._serverTime.getApproximate())-e)*r;return i<0?0:i},t.prototype._isRestricted=function(e,t){if(!e||!e.restrictions)return!1;var r="disallow_"+t+"_reasons";return!!(e.restrictions[r]||[]).length},t.prototype._getTrackWindow=function(e){var t,r,n={current_track:null,next_tracks:[],previous_tracks:[]},o={},a=[];if(!e.track)return Promise.resolve(n);var s=e.track.uri;if(!s)return Promise.resolve(n);var u=i.parseURI(s),l=this._metadataDecorator,c=l.formatLocalTrack(u,e.track.uid),d=l.formatAd(u,e.track),_=l.formatDJNarration(u,e.track),p=l.formatGenericTrack(u,e.track);n.current_track=c||d||_||p,n.current_track.metadata=e.track.metadata||{},c||d||_||(o[s]=1,a.push(s)),this._isRestricted(e,"peeking_next")||this._fillWindow(a,n.next_tracks,o,e.next_tracks?e.next_tracks.slice(0,5):[]),this._isRestricted(e,"peeking_prev")||this._fillWindow(a,n.previous_tracks,o,e.prev_tracks?e.prev_tracks.slice(-5):[],!0);var f="true"===(null===(t=e.track.metadata)||void 0===t?void 0:t.is_audiobook_chapter)||"true"===(null===(r=e.track.metadata)||void 0===r?void 0:r.is_audiobook)?"chapter":"unknown";return this._decorate?this._metadataDecorator.decorateTrackWindow(n,a,{contentType:f}):Promise.resolve(n)},t.prototype._fillWindow=function(e,t,r,o,a){a&&o.reverse();for(var s=0,u=o;s<u.length;s++){var l=u[s],c=l.metadata,d=l.uri,_=l.uid;if("true"!==(null==c?void 0:c.hidden_in_queue)){var p=i.parseURI(d);if(d&&"spotify:delimiter"!==d&&(!p||p.type!==i.URITypeMap.AD&&p.type!==i.URITypeMap.INTERRUPTION)){var f=this._metadataDecorator.formatLocalTrack(p,_),h=f||{uri:d,uid:_,type:"unknown"};if(f||d in r||(r[d]=1,e.push(d)),a?t.unshift(n.__assign(n.__assign({},h),{metadata:c})):t.push(n.__assign(n.__assign({},h),{metadata:c})),2===t.length)break}}}},t.prototype._getStateRepeatMode=function(e){var t=e.options;return t&&t.repeating_track?c.RepeatMode.TRACK:t&&t.repeating_context?c.RepeatMode.CONTEXT:c.RepeatMode.OFF},t.prototype._play=function(e,t,r){var n=this;return this._setFilterAndSort(e,r),this._setMetadataOptions(e,r),Promise.all([this._generatePlayOptions(r),this._generateLoggingParams(null==r?void 0:r.loggingParams)]).then((function(i){var o=i[0],a=i[1],s={context:e,play_origin:n._generatePlayOrigin(r&&r.playOrigin),options:o,logging_params:a};return n._playerClient.play(s,t)}))},t.prototype.getActiveDevice=function(){return this._playerClient.getActiveDevice()},t.prototype.getCurrentState=function(e){var t;if(e&&this._isOrphanedState)return Promise.resolve(null);var r=this._state;if(r&&!r.paused){var i=this._serverTime.getApproximate();r.position=this._offsetPosition(r.timestamp,r.position,null===(t=this._lastPlayerState)||void 0===t?void 0:t.playback_speed,i),r.timestamp=i}return Promise.resolve(r?n.__assign({},r):null)},t.prototype.getContextPlayerState=function(){return g.warn("The `getContextPlayerState()` method is not well supported. Please avoid using it directly."),this._playerClient.getContextPlayerState()},t.prototype.getDevices=function(){return this._playerClient.getDevices()},t.prototype.playURI=function(e,t,r){if(!i.parseURI(e))return Promise.reject(new TypeError("Invalid Spotify URI"));var n={uri:e,url:"context://"+e,metadata:r&&r.contextMetadata||{}};return this._play(n,t,r)},t.prototype.playPages=function(e,t,r){var n,i;if(!Array.isArray(e))return Promise.reject(new TypeError("Invalid pages array."));try{i=function(e){for(var t,r,n,i=[],o=0,a=e;o<a.length;o++){var s=a[o];i.push({tracks:Array.isArray(s.tracks)?S(s.tracks):void 0,page_url:null!==(t=P(s.pageURL))&&void 0!==t?t:void 0,next_page_url:null!==(r=P(s.nextPageURL))&&void 0!==r?r:void 0,metadata:null!==(n=s.metadata)&&void 0!==n?n:void 0})}return i}(e)}catch(e){return Promise.reject(e)}var o={uri:null!==(n=null==r?void 0:r.contextURI)&&void 0!==n?n:"spotify:internal:harmony-play-pages",metadata:(null==r?void 0:r.contextMetadata)||{},pages:i};return this._play(o,t,r)},t.prototype.playTracks=function(e,t,r){var n,i;if(!Array.isArray(e))return Promise.reject(new TypeError("Invalid tracks array."));try{i=S(e)}catch(e){return Promise.reject(e)}var o={uri:null!==(n=null==r?void 0:r.contextURI)&&void 0!==n?n:"spotify:internal:harmony-play-tracks",metadata:(null==r?void 0:r.contextMetadata)||{},pages:[{tracks:i}]};return this._play(o,t,r)},t.prototype.updateCurrentContext=function(e,t){return void 0===t&&(t={}),this._playerClient.updateCurrentContext(e,t)},t.prototype.setQueue=function(e,t,r){if(!Array.isArray(e))return Promise.reject(new TypeError("Invalid nextTracks array."));if(!Array.isArray(t))return Promise.reject(new TypeError("Invalid previousTracks array."));var n,i;try{n=S(e),i=S(t)}catch(e){return Promise.reject(e)}var o={next_tracks:n.length?n:void 0,prev_tracks:i.length?i:void 0};return this._playerClient.setQueue(o,r)},t.prototype.transfer=function(e,t){var r=this;return void 0===t&&(t={}),this._generateLoggingParams(null==t?void 0:t.loggingParams).then((function(i){var o=n.__assign(n.__assign({},t),{logging_params:i});return r._playerClient.transfer(e,o)}))},t.prototype.pause=function(e,t){var r=this;return this._generateLoggingParams(null==t?void 0:t.loggingParams).then((function(t){var n={logging_params:t};return r._playerClient.pause(e,n)}))},t.prototype.resume=function(e,t){var r=this;return this._generateLoggingParams(null==t?void 0:t.loggingParams).then((function(t){var n={logging_params:t};return r._playerClient.resume(e,n)}))},t.prototype.togglePlay=function(e,t){var r=this;return this._generateLoggingParams(null==t?void 0:t.loggingParams).then((function(t){var n={logging_params:t};return r._playerClient.togglePlay(e,n)}))},t.prototype.nextTrack=function(e,t){var r=this;return this._generateLoggingParams(null==t?void 0:t.loggingParams).then((function(n){var i={logging_params:n};return(null==t?void 0:t.track)&&(i.track=y.createContextTracks([t.track])[0]),r._playerClient.nextTrack(e,i)}))},t.prototype.previousTrack=function(e,t){var r=this;return this._generateLoggingParams(null==t?void 0:t.loggingParams).then((function(n){var i={logging_params:n};return(null==t?void 0:t.track)&&(i.track=y.createContextTracks([t.track])[0]),r._playerClient.previousTrack(e,i)}))},t.prototype.seek=function(e,t){return this._playerClient.seek(e,t)},t.prototype.setShuffle=function(e,t,r){var n=this;return this._generateLoggingParams(null==r?void 0:r.loggingParams).then((function(r){var i={logging_params:r};return n._playerClient.setShuffle(e,t,i)}))},t.prototype.toggleShuffle=function(e,t){var r=this;return this._generateLoggingParams(null==t?void 0:t.loggingParams).then((function(t){var n={logging_params:t};return r._playerClient.toggleShuffle(e,n)}))},t.prototype.setVolume=function(e,t){return this._playerClient.setVolume(e,t)},t.prototype.logout=function(e){return this._playerClient.logout(e)},t.prototype.setRepeatMode=function(e,t){var r=this;return this.getCurrentState().then((function(n){if(!n)return Promise.reject(new f.PlayerAPIClientError(_.HarmonyErrors.CONNECTAPI_CLIENT_NO_STATE,"Nothing playing"));var i=r._playerClient,o=n.disallows;switch(e){case c.RepeatMode.OFF:return(!o.toggling_repeat_context||!o.toggling_repeat_track)&&i.setOptions({repeating_context:!!o.toggling_repeat_context&&void 0,repeating_track:!!o.toggling_repeat_track&&void 0},t);case c.RepeatMode.CONTEXT:return!o.toggling_repeat_context&&i.setOptions({repeating_context:!0,repeating_track:!!o.toggling_repeat_track&&void 0},t);case c.RepeatMode.TRACK:return!o.toggling_repeat_track&&i.setOptions({repeating_context:!o.toggling_repeat_context||void 0,repeating_track:!0},t);default:return Promise.reject(new TypeError("Unknown repeat mode."))}}))},t.prototype.setPlaybackSpeed=function(e,t){var r=this;return this.getCurrentState().then((function(n){return n?r._playerClient.setOptions({playback_speed:e},t):Promise.reject(new f.PlayerAPIClientError(_.HarmonyErrors.CONNECTAPI_CLIENT_NO_STATE,"Nothing playing"))}))},t.prototype.register=function(){return this._playerClient.register()},t.prototype.suppressEvents=function(){this._suppressed=!0},t.prototype.unsuppressEvents=function(){this._suppressed=!1,this._lastDeviceInfoData&&this.emit("device_info_changed",this._lastDeviceInfoData),this._state&&this.emit("state_changed",{state:this._state})},t.prototype.getQueueManager=function(e,t){if(void 0===t&&(t={}),!this._queue){var r=t.reportInitial?this._lastPlayerState:null;this._queue=new y.QueueManager(n.__assign({connectClient:this._playerClient,initialContextPlayerState:r,runner:e},t))}return this._queue},t.prototype.sendCustomSignal=function(e,t,r){var n=this;return this._generateLoggingParams(null==r?void 0:r.loggingParams).then((function(i){return n._playerClient.sendCustomSignal(t,{parameters:null==r?void 0:r.parameters,logging_params:i,signal_id:e})}))},t.prototype.playAsNextInQueue=function(e,t,r){var n=this;return this._generateLoggingParams(null==r?void 0:r.loggingParams).then((function(r){var i={logging_params:r},o=S(e);return n._playerClient.playAsNextInQueue(o,t,i)}))},t.prototype._setContextURIOptions=function(e,t){var r=this;return this._client.getDeviceDescriptor().then((function(i){var o=e.split("?")[0],a=i.toTrackPlaybackDeviceInfo(),s="http://@webgate/track-playback/v1/devices/"+a.device_id+"/context/"+encodeURIComponent(o)+"/player_options",u={player_options:t,device_info:n.__assign(n.__assign({},a),{client_version:r._client.getSDKId()})};return r._transport.request(s,{authorize:!0,method:"POST",headers:{"Content-Type":"application/json"},responseType:"json",payload:JSON.stringify(u)}).then((function(e){if(200!==e.status){var t=new h.TrackPlayerAPIClientError(_.HarmonyErrors.TP_SET_OPTIONS_FAILED_WITH_STATUS,"Track-Playback service responded with "+e.status);return t.status=e.status,Promise.reject(t)}return!0})).catch((function(e){return Promise.reject(e)}))}))},t.prototype._setOptions=function(e,t,r){var n=this;return Promise.all([this._generateLoggingParams(null==r?void 0:r.loggingParams),this.getCurrentState()]).then((function(o){var a=o[0],s=o[1],u={logging_params:a};if(null==r?void 0:r.contextURI){if(!i.parseURI(r.contextURI))return Promise.reject(new TypeError("contextURI is not a valid URI"));if(!((null==s?void 0:s.context.uri)&&i.isSameIdentity(s.context.uri,r.contextURI)))return n._setContextURIOptions(r.contextURI,e)}return s?n._playerClient.setOptions(e,t,u):Promise.reject(new f.PlayerAPIClientError(_.HarmonyErrors.CONNECTAPI_CLIENT_NO_STATE,"Nothing playing"))}))},t.prototype.setModes=function(e,t,r){return this._setOptions({modes:e},t,r)},t.prototype.setShuffleMode=function(e,t,r){var n=this;return this.getCurrentState().then((function(i){var o,a,s=(null==i?void 0:i.disallows)||{},u={};if(null==r?void 0:r.contextURI)return u={shuffling_context:!!e,modes:{context_enhancement:e===d.ShuffleMode.SMART?"RECOMMENDATION":"NONE"}},n._setOptions(u,t,r);if(s.toggling_shuffle)return Promise.reject(new f.PlayerAPIClientError(_.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Shuffle mode cannot be modified."));if(e===d.ShuffleMode.SMART){if(null===(a=null===(o=s.setting_modes)||void 0===o?void 0:o.context_enhancement)||void 0===a?void 0:a.RECOMMENDATION)return Promise.reject(new f.PlayerAPIClientError(_.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Setting shuffle mode to SMART is not allowed."));u={shuffling_context:!0,modes:{context_enhancement:"RECOMMENDATION"}}}else u={shuffling_context:!!e,modes:{context_enhancement:"NONE"}};return n._setOptions(u,t,r)}))},t}(o.EventEmitter);r.HarmonyController=b},{"../enums/device_deactivated_reason":135,"../enums/errors":139,"../enums/hifi_status":141,"../enums/repeat_mode":144,"../enums/shuffle_mode":145,"../error/connect_state/client":147,"../error/track_playback/client":150,"../utils/command_id":156,"./metadata_decorator":125,"./playback_state_observer":126,"./player_queue":127,"@js-sdk/common/es5/debug_tools":9,"@js-sdk/common/es5/monotonic_now":15,"@js-sdk/playback/es5":102,"@spotify-internal/emitter/es5":109,"@spotify-internal/uri/es5":216,tslib:227}],118:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeviceDescriptor=void 0;var n=e("tslib"),i=e("@js-sdk/common/es5/user_agent/interpolate_ua"),o=e("@spotify-internal/emitter/es5"),a=e("../enums/device_type"),s=e("../enums/manifest_format"),u=e("../utils/device_id"),l=e("./helpers/capitalize"),c=function(e){function t(t){var r,n=e.call(this)||this;if(n._platformVersion="",n._metadata={},n._manifestPrependOffset=0,!t)throw new TypeError("Invalid argument `options`.");if(!t.id)throw new TypeError("Argument `options.id` is required.");if(!t.name||!t.model||!t.type)throw new TypeError("Incomplete `options` value.");return n._id=t.id,n._type=t.type,n._brand=t.brand,n._model=t.model,n._isGroup=!!t.is_group,n._name=t.name,n._platformName=t.platform_name,n._platformIdentifier=t.platform_identifier,n._platformVersion=t.platform_version||"",n._metadata=t.metadata||{},n._capabilities=t.capabilities||{manifest_formats:[]},n._manifestPrependOffset=(null===(r=n._capabilities.manifest_formats)||void 0===r?void 0:r.length)||0,n}return n.__extends(t,e),t.create=function(e){return new t({id:u.DeviceId.get(e.id,e.randomizeId),model:e.model||i.interpolateUA("harmony-{{name}}.{{version}}-{{platform}}").toLowerCase(),name:e.nameTemplate?i.interpolateUA(e.nameTemplate):e.name||l.capitalize(i.interpolateUA("Spotify ({{name}}/{{platform}})")),type:e.type||a.DeviceType.COMPUTER,brand:e.brand||"SpotifyHarmonyGeneric",platform_name:e.platform_name,platform_identifier:e.platform_identifier,platform_version:e.platform_version,metadata:e.metadata||{},capabilities:e.capabilities||{},is_group:!!e.is_group})},t.prototype.getId=function(){return this._id},t.prototype.setCapability=function(e,t){switch(e){case"manifest_formats":throw new TypeError('Cannot change capability "manifest_formats"');default:return this._capabilities[e]=t,this.emit("descriptor_changed",{descriptor:this.toJSON()}),!0}},t.prototype.getCapability=function(e){switch(e){case"manifest_formats":throw new TypeError("Use `descriptor.getManifestFormats()`.");default:return this._capabilities[e]}},t.prototype.setName=function(e){return this._name=e,this.emit("descriptor_changed",{descriptor:this.toJSON()}),!0},t.prototype.getName=function(){return this._name},t.prototype.getType=function(){return this._type},t.prototype.getBrand=function(){return this._brand},t.prototype.getModel=function(){return this._model},t.prototype.getPlatformIdentifier=function(){return this._platformIdentifier||"Partner "+this._brand+" "+this._model},t.prototype.getPlatformName=function(){return this._platformName||this.getPlatformIdentifier()},t.prototype.getPlatformVersion=function(){return this._platformVersion},t.prototype.getManifestFormats=function(){return this._capabilities.manifest_formats||[]},t.prototype.appendManifestFormat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this._capabilities.manifest_formats;Array.isArray(r)&&r.push.apply(r,e)},t.prototype.prependManifestFormat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this._capabilities.manifest_formats;Array.isArray(r)&&r.splice.apply(r,n.__spreadArray([this._manifestPrependOffset,0],e))},t.prototype.supportsVideoManifestFormats=function(){var e=this._capabilities.manifest_formats;return-1!==(null==e?void 0:e.indexOf(s.ManifestFormat.MANIFEST_IDS_VIDEO))},t.prototype.toJSON=function(){return{brand:this._brand,capabilities:n.__assign({},this._capabilities),id:this._id,metadata:n.__assign({},this._metadata),model:this._model,name:this._name,platform_name:this._platformName,platform_identifier:this._platformIdentifier,platform_version:this._platformVersion,type:this._type}},t.prototype.toTrackPlaybackDeviceInfo=function(){return{brand:this._brand,capabilities:n.__assign({},this._capabilities),device_id:this._id,device_type:this._type,metadata:n.__assign({},this._metadata),model:this._model,name:this._name,platform_name:this._platformName,platform_identifier:this._platformIdentifier,is_group:this._isGroup}},t}(o.EventEmitter);r.DeviceDescriptor=c},{"../enums/device_type":136,"../enums/manifest_format":143,"../utils/device_id":158,"./helpers/capitalize":120,"@js-sdk/common/es5/user_agent/interpolate_ua":18,"@spotify-internal/emitter/es5":109,tslib:227}],119:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Harmony=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@js-sdk/playback/es5/enums/reason"),a=e("@js-sdk/common/es5/promise_resolver"),s=e("@js-sdk/common/es5/throttle"),u=e("../typedefs"),l=e("../enums/harmony_event"),c=e("../enums/errors"),d=e("../enums/error_source"),_=e("../enums/repeat_mode"),p=e("../enums/disallow_transfer_reason"),f=e("../error/harmony_error"),h=e("./helpers/device"),v=e("./player_queue"),y=e("../version"),m=function(e){function t(t){var r=e.call(this)||this;return r._hasFakeState=!1,r._localPlayerEnabled=!1,r._localPlayback=!1,r._forceRemoteActions=!1,r._lastDeviceList=[],r._deferredStreamer=a.createPromiseResolver(),r._throttledSeek=s.throttle(100,r._seek,r),r._client=t.client,r._streamer=t.streamer,r._controller=t.controller,r._hidden=!!t.hidden,r._onlyLocalState=!!t.onlyLocalState,r._preferController=!r._onlyLocalState&&!!t.preferControllerState,r._claimInactivePlayerStates=!!t.claimInactivePlayerStates,r._enableControllerWithoutStreamer=!!t.enableControllerWithoutStreamer,r._autoActivateElement=!!t.autoActivateElement,r._deactivateOnStop=!!t.experimentalDeactivateOnStop,r._forceRemoteActions=!!t.forceRemoteActions,r._parseDeviceList=r._parseDeviceList.bind(r),r._init(),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._init=function(){var e,t=this;this._createStreamerDeferred();var r=this._client;r.on("error",this._onError.bind(this)),this.proxyEmit(r,"authenticated",l.HarmonyEvent.AUTHENTICATED),this.proxyEmit(r,"authentication_error",l.HarmonyEvent.AUTHENTICATION_ERROR),this.proxyEmit(r,"before_disconnect",l.HarmonyEvent.BEFORE_DISCONNECT),this.proxyEmit(r,"connected",l.HarmonyEvent.CONNECTED),this.proxyEmit(r,"connection_error",l.HarmonyEvent.CONNECTION_ERROR),this.proxyEmit(r,"descriptor_changed",l.HarmonyEvent.DEVICE_DESCRIPTOR_CHANGED),this.proxyEmit(r,"product_state_changed",l.HarmonyEvent.PRODUCT_STATE_CHANGED),this.proxyEmit(r,"reconnected",l.HarmonyEvent.RECONNECTED),this.proxyEmit(r,"reconnecting",l.HarmonyEvent.RECONNECTING),this.proxyEmit(r,"unrecoverable_failure",l.HarmonyEvent.UNRECOVERABLE_FAILURE),this.proxyEmit(r,"logged_out",l.HarmonyEvent.LOGGED_OUT);var n=this._controller;n.on("device_info_changed",(function(e){t._onDeviceStateChanged(e.data)})),n.on("devices_changed",this._onDevicesChanged.bind(this)),n.on("state_changed",this._onPlayerStateChanged.bind(this)),n.on("progress",this._onControllerProgress.bind(this)),this.proxyEmitAll(n,((e={}).max_subscriptions_reached=l.HarmonyEvent.MAX_SUBSCRIPTIONS_REACHED,e.device_deactivated=l.HarmonyEvent.DEVICE_DEACTIVATED,e)),n.on("registered",this.emit.bind(this,l.HarmonyEvent.REMOTE_OBSERVER_ENABLED,null)),n.on("deregistered",this.emit.bind(this,l.HarmonyEvent.REMOTE_OBSERVER_DISABLED,null));var i=this._streamer;i?(i.on("deregistered",this._onStreamerDeregistered.bind(this)),i.on("registered",this._onStreamerRegistered.bind(this)),i.on("registration_aborted",this._onStreamerRegistrationAborted.bind(this)),i.on("state_changed",this._onStreamerStateChanged.bind(this)),i.on("stopped_on_background",this._onStreamerStoppedOnBackground.bind(this)),i.on("streamer_seek_handled",this._onSeekHandled.bind(this)),this.proxyEmitSync(i,"before_volume_change",l.HarmonyEvent.BEFORE_VOLUME_CHANGE),this.proxyEmit(i,"autoplay_failed",l.HarmonyEvent.AUTOPLAY_FAILED),this.proxyEmit(i,"stalled",l.HarmonyEvent.BUFFER_STALLED),this.proxyEmit(i,"buffering_end",l.HarmonyEvent.BUFFERING_END),this.proxyEmit(i,"buffering_start",l.HarmonyEvent.BUFFERING_START),this.proxyEmit(i,"rebuffering_end",l.HarmonyEvent.REBUFFERING_END),this.proxyEmit(i,"rebuffering_start",l.HarmonyEvent.REBUFFERING_START),this.proxyEmit(i,"duration_changed",l.HarmonyEvent.DURATION_CHANGED),this.proxyEmit(i,"max_list_errors_reached",l.HarmonyEvent.MAX_LIST_ERRORS_REACHED),this.proxyEmit(i,"max_subscriptions_reached",l.HarmonyEvent.MAX_SUBSCRIPTIONS_REACHED),this.proxyEmit(i,"playback_capped",l.HarmonyEvent.PLAYBACK_CAPPED),this.proxyEmit(i,"player_initialization_done",l.HarmonyEvent.PLAYER_INITIALIZATION_DONE),this.proxyEmit(i,"player_initialization_failed",l.HarmonyEvent.PLAYER_INITIALIZATION_FAILED),this.proxyEmit(i,"progress",l.HarmonyEvent.PROGRESS),this.proxyEmit(i,"registration_error",l.HarmonyEvent.SERVICE_REGISTRATION_ERROR),this.proxyEmit(i,"track_ended",l.HarmonyEvent.TRACK_ENDED),this.proxyEmit(i,"video_element_appended",l.HarmonyEvent.VIDEO_ELEMENT_APPENDED),this.proxyEmit(i,"video_element_removed",l.HarmonyEvent.VIDEO_ELEMENT_REMOVED),this.proxyEmit(i,"volume_changed",l.HarmonyEvent.VOLUME_CHANGED),this.proxyEmit(i,"displayed_cues_changed",l.HarmonyEvent.DISPLAYED_CUES_CHANGED),this.proxyEmit(i,"subtitle_languages_loaded",l.HarmonyEvent.SUBTITLE_LANGUAGES_LOADED),this.proxyEmit(i,"speed_changed",l.HarmonyEvent.SPEED_CHANGED),this.proxyEmit(i,"playing_profile_changed",l.HarmonyEvent.PLAYING_PROFILE_CHANGED),this.proxyEmitSync(i,"reporting_start",l.HarmonyEvent.REPORTING_START),this.proxyEmitSync(i,"reporting_first_quartile",l.HarmonyEvent.REPORTING_FIRST_QUARTILE),this.proxyEmitSync(i,"reporting_midpoint",l.HarmonyEvent.REPORTING_MIDPOINT),this.proxyEmitSync(i,"reporting_third_quartile",l.HarmonyEvent.REPORTING_THIRD_QUARTILE),this.proxyEmitSync(i,"reporting_complete",l.HarmonyEvent.REPORTING_COMPLETE),this.proxyEmitSync(i,"reporting_pause",l.HarmonyEvent.REPORTING_PAUSE),this.proxyEmitSync(i,"reporting_resume",l.HarmonyEvent.REPORTING_RESUME),this.proxyEmitSync(i,"reporting_creative_view",l.HarmonyEvent.REPORTING_CREATIVE_VIEW),this.proxyEmitSync(i,"reporting_error",l.HarmonyEvent.REPORTING_ERROR),this.proxyEmitSync(i,"internal_endcontent","internal_endcontent"),i.on("context_ended",this.emit.bind(this,l.HarmonyEvent.LOCAL_CONTEXT_ENDED,null)),i.on("logged_out",this.emit.bind(this,l.HarmonyEvent.LOCAL_PLAYER_LOGGED_OUT,null))):(this._disableLocalTarget(),this.on(l.HarmonyEvent.AUTHENTICATED,(function(){t.emit(l.HarmonyEvent.LOCAL_PLAYER_DISABLED,null)})))},t.prototype._createStreamerDeferred=function(){this._deferredStreamer=a.createPromiseResolver(),this._deferredStreamer.promise.catch((function(){}))},t.prototype._isTargetIdLocal=function(e){return e?e===u.LOCAL_DEVICE_ID?Promise.resolve(!0):this._client.getDeviceDescriptor().then((function(t){return e===t.getId()})):Promise.resolve(!!this._localPlayback)},t.prototype._onStreamerRegistered=function(e){this._deferredStreamer.resolve(e.data),this._createStreamerDeferred(),this._deferredStreamer.resolve(e.data),this._localPlayerEnabled=!0,this._controller.register(),this.emit(l.HarmonyEvent.LOCAL_PLAYER_ENABLED,null)},t.prototype._onStreamerDeregistered=function(){this._disableLocalTarget(),this.emit(l.HarmonyEvent.LOCAL_PLAYER_DISABLED,null)},t.prototype._onStreamerRegistrationAborted=function(){this._disableLocalTarget(),this._enableControllerWithoutStreamer&&this._controller.register(),this.emit(l.HarmonyEvent.LOCAL_PLAYER_DISABLED,null)},t.prototype._disableLocalTarget=function(){this._localPlayerEnabled=!1;var e=new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"Cannot perform command; local player is disabled.");this._deferredStreamer.reject(e),this._createStreamerDeferred(),this._deferredStreamer.reject(e)},t.prototype._onStreamerConnect=function(){return this._deferredStreamer.promise},t.prototype._onDeviceStateChanged=function(e){var t,r=this,n=!!this._localPlayback,i=function(e){void 0===e&&(e=!1),r._generateLocalDeviceInfo(e).then((function(e){r.emit(l.HarmonyEvent.LAST_ACTIVE_DEVICE_INFO_CHANGED,{deviceInfo:e,hasOrphanedState:!1})}))};if(this._localPlayerEnabled&&e.hasOrphanedState&&this._claimInactivePlayerStates)return this._hasFakeState=!0,void i(!0);if(this._hasFakeState=!1,this._localPlayback=!(!e.deviceInfo||!e.deviceInfo.local),this._localPlayback){if(!n&&(null===(t=this._streamer)||void 0===t?void 0:t.hasOptimisticUpdates())&&this._streamer.getCurrentState().then((function(e){r.emit(l.HarmonyEvent.STATE_CHANGED,{state:e})})),!this._streamer)throw new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled.");this._streamer.getVolume().then((function(t){e.deviceInfo&&(e.deviceInfo.volume=t),r.emit(l.HarmonyEvent.LAST_ACTIVE_DEVICE_INFO_CHANGED,e)})).catch((function(){}))}else this._onlyLocalState?(this._localPlayback||n)&&i():this.emit(l.HarmonyEvent.LAST_ACTIVE_DEVICE_INFO_CHANGED,e)},t.prototype._onDevicesChanged=function(e){var t=this;this._parseDeviceList(e.data).then((function(e){h.areDeviceListsEqual(t._lastDeviceList,e)||(t._lastDeviceList=e,t.emit(l.HarmonyEvent.DEVICES_CHANGED,{devices:e,localDevice:null}))}))},t.prototype._onError=function(e){var t=e.data.error;e.data.source===d.HarmonyErrorSource.PLAYBACK&&t&&t.unrecoverable&&(this._disableLocalTarget(),this._streamer&&this._streamer.deregister()),this.emit(l.HarmonyEvent.ERROR,e.data)},t.prototype._onPlayerStateChanged=function(e){if(!this._onlyLocalState&&(this._preferController||!this._localPlayback)){var t=void 0;t=this._localPlayerEnabled&&this._claimInactivePlayerStates?e.data.state:e.data.orphaned?null:e.data.state,this.emit(l.HarmonyEvent.STATE_CHANGED,{state:t})}},t.prototype._onControllerProgress=function(e){this._onlyLocalState||this._localPlayback||this.emit(l.HarmonyEvent.PROGRESS,e.data)},t.prototype._onStreamerStateChanged=function(e){this._preferController||(this._onlyLocalState?this._triggerLocalStateChanges(e.data):this._hidden?this._handleHidden(e.data):this._localPlayback&&this.emit(l.HarmonyEvent.STATE_CHANGED,e.data))},t.prototype._onStreamerStoppedOnBackground=function(){this._deactivateOnStop&&(this._localPlayback=!1),this.emit(l.HarmonyEvent.STOPPED_ON_BACKGROUND,null)},t.prototype._handleHidden=function(e){e.state?(this._controller.suppressEvents(),this._triggerLocalStateChanges(e)):this._controller.unsuppressEvents()},t.prototype._parseDeviceList=function(e){var t=e.devices.slice(0).map((function(e){return Promise.resolve(e)}));return t.length&&e.localDevice?this._hasFakeState&&e.localDevice&&(e.localDevice.is_active=!0):t.push(this._generateLocalDeviceInfo(this._hasFakeState)),Promise.all(t).then((function(e){return e}))},t.prototype._triggerLocalStateChanges=function(e){var t=this;this._generateLocalDeviceInfo().then((function(e){t._onDeviceStateChanged({deviceInfo:e,hasOrphanedState:!1})})),this.emit(l.HarmonyEvent.STATE_CHANGED,e)},t.prototype._canStartNewContext=function(e){var t=this;return this._runOnDevice(e,(function(){return t._streamer?Promise.resolve(!0):Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled."))}),(function(){return Promise.resolve(!0)}),{bypassFakeState:!0})},t.prototype._activateElement=function(){this._autoActivateElement=!1,this._streamer&&this._streamer.activateElement().catch((function(){}))},t.prototype._runOnDevice=function(e,t,r,n){var i,o=this;return void 0===e&&(e=void 0),this._hasFakeState&&!(null==n?void 0:n.bypassFakeState)?(this._autoActivateElement&&this._activateElement(),this._claimStateAndRun(r,n)):(null!==(i=null==n?void 0:n.forceRemoteAction)&&void 0!==i?i:this._forceRemoteActions)?r():this._isTargetIdLocal(e).then((function(e){return e?o._onStreamerConnect().then(t):r()}))},t.prototype._claimStateAndRun=function(e,t){var r=this;return this._onStreamerConnect().then((function(){r._hasFakeState=!1;var e={paused:!0};return(null==t?void 0:t.loggingParams)&&(e.loggingParams=t.loggingParams),Promise.all([r._controller.transfer(u.LOCAL_DEVICE_ID,e),new Promise((function(e,t){r._streamer?r._streamer.once("track_loaded",e):t(new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled."))}))])})).then((function(){return e()}))},t.prototype._generateLocalDeviceInfo=function(e){var t=this;void 0===e&&(e=!1);var r=this._client,n=this._streamer,i=Promise.resolve(!1),o=Promise.resolve(-1);return this._localPlayerEnabled&&(e?i=Promise.resolve(!0):n&&(i=n.getCurrentState().then((function(e){return!!e}))),n&&(o=n.getVolume())),Promise.all([r.getClientDescriptor(),r.getSDKId(),i,o]).then((function(e){var r,n=e[0],i=e[1],o=e[2],a=e[3],s={hifi_status:{fully_supported:void 0,user_eligible:void 0,device_supported:null===(r=n.capabilities)||void 0===r?void 0:r.lossless_playback}};return{hidden:t._hidden,id:n.id,is_active:o,is_group:!1,is_being_activated:!1,is_controllable:t._localPlayerEnabled,is_observable:!!t._localPlayerEnabled&&!t._hidden,local:!0,metadata:n.metadata||{},name:n.name,type:n.type,brand:n.brand,model:n.model,version:i,volume:a,capabilities:{supports_lossless_audio:!1},playback_features:s,has_inactive_player_state:t._hasFakeState,disallow_transfer_reason:p.DisallowTransferReason.UNAVAILABLE}}))},t.prototype._movePosition=function(e,t){var r=this;return this.getCurrentState().then((function(n){if(!n||isNaN(n.position))return Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Seeking not allowed with invalid track."));var i=e,o=Math.min(n.duration,Math.max(0,n.position+i));return r.seek(o,t)}))},t.prototype._prepareSkipTrack=function(e){return"string"==typeof e?v.queueTrackFromQid(e):e},t.prototype._cycleRepeatMode=function(e){var t=this;return this.getCurrentState().then((function(r){if(!r)return Promise.reject(new f.HarmonyError(c.HarmonyErrors.CONNECTAPI_CLIENT_NO_STATE,"Nothing playing"));var n=null,i=r.disallows;switch(r.repeat_mode){case _.RepeatMode.OFF:if(i.toggling_repeat_context){if(i.toggling_repeat_track)return Promise.resolve(!1);n=_.RepeatMode.TRACK}else n=_.RepeatMode.CONTEXT;break;case _.RepeatMode.CONTEXT:n=i.toggling_repeat_track?_.RepeatMode.OFF:_.RepeatMode.TRACK;break;case _.RepeatMode.TRACK:n=_.RepeatMode.OFF;break;default:n=_.RepeatMode.OFF}return t.setRepeatMode(n,e)}))},t.prototype._onSeekHandled=function(e){this._controller.seek(e.data.position)},t.prototype._seek=function(e,t){var r=this;return this.getCurrentState().then((function(n){return(null==n?void 0:n.disallows.seeking)?Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Seeking is not allowed with current content.")):(r._client.getLogger().logClientEvent({source:"harmony.seek()",source_version:y.default.tagged,source_vendor:"spotify",event:"Harmony/Client seek",event_version:"1.0.0",json_data:{position:e,deviceId:t}},"object"),r._runOnDevice(t,(function(){return r._streamer.seek(e)}),r._controller.seek.bind(r._controller,e,t)))}))},t.prototype.getClientDescriptor=function(){return this._client.getClientDescriptor()},t.prototype.getProductState=function(){return this._client.getProductState()},t.prototype.getPublicTransport=function(){return this._client.getPublicTransport()},t.prototype.getUserInfo=function(){return this._client.getUserInfo()},t.prototype.getVersionDescriptor=function(){return this._client.getVersionDescriptor()},t.prototype.logAppMetrics=function(e,t){return this._client.logAppMetrics(e,t)},t.prototype.setName=function(e){return this._client.setName(e)},t.prototype.setNameTemplate=function(e){return this._client.setNameTemplate(e)},t.prototype.getContextPlayerState=function(){return this._controller.getContextPlayerState()},t.prototype.updateCurrentContext=function(e,t){return this._controller.updateCurrentContext(e,t)},t.prototype.getLastActiveDevice=function(){var e=this;return this._onlyLocalState||this._hasFakeState?this._generateLocalDeviceInfo(this._hasFakeState):this._controller.getActiveDevice().then((function(t){return(null==t?void 0:t.local)&&e._streamer?(t.hidden=e._hidden,e._streamer.getVolume().then((function(e){return t.volume=e,t}))):t}))},t.prototype.getCurrentState=function(){var e=this;if(!this._onlyLocalState&&(this._preferController||!this._localPlayback)){var t=!this._localPlayerEnabled||!this._claimInactivePlayerStates;return this._controller.getCurrentState(t).then((function(t){return!e._preferController&&e._localPlayback?e.getCurrentState():t}))}return this._onStreamerConnect().then(this._streamer.getCurrentState.bind(this._streamer))},t.prototype.pause=function(e,t){var r=this;return this._runOnDevice(e,(function(){return r._streamer.pause()}),this._controller.pause.bind(this._controller,e,t),{loggingParams:null==t?void 0:t.loggingParams,forceRemoteAction:null==t?void 0:t.forceRemoteAction})},t.prototype.resume=function(e,t){var r=this;return this._runOnDevice(e,(function(){return r._streamer.resume()}),this._controller.resume.bind(this._controller,e,t),{loggingParams:null==t?void 0:t.loggingParams,forceRemoteAction:null==t?void 0:t.forceRemoteAction})},t.prototype.togglePlay=function(e,t){var r=this;return this._runOnDevice(e,(function(){return r._streamer.togglePlay()}),this._controller.togglePlay.bind(this._controller,e,t),{loggingParams:null==t?void 0:t.loggingParams,forceRemoteAction:null==t?void 0:t.forceRemoteAction})},t.prototype.playURI=function(e,t,r){var n=this;return this._canStartNewContext(t).then((function(){return n._autoActivateElement&&n._activateElement(),n._controller.playURI(e,t,r)}))},t.prototype.playPages=function(e,t,r){var n=this;return this._canStartNewContext(t).then((function(){return n._autoActivateElement&&n._activateElement(),n._controller.playPages(e,t,r)}))},t.prototype.playTracks=function(e,t,r){var n=this;return this._canStartNewContext(t).then((function(){return n._autoActivateElement&&n._activateElement(),n._controller.playTracks(e,t,r)}))},t.prototype.nextTrack=function(e,t){var r=this;return this.getCurrentState().then((function(n){if(null==n?void 0:n.disallows.skipping_next)return Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Skipping is not allowed with current content."));var i={},a=function(){return r._streamer.nextTrack(o.Reason.FORWARD_BUTTON)},s=r._controller.nextTrack.bind(r._controller,e,i);return(null==t?void 0:t.track)&&(a=s,i.track=r._prepareSkipTrack(t.track)),(null==t?void 0:t.loggingParams)&&(i.loggingParams=t.loggingParams),r._runOnDevice(e,a,s,{loggingParams:null==t?void 0:t.loggingParams,forceRemoteAction:null==t?void 0:t.forceRemoteAction})}))},t.prototype.smartPreviousTrack=function(e,t){var r=this;return this.getCurrentState().then((function(n){return n?(n.disallows||{}).seeking||n.position<3e3?n.disallows.skipping_prev?Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Skipping is not allowed with current content.")):r.previousTrack(e,t):r.seek(0,e):Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_NO_TRACKS_LOADED,"No current state."))}))},t.prototype.previousTrack=function(e,t){var r=this;return this.getCurrentState().then((function(n){if(null==n?void 0:n.disallows.skipping_prev)return Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Skipping is not allowed with current content."));var i={},a=function(){return r._streamer.previousTrack(o.Reason.FORWARD_BUTTON)},s=r._controller.previousTrack.bind(r._controller,e,i);return(null==t?void 0:t.track)&&(a=s,i.track=r._prepareSkipTrack(t.track)),(null==t?void 0:t.loggingParams)&&(i.loggingParams=t.loggingParams),r._runOnDevice(e,a,s,{loggingParams:null==t?void 0:t.loggingParams,forceRemoteAction:null==t?void 0:t.forceRemoteAction})}))},t.prototype.seek=function(e,t){var r;return null!==(r=this._throttledSeek(e,t))&&void 0!==r?r:Promise.resolve(!0)},t.prototype.seekForward=function(e,t){return void 0===e&&(e=15e3),this._movePosition(e,t)},t.prototype.seekBackward=function(e,t){return void 0===e&&(e=15e3),this._movePosition(-1*e,t)},t.prototype.getVolume=function(){return this._streamer?this._streamer.getVolume():Promise.resolve(-1)},t.prototype.setVolume=function(e,t){var r=this;return this._runOnDevice(t,(function(){return r._streamer.setVolume(e)}),this._controller.setVolume.bind(this._controller,e),{bypassFakeState:!0})},t.prototype.getVideoProfiles=function(){if(!this._streamer)throw new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled.");return this._streamer.getVideoVariants()},t.prototype.setPreferredBitrate=function(e){if(!this._streamer)throw new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled.");return this._streamer.setPreferredBitrate(e)},t.prototype.getDevices=function(){var e=this;return this._controller.getDevices().then(this._parseDeviceList).then((function(t){return e._lastDeviceList=t,t}))},t.prototype.setQueue=function(e,t,r){var n=this;console.warn("Harmony.setQueue is deprecated; migrate to new PlayerQueue API");var i=function(){return n._controller.setQueue(e,t,r)};return this._runOnDevice(r,i,i)},t.prototype.addToQueue=function(e,t){var r=e.map((function(e){return"string"==typeof e?e:e.uri}));return this._controller.getQueueManager().addToQueue(r,t)},t.prototype.setShuffle=function(e,t,r){var n=this,i=function(){return n._controller.setShuffle(e,t,r)};return this._runOnDevice(t,i,i,{loggingParams:null==r?void 0:r.loggingParams,forceRemoteAction:null==r?void 0:r.forceRemoteAction})},t.prototype.toggleShuffle=function(e,t){var r=this,n=function(){return r._controller.toggleShuffle(e,t)};return this._runOnDevice(e,n,n,{loggingParams:null==t?void 0:t.loggingParams,forceRemoteAction:null==t?void 0:t.forceRemoteAction})},t.prototype.setRepeatMode=function(e,t){var r=this,n=function(){return r._controller.setRepeatMode(e,t)};return this._runOnDevice(t,n,n)},t.prototype.cycleRepeatMode=function(e){var t=this,r=function(){return t._cycleRepeatMode(e)};return this._runOnDevice(e,r,r)},t.prototype.transfer=function(e,t){var r=this,n=e||u.LOCAL_DEVICE_ID,i=function(){return r._controller.transfer(n,t)};return this._autoActivateElement&&this._activateElement(),this._runOnDevice(n,i,i,{bypassFakeState:!0,loggingParams:null==t?void 0:t.loggingParams,forceRemoteAction:null==t?void 0:t.forceRemoteAction})},t.prototype.logout=function(e){return this._controller.logout(e||u.LOCAL_DEVICE_ID)},t.prototype.activateElement=function(){return this._streamer?this._streamer.activateElement():Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled."))},t.prototype.getQueueManager=function(){var e=this;return this._controller.getQueueManager((function(t,r){return e._runOnDevice(r,t,t)}),{reportInactiveQueues:this._claimInactivePlayerStates,onlyLocalQueue:this._onlyLocalState,reportInitial:this._hasFakeState||this._localPlayback})},t.prototype.hideSubtitles=function(){if(!this._localPlayback)return Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot hide subtitles on remote player."));var e=this._streamer;return e?this.getCurrentState().then((function(t){var r;return"video"!==(null===(r=null==t?void 0:t.track_window.current_track)||void 0===r?void 0:r.media_type)?Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_INVALID_MEDIA_TYPE,"Content type does not allow subtitles.")):e.hideSubtitles()})):Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled."))},t.prototype.showSubtitles=function(){if(!this._localPlayback)return Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot show subtitles on remote player."));var e=this._streamer;return e?this.getCurrentState().then((function(t){var r;return"video"!==(null===(r=null==t?void 0:t.track_window.current_track)||void 0===r?void 0:r.media_type)?Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_INVALID_MEDIA_TYPE,"Content type does not allow subtitles.")):e.showSubtitles()})):Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled."))},t.prototype.areSubtitlesShown=function(){if(!this._localPlayback)return Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot show subtitles on remote player."));var e=this._streamer;return e?this.getCurrentState().then((function(t){var r;return"video"!==(null===(r=null==t?void 0:t.track_window.current_track)||void 0===r?void 0:r.media_type)?Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_INVALID_MEDIA_TYPE,"Content type does not allow subtitles.")):e.areSubtitlesShown()})):Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled."))},t.prototype.getSubtitleLanguages=function(){if(!this._localPlayback)return Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot get subtitle languages on remote player."));var e=this._streamer;return e?this.getCurrentState().then((function(t){var r;return"video"!==(null===(r=null==t?void 0:t.track_window.current_track)||void 0===r?void 0:r.media_type)?Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_INVALID_MEDIA_TYPE,"Content type does not allow subtitles.")):e.getSubtitleLanguages()})):Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled."))},t.prototype.getActiveSubtitleLanguage=function(){if(!this._localPlayback)return Promise.resolve(null);var e=this._streamer;return e?this.getCurrentState().then((function(t){var r;return"video"!==(null===(r=null==t?void 0:t.track_window.current_track)||void 0===r?void 0:r.media_type)?Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_INVALID_MEDIA_TYPE,"Content type does not allow subtitles.")):e.getActiveSubtitleLanguage()})):Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled."))},t.prototype.setSubtitleLanguage=function(e){if(!this._localPlayback)return Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot set subtitle languages on remote player."));var t=this._streamer;return t?this.getCurrentState().then((function(r){var n;return"video"!==(null===(n=null==r?void 0:r.track_window.current_track)||void 0===n?void 0:n.media_type)?Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_INVALID_MEDIA_TYPE,"Content type does not allow subtitles.")):t.setSubtitleLanguage(e)})):Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled."))},t.prototype.deactivateSubtitleEvents=function(){if(!this._localPlayback)return Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot deactivate subtitle events on remote player."));var e=this._streamer;return e?e.deactivateSubtitleEvents():Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled."))},t.prototype.activateSubtitleEvents=function(){if(!this._localPlayback)return Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot activate subtitle events on remote player."));var e=this._streamer;return e?e.activateSubtitleEvents():Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled."))},t.prototype.setBackgrounded=function(e){return this._localPlayback?this._streamer?this._streamer.setBackgrounded(e):Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled.")):Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot set background mode on remote player."))},t.prototype.setVideoResolution=function(e){return this._localPlayback?this._streamer?this._streamer.setVideoResolution(e):Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled.")):Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot set preferred video resolution on remote player."))},t.prototype.getMediaConfig=function(){return this._streamer?this._streamer.getMediaConfig():Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_LOCAL_PLAYER_DISABLED,"The local player is not enabled."))},t.prototype.setPlaybackSpeed=function(e,t){var r=this;return isNaN(e)||e<.5||e>3.5?Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Invalid playback speed: "+e+". Should be in range 0.5 - 3.5")):this.getCurrentState().then((function(n){return!n||n.disallows.setting_playback_speed?Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Cannot change playback speed; content type is not allowed.")):r._runOnDevice(t,(function(){return r._streamer.setPlaybackSpeed(e)}),(function(){return r._controller.setPlaybackSpeed(e,t)}))}))},t.prototype.sendCustomSignal=function(e,t,r){var n=this;return this.getCurrentState().then((function(i){if(((null==i?void 0:i.disallows.signals)||{})[e])return Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Sending signal "+e+" is not allowed."));var o=function(){return n._controller.sendCustomSignal(e,t,r)};return n._runOnDevice(t,o,o,{loggingParams:null==r?void 0:r.loggingParams,forceRemoteAction:null==r?void 0:r.forceRemoteAction})}))},t.prototype.playAsNextInQueue=function(e,t,r){var n=this,i=function(){return n._controller.playAsNextInQueue(e,t,r)};return this._runOnDevice(t,i,i,{loggingParams:null==r?void 0:r.loggingParams,forceRemoteAction:null==r?void 0:r.forceRemoteAction})},t.prototype.setModes=function(e,t,r){var n=this;return this.getCurrentState().then((function(i){var o,a,s=(null==i?void 0:i.disallows)||{};for(var u in e)if(e.hasOwnProperty(u)){var l=e[u];if(null===(a=null===(o=s.setting_modes)||void 0===o?void 0:o[u])||void 0===a?void 0:a[l])return Promise.reject(new f.HarmonyError(c.HarmonyErrors.HARMONY_OPERATION_FORBIDDEN,"Setting "+u+" to "+l+" is not allowed."))}var d=function(){return n._controller.setModes(e,t,r)};return n._runOnDevice(t,d,d,{loggingParams:null==r?void 0:r.loggingParams,forceRemoteAction:null==r?void 0:r.forceRemoteAction})}))},t.prototype.setShuffleMode=function(e,t,r){var n=this,i=function(){return n._controller.setShuffleMode(e,t,r)};return this._runOnDevice(t,i,i,{loggingParams:null==r?void 0:r.loggingParams,forceRemoteAction:null==r?void 0:r.forceRemoteAction})},t}(i.EventEmitter);r.Harmony=m},{"../enums/disallow_transfer_reason":137,"../enums/error_source":138,"../enums/errors":139,"../enums/harmony_event":140,"../enums/repeat_mode":144,"../error/harmony_error":148,"../typedefs":154,"../version":160,"./helpers/device":121,"./player_queue":127,"@js-sdk/common/es5/promise_resolver":16,"@js-sdk/common/es5/throttle":17,"@js-sdk/playback/es5/enums/reason":88,"@spotify-internal/emitter/es5":109,tslib:227}],120:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.capitalize=void 0,r.capitalize=function(e){return e.replace(/\b[a-z]/g,(function(e){return e.toUpperCase()}))}},{}],121:[function(e,t,r){"use strict";function n(e,t){return!e&&!t||!(!e||!t)&&(e.id===t.id&&e.is_active===t.is_active&&e.is_controllable===t.is_controllable&&e.is_observable===t.is_observable&&e.is_being_activated===t.is_being_activated&&e.local===t.local&&e.name===t.name&&e.type===t.type&&e.version===t.version&&e.volume===t.volume)}Object.defineProperty(r,"__esModule",{value:!0}),r.areDeviceListsEqual=r.areDevicesEqual=void 0,r.areDevicesEqual=n,r.areDeviceListsEqual=function(e,t){if(!Array.isArray(e)||!Array.isArray(t))throw new TypeError("Invalid devices list.");if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(!n(e[r],t[r]))return!1;return!0}},{}],122:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Logger=void 0;var n=e("@js-sdk/logger/es5"),i=function(){function e(e){this._melodyLogger=new n.MelodyLogger(e)}return e.prototype.logClientEvent=function(e,t){return e?this._melodyLogger.sendLog("/v1/msg/batch",{type:"client_event",message:{source:e.source||n.LogValues.UNKNOWN,context:e.context||n.LogValues.UNKNOWN,event:e.event||n.LogValues.UNKNOWN,event_version:e.event_version||n.LogValues.EMPTY,test_version:e.test_version||n.LogValues.EMPTY,source_version:e.source_version||n.LogValues.UNKNOWN,source_vendor:e.source_vendor||n.LogValues.UNKNOWN,json_data:"json"===t?e.json_data||"{}":JSON.stringify(e.json_data||{})}},{batch:!0}):Promise.reject(new TypeError("Logger.logClientEvent `data` cannot be null."))},e.prototype.logMetrics=function(e,t){if(!e&&!t)return Promise.resolve(!0);var r=e||[],n=t||[];if(!r.length&&!n.length)return Promise.resolve(!0);if(!Array.isArray(r)||!Array.isArray(n))return Promise.reject(new TypeError("Logger.logMetrics `meters` and `timers` must be null or an array."));for(var i=0,o=r;i<o.length;i++){var a=o[i];if(!("what"in a)||!("result"in a)||!("reason"in a))return Promise.reject(new TypeError("Logger.logMetrics: Invalid meter format in `meters` array."))}for(var s=0,u=n;s<u.length;s++){var l=u[s];if(!("what"in l)||!("duration"in l))return Promise.reject(new TypeError("Logger.logMetrics: Invalid timer format in `timers` array."))}return this._melodyLogger.sendLog("/v1/metric",{sdk_id:void 0,platform:void 0,client_version:void 0,meters:r,timers:n})},e.prototype.logJSSDKError=function(e,t){return this._melodyLogger.sendLog("/v1/msg/batch",{type:"jssdk_error",message:{source:e.source||n.LogValues.UNKNOWN,source_version:e.source_version||n.LogValues.UNKNOWN,type:e.type||n.LogValues.UNKNOWN,message:e.message||n.LogValues.EMPTY,stack:JSON.stringify(e.stack||n.LogValues.EMPTY),json_data:"json"===t?e.json_data||"{}":JSON.stringify(e.json_data||{}),json_data_version:e.json_data_version||n.LogValues.EMPTY_VERSION}},{batch:!0})},e.prototype.logJSSDKContentRequest=function(e){var t;return this._melodyLogger.sendLog("/v1/msg/jssdk_content_request",{source:e.source||n.LogValues.UNKNOWN,type:e.type||n.LogValues.UNKNOWN,http_status:null!==(t=e.http_status)&&void 0!==t?t:void 0,ms_request_duration:e.ms_request_duration||n.LogValues.EMPTY,n_retries:e.n_retries||n.LogValues.ZERO,playback_id:e.playback_id||n.LogValues.EMPTY})},e.prototype.logJSSDKConnectCommand=function(e){return this._melodyLogger.sendLog("/v1/msg/batch",{type:"jssdk_connect_command",message:{ms_ack_duration:e.ms_ack_duration,ms_request_latency:e.ms_request_latency||n.LogValues.ZERO,command_id:e.command_id||n.LogValues.EMPTY,command_type:e.command_type||n.LogValues.EMPTY,target_device_brand:e.target_device_brand||n.LogValues.EMPTY,target_device_model:e.target_device_model||n.LogValues.EMPTY,target_device_client_id:e.target_device_client_id||n.LogValues.EMPTY,target_device_id:e.target_device_id||n.LogValues.EMPTY,interaction_ids:e.interaction_ids||n.LogValues.EMPTY,play_origin:e.play_origin||n.LogValues.EMPTY,result:e.result||n.LogValues.EMPTY,http_response:e.http_response||n.LogValues.EMPTY,http_status_code:e.http_status_code||n.LogValues.ZERO}},{batch:!0})},e}();r.Logger=i},{"@js-sdk/logger/es5":28}],123:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.ManifestTrackResolver=r.FLAC_BITRATE=void 0;var i=e("@spotify-internal/uri/es5"),o=e("@js-sdk/playback/es5"),a=e("../enums/manifest_format");r.FLAC_BITRATE=1411200;var s=/^https:\/\//,u=((n={})[a.ManifestFormat.FILE_URLS_MP3]=o.MediaFormat.MP3,n[a.ManifestFormat.FILE_URLS_EXTERNAL]=o.MediaFormat.MP3,n[a.ManifestFormat.FILE_IDS_MP3]=o.MediaFormat.MP3,n[a.ManifestFormat.FILE_IDS_MP4]=o.MediaFormat.MP4,n[a.ManifestFormat.FILE_IDS_MP4_DUAL]=o.MediaFormat.MP4,n[a.ManifestFormat.FILE_IDS_CBCS]=o.MediaFormat.MP4_CBCS,n[a.ManifestFormat.FILE_IDS_MP4FLAC]=o.MediaFormat.MP4_FLAC,n[a.ManifestFormat.MANIFEST_IDS_VIDEO]=o.MediaFormat.MANIFEST_ID,n[a.ManifestFormat.MANIFEST_URLS_VIDEO_AD]=o.MediaFormat.AD_MANIFEST,n[a.ManifestFormat.MANIFEST_URLS_AUDIO_AD]=o.MediaFormat.AD_MANIFEST,n),l=function(){function e(e){this._descriptor=e.descriptor,this._listPlayer=e.listPlayer}return e.create=function(t){return new e(t)},e.prototype._resolveFromStateTrack=function(e,t,n){for(var l,c,d,_,p=e.manifest,f=e.metadata.uri,h=i.parseURI(f),v=null,y=0,m=n;y<m.length;y++){var E=m[y],g=p[E];if(g)for(var R=0,T=g;R<T.length;R++){var I=T[R];if(I.file_id||s.test(null!==(l=I.file_url)&&void 0!==l?l:"")){var S=!(!h||h.type!==i.URITypeMap.AD&&h.type!==i.URITypeMap.INTERRUPTION);if(E!==a.ManifestFormat.FILE_IDS_MP3||S){var P=void 0;P=I.track_type?I.track_type.toLowerCase():E===a.ManifestFormat.MANIFEST_IDS_VIDEO?"video":"audio";var b=void 0;if(I.format){var A=parseInt(I.format,10);o.AudioFileFormat[A]&&(b=A)}var L=null!==(c=I.bitrate)&&void 0!==c?c:E===a.ManifestFormat.FILE_IDS_MP4FLAC?r.FLAC_BITRATE:128e3,C=null!==(d=I.bitrate)&&void 0!==d?d:E===a.ManifestFormat.FILE_IDS_MP4FLAC?7e5:128e3,O=u[E];if(v={uri:f,uriType:h&&h.type?h.type:void 0,fileId:null!==(_=I.file_id)&&void 0!==_?_:"",resolvedURL:I.file_url,mediaType:P,format:O,bitrate:C,fileFormat:null!=b?b:void 0,playbackQuality:I.audio_quality,hifi_status:I.hifi_status,impressionURL:I.impression_url,impressionURLs:I.impression_urls,gainDb:I.gain_db,isAd:S,noLog:!1,noTSV:S,noManifest:O===o.MediaFormat.MP3,playable:!0},E===a.ManifestFormat.MANIFEST_IDS_VIDEO||L<=t)return v}}}}return v},e.prototype.resolveFromStateTrack=function(e){var t=this;return Promise.all([Promise.resolve(this._descriptor),this._listPlayer.getCurrentBandwidth()]).then((function(r){var n=r[0],i=r[1];return t._resolveFromStateTrack(e,i,n.getManifestFormats())}))},e}();r.ManifestTrackResolver=l},{"../enums/manifest_format":143,"@js-sdk/playback/es5":102,"@spotify-internal/uri/es5":216}],124:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MediaSessionManager=void 0;var n=e("@js-sdk/common/es5/debug_tools"),i=e("../enums/errors"),o=e("../error/harmony_error"),a=n.logging.forTag("media_session");function s(e){return Math.round(1e3*e)}var u=function(){function e(e){this._currentURI=null,this._streamer=e.streamer,this._handleAction=this._handleAction.bind(this),this._updateMediaSession=this._updateMediaSession.bind(this),this._updateMediaSessionMetadata=this._updateMediaSessionMetadata.bind(this),this._init()}return e.create=function(t){return"undefined"!=typeof window&&"undefined"!=typeof navigator&&"mediaSession"in navigator&&"MediaMetadata"in window?new e(t):(a.warn("The MediaSession API is not supported."),null)},e.prototype._init=function(){this._streamer.on("state_changed",this._updateMediaSession)},e.prototype._handleAction=function(e){var t=this;switch(e.action){case"play":this._streamer.resume();break;case"pause":this._streamer.pause();break;case"seekto":var r=e.seekTime;null!=r&&this._streamer.seek(s(r));break;case"seekforward":var n=e.seekOffset;this._streamer.getCurrentState().then((function(e){if(e){var r=e.position,i=e.duration,o=Math.min(i,Math.max(0,n?r+s(n):r+15e3));t._streamer.seek(o)}}));break;case"seekbackward":var i=e.seekOffset;this._streamer.getCurrentState().then((function(e){if(e){var r=e.position,n=Math.max(0,i?r-s(i):r-15e3);t._streamer.seek(n)}}));break;case"nexttrack":this._streamer.nextTrack();break;case"previoustrack":this._smartPreviousTrack()}},e.prototype._clearHandlers=function(){navigator.mediaSession.setActionHandler("play",null),navigator.mediaSession.setActionHandler("pause",null),navigator.mediaSession.setActionHandler("seekto",null),navigator.mediaSession.setActionHandler("nexttrack",null),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("seekbackward",null)},e.prototype._smartPreviousTrack=function(){var e=this;this._streamer.getCurrentState().then((function(t){if(!t)return Promise.reject(new o.HarmonyError(i.HarmonyErrors.HARMONY_NO_TRACKS_LOADED,"No current state."));var r=t.disallows,n=t.position,a=t.track_window;return r.seeking||n<3e3&&a.previous_tracks.length>0?e._streamer.previousTrack():e._streamer.seek(0)}))},e.prototype._updateMediaSessionMetadata=function(e){var t,r=e.name,n=e.artists,i=e.album,o=null===(t=null==i?void 0:i.images)||void 0===t?void 0:t.map((function(e){return{src:e.url,sizes:e.width+"x"+e.height}})),a={title:r||"",artist:(null==n?void 0:n.map((function(e){return null==e?void 0:e.name})).join(", "))||"",album:(null==i?void 0:i.name)||"",artwork:o};navigator.mediaSession.metadata=new window.MediaMetadata(a)},e.prototype._updateMediaSession=function(e){var t,r=e.data.state,n=null===(t=null==r?void 0:r.track_window)||void 0===t?void 0:t.current_track;if(!r||!n)return this._currentURI=null,navigator.mediaSession.metadata=null,navigator.mediaSession.playbackState="none",void this._clearHandlers();navigator.mediaSession.playbackState=r.paused?"paused":"playing",this._currentURI!==n.uri&&(this._currentURI=n.uri,this._updateMediaSessionMetadata(n));var i=r.position,o=r.duration,a=Math.min(Math.max(0,i),o);o&&navigator.mediaSession.setPositionState({position:a,duration:o}),navigator.mediaSession.setActionHandler("play",this._handleAction),navigator.mediaSession.setActionHandler("pause",this._handleAction);var s=r.disallows;navigator.mediaSession.setActionHandler("seekto",s.seeking?null:this._handleAction),navigator.mediaSession.setActionHandler("nexttrack",s.skipping_next?null:this._handleAction),navigator.mediaSession.setActionHandler("previoustrack",this._handleAction),"episode"===n.type?(navigator.mediaSession.setActionHandler("seekforward",this._handleAction),navigator.mediaSession.setActionHandler("seekbackward",this._handleAction)):(navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("seekbackward",null))},e}();r.MediaSessionManager=u},{"../enums/errors":139,"../error/harmony_error":148,"@js-sdk/common/es5/debug_tools":9}],125:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MetadataDecorator=void 0;var n=e("tslib"),i=e("@spotify-internal/linkedlist/es5"),o=e("@spotify-internal/uri/es5"),a=function(){function e(e){this._transport=e.transport,this._metadataCache=new i.LRUCache(e.cacheSize||20)}return e.create=function(t){return new e(t)},e.prototype._decorateTrackWindow=function(e){var t,r,i,o=this._metadataCache,a={current_track:null,next_tracks:[],previous_tracks:[]},s=function(e){var t,r=null===(t=null==e?void 0:e.metadata)||void 0===t?void 0:t.track_player;e&&r&&(e.media_type="video"===r?"video":"audio")};e.current_track&&(r=o&&e.current_track&&"uri"in e.current_track&&o.get(e.current_track.uri),a.current_track=n.__assign({uid:e.current_track.uid,metadata:e.current_track.metadata},r||e.current_track),s(a.current_track)),t=e.next_tracks.length;for(;t--;)i=e.next_tracks[t],r=o&&i&&"uri"in i&&o.get(i.uri),a.next_tracks[t]=n.__assign({uid:i.uid,metadata:i.metadata},r||i),s(a.next_tracks[t]);for(t=e.previous_tracks.length;t--;)i=e.previous_tracks[t],r=o&&i&&"uri"in i&&o.get(i.uri),a.previous_tracks[t]=n.__assign({uid:i.uid,metadata:i.metadata},r||i),s(a.previous_tracks[t]);return a},e.prototype._buildTrackList=function(e){for(var t=[],r={},i=0,o=n.__spreadArray(n.__spreadArray([e.current_track],e.next_tracks),e.previous_tracks);i<o.length;i++){var a=o[i];a&&!r[a.uri]&&t.push(a.uri)}return t},e.prototype._cacheMetadata=function(e,t){for(var r=[],n=[],i=[],a=this._metadataCache,s=0,u=e;s<u.length;s++){var l=u[s];if(!a.get(l)){var c=o.parseURI(l);c&&(c.type===o.URITypeMap.TRACK?n.push(c.id):"chapter"===(null==t?void 0:t.contentType)?i.push(c.id):c.type===o.URITypeMap.EPISODE&&r.push(c.id))}}return r.length||n.length||i.length?Promise.all([this._requestMultiData("episodes",r),this._requestMultiData("tracks",n),this._requestMultiData("chapters",i)]).then((function(e){var t=e[0],r=e[1],n=e[2];return!!t||!!r||!!n})):Promise.resolve(!0)},e.prototype._requestMultiData=function(e,t){var r=this;if(!t.length)return Promise.resolve(!1);var n=this._metadataCache,i=["https://@webapi/v1/",e,"?ids=",t.join(","),"&market=from_token"].join("");return this._transport.request(i,{responseType:"json"}).then((function(t){var i;if(200!==t.status)return!1;var o=null===(i=t.body)||void 0===i?void 0:i[e];if(!o)return!1;for(var a=o.length;a--;){var s=o[a];s&&("episodes"===e?s=r._formatEpisodeData(s):"chapters"===e?s=r._formatChapterData(s):(s.track_type="audio",s.media_type="audio",s.content_type="tracks"===e?"music":"undefined"),n&&n.set(s.uri,s),n&&s.linked_from&&s.linked_from.uri&&n.set(s.linked_from.uri,s))}return!0}))},e.prototype._formatEpisodeData=function(e){var t="audio"===e.show.media_type?"audio":"video";return{id:e.id,uri:e.uri,type:"episode",media_type:t,track_type:e.show.media_type,content_type:"podcast",name:e.name,artists:[{uri:e.show.uri,name:e.show.publisher}],album:{uri:e.show.uri,name:e.show.name,images:e.images},duration_ms:e.duration_ms||0,is_playable:!0}},e.prototype._formatChapterData=function(e){return{id:e.id,uri:e.uri,type:"episode",name:e.name,media_type:e.audiobook.media_type,track_type:"audio",content_type:"chapter",artists:[{uri:e.audiobook.uri,name:e.audiobook.name}],album:{name:e.audiobook.name,uri:e.audiobook.uri,images:e.images},duration_ms:e.duration_ms||0,is_playable:!0}},e.prototype.formatLocalTrack=function(e,t){return e&&e.type===o.URITypeMap.LOCAL_TRACK?{uri:e.toURI(),type:"local",uid:t,media_type:"audio",track_type:"audio",content_type:"music",name:e.track,artists:[{uri:o.localArtistURI(e.artist).toURI(),name:e.artist}],album:{uri:o.localAlbumURI(e.artist,e.album).toURI(),name:e.album,images:[{url:""}]},duration_ms:e.duration?1e3*e.duration:0,is_playable:!1}:null},e.prototype.formatAd=function(e,t){if(!e||e.type!==o.URITypeMap.AD&&e.type!==o.URITypeMap.INTERRUPTION)return null;if(!t||!t.metadata)return null;var r=t.metadata;return{id:e.id,uri:e.toURI(),type:e.type,uid:t.uid,media_type:"audio",track_type:"audio",content_type:"ad",name:r.advertiser,artists:[{uri:r.click_url,name:r.buttonMessage||r.advertiser}],album:{uri:r.click_url,name:r.advertiser,images:[{url:r.image_url}]},duration_ms:parseInt(r.duration,10),is_playable:!1}},e.prototype.formatDJNarration=function(e,t){var r;if(!e||"true"!==(null===(r=t.metadata)||void 0===r?void 0:r.is_narration))return null;if(!t||!t.metadata)return null;var n=t.metadata;return{id:e.id,uri:e.toURI(),type:e.type,uid:t.uid,name:n.title,media_type:"audio",track_type:"audio",content_type:"narration",album:{name:n.album_title,images:[{url:n.image_url}]},artists:[{uri:"",name:n.artist_name}]}},e.prototype.formatGenericTrack=function(e,t){var r,n,i,o,a,s,u=t.metadata||{};return{id:null!==(r=null==e?void 0:e.id)&&void 0!==r?r:"",uri:null!==(n=null==e?void 0:e.toURI())&&void 0!==n?n:t.uri,type:null!==(i=null==e?void 0:e.type)&&void 0!==i?i:"unknown",uid:t.uid,name:u.title,media_type:"video"===u.track_player?"video":"audio",duration_ms:u.duration||0,track_type:void 0,content_type:"unknown",album:{name:null!==(o=u.album_title)&&void 0!==o?o:"",uri:null!==(a=u.album_uri)&&void 0!==a?a:"",images:u.image_url&&[{url:u.image_url}]},artists:[{uri:null!==(s=u.artist_uri)&&void 0!==s?s:"",name:u.artist_name}]}},e.prototype.decorateTrackWindow=function(e,t,r){var n=this,i=null!=t?t:this._buildTrackList(e);return this._cacheMetadata(i,{contentType:null==r?void 0:r.contentType}).then((function(t){return t?n._decorateTrackWindow(e):e}))},e}();r.MetadataDecorator=a},{"@spotify-internal/linkedlist/es5":161,"@spotify-internal/uri/es5":216,tslib:227}],126:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.parseDisallows=r.parseRestrictions=void 0;var n=e("tslib"),i=/^disallow_([^]+)_reasons$/;function o(e){var t,r,n={};for(var i in e)e.hasOwnProperty(i)&&(n[i]=!!(null===(r=null===(t=null==e?void 0:e[i])||void 0===t?void 0:t.reasons)||void 0===r?void 0:r.length));return n}function a(e){var t,r,n,i,o,a,s,u,l={};for(var c in e)if(e.hasOwnProperty(c))for(var d in l[c]={},null===(t=e[c])||void 0===t?void 0:t.values){if(null===(r=e[c])||void 0===r?void 0:r.values.hasOwnProperty(d))(l[c]||{})[d]=!(!(null===(o=null===(i=null===(n=e[c])||void 0===n?void 0:n.values)||void 0===i?void 0:i[d])||void 0===o?void 0:o.reasons)||!(null===(u=null===(s=null===(a=e[c])||void 0===a?void 0:a.values)||void 0===s?void 0:s[d])||void 0===u?void 0:u.reasons.length))}return l}r.parseRestrictions=function(e,t){var r=n.__assign({},e);return delete r.disallow_pausing_reasons,delete r.disallow_resuming_reasons,t?r.disallow_pausing_reasons=["already_paused"]:r.disallow_resuming_reasons=["not_paused"],r},r.parseDisallows=function(e){var t={};for(var r in e)if(e.hasOwnProperty(r))if("disallow_setting_modes"===r)t.setting_modes=a(e[r]);else if("disallow_signals"===r)t.signals=o(e[r]);else{var n=e[r];if(Array.isArray(n)){var s=!(!n||!n.length);t[r.replace(i,"$1")]=s}}return t}},{tslib:227}],127:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.QueueManager=r.queueTrackFromQid=r.createContextTracks=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("../enums/harmony_event"),a=e("../enums/errors"),s=e("../error/player_queue");function u(e,t){var r,n,i,o,a,s;void 0===t&&(t={isCurrentTrack:!1,ignoreMetaForTrack:!1});var u=[],l=[],c=!1,d=!1;if(!(null==e?void 0:e.length))return{items:u,tracks:l,hasQueuedTracks:c};for(var _=0,p=e;_<p.length;_++){var f=p[_],h="spotify:delimiter"===f.uri||/^spotify:meta:/.test(f.uri)?"meta":"track",v=f.uid+":::"+(null!==(n=null===(r=f.metadata)||void 0===r?void 0:r.iteration)&&void 0!==n?n:""),y={type:h,uri:f.uri,uid:f.uid,qid:v,metadata:f.metadata||{},hidden:"true"===(null===(i=f.metadata)||void 0===i?void 0:i.hidden),hidden_in_queue:"true"===(null===(o=f.metadata)||void 0===o?void 0:o.hidden_in_queue)&&!t.isCurrentTrack,queued:"true"===(null===(a=f.metadata)||void 0===a?void 0:a.is_queued),provider:f.provider,removed_reasons:f.removed,$blck_rs:f.blocked};y.queued&&(c=!0),u.push(y),"meta"===y.type?d=!0:!t.ignoreMetaForTrack&&d||"track"!==y.type||y.hidden||(null===(s=y.removed_reasons)||void 0===s?void 0:s.length)||y.hidden_in_queue||l.push(y)}return{items:u,tracks:l,hasQueuedTracks:c}}function l(e,t){if(void 0===t&&(t={}),!Array.isArray(e))throw new TypeError("Items is not an array.");if(!e.length)return[];for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n];if(o){"string"==typeof o&&(o={type:"track",uri:o});var a={uri:o.uri,uid:o.uid,metadata:o.metadata||{},removed:o.removed_reasons,blocked:o.$blck_rs,provider:o.provider};(o.queued||t.queued)&&(a.metadata.is_queued="true",a.provider="queue"),(o.hidden||"meta"===o.type)&&(a.metadata.hidden="true"),o.hidden_in_queue&&(a.metadata.hidden_in_queue="true"),r.push(a)}}return r}function c(e){var t=e.split(":::"),r=t[0],n=t[1],i={type:"track",uid:r};return n&&(i.metadata={iteration:n}),i}r.createContextTracks=l,r.queueTrackFromQid=c;var d=function(e){function t(t){var r=e.call(this)||this;return r._hasInitialState=!1,r._reportInactiveQueues=!1,r._onlyLocalQueue=!1,r._currentPlayerState=null,r._currentInternalQueue=null,r._currentQueue=null,r._hasQueuedTracks=!1,r._connectClient=t.connectClient,r._runner=t.runner||function(e){return e()},r._parsePlayerState=r._parsePlayerState.bind(r),r._onlyLocalQueue=!!t.onlyLocalQueue,r._reportInactiveQueues=!!t.reportInactiveQueues,r._connectClient.on("player_state_changed",r._onPlayerStateChanged.bind(r)),r._parsePlayerState(t.initialContextPlayerState),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._onPlayerStateChanged=function(e){var t=e.data,r=t.playerState,n=t.orphaned,i=t.isLocal;this._parsePlayerState(r,n,i)},t.prototype._parsePlayerState=function(e,t,r){var n,i,a;if(this._hasInitialState=!0,this._onlyLocalQueue&&!r||!this._reportInactiveQueues&&t)this._currentPlayerState=null,this._currentInternalQueue=null,this._currentQueue=null;else if(this._currentPlayerState=null!=e?e:null,e){if(e.queue_revision===(null===(n=this._currentInternalQueue)||void 0===n?void 0:n.revision))return null;this._hasQueuedTracks=!1;var s={ignoreMetaForTrack:null===(i=e.options)||void 0===i?void 0:i.repeating_context},l=e.queue_revision,c=u([e.track],{isCurrentTrack:!0}).items[0],d=u(e.next_tracks,s),_=u(e.prev_tracks,s);this._hasQueuedTracks=d.hasQueuedTracks;var p={uri:e.context_uri,metadata:null!==(a=e.context_metadata)&&void 0!==a?a:void 0};this._currentInternalQueue={revision:l,context:p,current_track:c,next_items:d.items,previous_items:_.items},this._currentQueue={revision:l,context:p,current_track:c,next_tracks:d.tracks,previous_tracks:_.tracks}}else this._hasQueuedTracks=!1,this._currentInternalQueue=null,this._currentQueue=null;return this.emit(o.HarmonyEvent.PLAYER_QUEUE_CHANGED,{internalPlayerQueue:this._currentInternalQueue,playerQueue:this._currentQueue}),this._currentInternalQueue},t.prototype._setQueueNext=function(e,t){var r,n=this,i=this._currentPlayerState;if(!i)return Promise.reject(new s.PlayerQueueError(a.HarmonyErrors.QUEUE_MANAGER_NO_STATE,"Cannot perform operation; no current state."));var o={next_tracks:e,prev_tracks:i.prev_tracks,queue_revision:i.queue_revision},u=null===(r=i.restrictions)||void 0===r?void 0:r.disallow_set_queue_reasons;return this._runner((function(){return u&&u.length?Promise.reject(new s.PlayerQueueError(a.HarmonyErrors.QUEUE_OPERATION_FORBIDDEN,"Cannot perform operation; SetQueueCommand is not allowed.")):n._connectClient.setQueue(o,t)}),t)},t.prototype._insertQueuedWhenEmpty=function(e,t,r){var i,o,a,s,u="true"===(null===(o=null===(i=t[0])||void 0===i?void 0:i.metadata)||void 0===o?void 0:o.is_narration),l="true"===(null===(a=null==r?void 0:r.metadata)||void 0===a?void 0:a.is_narration);if(l||u){if(!l||u){for(var c=-1,d=0,_=t.length;d<_;d++){var p=t[d];if("true"===(null===(s=null==p?void 0:p.metadata)||void 0===s?void 0:s.is_narration)){c=d+1;break}}return-1===c?void t.unshift.apply(t,e):void t.splice.apply(t,n.__spreadArray([c+1,0],e))}t.splice.apply(t,n.__spreadArray([1,0],e))}else t.unshift.apply(t,e)},t.prototype._insertQueued=function(e,t){var r,i,o=this._currentPlayerState;if(!o)return Promise.reject(new s.PlayerQueueError(a.HarmonyErrors.QUEUE_MANAGER_NO_STATE,"Cannot perform operation; no current state."));var u=Array.from(null!==(r=o.next_tracks)&&void 0!==r?r:[]);if(this._hasQueuedTracks){for(var l=!1,c=0,d=u.length;c<d;c++){var _=u[c];if("true"!==(null===(i=null==_?void 0:_.metadata)||void 0===i?void 0:i.is_queued)){u.splice.apply(u,n.__spreadArray([c,0],e)),l=!0;break}}l||u.push.apply(u,e)}else{var p=o.track;this._insertQueuedWhenEmpty(e,u,p)}return this._setQueueNext(u,t)},t.prototype.getInternalPlayerQueue=function(){var e=this;return this._hasInitialState?Promise.resolve(this._currentInternalQueue):new Promise((function(t){e.on(o.HarmonyEvent.PLAYER_QUEUE_CHANGED,(function(e){t(e.data.internalPlayerQueue)}))}))},t.prototype.getPlayerQueue=function(){var e=this;return this._hasInitialState?Promise.resolve(this._currentQueue):new Promise((function(t){e.on(o.HarmonyEvent.PLAYER_QUEUE_CHANGED,(function(e){t(e.data.playerQueue)}))}))},t.prototype.setInternalPlayerQueue=function(e,t,r){var n=this;if(void 0===r&&(r={ignoreRevision:!1}),!this._currentPlayerState)return Promise.reject(new s.PlayerQueueError(a.HarmonyErrors.QUEUE_MANAGER_NO_STATE,"Cannot perform operation; no current state."));if(e.revision!==this._currentPlayerState.queue_revision&&!r.ignoreRevision)return Promise.reject(new s.PlayerQueueError(a.HarmonyErrors.QUEUE_OPERATION_STALE_REVISION,"Cannot perform operation; revision is stale."));var i={next_tracks:l(e.next_items),prev_tracks:l(e.previous_items),queue_revision:r.ignoreRevision?void 0:this._currentPlayerState.queue_revision};return this._runner((function(){return n._connectClient.setQueue(i,t)}),t)},t.prototype.addToQueue=function(e,t){var r,n=this,i=this._currentPlayerState;if(!i)return Promise.reject(new s.PlayerQueueError(a.HarmonyErrors.QUEUE_MANAGER_NO_STATE,"Cannot perform operation; no current state."));if(!Array.isArray(e))return Promise.reject(new TypeError("Argument `items` must be an array."));var o=l(e,{queued:!0}),u=null===(r=i.restrictions)||void 0===r?void 0:r.disallow_add_to_queue_reasons;return o.length?1===o.length?this._runner((function(){return u&&u.length?Promise.reject(new s.PlayerQueueError(a.HarmonyErrors.QUEUE_OPERATION_FORBIDDEN,"Cannot perform operation; AddToQueueCommand is not allowed.")):n._connectClient.addToQueue(o[0],t)}),t):this._insertQueued(o,t):Promise.resolve(!1)},t.prototype.removeNext=function(e,t){var r,n,i,o,u=this._currentPlayerState;if(!u)return Promise.reject(new s.PlayerQueueError(a.HarmonyErrors.QUEUE_MANAGER_NO_STATE,"Cannot perform operation; no current state."));o="string"==typeof e?c(e):e;for(var l=Array.from(null!==(r=u.next_tracks)&&void 0!==r?r:[]),d=l.length,_=0;_<d;_++){var p=l[_];if((null==p?void 0:p.uid)===o.uid&&(null===(n=null==p?void 0:p.metadata)||void 0===n?void 0:n.iteration)===(null===(i=o.metadata)||void 0===i?void 0:i.iteration)){l.splice(_,1);break}}return l.length===d?Promise.resolve(!1):this._setQueueNext(l,t)},t}(i.EventEmitter);r.QueueManager=d},{"../enums/errors":139,"../enums/harmony_event":140,"../error/player_queue":149,"@spotify-internal/emitter/es5":109,tslib:227}],128:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HarmonyStreamer=void 0;var n=e("tslib"),i=e("@js-sdk/playback/es5"),o=e("@spotify-internal/emitter/es5"),a=e("../enums/error_source"),s=e("./media_session"),u=function(e){function t(t){var r=e.call(this)||this;return r._client=t.client,r._initialVolume=t.initialVolume,r._listPlayer=t.listPlayer,r._playerPromise=t.playerPromise,r._playbackServiceClient=t.playbackServiceClient,r._playbackStateObserver=t.playbackStateObserver,r._stopOnBackground=t.stopOnBackground,r._enableMediaSession=t.enableMediaSession,r._init(),r}return n.__extends(t,e),t.prototype._init=function(){var e,t,r,n,o,u,l=this;this._client.addListeners(((e={}).before_disconnect=this._onClientBeforeDisconnect.bind(this),e.before_offline_disconnect=this._onClientBeforeOfflineDisconnect.bind(this),e));var c=this._listPlayer;c.addListeners(((t={})[i.PlaybackEvent.LIST_PLAYER_CAPPED]=this._onCapped.bind(this),t[i.PlaybackEvent.LIST_PLAYER_TRACK_ENDED]=this._onTrackEnded.bind(this),t[i.PlaybackEvent.LIST_PLAYER_BEFORE_VOLUME_CHANGE]=this._onBeforeVolumeChange.bind(this),t[i.PlaybackEvent.LIST_PLAYER_VOLUME_CHANGED]=this._onVolumeChanged.bind(this),t[i.PlaybackEvent.LIST_PLAYER_ERROR]=function(e){l._onError(e,a.HarmonyErrorSource.PLAYBACK)},t)),this.proxyEmitAll(c,((r={})[i.PlaybackEvent.LIST_PLAYER_AUTOPLAY_FAILED]="autoplay_failed",r[i.PlaybackEvent.LIST_PLAYER_TRACK_LOADED]="track_loaded",r[i.PlaybackEvent.LIST_PLAYER_DURATION_CHANGED]="duration_changed",r[i.PlaybackEvent.LIST_PLAYER_POSITION_CHANGED]="position_changed",r[i.PlaybackEvent.LIST_PLAYER_PROGRESS]="progress",r[i.PlaybackEvent.LIST_PLAYER_BUFFER_STALLED]="stalled",r[i.PlaybackEvent.LIST_PLAYER_BUFFERING_END]="buffering_end",r[i.PlaybackEvent.LIST_PLAYER_BUFFERING_START]="buffering_start",r[i.PlaybackEvent.LIST_PLAYER_REBUFFERING_END]="rebuffering_end",r[i.PlaybackEvent.LIST_PLAYER_REBUFFERING_START]="rebuffering_start",r[i.PlaybackEvent.LIST_PLAYER_MAX_LIST_ERRORS_REACHED]="max_list_errors_reached",r[i.PlaybackEvent.LIST_PLAYER_VIDEO_ELEMENT_APPENDED]="video_element_appended",r[i.PlaybackEvent.LIST_PLAYER_VIDEO_ELEMENT_REMOVED]="video_element_removed",r[i.PlaybackEvent.LIST_PLAYER_LIST_ENDED]="context_ended",r[i.PlaybackEvent.LIST_PLAYER_SEEK_HANDLED]="streamer_seek_handled",r[i.PlaybackEvent.LIST_PLAYER_DISPLAYED_CUES_CHANGED]="displayed_cues_changed",r[i.PlaybackEvent.LIST_PLAYER_SUBTITLE_LANGUAGES_LOADED]="subtitle_languages_loaded",r[i.PlaybackEvent.LIST_PLAYER_PLAYBACK_SPEED_CHANGED]="speed_changed",r[i.PlaybackEvent.LIST_PLAYER_PLAYING_PROFILE_CHANGED]="playing_profile_changed",r)),this.proxyEmitAllSync(c,((n={})[i.PlaybackEvent.REPORTING_START]="reporting_start",n[i.PlaybackEvent.REPORTING_FIRST_QUARTILE]="reporting_first_quartile",n[i.PlaybackEvent.REPORTING_MIDPOINT]="reporting_midpoint",n[i.PlaybackEvent.REPORTING_THIRD_QUARTILE]="reporting_third_quartile",n[i.PlaybackEvent.REPORTING_COMPLETE]="reporting_complete",n[i.PlaybackEvent.REPORTING_PAUSE]="reporting_pause",n[i.PlaybackEvent.REPORTING_RESUME]="reporting_resume",n[i.PlaybackEvent.REPORTING_CREATIVE_VIEW]="reporting_creative_view",n[i.PlaybackEvent.REPORTING_ERROR]="reporting_error",n));var d=this._playbackServiceClient;d.addListeners(((o={}).logout=this._onPlaybackClientLogout.bind(this),o.error=function(e){l._onError(e,e.data.source)},o)),this.proxyEmitAll(d,((u={}).max_subscriptions_reached="max_subscriptions_reached",u.deregistered="deregistered",u.registered="registered",u.registration_aborted="registration_aborted",u.internal_endcontent="internal_endcontent",u)),this.proxyEmit(this._playbackStateObserver,"state_changed","state_changed"),this._stopOnBackground&&document.addEventListener&&document.addEventListener("visibilitychange",(function(){document.hidden&&l.stop()&&l.emitSync("stopped_on_background",null)})),this._enableMediaSession&&s.MediaSessionManager.create({streamer:this}),this._playerPromise.then((function(e){e.setVolume(l._initialVolume),l.emit("player_initialization_done",null)}),(function(e){l.emit("player_initialization_failed",{reason:e.message,error:e})}))},t.prototype._assertOperationSuccess=function(e){return e===i.OperationResult.SUCCESS},t.prototype._onTrackEnded=function(){this.emit("track_ended",null)},t.prototype._onClientBeforeDisconnect=function(e){e.data.awaitPromise(this.deregister().catch((function(){})))},t.prototype._onClientBeforeOfflineDisconnect=function(e){e.data.awaitPromise(this.pause().catch((function(){})))},t.prototype._onBeforeVolumeChange=function(e){var t;this.emitSync("before_volume_change",{volume:e.data.volume,remote:!!(null===(t=e.data.options)||void 0===t?void 0:t.commandId)}).defaultPrevented&&e.preventDefault()},t.prototype._onVolumeChanged=function(e){this.emit("volume_changed",{volume:e.data.volume,remote:!!e.data.commandId})},t.prototype._onCapped=function(){this.emit("playback_capped",null)},t.prototype._onError=function(e,t){var r=e.data.error;r&&(r.registration&&this.emit("registration_error",{error:r}),this.emit("error",{source:t,error:r}),this._client.notifyError(t,r))},t.prototype._onPlaybackClientLogout=function(){this.emit("logged_out",null)},t.prototype.stop=function(){return this._playbackServiceClient.stop()},t.prototype.register=function(){return this._playbackServiceClient.register()},t.prototype.deregister=function(){return this._playbackServiceClient.deregister()},t.prototype.resume=function(){return this._listPlayer.resume().then(this._assertOperationSuccess)},t.prototype.pause=function(){return this._listPlayer.pause().then(this._assertOperationSuccess)},t.prototype.nextTrack=function(e){return void 0===e&&(e=i.Reason.FORWARD_BUTTON),this._listPlayer.next(e).then(this._assertOperationSuccess)},t.prototype.canChangeTrack=function(){return this._listPlayer.canChangeTrack()},t.prototype.previousTrack=function(e){return void 0===e&&(e=i.Reason.BACK_BUTTON),this._listPlayer.previous(e).then(this._assertOperationSuccess)},t.prototype.togglePlay=function(){return this._listPlayer.togglePlay().then(this._assertOperationSuccess)},t.prototype.setVolume=function(e){return this._listPlayer.setVolume(e).then(this._assertOperationSuccess)},t.prototype.getVolume=function(){return this._listPlayer.getVolume()},t.prototype.seek=function(e){return this._listPlayer.seek(e).then(this._assertOperationSuccess)},t.prototype.getCurrentState=function(){return this._playbackStateObserver.getCurrentState()},t.prototype.getVideoVariants=function(){return this._playerPromise.then((function(e){return e.getVideoVariants()}))},t.prototype.setPreferredBitrate=function(e){var t=this;return this._playerPromise.then((function(r){return r.setPreferredBitrate(e).then(t._assertOperationSuccess)}))},t.prototype.setVideoResolution=function(e){return this._playerPromise.then((function(t){return t.setVideoResolution(e)}))},t.prototype.setBackgrounded=function(e){return this._playerPromise.then((function(t){return t.setBackgrounded(e)}))},t.prototype.activateElement=function(){return this._playerPromise.then((function(e){return e.activateElement()}))},t.prototype.hideSubtitles=function(){return this._listPlayer.hideSubtitles().then(this._assertOperationSuccess)},t.prototype.showSubtitles=function(){return this._listPlayer.showSubtitles().then(this._assertOperationSuccess)},t.prototype.areSubtitlesShown=function(){return this._listPlayer.areSubtitlesShown()},t.prototype.getSubtitleLanguages=function(){return this._listPlayer.getSubtitleLanguages()},t.prototype.getActiveSubtitleLanguage=function(){return this._listPlayer.getActiveSubtitleLanguage()},t.prototype.setSubtitleLanguage=function(e){return this._listPlayer.setSubtitleLanguage(e).then(this._assertOperationSuccess)},t.prototype.getMediaConfig=function(){return this._listPlayer.getMediaConfig()},t.prototype.setPlaybackSpeed=function(e){return this._listPlayer.setPlaybackSpeed(e).then(this._assertOperationSuccess)},t.prototype.deactivateSubtitleEvents=function(){return this._listPlayer.deactivateCueEvents().then(this._assertOperationSuccess)},t.prototype.activateSubtitleEvents=function(){return this._listPlayer.activateCueEvents().then(this._assertOperationSuccess)},t.prototype.hasOptimisticUpdates=function(){return this._playbackServiceClient.hasOptimisticUpdates()},t}(o.EventEmitter);r.HarmonyStreamer=u},{"../enums/error_source":138,"./media_session":124,"@js-sdk/playback/es5":102,"@spotify-internal/emitter/es5":109,tslib:227}],129:[function(e,t,r){(function(t){(function(){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.TrackPlaybackServiceClient=void 0;var i=e("tslib"),o=e("@js-sdk/common/es5/debouncer"),a=e("@spotify-internal/emitter/es5"),s=e("@js-sdk/common/es5/debug_tools"),u=e("@js-sdk/playback/es5"),l=e("@js-sdk/common/es5/promise_resolver"),c=e("@js-sdk/common/es5/monotonic_now"),d=e("../../typedefs"),_=e("../../enums/errors"),p=e("../../enums/debug_source"),f=e("../../enums/error_source"),h=e("../../error/track_playback/client"),v=e("../../version"),y=e("../../utils/assert"),m=s.logging.forTag("tpapiclient"),E=s.logging.forTag("tpapiclient.endsong"),g=s.logging.forTag("tpapiclient.endsongs"),R=/^hm:\/\/track-playback\/v1/,T=/^hm:\/\/play-token\/lost/,I=function(e,t){var r=e.getStatusFamily();return r===t.SERVER_ERROR||r===t.CONNECTION_ERROR},S={condition:I,maxRetries:8},P={condition:I,maxRetries:2};var b=function(e){function r(t){var r=e.call(this)||this;return r._deviceId=null,r._sequenceNumber=0,r._currentContext=null,r._loading=!1,r._lastSentStateUpdatePayload=null,r._isSendingConflict=!1,r._queuedRejectedStates=[],r._isSendingUpdate=!1,r._queueSendUpdate=[],r._currentTrackInfo={},r._registered=!1,r._isDeregistering=!1,r._waitingForTrackingData=l.createPromiseResolver(),r._lastProcessedStateId=null,r._limitStateUpdates=!1,r._lastUpdateStateMonotonicTime=c.monotonicNow(),r._initialUpdateSent=!1,r._startedPlayingUpdateSent=!1,r._nextFinalizedDataPayload=null,r._switchingContext=!1,r._connectionId=null,r._transport=t.transport,r._logger=t.logger,r._endpoint=t.endpoint||"http://@webgate/track-playback",r._listPlayer=t.listPlayer,r._ListClass=t.ListClass,r._currentGaiaVolume=t.initialVolume*d.GAIA_VOLUME,r._clientVersion=t.clientVersion,r._manifestTrackResolver=t.manifestTrackResolver,r._descriptorPromise=Promise.resolve(t.descriptor),r._init(),r._performCommand=r._performCommand.bind(r),r._handleRegisterResponse=r._handleRegisterResponse.bind(r),r._handleStateConflictResponse=r._handleStateConflictResponse.bind(r),r.register=r.register.bind(r),r._parseDescriptor=r._parseDescriptor.bind(r),r._volumeDebouncer=new o.Debouncer(r._sendVolume.bind(r),{blockInitial:!0}),r}return i.__extends(r,e),r.create=function(e){return new r(e)},r.prototype._init=function(){var e,t=this;this._waitingForTrackingData=l.createPromiseResolver(),this._waitingForTrackingData.resolve(!0),this._transport.on(this._transport.EVENT_CONNECTION_ID,this._onConnectionId.bind(this)),this._transport.matchMessages(T,this._onPlayTokenLost.bind(this)),this._transport.matchMessages(R,this._onTrackPlaybackMessage.bind(this)),this._listPlayer.addListeners(((e={})[u.PlaybackEvent.LIST_PLAYER_CAPPED]=this._onCapped.bind(this),e[u.PlaybackEvent.LIST_PLAYER_ERROR_SYNC]=this._onError.bind(this),e[u.PlaybackEvent.LIST_PLAYER_BEFORE_NEXT]=this._onBeforeTrackChange.bind(this),e[u.PlaybackEvent.LIST_PLAYER_BEFORE_PREVIOUS]=this._onBeforeTrackChange.bind(this),e[u.PlaybackEvent.LIST_PLAYER_BEFORE_PLAYER_LOAD]=this._onBeforePlayerLoad.bind(this),e[u.PlaybackEvent.LIST_PLAYER_PLAYER_LOAD]=this._onListPlayerLoad.bind(this),e[u.PlaybackEvent.LIST_PLAYER_BEFORE_TRACK_LOAD]=this._onBeforeTrackLoad.bind(this),e[u.PlaybackEvent.LIST_PLAYER_POSITION_CHANGED]=this._onPositionChanged.bind(this),e[u.PlaybackEvent.LIST_PLAYER_DURATION_CHANGED]=this._onDurationChanged.bind(this),e[u.PlaybackEvent.LIST_PLAYER_VOLUME_CHANGED]=this._onVolumeChanged.bind(this),e[u.PlaybackEvent.LIST_PLAYER_PLAYBACK_SPEED_CHANGED]=this._onSpeedChanged.bind(this),e[u.PlaybackEvent.LIST_PLAYER_PAUSED]=this._onPlayPause.bind(this,!0),e[u.PlaybackEvent.LIST_PLAYER_PLAYING]=this._onPlayPause.bind(this,!1),e[u.PlaybackEvent.LIST_PLAYER_PLAYED_THRESHOLD_REACHED]=this._onPlayThresholdReached.bind(this),e[u.PlaybackEvent.LIST_PLAYER_PROGRESS]=this._onProgress.bind(this),e[u.PlaybackEvent.LIST_PLAYER_TRACKING_DATA_CREATED]=this._onTrackDataCreatedEvent.bind(this),e[u.PlaybackEvent.LIST_PLAYER_TRACKING_DATA_FINALIZED]=this._onTrackDataFinalizedEvent.bind(this),e)),this._descriptorPromise.then((function(e){e.on("descriptor_changed",(function(){t._parseDescriptor(e),t._updateDeviceInfo()}))}))},r.prototype._onBeforeTrackChange=function(){var e,t;if(!this._nextFinalizedDataPayload&&!this._switchingContext){var r=null!==(t=null===(e=this._currentContext)||void 0===e?void 0:e.getStateRef())&&void 0!==t?t:null,n=this._generateStatePayload(r,p.DebugSource.TRACK_DATA_FINALIZED);this._setSequenceNumber(n),this._nextFinalizedDataPayload=n}},r.prototype._onBeforeTrackLoad=function(e){var t;this._loading=!0,this._switchingContext=!1,this._currentTrackInfo.duration=void 0,this._stateEventPositionOverride=null===(t=e.data.newTrack.options)||void 0===t?void 0:t.position},r.prototype._onBeforePlayerLoad=function(e){var t,r,n,i,o,a,s,u,l,c=this._currentContext;if(c){var d=c.getCurrentTrack(),_=c.getCurrentState(),f=null!==(r=null!==(t=null==_?void 0:_.duration_override)&&void 0!==t?t:null==d?void 0:d.metadata.duration)&&void 0!==r?r:0,h=e.data,v=h.track.metadata||{},y=null===(n=null==_?void 0:_.options)||void 0===n?void 0:n.playback_speed,m=null!==(i=!!y)&&void 0!==i&&i;this._currentTrackInfo={duration:f,mediaType:h.track.mediaType.toUpperCase(),fileFormat:h.track.fileFormat,bitrate:null===(a=null===(o=h.logData)||void 0===o?void 0:o.format)||void 0===a?void 0:a.bitrate,playbackQuality:v.playbackQuality,hifiStatus:v.hifiStatus,isPlaybackSpeedRestricted:m?!!(null===(u=null===(s=null==_?void 0:_.restrictions)||void 0===s?void 0:s.disallow_setting_playback_speed_reasons)||void 0===u?void 0:u.length):!!(null===(l=h.track.options)||void 0===l?void 0:l.useDefaultPlaybackSpeed),currentPlaybackSpeed:null!=y?y:this._currentTrackInfo.selectedPlaybackSpeed,selectedPlaybackSpeed:null!=y?y:this._currentTrackInfo.selectedPlaybackSpeed};var E=h.options;c.setPaused(!E.autoplay),this._setCurrentTrackPosition(E&&E.position||0),this._updateState(p.DebugSource.BEFORE_TRACK_LOAD),this._startedPlayingUpdateSent=!1,this._initialUpdateSent=!1}},r.prototype._onCapped=function(){this._listPlayer.clear(u.Reason.CAPPED),this._currentContext=null,this._updateState(p.DebugSource.CAPPED),this._setCurrentTrackPosition(void 0),this._lastProcessedStateId=null,this.emit("state_cleared",null)},r.prototype._onConnectionId=function(e){var t=this;this._connectionId=e.data.id,this._isDeregistering||(this._registered=!1,Promise.all([this._listPlayer.getVolume(),this._descriptorPromise.then(this._parseDescriptor)]).then(this.register,(function(e){m.info("Skipping registration due to error",e),t.emit("registration_aborted",{reason_error:e,source:f.HarmonyErrorSource.TRACK_PLAYBACK})})).catch((function(){})))},r.prototype._onDurationChanged=function(e){var t,r=null===(t=this._currentContext)||void 0===t?void 0:t.getCurrentTrack();(null==r?void 0:r.metadata.uri)===e.data.track.uri&&this._currentTrackInfo.duration!==e.data.duration&&(this._currentTrackInfo.duration=e.data.duration,this._setCurrentTrackPosition(e.data.position),this._emitStateChanged())},r.prototype._onError=function(e){"position"in e.data&&(this._setCurrentTrackPosition(e.data.position),this._updateState(p.DebugSource.ERROR))},r.prototype._onSpeedChanged=function(e){this._currentTrackInfo.currentPlaybackSpeed=e.data.playback_speed,this._currentTrackInfo.selectedPlaybackSpeed=e.data.playback_speed_selected,this._setAllTrackPositions(e.data.position),this._updateState(p.DebugSource.SPEED_CHANGED)},r.prototype._onPlayPause=function(e,t){var r=this._currentContext;r&&(r.setPaused(e),"position"in t.data&&this._setAllTrackPositions(t.data.position),t.data.track.stateId&&this._shouldSendUpdateForEvent(t.data.track.stateId)?this._updateState(e?p.DebugSource.PAUSE:p.DebugSource.RESUME):(this._lastProcessedStateId=null,this._emitStateChanged()))},r.prototype._onPlayThresholdReached=function(e){this._initialUpdateSent=!0,this._setAllTrackPositions(e.data.position),this._updateState(p.DebugSource.PLAYED_THRESHOLD_REACHED)},r.prototype._onPlayTokenLost=function(){this._listPlayer.pause().catch((function(){}))},r.prototype._onPositionChanged=function(e){this._loading||(this._setCurrentTrackPosition(e.data.position),this._logger.logClientEvent({source:"harmony:track_playback:client",source_version:v.default.tagged,source_vendor:"spotify",event:e.type,event_version:"1.0.0",json_data:{track:e.data.track,event_position:e.data.position,prev_position:this._previousTrackPosition,curr_position:this._currentTrackPosition}},"object"),e.data.position===this._previousTrackPosition&&this._logger.logClientEvent({source:"harmony:track_playback:client",source_version:v.default.tagged,source_vendor:"spotify",event:e.type+" - same position as previous event",event_version:"1.0.0",json_data:{track:e.data.track,event_position:e.data.position,prev_position:this._previousTrackPosition,curr_position:this._currentTrackPosition}},"object"),e.data.track&&this._shouldSendUpdateForEvent(e.data.track.stateId)?this._updateState(p.DebugSource.POSITION_CHANGED):(this._lastProcessedStateId=null,this._emitStateChanged()))},r.prototype._onProgress=function(e){if(!this._loading&&this._currentContext&&(this._setAllTrackPositions(e.data.position),!this._startedPlayingUpdateSent&&e.data.played>1e3&&(this._startedPlayingUpdateSent=!0,this._updateState(p.DebugSource.STARTED_PLAYING)),e.data.logData)){var t=this._currentContext.getCurrentTrack(),r=t&&"number"==typeof t.ms_playing_update_interval?t.ms_playing_update_interval:null;this._initialUpdateSent&&null!==r&&r>0&&c.monotonicNow()-this._lastUpdateStateMonotonicTime>r&&this._updateState(p.DebugSource.PROGRESS)}},r.prototype._onTrackDataCreatedEvent=function(){this._waitingForTrackingData=l.createPromiseResolver()},r.prototype._onTrackDataFinalizedEvent=function(e){var t=this._nextFinalizedDataPayload;t&&(t.playback_stats=e.data.playbackStats,this._updateState(p.DebugSource.TRACK_DATA_FINALIZED,t)),this._nextFinalizedDataPayload=null,this._waitingForTrackingData&&this._waitingForTrackingData.resolve(!0)},r.prototype._onListPlayerLoad=function(e){this._loading=!1;var t=this._currentContext;t&&(t.setPaused(!e.data.autoplay),this._setCurrentTrackPosition(e.data.position||0))},r.prototype._onTrackPlaybackMessage=function(e){var t=e.payloads;Array.isArray(t)&&t.length&&this._performCommand(t[0])},r.prototype._onVolumeChanged=function(e){var t;if(this._currentGaiaVolume=e.data.volume*d.GAIA_VOLUME,this._registered){var r=null!==(t=e.data.commandId)&&void 0!==t?t:"",n={seq_num:void 0,volume:this._currentGaiaVolume,command_id:r};this._volumeDebouncer.async(n)}},r.prototype._clearSessionData=function(){this._connectionId=null,this._sequenceNumber=0,this._currentContext=null,this._lastSentStateUpdatePayload=null,this._isSendingConflict=!1,this._isSendingUpdate=!1,this._queueSendUpdate=[],this._previousTrackPosition=void 0,this._currentTrackPosition=void 0,this._currentTrackInfo={},this._lastProcessedStateId=null,this.emit("state_cleared",null)},r.prototype._createStateRef=function(e,t){if(!t)return null;var r=e.states[t.state_index];if(!r)throw new h.TrackPlayerAPIClientError(_.HarmonyErrors.TP_CANNOT_CREATE_STATE_REF,"Invalid state reference.");return{state_machine_id:e.state_machine_id,state_id:r.state_id,paused:t.paused}},r.prototype._deregisterFromService=function(e){var t=this,r=null,n=this._currentContext;n&&(e&&(n.setPaused(!e.playing),this._setAllTrackPositions(e.position)),r=n.getStateRef());var i=this._generateStatePayload(r,p.DebugSource.DEREGISTER);this._setSequenceNumber(i);var o=this._endpoint+"/v1/devices/"+this._deviceId;return this._transport.request(o,{authorize:!0,method:"DELETE",payload:JSON.stringify(i),responseType:"json",retry:P}).then((function(e){if(200!==e.status&&204!==e.status)return t._registered=!0,!1;var r=e.body;return r&&(r.endsong&&E.log(r.endsong),r.endsongs&&(g.log(r.endsongs),t.emit("internal_endcontent",{endcontents:r.endsongs}))),t._clearSessionData(),t.emit("deregistered",null),!0}))},r.prototype._emitError=function(e,t){void 0===t&&(t={}),this.emit("error",{error:e,source:f.HarmonyErrorSource.TRACK_PLAYBACK}),e.registration||this._logger.logJSSDKError({source:"tpapi-client",source_version:v.default.tagged,type:e.code,message:e&&e.message,stack:e&&e.stack,json_data:t,json_data_version:"1.0.0"},"object").catch((function(e){m.error("Track-Playback Logging Error",e)}))},r.prototype._emitStateChanged=function(){var e=this._currentContext;if(e){var t=this._currentTrackPosition||0;void 0!==this._stateEventPositionOverride&&(t=this._stateEventPositionOverride,this._stateEventPositionOverride=void 0),this.emit("state_changed",{position:t,currentTrackInfo:this._currentTrackInfo,stateMachine:e.getStateMachine(),stateRef:e.getInternalStateRef(),paused:e.isPaused(),contextMetadata:e.getContextMetadata(),loading:this._loading})}},r.prototype._generateStatePayload=function(e,t){var r,n=this._currentTrackInfo;return{seq_num:void 0,seq_nums:void 0,state_ref:e,sub_state:{playback_speed:(null==e?void 0:e.paused)?0:null!==(r=this._currentTrackInfo.currentPlaybackSpeed)&&void 0!==r?r:1,position:this._currentTrackPosition,duration:n.duration||void 0,media_type:n.mediaType,bitrate:n.bitrate,audio_quality:n.playbackQuality,format:n.fileFormat},previous_position:this._previousTrackPosition,playback_stats:void 0,rejected_state_refs:void 0,debug_source:t}},r.prototype._handleRegisterResponse=function(e){var t;if(429===e.status)return(t=h.TrackPlayerAPIClientError.fatal(_.HarmonyErrors.TP_MAX_SUBSCRIPTIONS_REACHED,"Max connections reached")).maxedSubscriptions=!0,t.status=e.status,this.emit("max_subscriptions_reached",{error:t}),Promise.reject(t);if(403===e.status&&e.body&&"PREMIUM_REQUIRED"===e.body.error_type?t=h.TrackPlayerAPIClientError.fatal(_.HarmonyErrors.TP_REGISTRATION_FAILED_NON_PREMIUM,"Cannot register to Track Playback with non-premium user."):200!==e.status?t=h.TrackPlayerAPIClientError.fatal(_.HarmonyErrors.TP_REGISTRATION_FAILED_WITH_STATUS,"track-playback service responded with status "+e.status+" when registering device"):e.body||(t=h.TrackPlayerAPIClientError.fatal(_.HarmonyErrors.TP_NO_RESPONSE_BODY,"Unexpected empty response body from registration request.")),t)return t.status=e.status,Promise.reject(t);var r=e.body;return r.endsong&&E.log(r.endsong),r.endsongs&&(g.log(r.endsongs),this.emit("internal_endcontent",{endcontents:r.endsongs})),this._sequenceNumber=r.initial_seq_num,this._registered=!0,this.emit("registered",{deviceId:this._deviceId}),Promise.resolve(!0)},r.prototype._handleStateConflictResponse=function(e){var t;if(e.status>=200&&e.status<300){var r=null===(t=e.body)||void 0===t?void 0:t.commands;if(!r||!r.length)return;for(var n=0,i=r.length;n<i;n++)this._performCommand(r[n])}else{var o=new h.TrackPlayerAPIClientError(_.HarmonyErrors.TP_CONFLICT_REQUEST_FAILED_WITH_STATUS,"Track-Playback service responded with "+e.status);o.status=e.status,this._emitError(o)}},r.prototype._handleStateUpdateResponse=function(e,t){var r;if(200!==t.status)return(r=new h.TrackPlayerAPIClientError(_.HarmonyErrors.TP_PARSE_STATE_UPDATE_FAILED_WITH_STATUS,"Service responded with status "+t.status)).status=t.status,Promise.reject(r);if(!t.body)return(r=new h.TrackPlayerAPIClientError(_.HarmonyErrors.TP_UPDATE_REQUEST_EMPTY_RESPONSE,"Unexpected empty response body from state update request.")).status=t.status,Promise.reject(r);var n=t.body;n.endsong&&E.log(n.endsong),n.endsongs&&(g.log(n.endsongs),this.emit("internal_endcontent",{endcontents:n.endsongs}));var i=this._currentContext;if(!i)return Promise.resolve();var o=n.state_machine,a=n.updated_state_ref;return this._isCurrentStateRef(e)?(i.setStateMachine(o),i.setCurrentState(a),i.setContextMetadata(n.context_metadata||null),this._emitStateChanged(),Promise.resolve()):Promise.resolve()},r.prototype._isCurrentStateRef=function(e){var t=this._currentContext?this._currentContext.getStateRef():null;return!t&&!e||!(!t||!e)&&(t.state_machine_id===e.state_machine_id&&t.state_id===e.state_id&&t.paused===e.paused)},r.prototype._logUnsentStateUpdate=function(e){m.info("Unsent state update.",e),this._logger.logClientEvent({source:"tpapi-client",source_version:v.default.tagged,source_vendor:"spotify",event:"unsent-state-update",event_version:"1.0.0",json_data:e},"object").catch((function(e){m.error("Track-Playback Logging Error",e)}))},r.prototype._logout=function(){var e=this;this._listPlayer.pause().catch((function(){})),this.emit("state_cleared",null),this.deregister().then((function(t){e._currentContext=null,e._setCurrentTrackPosition(void 0),t&&e.emit("logout",null)}))},r.prototype._parseDescriptor=function(e){return this._deviceId=e.getId(),this._deviceInfo=e.toTrackPlaybackDeviceInfo(),!0},r.prototype._performCommand=function(e){switch(e.type){case"set_volume":this._setVolume(e);break;case"log_out":this._logout();break;case"replace_state":this._replaceState(e);break;case"ping":this._updateState(p.DebugSource.PING);break;default:this._emitError(new h.TrackPlayerAPIClientError(_.HarmonyErrors.TP_UNKNOWN_COMMAND,"Received unknown command."),{command:e})}},r.prototype._rejectState=function(e){var t=this,r=this._queuedRejectedStates;if(void 0!==e&&r.push(e),this._registered&&!this._isSendingConflict&&r.length){this._isSendingConflict=!0;var n=r.splice(0,5),i=this._currentContext?this._currentContext.getStateRef():null,o=this._generateStatePayload(i);o.rejected_state_refs=n,this._setSequenceNumbers(o,n.length);var a=function(){t._isSendingConflict=!1,t._rejectState()},s=this._endpoint+"/v1/devices/"+this._deviceId+"/state_conflict";this._transport.request(s,{authorize:!0,method:"POST",headers:{"Content-Type":"application/json"},responseType:"json",payload:JSON.stringify(o),retry:P}).then(this._handleStateConflictResponse).then(a,a)}},r.prototype._replaceState=function(e){var t,r,n,i,o=this._listPlayer,a=e.state_machine,s=e.state_ref,l=this._createStateRef(a,s);if(this._isCurrentStateRef(e.prev_state_ref))if(s){var c=null!==(r=null===(t=this._currentContext)||void 0===t?void 0:t.getStateRef())&&void 0!==r?r:null;if(y.assert(null!==l,"New state reference is null"),this._currentContext&&(null==c?void 0:c.state_id)===l.state_id){var d=this._currentContext;d.setStateMachine(a),d.setCurrentState(s),d.setContextMetadata(e.context_metadata||null);var _=!1;d.isPaused()!==s.paused&&(_=!0),s.paused?(d.setPaused(!0),o.pause()):(d.setPaused(!1),o.resume());var f=a.states[s.state_index],h=null===(n=null==f?void 0:f.options)||void 0===n?void 0:n.playback_speed;h&&h!==this._currentTrackInfo.currentPlaybackSpeed&&(this._listPlayer.setPlaybackSpeed(h),_=!0);var v=parseInt(e.seek_to,10);d.allowSeeking()&&!isNaN(v)&&(o.seek(v,u.Reason.REMOTE),this._setCurrentTrackPosition(v),_=!0),_?this._emitStateChanged():(this._lastProcessedStateId=null,this._updateState(p.DebugSource.MODIFY_CURRENT_STATE))}else{this._lastProcessedStateId=null!==(i=l.state_id)&&void 0!==i?i:null,this._currentContext&&this._onBeforeTrackChange();var m=this._ListClass.create("spotify:app:jsspeaker",this._manifestTrackResolver);m.setStateMachine(a),m.startAtState(s),this._deviceId&&m.setDeviceId(this._deviceId),this._currentContext=m;var E=e.seek_to||0;m.setInitialPosition(E),this._loading=!0,this._switchingContext=!0,o.play(m,{reason:u.Reason.REMOTE})}}else this._clearContextAndState();else this._rejectState(l)},r.prototype._clearContextAndState=function(){var e=this._listPlayer;e.pause().catch((function(){})),e.clear(u.Reason.REMOTE),this._currentContext=null,this._updateState(p.DebugSource.STATE_CLEAR),this._setAllTrackPositions(void 0),this._lastProcessedStateId=null,this.emit("state_cleared",null),this._loading=!0},r.prototype._sendDevicesRequest=function(e,t){var r=this._endpoint+"/v1/devices";return"PUT"===e&&(r=r+"/"+this._deviceId),this._transport.request(r,{authorize:!0,method:e||"POST",headers:{"Content-Type":"application/json"},responseType:"json",payload:JSON.stringify(t),retry:S})},r.prototype._sendVolume=function(e){var t=this._endpoint+"/v1/devices/"+this._deviceId+"/volume";return this._setSequenceNumber(e),this._transport.request(t,{authorize:!0,method:"PUT",headers:{"Content-Type":"application/json"},payload:JSON.stringify(e)})},r.prototype._setAllTrackPositions=function(e){this._previousTrackPosition=e,this._currentTrackPosition=e},r.prototype._setCurrentTrackPosition=function(e){void 0!==e&&void 0!==this._currentTrackPosition&&e===this._currentTrackPosition||(this._previousTrackPosition=this._currentTrackPosition,this._currentTrackPosition=e)},r.prototype._setSequenceNumber=function(e){return void 0===e.seq_num&&(e.seq_num=++this._sequenceNumber),e},r.prototype._setSequenceNumbers=function(e,t){e.seq_nums=[];for(var r=0;r<t;r++)e.seq_nums.push(++this._sequenceNumber);return e},r.prototype._setVolume=function(e){var t,r=e.volume/d.GAIA_VOLUME;this._listPlayer.setVolume(r,null!==(t=e.command_id)&&void 0!==t?t:"tpcommand-"+Date.now())},r.prototype._shouldSendUpdateForEvent=function(e){return!(!e||e===this._lastProcessedStateId)},r.prototype._updateDeviceInfo=function(){var e=this;this._registered&&this._deviceInfo&&this._sendDevicesRequest("PUT",this._deviceInfo).then((function(t){204===t.status&&e.emit("registration_updated",null)}))},r.prototype._updateState=function(e,t){var r,i,o,a,s=this;if(this._registered)if(t?(o=t.state_ref,a=t):(o=null!==(i=null===(r=this._currentContext)||void 0===r?void 0:r.getStateRef())&&void 0!==i?i:null,a=this._generateStatePayload(o,e)),this._shouldSendPayload(a)){if(this._emitStateChanged(),this._isSendingUpdate&&this._limitStateUpdates)return this._logUnsentStateUpdate(a),void this._queueSendUpdate.push(e);this._isSendingUpdate=!0,this._queueSendUpdate=[],this._setSequenceNumber(a),this._lastSentStateUpdatePayload=a;var u=function(){s._isSendingUpdate=!1,s._queueSendUpdate.length&&s._updateState(s._queueSendUpdate[s._queueSendUpdate.length-1]),m.info("State update sent.",e,a)},l=this._endpoint+"/v1/devices/"+this._deviceId+"/state";this._lastUpdateStateMonotonicTime=c.monotonicNow(),this._transport.request(l,{authorize:!0,method:"PUT",headers:{"Content-Type":"application/json"},responseType:"json",payload:JSON.stringify(a),retry:S}).then(this._handleStateUpdateResponse.bind(this,o)).then(u,(function(e){!function(e){return"object"===n(e)&&null!==e&&"code"in e}(e)?s._emitError(new h.TrackPlayerAPIClientError(_.HarmonyErrors.TP_STATE_UPDATE_FAILED,""+e)):s._emitError(e),u()}))}else m.info("State update ignored (duplicate).",a)},r.prototype._shouldSendPayload=function(e){var t=this._lastSentStateUpdatePayload;if(!t||!t.state_ref||!e.state_ref)return!0;var r=e.state_ref,n=t.state_ref;if(r.paused!==n.paused||r.state_id!==n.state_id||r.state_machine_id!==n.state_machine_id)return!0;var i=e.sub_state,o=t.sub_state;if(i.playback_speed!==o.playback_speed||i.position!==o.position)return!0;if(e.previous_position!==t.previous_position)return!0;return Math.abs((i.duration||0)-(o.duration||0))>=51},r.prototype.stop=function(){return!(!this._registered||!this._currentContext)&&(this._clearContextAndState(),!0)},r.prototype.deregister=function(){var e=this;return this._registered?(this._isDeregistering=!0,this._registered=!1,this._listPlayer.getPlayerState().then((function(t){return Promise.all([e._deregisterFromService(t),e._waitingForTrackingData.promise,e._listPlayer.stop().catch((function(){}))]).then((function(t){var r=t[0];return e._isDeregistering=!1,r}))}),(function(){return e._isDeregistering=!1,e._registered=!0,!1}))):Promise.resolve(!1)},r.prototype.register=function(){var e,r=this;if(this._registered)return Promise.resolve(!1);if(!this._deviceInfo)return Promise.reject(new Error("Need DeviceInfo for device registration."));if(!this._connectionId)return Promise.reject(new Error("Need connection-id for device registration"));var n=this._currentContext;return n&&(e=this._generateStatePayload(n.getStateRef(),p.DebugSource.REGISTER),this._setSequenceNumber(e)),this._sendDevicesRequest("POST",{device:this._deviceInfo,outro_endcontent_snooping:"true"===t.env.OUTRO_SNOOPING,connection_id:this._connectionId,client_version:this._clientVersion,previous_session_state:e,volume:this._currentGaiaVolume}).then(this._handleRegisterResponse).catch((function(e){return e&&!e.maxedSubscriptions&&(e.registration=!0,r._emitError(e)),!1}))},r.prototype.hasOptimisticUpdates=function(){return!1},r}(a.EventEmitter);r.TrackPlaybackServiceClient=b}).call(this)}).call(this,e("_process"))},{"../../enums/debug_source":134,"../../enums/error_source":138,"../../enums/errors":139,"../../error/track_playback/client":150,"../../typedefs":154,"../../utils/assert":155,"../../version":160,"@js-sdk/common/es5/debouncer":5,"@js-sdk/common/es5/debug_tools":9,"@js-sdk/common/es5/monotonic_now":15,"@js-sdk/common/es5/promise_resolver":16,"@js-sdk/playback/es5":102,"@spotify-internal/emitter/es5":109,_process:225,tslib:227}],130:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TrackPlayerServiceContext=void 0;var n=e("@js-sdk/playback/es5"),i=e("@spotify-internal/uri/es5"),o=e("../../enums/errors"),a=e("../../error/track_playback/client"),s=function(){function e(e,t){this._stateMachine=null,this._currentState=null,this._currentStateIndex=null,this._pausedState=!1,this._initialPlaybackPosition=null,this._contextMetadata=null,this._uri=e,this._manifestTrackResolver=t}return e.create=function(t,r){return new e(t,r)},e.prototype.setPaused=function(e){this._pausedState=e},e.prototype.isPaused=function(){return this._currentStateIndex&&this._currentStateIndex<0&&this._currentState&&this._currentState.transitions.advance?!!this._currentState.transitions.advance.paused:this._pausedState},e.prototype.setInitialPosition=function(e){this._initialPlaybackPosition=e},e.prototype.setStateMachine=function(e){this._stateMachine=e},e.prototype.setDeviceId=function(e){this._deviceId=e},e.prototype.setContextMetadata=function(e){this._contextMetadata=e},e.prototype.getContextMetadata=function(){return this._contextMetadata||{}},e.prototype.startAtState=function(e){var t=this._stateMachine&&this._stateMachine.states[e.state_index];if(!t)throw new a.TrackPlayerAPIClientError(o.HarmonyErrors.TP_MISSING_INITIAL_STATE,"Invalid state reference.");var r=t.transitions;this._currentStateIndex=-1,this._currentState={decoy:!0,paused:!!e.paused,track:-1,state_id:null,transitions:{advance:e,show_next:r.show_next,show_prev:r.show_prev,skip_next:e,skip_prev:r.skip_prev},options:t.options,duration_override:t.duration_override,position_offset:t.position_offset}},e.prototype.setCurrentState=function(e){var t=e.state_index;this._currentStateIndex=t,this._currentState=this._stateMachine&&this._stateMachine.states[t]},e.prototype.getStateMachine=function(){return this._stateMachine},e.prototype.getInternalStateRef=function(){var e=this._pausedState,t=this._currentStateIndex;if(!t)return null;if(t&&t<0){var r=this._currentState&&this._currentState.transitions.advance;r&&(t=r.state_index,e=!!r.paused)}return{paused:e,state_index:t}},e.prototype.getStateRef=function(){var e,t,r=this._stateMachine;if(!r||null===this._currentStateIndex)return null;if(this._currentStateIndex<0){var n=this._currentState&&this._currentState.transitions.advance;n&&(e=r.states[n.state_index],t=n.paused)}else e=r.states[this._currentStateIndex],t=this._pausedState;return e?{state_machine_id:r.state_machine_id,state_id:e.state_id,paused:!!t}:null},e.prototype.getCurrentTrack=function(){var e,t=this._stateMachine;if(!t||null===this._currentStateIndex)return null;if(this._currentStateIndex<0){var r=this._currentState&&this._currentState.transitions.advance;r&&(e=t.states[r.state_index])}else e=t.states[this._currentStateIndex];return e?t.tracks[e.track]:null},e.prototype.startAt=function(){return Promise.resolve(n.OperationResult.SUCCESS)},e.prototype.setShuffle=function(){return Promise.resolve(n.OperationResult.SUCCESS)},e.prototype.setRepeatMode=function(){return Promise.resolve(n.OperationResult.SUCCESS)},e.prototype.next=function(e){var t=this._currentState,r=null;if(t){var i=t.transitions;switch(e.reason){case n.Reason.FORWARD_BUTTON:"skip_next"in i&&(r=i.skip_next);break;default:"advance"in i&&(r=i.advance)}}return this._transitionTo(e,r,!1)},e.prototype.peekNext=function(e){var t=this._currentState,r=null;if(t){var i=t.transitions;switch(e.reason){case n.Reason.FORWARD_BUTTON:"skip_next"in i&&(r=i.skip_next);break;default:"advance"in i&&(r=i.advance)}}return this._transitionTo(e,r,!0)},e.prototype.previous=function(e){var t=this._currentState,r=null;t&&(r=t.transitions.skip_prev);return this._transitionTo(e,r,!1)},e.prototype.translatePosition=function(e){var t,r;return(null!==(r=null===(t=this._currentState)||void 0===t?void 0:t.position_offset)&&void 0!==r?r:0)+e},e.prototype.translateDuration=function(e){var t,r;return null!==(r=null===(t=this._currentState)||void 0===t?void 0:t.duration_override)&&void 0!==r?r:e},e.prototype.handleSeek=function(e,t){var r;return(null===(r=this._currentState)||void 0===r?void 0:r.duration_override)&&t.reason!==n.Reason.REMOTE?t.listConstants.IGNORE:e},e.prototype.allowSeeking=function(){return!!this._currentState&&!this._currentState.disallow_seeking},e.prototype._transitionTo=function(e,t,r){var n=this;return void 0===r&&(r=!1),new Promise((function(o){var a,s=e.reason,u=e.listConstants;if(!t)return o(u.FORBIDDEN);var l=n._stateMachine;if(!l)return o(u.NULL_VALUE);var c=l.states[t.state_index];if(!c)return o(u.NULL_VALUE);var d=l.tracks[c.track];if(!(null===(a=null==d?void 0:d.metadata)||void 0===a?void 0:a.uri))return o(u.NULL_VALUE);if(!n._currentState)return o(u.NULL_VALUE);var _=n._currentState,p=_.decoy?!!_.paused:t.paused;r||(n._currentState=c,n._currentStateIndex=t.state_index,n._pausedState=!!p);var f=0;return r||null===n._initialPlaybackPosition?"initial_playback_position"in c&&(f=c.initial_playback_position||0):(f=n._initialPlaybackPosition,n._initialPlaybackPosition=null),n._manifestTrackResolver.resolveFromStateTrack(d).then((function(e){var t,r;if(!e)return o(u.NULL_VALUE);var a=n._uri;d.metadata&&d.metadata.context_uri&&(a=d.metadata.context_uri);var l=s,_=d.ms_played_until_update,h={playbackQuality:e.playbackQuality,hifiStatus:e.hifi_status},v={uri:e.uri,playableURI:e.uri,fileId:e.fileId,resolvedURL:e.resolvedURL,playable:e.playable,isAd:e.isAd,format:e.format,fileFormat:e.fileFormat,mediaType:e.mediaType,noManifest:e.noManifest,metadata:h,options:{position:f,paused:p,playedThreshold:_,useDefaultPlaybackSpeed:!i.isEpisodeURI(e.uri),playbackSpeed:null===(r=null===(t=n._currentState)||void 0===t?void 0:t.options)||void 0===r?void 0:r.playback_speed},logData:{noLog:!!e.noLog,noTSV:!!e.noTSV,deviceId:n._deviceId,playbackId:c.state_id?c.state_id:void 0,reason:l,displayTrack:e.uri,playContext:a,impressionURL:e.impressionURL,impressionURLs:e.impressionURLs,format:{codec:e.format,bitrate:e.bitrate},uriType:e.uriType,displayTitle:d.metadata.name,displayGroup:d.metadata.group_name,displayDuration:d.metadata.duration,playbackService:"track-playback"},stateId:c.state_id?c.state_id:void 0,audioGain:e.gainDb};return o(v)}))}))},e.prototype.getCurrentState=function(){return this._currentState},e}();r.TrackPlayerServiceContext=s},{"../../enums/errors":139,"../../error/track_playback/client":150,"@js-sdk/playback/es5":102,"@spotify-internal/uri/es5":216}],131:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TPPlaybackStateObserver=void 0;var n=e("tslib"),i=e("@spotify-internal/uri/es5"),o=e("@spotify-internal/emitter/es5"),a=e("@js-sdk/common/es5/debug_tools"),s=e("@js-sdk/playback/es5"),u=e("../../enums/repeat_mode"),l=e("../../enums/hifi_status"),c=e("../../enums/shuffle_mode"),d=e("../playback_state_observer"),_=a.logging.forTag("tp.stream.PlaybackStateObserver"),p=function(e){function t(t,r){void 0===r&&(r={});var n=e.call(this)||this;return n._tpApiClient=t,n._numPreviousTracks=r.numPrevious||2,n._numNextTracks=r.numNextTracks||2,n._currentState=null,n._init(),n}return n.__extends(t,e),t.create=function(e,r){return new t(e,r)},t.prototype._init=function(){this._tpApiClient.on("state_changed",this._onStateChanged.bind(this)),this._tpApiClient.on("state_cleared",this._onStateCleared.bind(this))},t.prototype._onStateChanged=function(e){var t,r,i,o,a,u,p,f,h,v,y=e.data,m=y.stateMachine,E=y.stateRef,g=y.position,R=y.paused,T=y.loading,I=y.currentTrackInfo,S=y.contextMetadata,P=null==m?void 0:m.states;if(m&&(null==P?void 0:P.length)&&E){var b=P[E.state_index],A=m.tracks[null==b?void 0:b.track];if(b&&A){var L=b.options,C=null!==(t=I.duration)&&void 0!==t?t:0,O=this._createTrackWindow(m,b,C);C||(C=null!==(i=null===(r=O.current_track)||void 0===r?void 0:r.duration_ms)&&void 0!==i?i:0),!(null!==(o=!!(null==L?void 0:L.playback_speed))&&void 0!==o&&o)&&I.isPlaybackSpeedRestricted&&(b.restrictions=n.__assign({disallow_setting_playback_speed_reasons:["not_supported_by_content_type"]},b.restrictions));var N=d.parseRestrictions(b.restrictions||{},R),D=d.parseDisallows(N),M={current:R?0:null!==(a=I.currentPlaybackSpeed)&&void 0!==a?a:1,selected:D.setting_playback_speed?1:null!==(u=I.selectedPlaybackSpeed)&&void 0!==u?u:1,restricted:!!D.setting_playback_speed},k={timestamp:Date.now(),context:{uri:null!==(f=null===(p=A.metadata)||void 0===p?void 0:p.context_uri)&&void 0!==f?f:null,metadata:S},position:g,duration:C,paused:R,playback_quality:null!==(h=I.playbackQuality)&&void 0!==h?h:s.PlaybackQuality.UNKNOWN,playback_features:{hifi_status:null!==(v=I.hifiStatus)&&void 0!==v?v:l.HiFiStatus.NONE,playback_speed:M,signal_ids:b.signals||[],modes:(null==L?void 0:L.modes)||{}},shuffle:this._getShuffleSetting(m),shuffle_mode:c.getShuffleMode(null==L?void 0:L.shuffling_context,null==L?void 0:L.modes),repeat_mode:this._getRepeatSetting(m),track_window:O,restrictions:N,disallows:D,loading:T,playback_speed:M.current,playback_id:b.state_id};this._currentState=k,this.emit("state_changed",{state:k?n.__assign({},k):null})}else _.warn("_onStateChanged called with no current state or track",e)}else _.warn("_onStateChanged called with no current state",e)},t.prototype._createTrackWindow=function(e,t,r){var n=this,i=e.states;return{current_track:this._getTrackMetadata(e,t,r),next_tracks:this._getNextStates(t,i).map((function(t){return n._getTrackMetadata(e,t,null)})).filter((function(e){return!!e})),previous_tracks:this._getPreviousStates(t,i).map((function(t){return n._getTrackMetadata(e,t,null)})).filter((function(e){return!!e}))}},t.prototype._onStateCleared=function(){this._currentState=null,this.emit("state_changed",{state:null})},t.prototype._getRepeatSetting=function(e){var t=e.attributes.options;return t.repeating_track?u.RepeatMode.TRACK:t.repeating_context?u.RepeatMode.CONTEXT:u.RepeatMode.OFF},t.prototype._getShuffleSetting=function(e){return e.attributes.options.shuffling_context},t.prototype._getNextStates=function(e,t){for(var r=this._numNextTracks,n=[],i=e;i&&"show_next"in i.transitions&&i.transitions.show_next;){var o=t[i.transitions.show_next.state_index];if(o&&n.push(o),i=o,n.length>=r)break}return n},t.prototype._getPreviousStates=function(e,t){for(var r=this._numPreviousTracks,n=[],i=e;i&&"show_prev"in i.transitions&&i.transitions.show_prev;){var o=t[i.transitions.show_prev.state_index];if(o&&n.unshift(o),i=o,n.length>=r)break}return n},t.prototype._getTrackMetadata=function(e,t,r){var o,a,s=null==e?void 0:e.tracks[t.track];if(!(null==s?void 0:s.metadata))return null;var u=s.metadata,l=s.manifest&&"manifest_ids_video"in s.manifest,c=s.track_type.toLowerCase(),d=i.parseURI(u.uri),_=u.linked_from_uri?i.parseURI(u.linked_from_uri):null,p=null===(o=u.episode_content_type)||void 0===o?void 0:o.toLowerCase(),f={episode:p||"unknown",track:"music",ad:"ad",interruption:"ad",media:"narration"},h="unknown";(null==d?void 0:d.type)&&d.type in f&&(h=f[d.type]);var v=null===(a=u.images)||void 0===a?void 0:a.map((function(e){if(0===e.url.indexOf("spotify:image:")){var t=e.url.split(":").slice(-1)[0];return n.__assign(n.__assign({},e),{url:"https://i.scdn.co/image/"+t})}return e}));return{id:d?d.id:null,uri:u.uri,type:(null==d?void 0:d.type)||"unknown",uid:t.track_uid,linked_from:{uri:u.linked_from_uri||null,id:_?_.id:null},media_type:l?"video":"audio",track_type:c,content_type:h,name:u.name,duration_ms:r||u.duration,artists:u.authors,album:{uri:u.group_uri,name:u.group_name,images:v},is_playable:!0,metadata:t.track_metadata||{}}},t.prototype.getCurrentState=function(){var e=this._currentState;if(e&&!e.paused){var t=Date.now(),r=e.position+(t-e.timestamp);e.position=r,e.timestamp=t}return Promise.resolve(this._currentState?n.__assign({},this._currentState):null)},t}(o.EventEmitter);r.TPPlaybackStateObserver=p},{"../../enums/hifi_status":141,"../../enums/repeat_mode":144,"../../enums/shuffle_mode":145,"../playback_state_observer":126,"@js-sdk/common/es5/debug_tools":9,"@js-sdk/playback/es5":102,"@spotify-internal/emitter/es5":109,"@spotify-internal/uri/es5":216,tslib:227}],132:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createHarmonyClient=void 0;var n=e("./_internal/client");r.createHarmonyClient=function(e){return n.HarmonyClient.create(e)}},{"./_internal/client":110}],133:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createControllerForClient=void 0;var n=e("@spotify-internal/transport/es5/server_time"),i=e("./_internal/controller"),o=e("./_internal/connect_state/client"),a=e("./_internal/connect_state/command_tracker");r.createControllerForClient=function(e,t){void 0===t&&(t={});var r=e.getPublicTransport(),s=e.getVersionDescriptor().tagged,u=o.PlayerAPIClient.create({autoregister:!("autoregister"in t)||t.autoregister,descriptor:e.getClientDescriptor(),transport:r,tracker:new a.CommandTracker(e.getLogger())});return i.HarmonyController.create({client:e,playerClient:u,version:s,serverTime:n.ServerTime.create(r),decorateTrackWindow:"boolean"!=typeof t.decorateTrackWindow||t.decorateTrackWindow,disableProgress:t.disableProgress})}},{"./_internal/connect_state/client":115,"./_internal/connect_state/command_tracker":116,"./_internal/controller":117,"@spotify-internal/transport/es5/server_time":198}],134:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DebugSource=void 0,function(e){e.TRACK_DATA_FINALIZED="track_data_finalized",e.DEREGISTER="deregister",e.REGISTER="register",e.BEFORE_TRACK_LOAD="before_track_load",e.CAPPED="capped",e.ERROR="error",e.PAUSE="pause",e.RESUME="resume",e.PLAYED_THRESHOLD_REACHED="played_threshold_reached",e.POSITION_CHANGED="position_changed",e.SPEED_CHANGED="speed_changed",e.STARTED_PLAYING="started_playing",e.PROGRESS="progress",e.PING="ping",e.MODIFY_CURRENT_STATE="modify_current_state",e.STATE_CLEAR="state_clear"}(r.DebugSource||(r.DebugSource={}))},{}],135:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeviceDeactivatedReason=void 0,function(e){e.LOCAL_PLAYER_DISABLED="local_player_disabled",e.STOPPED="stopped",e.REMOTE_ACTIVATED="remote_activated",e.UNKNOWN="unknown"}(r.DeviceDeactivatedReason||(r.DeviceDeactivatedReason={}))},{}],136:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeviceType=void 0,function(e){e.UNKNOWN="unknown",e.COMPUTER="computer",e.TABLET="tablet",e.SMARTPHONE="smartphone",e.SPEAKER="speaker",e.TV="tv",e.AVR="avr",e.STB="stb",e.AUDIO_DONGLE="audio_dongle",e.GAME_CONSOLE="game_console",e.CAST_VIDEO="cast_video",e.CAST_AUDIO="cast_audio",e.AUTOMOBILE="automobile",e.SMARTWATCH="smartwatch",e.CHROMEBOOK="chromebook"}(r.DeviceType||(r.DeviceType={}))},{}],137:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DisallowTransferReason=void 0,function(e){e.INCOMPATIBLE="incompatible",e.UNAVAILABLE="unavailable",e.AD_PLAYING="ad_playing",e.NARRATION="narration",e.WAKING_UP="waking_up",e.TIMED_OUT_WAKEUP="timed_out_wakeup",e.PREMIUM_REQUIRED="premium_required",e.NOT_INSTALLED="not_installed",e.UNSUPPORTED="unsupported",e.NOT_AUTHORIZED="not_authorized"}(r.DisallowTransferReason||(r.DisallowTransferReason={}))},{}],138:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HarmonyErrorSource=void 0,function(e){e.CLOUD_PLAYBACK="cloud-playback",e.CONNECT_API="connect-api",e.HARMONY="harmony",e.PLAYBACK="playback",e.TRACK_PLAYBACK="track-playback",e.TRANSPORT="transport"}(r.HarmonyErrorSource||(r.HarmonyErrorSource={}))},{}],139:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HarmonyErrors=void 0,function(e){e.USER_INFO_REQUEST_EMPTY_RESPONSE="USER_INFO_REQUEST_EMPTY_RESPONSE",e.USER_INFO_REQUEST_FAILED_WITH_STATUS="USER_INFO_REQUEST_FAILED_WITH_STATUS",e.HARMONY_NO_TRACKS_LOADED="HARMONY_NO_TRACKS_LOADED",e.HARMONY_OPERATION_FORBIDDEN="HARMONY_OPERATION_FORBIDDEN",e.HARMONY_LOCAL_PLAYER_DISABLED="HARMONY_LOCAL_PLAYER_DISABLED",e.HARMONY_INVALID_DESCRIPTOR_ID="HARMONY_INVALID_DESCRIPTOR_ID",e.HARMONY_INVALID_MEDIA_TYPE="HARMONY_INVALID_MEDIA_TYPE",e.CONNECTAPI_CLIENT_INVALID_ARGUMENTS="CONNECTAPI_CLIENT_INVALID_ARGUMENTS",e.CONNECTAPI_CLIENT_MISSING_DEVICE_ID="CONNECTAPI_CLIENT_MISSING_DEVICE_ID",e.CONNECTAPI_CLIENT_NO_CONNECTION_ID="CONNECT_API_CLIENT_NO_CONNECTION_ID",e.CONNECTAPI_CLIENT_NO_DEVICE="CONNECTAPI_CLIENT_NO_DEVICE",e.CONNECTAPI_CLIENT_NO_SESSION_ID="CONNECTAPI_CLIENT_NO_SESSION_ID",e.CONNECTAPI_CLIENT_NO_STATE="CONNECTAPI_CLIENT_NO_STATE",e.CONNECTAPI_CLIENT_INVALID_POSITION="CONNECT_API_CLIENT_INVALID_POSITION",e.CONNECTAPI_CLIENT_INVALID_VOLUME="CONNECT_API_CLIENT_INVALID_VOLUME",e.CONNECTAPI_MAX_SUBSCRIPTIONS_REACHED="CONNECTAPI_MAX_SUBSCRIPTIONS_REACHED",e.CONNECTAPI_REGISTRATION_FAILED_WITH_STATUS="CONNECTAPI_REGISTRATION_FAILED_WITH_STATUS",e.CONNECTAPI_CLIENT_ACK_TIMEOUT="CONNECTAPI_CLIENT_ACK_TIMEOUT",e.CP_NO_DEVICE_DESCRIPTOR="CP_NO_DEVICE_DESCRIPTOR",e.CP_NO_CONNECTION_ID="CP_NO_CONNECTION_ID",e.CP_REGISTRATION_FAILED_WITH_STATUS="CP_REGISTRATION_FAILED_WITH_STATUS",e.CP_REGISTRATION_FAILED_NON_PREMIUM="CP_REGISTRATION_FAILED_NON_PREMIUM",e.CP_REQUEST_FAILED_WITH_STATUS="CP_REQUEST_FAILED_WITH_STATUS",e.CP_NO_DEVICE_ID="CP_NO_DEVICE_ID",e.CP_NO_RESPONSE_BODY="CP_NO_RESPONSE_BODY",e.CP_NO_TRACKING_DATA="CP_NO_TRACKING_DATA",e.CP_INVALID_STATE="CP_INVALID_STATE",e.CP_NO_PLAYBACK_ID="CP_NO_PLAYBACK_ID",e.QUEUE_MANAGER_NO_STATE="QUEUE_MANAGER_NO_STATE",e.QUEUE_OPERATION_FORBIDDEN="QUEUE_OPERATION_FORBIDDEN",e.QUEUE_OPERATION_STALE_REVISION="QUEUE_OPERATION_STALE_REVISION",e.TP_NO_RESPONSE_BODY="TP_NO_RESPONSE_BODY",e.TP_REGISTRATION_FAILED_NON_PREMIUM="TP_REGISTRATION_FAILED_NON_PREMIUM",e.TP_REGISTRATION_FAILED_WITH_STATUS="TP_REGISTRATION_FAILED_WITH_STATUS",e.TP_STATE_UPDATE_FAILED="TP_STATE_UPDATE_FAILED",e.TP_MAX_SUBSCRIPTIONS_REACHED="TP_MAX_SUBSCRIPTIONS_REACHED",e.TP_UPDATE_REQUEST_EMPTY_RESPONSE="TP_UPDATE_REQUEST_EMPTY_RESPONSE",e.TP_PARSE_STATE_UPDATE_FAILED_WITH_STATUS="TP_PARSE_STATE_UPDATE_FAILED_WITH_STATUS",e.TP_SET_OPTIONS_FAILED_WITH_STATUS="TP_SET_OPTIONS_FAILED_WITH_STATUS",e.TP_UNKNOWN_COMMAND="TP_UNKNOWN_COMMAND",e.TP_CANNOT_CREATE_STATE_REF="TP_CANNOT_CREATE_STATE_REF",e.TP_MISSING_INITIAL_STATE="TP_MISSING_INITIAL_STATE",e.TP_INVALID_STATE_REFERENCE="TP_INVALID_STATE_REFERENCE",e.TP_CONFLICT_REQUEST_FAILED_WITH_STATUS="TP_CONFLICT_REQUEST_FAILED_WITH_STATUS"}(r.HarmonyErrors||(r.HarmonyErrors={}))},{}],140:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HarmonyEvent=void 0,function(e){e.AUTHENTICATED="authenticated",e.AUTHENTICATION_ERROR="authentication_error",e.AUTOPLAY_FAILED="autoplay_failed",e.BEFORE_DISCONNECT="before_disconnect",e.BEFORE_VOLUME_CHANGE="before_volume_change",e.BUFFER_STALLED="stalled",e.BUFFERING_END="buffering_end",e.BUFFERING_START="buffering_start",e.REBUFFERING_END="rebuffering_end",e.REBUFFERING_START="rebuffering_start",e.CONNECTED="connected",e.CONNECTION_ERROR="connection_error",e.DEVICES_CHANGED="devices_changed",e.DEVICE_DEACTIVATED="device_deactivated",e.DEVICE_DESCRIPTOR_CHANGED="descriptor_changed",e.DISCONNECTED="disconnected",e.DISPLAYED_CUES_CHANGED="displayed_cues_changed",e.DURATION_CHANGED="duration_changed",e.ERROR="error",e.LAST_ACTIVE_DEVICE_INFO_CHANGED="last_active_device_info_changed",e.LOCAL_CONTEXT_ENDED="local_context_ended",e.LOCAL_PLAYER_DISABLED="local_player_disabled",e.LOCAL_PLAYER_ENABLED="local_player_enabled",e.LOCAL_PLAYER_LOGGED_OUT="local_player_logged_out",e.LOGGED_OUT="logged_out",e.MAX_LIST_ERRORS_REACHED="max_list_errors_reached",e.MAX_SUBSCRIPTIONS_REACHED="max_subscriptions_reached",e.PLAYBACK_CAPPED="playback_capped",e.PLAYER_INITIALIZATION_DONE="player_initialization_done",e.PLAYER_INITIALIZATION_FAILED="player_initialization_failed",e.PLAYING_PROFILE_CHANGED="playing_profile_changed",e.PRODUCT_STATE_CHANGED="product_state_changed",e.PROGRESS="progress",e.PLAYER_QUEUE_CHANGED="player_queue_changed",e.RECONNECTED="reconnected",e.RECONNECTING="reconnecting",e.REMOTE_OBSERVER_DISABLED="remote_observer_disabled",e.REMOTE_OBSERVER_ENABLED="remote_observer_enabled",e.REPORTING_START="reporting_start",e.REPORTING_FIRST_QUARTILE="reporting_first_quartile",e.REPORTING_MIDPOINT="reporting_midpoint",e.REPORTING_THIRD_QUARTILE="reporting_third_quartile",e.REPORTING_COMPLETE="reporting_complete",e.REPORTING_PAUSE="reporting_pause",e.REPORTING_RESUME="reporting_resume",e.REPORTING_CREATIVE_VIEW="reporting_creative_view",e.REPORTING_ERROR="reporting_error",e.SERVICE_REGISTRATION_ERROR="service_registration_error",e.SPEED_CHANGED="speed_changed",e.STATE_CHANGED="state_changed",e.STOPPED_ON_BACKGROUND="stopped_on_background",e.SUBTITLE_LANGUAGES_LOADED="subtitle_languages_loaded",e.TRACK_ENDED="track_ended",e.UNRECOVERABLE_FAILURE="unrecoverable_failure",e.VIDEO_ELEMENT_APPENDED="video_element_appended",e.VIDEO_ELEMENT_REMOVED="video_element_removed",e.VOLUME_CHANGED="volume_changed"}(r.HarmonyEvent||(r.HarmonyEvent={}))},{}],141:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HiFiStatus=void 0,function(e){e.ON="ON",e.OFF="OFF",e.NONE="NONE"}(r.HiFiStatus||(r.HiFiStatus={}))},{}],142:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.License=void 0,function(e){e.PREMIUM="premium",e.TFT="tft"}(r.License||(r.License={}))},{}],143:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ManifestFormat=void 0,function(e){e.FILE_URLS_MP3="file_urls_mp3",e.FILE_URLS_EXTERNAL="file_urls_external",e.FILE_IDS_MP3="file_ids_mp3",e.FILE_IDS_MP4="file_ids_mp4",e.FILE_IDS_MP4_DUAL="file_ids_mp4_dual",e.FILE_IDS_CBCS="file_ids_mp4_cbcs",e.FILE_IDS_MP4FLAC="file_ids_mp4flac",e.MANIFEST_IDS_VIDEO="manifest_ids_video",e.MANIFEST_URLS_VIDEO_AD="manifest_urls_video_ad",e.MANIFEST_URLS_AUDIO_AD="manifest_urls_audio_ad"}(r.ManifestFormat||(r.ManifestFormat={}))},{}],144:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RepeatMode=void 0,function(e){e[e.OFF=0]="OFF",e[e.CONTEXT=1]="CONTEXT",e[e.TRACK=2]="TRACK"}(r.RepeatMode||(r.RepeatMode={}))},{}],145:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.getShuffleMode=r.ShuffleMode=void 0,function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON",e[e.SMART=2]="SMART"}(n=r.ShuffleMode||(r.ShuffleMode={})),r.getShuffleMode=function(e,t){return e&&"RECOMMENDATION"===(null==t?void 0:t.context_enhancement)?n.SMART:n[e?"ON":"OFF"]}},{}],146:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CloudPlaybackClientError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.status=-1,n.unrecoverable=!1,n.debug={},n.registration=!1,n.code=t,n.name="CloudPlaybackClientError",n}return n.__extends(t,e),t.fatal=function(e,r){var n=new t(e,r);return n.unrecoverable=!0,n},t}(Error);r.CloudPlaybackClientError=i},{tslib:227}],147:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PlayerAPIClientError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.status=-1,n.maxedSubscriptions=!1,n.unrecoverable=!1,n.debug={},n.code=t,n.name="PlayerAPIClientError",n}return n.__extends(t,e),t.fatal=function(e,r){var n=new t(e,r);return n.unrecoverable=!0,n},t}(Error);r.PlayerAPIClientError=i},{tslib:227}],148:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HarmonyError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.status=-1,n.unrecoverable=!1,n.debug={},n.code=t,n.name="HarmonyError",n}return n.__extends(t,e),t.fatal=function(e,r){var n=new t(e,r);return n.unrecoverable=!0,n},t}(Error);r.HarmonyError=i},{tslib:227}],149:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PlayerQueueError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.unrecoverable=!1,n.code=t,n.name="PlayerQueueError",n}return n.__extends(t,e),t}(Error);r.PlayerQueueError=i},{tslib:227}],150:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TrackPlayerAPIClientError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.status=-1,n.maxedSubscriptions=!1,n.unrecoverable=!1,n.debug={},n.registration=!1,n.code=t,n.name="TrackPlayerAPIClientError",n}return n.__extends(t,e),t.fatal=function(e,r){var n=new t(e,r);return n.unrecoverable=!0,n},t}(Error);r.TrackPlayerAPIClientError=i},{tslib:227}],151:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createHarmonyAndTransport=r.createHarmony=r.HarmonyError=r.LOCAL_DEVICE_ID=r.HiFiStatus=r.DeviceDeactivatedReason=r.ShuffleMode=r.RepeatMode=r.HarmonyEvent=r.HarmonyErrorSource=r.DeviceType=r.PlaybackQuality=r.Robustness=r.MediaCodec=r.KeySystem=void 0;var n=e("tslib"),i=e("@js-sdk/playback/es5/enums/errors"),o=e("@spotify-internal/transport/es5/enums/errors"),a=e("./enums/errors"),s=e("./utils/create_transport"),u=e("./_internal/harmony"),l=e("./client"),c=e("./streamer"),d=e("./controller"),_=e("@js-sdk/playback/es5");Object.defineProperty(r,"KeySystem",{enumerable:!0,get:function(){return _.KeySystem}}),Object.defineProperty(r,"MediaCodec",{enumerable:!0,get:function(){return _.MediaCodec}}),Object.defineProperty(r,"Robustness",{enumerable:!0,get:function(){return _.Robustness}}),Object.defineProperty(r,"PlaybackQuality",{enumerable:!0,get:function(){return _.PlaybackQuality}});var p=e("./enums/device_type");Object.defineProperty(r,"DeviceType",{enumerable:!0,get:function(){return p.DeviceType}});var f=e("./enums/error_source");Object.defineProperty(r,"HarmonyErrorSource",{enumerable:!0,get:function(){return f.HarmonyErrorSource}});var h=e("./enums/harmony_event");Object.defineProperty(r,"HarmonyEvent",{enumerable:!0,get:function(){return h.HarmonyEvent}});var v=e("./enums/repeat_mode");Object.defineProperty(r,"RepeatMode",{enumerable:!0,get:function(){return v.RepeatMode}});var y=e("./enums/shuffle_mode");Object.defineProperty(r,"ShuffleMode",{enumerable:!0,get:function(){return y.ShuffleMode}});var m=e("./enums/device_deactivated_reason");Object.defineProperty(r,"DeviceDeactivatedReason",{enumerable:!0,get:function(){return m.DeviceDeactivatedReason}});var E=e("./enums/hifi_status");Object.defineProperty(r,"HiFiStatus",{enumerable:!0,get:function(){return E.HiFiStatus}});var g=e("./typedefs");function R(e){var t,r=e.transport;if(!r)throw new TypeError("No Transport instance provided");var i=n.__assign(n.__assign({},e.client),{transport:r,hidden:!!e.hidden,playTokenLostBehavior:e.playTokenLostBehavior||(e.hidden&&!e.onlyLocalState?"stop":"pause")}),o=l.createHarmonyClient(i),a=e.streamer||{},s=e.controller||{},_=void 0,p=!1;e.streamer&&e.streamer.disabled?(e.hidden=!0,e.onlyLocalState=!1,e.claimInactivePlayerStates=!1,p=!0):(_=c.createStreamerForClient(o,a),s.autoregister=!1,e.onlyLocalState&&(s.decorateTrackWindow=!1,s.disableProgress=!0));var f=d.createControllerForClient(o,s);return u.Harmony.create({transport:r,client:o,streamer:_,controller:f,enableControllerWithoutStreamer:p,hidden:e.hidden,onlyLocalState:e.onlyLocalState,claimInactivePlayerStates:e.claimInactivePlayerStates,forceRemoteActions:e.forceRemoteActions,autoActivateElement:null!==(t=e.autoActivateElement)&&void 0!==t?t:"undefined"!=typeof WebKitMediaKeys,experimentalDeactivateOnStop:e.experimentalDeactivateOnStop})}Object.defineProperty(r,"LOCAL_DEVICE_ID",{enumerable:!0,get:function(){return g.LOCAL_DEVICE_ID}}),r.HarmonyError=n.__assign(n.__assign(n.__assign({},a.HarmonyErrors),o.TransportErrors),i.Errors),r.createHarmony=R,r.createHarmonyAndTransport=function(e){var t=s.createTransportForHarmony(e);return{harmony:R(n.__assign(n.__assign({},e),{transport:t})),transport:t}}},{"./_internal/harmony":119,"./client":132,"./controller":133,"./enums/device_deactivated_reason":135,"./enums/device_type":136,"./enums/error_source":138,"./enums/errors":139,"./enums/harmony_event":140,"./enums/hifi_status":141,"./enums/repeat_mode":144,"./enums/shuffle_mode":145,"./streamer":153,"./typedefs":154,"./utils/create_transport":157,"@js-sdk/playback/es5":102,"@js-sdk/playback/es5/enums/errors":80,"@spotify-internal/transport/es5/enums/errors":170,tslib:227}],152:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createHarmonyWithPlaybackService=r.PlaybackServiceCreators=void 0;var n=e("tslib"),i=e("./_internal/harmony"),o=e("./client"),a=e("./controller"),s=e("./streamer"),u=e("./_internal/cloud_playback/client"),l=e("./_internal/cloud_playback/playback_state_observer"),c=e("./_internal/track_playback/client"),d=e("./_internal/track_playback/context"),_=e("./_internal/track_playback/playback_state_observer");n.__exportStar(e("./index"),r),r.PlaybackServiceCreators={"cloud-playback":function(e){var t=u.CloudPlaybackClient.create(e);return{playbackServiceClient:t,playbackStateObserver:l.CPPlaybackStateObserver.create(t)}},"track-playback":function(e){var t=c.TrackPlaybackServiceClient.create(n.__assign(n.__assign({},e),{ListClass:d.TrackPlayerServiceContext}));return{playbackServiceClient:t,playbackStateObserver:_.TPPlaybackStateObserver.create(t)}}},r.createHarmonyWithPlaybackService=function(e){var t,u,l,c=e.transport;if(!c)throw new TypeError("No Transport instance provided");var d=n.__assign(n.__assign({},e.client),{transport:c,hidden:!!e.hidden,playTokenLostBehavior:e.playTokenLostBehavior||(e.hidden&&!e.onlyLocalState?"stop":"pause")}),_=o.createHarmonyClient(d),p=e.streamer||{},f=e.controller||{},h=void 0,v=!1;if(e.streamer&&e.streamer.disabled)e.hidden=!0,e.onlyLocalState=!1,e.claimInactivePlayerStates=!1,v=!0;else{var y=null!==(u=null===(t=e.streamer)||void 0===t?void 0:t.playbackService)&&void 0!==u?u:"track-playback";h=s.createStreamerForClientWithPlaybackService(_,r.PlaybackServiceCreators[y],p),f.autoregister=!1,e.onlyLocalState&&(f.decorateTrackWindow=!1,f.disableProgress=!0)}var m=a.createControllerForClient(_,f);return i.Harmony.create({transport:c,client:_,streamer:h,controller:m,enableControllerWithoutStreamer:v,hidden:e.hidden,onlyLocalState:e.onlyLocalState,claimInactivePlayerStates:e.claimInactivePlayerStates,autoActivateElement:null!==(l=e.autoActivateElement)&&void 0!==l?l:"undefined"!=typeof WebKitMediaKeys,experimentalDeactivateOnStop:e.experimentalDeactivateOnStop})}},{"./_internal/cloud_playback/client":111,"./_internal/cloud_playback/playback_state_observer":114,"./_internal/harmony":119,"./_internal/track_playback/client":129,"./_internal/track_playback/context":130,"./_internal/track_playback/playback_state_observer":131,"./client":132,"./controller":133,"./index":151,"./streamer":153,tslib:227}],153:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.of=r.createStreamerForClient=r.createStreamerForClientWithPlaybackService=r.HarmonyStreamer=void 0;var n=e("tslib"),i=e("@js-sdk/playback/es5"),o=e("./enums/manifest_format"),a=e("./_internal/streamer");Object.defineProperty(r,"HarmonyStreamer",{enumerable:!0,get:function(){return a.HarmonyStreamer}});var s=e("./_internal/track_playback/context"),u=e("./_internal/track_playback/playback_state_observer"),l=e("./_internal/manifest_track_resolver"),c=e("./_internal/track_playback/client");function d(e,t,r){var s,u,c,d,_,p,f;void 0===r&&(r={});var h=e.getSDKId(),v=e.getPublicTransport(),y=e.getLogger(),m=e.getDeviceDescriptor(),E=null!==(s=r.initialVolume)&&void 0!==s?s:1,g=n.__assign(n.__assign({},r),{transport:v,sdkId:e.getUntaggedSDKId(),loggerOptions:{disableMux:null===(d=null!==(c=null===(u=null==r?void 0:r.mux)||void 0===u?void 0:u.disable)&&void 0!==c?c:null==r?void 0:r.disableMux)||void 0===d||d,muxEnvKey:null!==(p=null===(_=null==r?void 0:r.mux)||void 0===_?void 0:_.envKey)&&void 0!==p?p:null==r?void 0:r.muxEnvKey,deviceInfo:m.then((function(e){return{platform_name:e.getPlatformName(),platform:e.getPlatformIdentifier(),version:e.getPlatformVersion(),brand:e.getBrand(),model:e.getModel(),type:e.getType()}})),muxCustomDimensions:null===(f=null==r?void 0:r.mux)||void 0===f?void 0:f.customDimensions,platform:e.getPlatformIdentifier(),clientVersion:e.getPlatformVersion()}}),R=i.createPlayer(g).then((function(e){return e.player})),T=R.then((function(e){return e.getMediaConfig()})),I=Promise.all([m,T]).then((function(e){var t=e[0],n=e[1];return t.getCapability("audio_podcasts")&&!r.disableExternalFiles&&t.appendManifestFormat(o.ManifestFormat.FILE_URLS_EXTERNAL),n.keysystem===i.KeySystem.FAIRPLAY?t.appendManifestFormat(o.ManifestFormat.FILE_IDS_CBCS):n.keysystem!==i.KeySystem.WIDEVINE||r.preferMultiDRMFormat?t.appendManifestFormat(o.ManifestFormat.FILE_IDS_MP4_DUAL,o.ManifestFormat.FILE_IDS_MP4,o.ManifestFormat.MANIFEST_URLS_AUDIO_AD):(-1!==n.formats.audio.indexOf('audio/mp4; codecs="flac"')&&t.getCapability("lossless_playback")&&t.appendManifestFormat(o.ManifestFormat.FILE_IDS_MP4FLAC),t.appendManifestFormat(o.ManifestFormat.FILE_IDS_MP4,o.ManifestFormat.FILE_IDS_MP4_DUAL,o.ManifestFormat.MANIFEST_URLS_AUDIO_AD)),n.supports.protected_video&&t.getCapability("video_playback")&&t.prependManifestFormat(o.ManifestFormat.MANIFEST_IDS_VIDEO),n.supports.unprotected_video&&t.getCapability("video_ads")&&t.prependManifestFormat(o.ManifestFormat.MANIFEST_URLS_VIDEO_AD),t})),S=i.ListPlayer.create({trackPlayer:R}),P=l.ManifestTrackResolver.create({descriptor:m,listPlayer:S}),b=t({initialVolume:E,listPlayer:S,logger:y,transport:v,clientVersion:h,descriptor:I,endpoint:r.endpoint,manifestTrackResolver:P}),A=b.playbackServiceClient,L=b.playbackStateObserver;return new a.HarmonyStreamer({client:e,playbackServiceClient:A,playbackStateObserver:L,initialVolume:E,playerPromise:R,listPlayer:S,stopOnBackground:r.stopOnBackground,enableMediaSession:r.enableMediaSession})}r.createStreamerForClientWithPlaybackService=d,r.createStreamerForClient=function(e,t){return void 0===t&&(t={}),d(e,(function(e){var t=c.TrackPlaybackServiceClient.create(n.__assign(n.__assign({},e),{ListClass:s.TrackPlayerServiceContext}));return{playbackServiceClient:t,playbackStateObserver:u.TPPlaybackStateObserver.create(t)}}),t)},r.of=function(e){var t=e._streamer;if(!(t instanceof a.HarmonyStreamer))throw new Error("The harmony instance has an invalid `_streamer`.");return t}},{"./_internal/manifest_track_resolver":123,"./_internal/streamer":128,"./_internal/track_playback/client":129,"./_internal/track_playback/context":130,"./_internal/track_playback/playback_state_observer":131,"./enums/manifest_format":143,"@js-sdk/playback/es5":102,tslib:227}],154:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GAIA_VOLUME=r.LOCAL_DEVICE_ID=void 0,r.LOCAL_DEVICE_ID="@local",r.GAIA_VOLUME=65535},{}],155:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.assert=void 0,r.assert=function(e,t){if(!e)throw new Error("Assertion failed: "+t)}},{}],156:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getOrCreateCommandId=r.createCommandId=void 0;var n=e("./generate_id"),i=/^[0-9a-f]{32}$/i;r.createCommandId=function(){return n.generateId(32)};r.getOrCreateCommandId=function(e){if(e&&(t=e,!i.test(t)))throw new TypeError("Invalid commandId. Expected a 32 character hex string but got: "+e);var t;return e||r.createCommandId()}},{"./generate_id":159}],157:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createTransportForHarmony=void 0;var n=e("@spotify-internal/transport/es5/providers/endpoints/xresolve"),i=e("@spotify-internal/transport/es5");function o(e){return"string"==typeof e}r.createTransportForHarmony=function(e){if("function"!=typeof e.getToken)throw new TypeError("Argument options.getToken must be a function");var t=n.createProvider(e.xresolve);return i.createTransport({providers:{endpoints:function(r){return t(r).then((function(t){var r=e.endpoints;if(r)for(var n in r)if(r.hasOwnProperty(n)){var i=r[n];o(i)&&(t[n]=i)}return t}))},token:function(){return new Promise((function(t){e.getToken((function(e,r){t(void 0===r?e:[e,r])}))}))}},disconnectBeforeUnload:e.disconnectBeforeUnload,forcePolyfillTypes:e.forcePolyfillTypes,reconnectionRetries:e.reconnectionRetries,requestMode:e.requestMode||"fetch"})}},{"@spotify-internal/transport/es5":188,"@spotify-internal/transport/es5/providers/endpoints/xresolve":196}],158:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeviceId=void 0;var n=e("./generate_id"),i=function(){return n.generateId(40)};r.DeviceId={get:function(e,t){if(void 0===t&&(t=!1),e&&"string"==typeof e)return e;if(t)return i();var r=localStorage.getItem("_spharmony_device_id");return r||(r=i(),localStorage.setItem("_spharmony_device_id",r)),r},generate:i}},{"./generate_id":159}],159:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.generateId=r.generateRandomBytes=r.generateRandomBytesModern=r.generateRandomBytesLegacy=r.bytesToHex=void 0;var n="undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues;function i(e){for(var t="",r=0;r<e.length;r++){var n=e[r];n<16&&(t+="0"),t+=n.toString(16)}return t}function o(e){for(var t=[];t.length<e;)t.push(Math.floor(256*Math.random()));return t}function a(e){return crypto.getRandomValues(new Uint8Array(e))}r.bytesToHex=i,r.generateRandomBytesLegacy=o,r.generateRandomBytesModern=a;r.generateRandomBytes=function(e){return n?a(e):o(e)};r.generateId=function(e){var t=Math.ceil(e/2);return i(r.generateRandomBytes(t))}},{}],160:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default={tagged:"4.44.1-c295c74e",version:"4.44.1",revision:"c295c74e"}},{}],161:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ListNode=r.LinkedList=void 0;var n=e("tslib"),i=e("./linkedlist");Object.defineProperty(r,"LinkedList",{enumerable:!0,get:function(){return i.LinkedList}}),Object.defineProperty(r,"ListNode",{enumerable:!0,get:function(){return i.ListNode}}),n.__exportStar(e("./lrucache"),r)},{"./linkedlist":162,"./lrucache":163,tslib:227}],162:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LinkedList=r.ListNode=void 0;var n=function(e){this.listId=null,this.key="",this.prev=null,this.next=null,this.value=null,this.value=e};r.ListNode=n;var i=function(){function e(){this._id={},this.length=0,this.first=null,this.last=null}return e.prototype.append=function(e){if(e.listId)throw new Error("Node already exists in another list!");return e.listId=this._id,this.first?this.last&&(e.prev=this.last,e.next=null,this.last.next=e,this.last=e):(this.first=e,this.last=e),++this.length},e.prototype.insertAfter=function(e,t){if(t.listId)throw new Error("Node already exists in another list!");return t.listId=this._id,t.prev=e,t.next=e.next,e.next&&(e.next.prev=t),e.next=t,t.prev===this.last&&(this.last=t),++this.length},e.prototype.remove=function(e){return!(!this.length||e.listId!==this._id)&&(this.length>1?(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e===this.first?this.first=e.next:e===this.last&&(this.last=e.prev)):(this.first=null,this.last=null),e.listId=null,e.prev=null,e.next=null,this.length--,!0)},e}();r.LinkedList=i},{}],163:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LRUCache=void 0;var n=e("./linkedlist"),i=function(){function e(e){this._limit=100,this._list=new n.LinkedList,this._map={},this._limit=e}return e.prototype.get=function(e){var t=this._map[e];if(!t)return null;var r=this._list;return r.remove(t),r.append(t),t.value},e.prototype.set=function(e,t){if(!e)throw new TypeError("Cache key cannot be empty.");var r=this._list,i=this._map;if(r.length>=this._limit){var o=r.first;i[o.key]=null,r.remove(o)}var a=i[e];a?(r.remove(a),a.value=t):(a=new n.ListNode(t)).key=e,r.append(a),i[e]=a},e.prototype.remove=function(e){var t=this._map,r=t[e];return r?(this._list.remove(r),t[e]=null,r.value):null},e.prototype.keys=function(){for(var e=[],t=this._list.first;t;)e.push(t.key),t=t.next;return e.reverse()},e.prototype.values=function(){for(var e=[],t=this._list.first;t;)e.push(t.value),t=t.next;return e.reverse()},e.prototype.size=function(){return this._list.length},e.prototype.clear=function(){var e=this._list.length;return this._list=new n.LinkedList,this._map={},e},e}();r.LRUCache=i},{"./linkedlist":162}],164:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BrowserConnectionObserver=r.ConnectionObserver=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("../enums/event"),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(i.EventEmitter);r.ConnectionObserver=a;var s=function(e){function t(t){var r=e.call(this)||this,n="undefined"!=typeof window,i=t&&t.notifyBeforeUnload;return r._navigator=n&&window.navigator||null,n&&"function"==typeof window.addEventListener&&(window.addEventListener("online",r.emitSync.bind(r,o.Event.CONNECTION_ONLINE,null)),window.addEventListener("offline",r.emitSync.bind(r,o.Event.CONNECTION_OFFLINE,null)),i&&window.addEventListener(o.Event.WINDOW_BEFORE_UNLOAD,r.emitSync.bind(r,o.Event.WINDOW_BEFORE_UNLOAD,null))),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype.isOnline=function(){var e=this._navigator;return!e||!("onLine"in e)||e.onLine},t}(a);r.BrowserConnectionObserver=s},{"../enums/event":171,"@spotify-internal/emitter/es5":109,tslib:227}],165:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isReadableStream=void 0,r.isReadableStream=function(e){return!!e&&"[object ReadableStream]"===Object.prototype.toString.call(e)}},{}],166:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.OperationMetricsTracker=void 0;var n=function(){function e(){this._startTime=null,this._endTime=null}return e.create=function(){return new e},e.prototype.start=function(){if(null!==this._startTime)throw new Error("Measurement is already in progress.");this._startTime=Date.now()},e.prototype.end=function(){if(null===this._startTime||null!==this._endTime)throw new Error("Measurement is not in progress.");this._endTime=Date.now()},e.prototype.getMetrics=function(){if(null===this._startTime||null===this._endTime)throw new Error("Measurement is not done.");return{start_time:this._startTime,end_time:this._endTime}},e}();r.OperationMetricsTracker=n},{}],167:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PublicTransport=void 0;var n,i=e("tslib"),o=e("@spotify-internal/emitter/es5"),a=e("../enums/event"),s=e("../enums/status_code"),u=e("../enums/status_family");!function(e){e.EVENT_ACCESS_TOKEN="access_token",e.EVENT_CONNECTION_ID="connection_id",e.EVENT_CONNECTION_OFFLINE="connection_offline",e.EVENT_CONNECTION_ONLINE="connection_online",e.EVENT_ENDPOINTS_RESOLVED="endpoints_resolved"}(n||(n={}));var l=function(e){function t(t,r){var o=e.call(this)||this;o.EVENT_ACCESS_TOKEN=n.EVENT_ACCESS_TOKEN,o.EVENT_CONNECTION_ID=n.EVENT_CONNECTION_ID,o.EVENT_CONNECTION_OFFLINE=n.EVENT_CONNECTION_OFFLINE,o.EVENT_CONNECTION_ONLINE=n.EVENT_CONNECTION_ONLINE,o.EVENT_ENDPOINTS_RESOLVED=n.EVENT_ENDPOINTS_RESOLVED,o.StatusCode=s.StatusCode,o.StatusFamily=u.StatusFamily,o.getConnectionId=t.getConnectionId.bind(t),o.getEndpoints=t.getEndpoints.bind(t),o.getInitTime=t.getInitTime.bind(t),o.getLastToken=t.getLastToken.bind(t),o.matchMessages=t.matchMessages.bind(t),o.unmatchMessages=t.unmatchMessages.bind(t),o.handlePushRequests=t.handlePushRequests.bind(t),o.unhandlePushRequests=t.unhandlePushRequests.bind(t),o.hasPlugin=t.hasPlugin.bind(t),o.getPluginAPI=t.getPluginAPI.bind(t);var l=t.request.bind(t);return(null==r?void 0:r.requestOptions)?o.request=function(e,t){return l(e,t?i.__assign(i.__assign(i.__assign({},null==r?void 0:r.requestOptions),t),{metadata:i.__assign(i.__assign({},r.requestOptions.metadata),null==t?void 0:t.metadata),retry:i.__assign(i.__assign({},r.requestOptions.retry),null==t?void 0:t.retry)}):r.requestOptions)}:o.request=l,o.proxyEmit(t,a.Event.ACCESS_TOKEN,n.EVENT_ACCESS_TOKEN),o.proxyEmit(t,a.Event.CONNECTION_OFFLINE,n.EVENT_CONNECTION_OFFLINE),o.proxyEmit(t,a.Event.CONNECTION_ONLINE,n.EVENT_CONNECTION_ONLINE),o.proxyEmit(t,a.Event.ENDPOINTS_RESOLVED,n.EVENT_ENDPOINTS_RESOLVED),o.onAddListener(n.EVENT_CONNECTION_ID,o._onAddConnectionIdListener.bind(o,t.on.bind(t))),o.onRemoveListener(n.EVENT_CONNECTION_ID,o._onRemoveConnectionIdListener.bind(o,t.removeListener.bind(t))),o}return i.__extends(t,e),t.prototype._onAddConnectionIdListener=function(e,t){var r=this;t.preventDefault();var i=t.data.listener,o=function(e){var t=r.createEvent(n.EVENT_CONNECTION_ID,e.data);i.call(r,t)};i.$proxy_wrapper=o,e(a.Event.CONNECTION_ID,o,t.data.options)},t.prototype._onRemoveConnectionIdListener=function(e,t){t.preventDefault();var r=t.data.listener;r.$proxy_wrapper&&e(a.Event.CONNECTION_ID,r.$proxy_wrapper,t.data.options)},t.prototype.removeAllListeners=function(){return this},t}(o.EventEmitter);r.PublicTransport=l},{"../enums/event":171,"../enums/status_code":175,"../enums/status_family":176,"@spotify-internal/emitter/es5":109,tslib:227}],168:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AllowsPayload=void 0,r.AllowsPayload={POST:!0,PUT:!0,PATCH:!0,DELETE:!0}},{}],169:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DisconnectionReason=void 0,function(e){e.RECONNECTION_FAILED="reconnection_failed",e.EXPLICIT="explicit",e.LOG_OUT="log_out",e.WINDOW_BEFORE_UNLOAD="window_before_unload"}(r.DisconnectionReason||(r.DisconnectionReason={}))},{}],170:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TransportErrors=void 0,function(e){e.HTTP_REQUEST_ABORTED="HTTP_REQUEST_ABORTED",e.HTTP_REQUEST_FAILED="HTTP_REQUEST_FAILED",e.HTTP_REQUEST_TIMEOUT="HTTP_REQUEST_TIMEOUT",e.LOGGING_REQUEST_FAILED="LOGGING_REQUEST_FAILED",e.TRANSPORT_ENDPOINTS_PROVIDER_ERROR="TRANSPORT_ENDPOINTS_PROVIDER_ERROR",e.TRANSPORT_INVALID_STATE="TRANSPORT_INVALID_STATE",e.TRANSPORT_INVALID_TOKEN="TRANSPORT_INVALID_TOKEN",e.TRANSPORT_STALE_TOKEN="TRANSPORT_STALE_TOKEN ",e.TRANSPORT_TOKEN_PROVIDER_ERROR="TRANSPORT_TOKEN_PROVIDER_ERROR",e.TRANSPORT_LIFECYCLE_DISABLED="TRANSPORT_LIFECYCLE_DISABLED",e.TRANSPORT_UNSUPPORTED_OPTION="TRANSPORT_UNSUPPORTED_OPTION",e.XRESOLVE_INCOMPLETE_RESPONSE="XRESOLVE_INCOMPLETE_RESPONSE",e.XRESOLVE_INVALID_RESPONSE="XRESOLVE_INVALID_RESPONSE",e.XRESOLVE_REQUEST_FAILED_WITH_STATUS="XRESOLVE_REQUEST_FAILED_WITH_STATUS"}(r.TransportErrors||(r.TransportErrors={}))},{}],171:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Event=void 0,function(e){e.CONNECTION_ONLINE="online",e.CONNECTION_OFFLINE="offline",e.PRODUCT_STATE_CHANGED="product_state_changed",e.ACCESS_TOKEN="access_token",e.AUTHENTICATED="authenticated",e.AUTHENTICATION_FAILED="authentication_failed",e.BEFORE_OFFLINE_DISCONNECT="before_offline_disconnect",e.BEFORE_ONLINE_DISCONNECT="before_online_disconnect",e.CONNECTED="connected",e.CONNECTION_FAILED="connection_failed",e.CONNECTION_ID="connection_id",e.DISCONNECTED="disconnected",e.ENDPOINTS_RESOLVED="endpoints_resolved",e.LOGGED_OUT="logged_out",e.SHORT_SESSION_DISCONNECTED="short_session_disconnected",e.TOKEN_PROVIDER_ERROR="token_provider_error",e.RECONNECTED="reconnected",e.RECONNECTING="reconnecting",e.WINDOW_BEFORE_UNLOAD="beforeunload"}(r.Event||(r.Event={}))},{}],172:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InternalSocketCode=void 0,function(e){e[e.CLOSE=4e3]="CLOSE",e[e.TIMEOUT=4001]="TIMEOUT"}(r.InternalSocketCode||(r.InternalSocketCode={}))},{}],173:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Method=void 0,function(e){e.DELETE="DELETE",e.GET="GET",e.OPTIONS="OPTIONS",e.PATCH="PATCH",e.POST="POST",e.PUT="PUT",e.TRACE="TRACE"}(r.Method||(r.Method={}))},{}],174:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PluginEvent=void 0,function(e){e.TRANSPORT_AUTHENTICATE="transport_authenticate",e.TRANSPORT_AUTHENTICATE_FAILED="transport_authenticate_failed",e.TRANSPORT_CONNECT="transport_connect",e.TRANSPORT_DISCONNECT="transport_disconnect",e.TRANSPORT_ENDPOINTS_RESOLVED="transport_endpoints_resolved",e.TRANSPORT_BEFORE_PROCESS_REQUEST="transport_before_process_request",e.TRANSPORT_BEFORE_SEND_REQUEST="transport_before_send_request",e.TRANSPORT_BEFORE_RETURN_RESPONSE="transport_before_return_response",e.TRANSPORT_REQUEST="transport_request",e.PLUGIN_CONNECTION_INFO="plugin_connection_info",e.PLUGIN_DISCONNECTED="plugin_disconnected",e.PLUGIN_MESSAGE="plugin_message",e.PLUGIN_REQUEST="plugin_request",e.PLUGIN_ERROR="plugin_error"}(r.PluginEvent||(r.PluginEvent={}))},{}],175:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StatusCode=void 0,function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.OK=200]="OK",e[e.CREATED=201]="CREATED",e[e.ACCEPTED=202]="ACCEPTED",e[e.NO_CONTENT=204]="NO_CONTENT",e[e.PARTIAL_CONTENT=206]="PARTIAL_CONTENT",e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.PAYMENT_REQUIRED=402]="PAYMENT_REQUIRED",e[e.FORBIDDEN=403]="FORBIDDEN",e[e.NOT_FOUND=404]="NOT_FOUND",e[e.METHOD_NOT_ALLOWED=405]="METHOD_NOT_ALLOWED",e[e.NOT_ACCEPTABLE=406]="NOT_ACCEPTABLE",e[e.PROXY_AUTHENTICATION_REQUIRED=407]="PROXY_AUTHENTICATION_REQUIRED",e[e.TIMED_OUT=408]="TIMED_OUT",e[e.REQUEST_TIMEOUT=408]="REQUEST_TIMEOUT",e[e.CONFLICT=409]="CONFLICT",e[e.GONE=410]="GONE",e[e.LENGTH_REQUIRED=411]="LENGTH_REQUIRED",e[e.PRECONDITION_FAILED=412]="PRECONDITION_FAILED",e[e.REQUEST_ENTITY_TOO_LARGE=413]="REQUEST_ENTITY_TOO_LARGE",e[e.REQUEST_URI_TOO_LONG=414]="REQUEST_URI_TOO_LONG",e[e.UNSUPPORTED_MEDIA_TYPE=415]="UNSUPPORTED_MEDIA_TYPE",e[e.REQUESTED_RANGE_NOT_SATISFIABLE=416]="REQUESTED_RANGE_NOT_SATISFIABLE",e[e.EXPECTATION_FAILED=417]="EXPECTATION_FAILED",e[e.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",e[e.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",e[e.BAD_GATEWAY=502]="BAD_GATEWAY",e[e.SERVICE_UNAVAILABLE=503]="SERVICE_UNAVAILABLE",e[e.GATEWAY_TIMEOUT=504]="GATEWAY_TIMEOUT",e[e.HTTP_VERSION_NOT_SUPPORTED=505]="HTTP_VERSION_NOT_SUPPORTED"}(r.StatusCode||(r.StatusCode={}))},{}],176:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StatusFamily=void 0,function(e){e[e.CONNECTION_ERROR=0]="CONNECTION_ERROR",e[e.INFORMATIONAL=1]="INFORMATIONAL",e[e.SUCCESS=2]="SUCCESS",e[e.REDIRECTION=3]="REDIRECTION",e[e.CLIENT_ERROR=4]="CLIENT_ERROR",e[e.SERVER_ERROR=5]="SERVER_ERROR"}(r.StatusFamily||(r.StatusFamily={}))},{}],177:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RequestTimeoutError=r.RequestAbortedError=r.RequestError=void 0;var n=e("tslib"),i=e("../enums/errors"),o=function(e){function t(t,r,n,i){var o=e.call(this,t)||this;return o.name="RequestError",o.message=t,o.code=r,o.status=n||0,o.url=i,o}return n.__extends(t,e),t}(Error);r.RequestError=o;var a=function(e){function t(t,r){var n=e.call(this,"Request aborted by signal.",i.TransportErrors.HTTP_REQUEST_ABORTED,0,t)||this;return n.name="RequestAbortedError",n.reason=r,n}return n.__extends(t,e),t}(o);r.RequestAbortedError=a;var s=function(e){function t(t,r){var n=e.call(this,"Request aborted by timeout.",i.TransportErrors.HTTP_REQUEST_TIMEOUT,0,t)||this;return n.name="RequestTimeoutError",n.reason=r,n}return n.__extends(t,e),t}(o);r.RequestTimeoutError=s},{"../enums/errors":170,tslib:227}],178:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TransportError=void 0;var n=e("tslib"),i=function(e){function t(t,r,n){void 0===n&&(n=null);var i=e.call(this,r)||this;return i.name="TransportError",i.message=r,i.code=t,i.origin=n,i}return n.__extends(t,e),t}(Error);r.TransportError=i},{tslib:227}],179:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.XResolveError=void 0;var n=e("tslib"),i=function(e){function t(t,r,n){void 0===n&&(n=-1);var i=e.call(this,r)||this;return i.name="XResolveError",i.message=r,i.code=t,i.status=n,i}return n.__extends(t,e),t}(Error);r.XResolveError=i},{tslib:227}],180:[function(e,t,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),r.createErrorFromSignal=r.createAbortSignalWithTimeout=r.raceSingals=r.anySignal=r.createAbortControllerLike=r.hasNativeAbortController=r.AbortControllerMicrofill=r.AbortSignalMicrofill=r.TIMEOUT_REASON=r.ABORT_REASON=void 0;var o=e("tslib"),a=e("@spotify-internal/emitter/es5"),s=e("../error/request");function u(e,t){var r=new Error(t);return r.name=e,r}r.ABORT_REASON="Signal is aborted without reason",r.TIMEOUT_REASON="Signal timed out";var l=function(e){function t(){var t=e.call(this)||this;return t._aborted=!1,t._reason=void 0,t.onabort=null,t.on("abort",(function(){var e;return null===(e=t.onabort)||void 0===e?void 0:e.call(t)})),t}return o.__extends(t,e),t.abort=function(e){var n=new t;return n._aborted=!0,n._reason=u("AbortError",null!=e?e:r.ABORT_REASON),n},t.signalAbort=function(e,t){"_aborted"in e&&!e._aborted&&(e._aborted=!0,"_reason"in e&&(e._reason=t||u("AbortError",r.ABORT_REASON)),e.emit("abort",null))},t.timeout=function(e){if(!isFinite(e))throw new TypeError('Value of "delay" is not supported.');var n=new t;return setTimeout((function(){t.signalAbort(n,u("TimeoutError",r.TIMEOUT_REASON))}),e),n},Object.defineProperty(t.prototype,"aborted",{get:function(){return this._aborted},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reason",{get:function(){return this._reason},enumerable:!1,configurable:!0}),t.prototype.addEventListener=function(e,t){this.addListener(e,t)},t.prototype.removeEventListener=function(e,t){this.removeListener(e,t)},t.prototype.dispatchEvent=function(){},t}(a.EventEmitter);r.AbortSignalMicrofill=l;var c=function(){function e(){this.signal=new l}return e.prototype.abort=function(e){var t=this.signal;l.signalAbort(t,e)},e}();function d(){return"undefined"!=typeof window&&"function"==typeof window.AbortController}r.AbortControllerMicrofill=c,r.hasNativeAbortController=d,r.createAbortControllerLike=d()?function(){return new AbortController}:function(){return new c},r.anySignal="undefined"!=typeof window&&"function"==typeof(null===(n=window.AbortSignal)||void 0===n?void 0:n.any)?window.AbortSignal.any:function(e){for(var t=r.createAbortControllerLike(),n=o.__spreadArray([],e),i=function e(){for(var r=0,i=n;r<i.length;r++){i[r].removeEventListener("abort",e)}t.abort()},a=0,s=o.__spreadArray([],e);a<s.length;a++){var u=s[a];if(u.aborted)return t.abort(u.reason),t.signal;u.addEventListener("abort",i)}return t.signal},r.raceSingals=r.anySignal,r.createAbortSignalWithTimeout="undefined"!=typeof window&&"function"==typeof(null===(i=window.AbortSignal)||void 0===i?void 0:i.timeout)?window.AbortSignal.timeout:l.timeout,r.createErrorFromSignal=function(e,t){var r;return"TimeoutError"===(null===(r=t.reason)||void 0===r?void 0:r.name)?new s.RequestTimeoutError(e,t.reason):new s.RequestAbortedError(e,t.reason)}},{"../error/request":177,"@spotify-internal/emitter/es5":109,tslib:227}],181:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FetchHeaders=void 0;var n=function(){function e(e){this.get=e.get.bind(e),this.has=e.has.bind(e)}return e.prototype.get=function(e){return null},e.prototype.has=function(e){return!1},e}();r.FetchHeaders=n},{}],182:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.request=r.isSupported=void 0;var n=e("@js-sdk/common/es5/debug_tools"),i=e("@js-sdk/common/es5/monotonic_now"),o=e("../../enums/allows_payload"),a=e("../../enums/status_code"),s=e("../../error/request"),u=e("./headers"),l=e("../response"),c=e("../../helpers/abortcontroller"),d=n.logging.forTag("transport.http.fetch"),_={json:!0,text:!0,arraybuffer:!0,blob:!0};function p(){return"function"==typeof fetch}r.isSupported=p,r.request=function(e){if(!p())return Promise.reject(new TypeError("Fetch is not supported"));var t=e.options.signal;if(null==t?void 0:t.aborted)return Promise.reject(c.createErrorFromSignal(e.url,t));if(!e.url)return Promise.reject(new TypeError("Request URL cannot be blank."));var r=e.method||"GET",n=e.url,f=null;if(r in o.AllowsPayload&&!0===o.AllowsPayload[r]&&e.payload?f=e.payload:e.payload&&(n+="?"+e.payload),e.options.responseType&&!(e.options.responseType in _))return Promise.reject(new TypeError("Cannot set responseType: not supported in browser."));var h={mode:e.options.mode||"cors",credentials:e.options.credentials||"same-origin",redirect:e.options.redirect||"follow",signal:t,method:r};e.headers.count()&&(h.headers=e.headers.toJSON()),f&&(h.body=f);var v=i.monotonicNow();return fetch(n,h).then((function(t){var r;r=e.options.ignoreResponseBody||t.status===a.StatusCode.NO_CONTENT?null:"json"===e.options.responseType?t.json().catch((function(e){return d.warn("Could not parse response as JSON:",e),null})):"arraybuffer"===e.options.responseType?t.arrayBuffer():"blob"===e.options.responseType?t.blob():t.text();var n=e.options.parseResponseHeaders||t.status>299?new u.FetchHeaders(t.headers):null;return Promise.all([t.url,t.status,n,r])})).then((function(t){var r=t[0],n=t[1],o=t[2],a=t[3],s=i.monotonicNow(),u=new l.HTTPResponse(r,n);return u.body=a,u.headers=o,e.options.timing&&(u.timing={completed:i.monotonicDuration(v,s)}),u})).catch((function(t){var r=i.monotonicNow();if("AbortError"===(null==t?void 0:t.name))throw new s.RequestAbortedError(n);if("TimeoutError"===(null==t?void 0:t.name))throw new s.RequestTimeoutError(n);var o=new l.HTTPResponse(n);return e.options.timing&&(o.timing={completed:i.monotonicDuration(v,r)}),o})).then((function(t){return e.options.connectionObserver&&(t.offline=!e.options.connectionObserver.isOnline()),t}))}},{"../../enums/allows_payload":168,"../../enums/status_code":175,"../../error/request":177,"../../helpers/abortcontroller":180,"../response":185,"./headers":181,"@js-sdk/common/es5/debug_tools":9,"@js-sdk/common/es5/monotonic_now":15}],183:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HTTPRequest=void 0;var n=e("./request_headers"),i=function(){function e(e,t){this.url=e,this.method=(null==t?void 0:t.method)||"GET",this.headers=new n.HTTPRequestHeaders(null==t?void 0:t.headers),this.options=(null==t?void 0:t.options)||{},this.payload=null==t?void 0:t.payload,this.urlExpanded=(null==t?void 0:t.urlExpanded)||!1,this.retryOptions=(null==t?void 0:t.retryOptions)||{}}return e.create=function(t,r){return new e(t,r)},e.prototype.clone=function(){var t=new e(this.url);return t.method=this.method,t.headers=new n.HTTPRequestHeaders(this.headers.toJSON()),t.options=this.options,t.payload=this.payload,t.urlExpanded=this.urlExpanded,t.retryOptions=this.retryOptions,t},e}();r.HTTPRequest=i},{"./request_headers":184}],184:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HTTPRequestHeaders=void 0;var n=e("tslib"),i=function(){function e(e){this._headers={},this._count=0,this._setAll(e)}return e.prototype._setAll=function(e){var t=0;for(var r in e)e.hasOwnProperty(r)&&e[r]&&(this._headers[r.toLowerCase()]=e[r],t++);this._count=t},e.prototype.get=function(e){return this._headers[e.toLowerCase()]||null},e.prototype.has=function(e){return!!this._headers[e.toLowerCase()]},e.prototype.set=function(e,t){this._headers[e.toLowerCase()]=t,this._count++},e.prototype.delete=function(e){var t=e.toLowerCase();this._headers[t]&&this._count--,delete this._headers[e.toLowerCase()]},e.prototype.count=function(){return this._count},e.prototype.toJSON=function(){return n.__assign({},this._headers)},e}();r.HTTPRequestHeaders=i},{tslib:227}],185:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HTTPResponse=void 0;var n=function(){function e(e,t){void 0===t&&(t=0),this.url="",this.status=0,this.headers=null,this.body=null,this.offline=!1,this.timing=null,this.metadata=null,this.retries={count:0},this.url=e,this.status=t,this.ok=t>=200&&t<=299}return e.prototype.getStatusFamily=function(){return 0|this.status/100},e}();r.HTTPResponse=n},{}],186:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.XHRHeaders=void 0;var n=function(){function e(e){this._headers={},this._init(e)}return e.prototype._init=function(e){if(e)for(var t=0,r=e.split("\r\n");t<r.length;t++){var n=r[t],i=n.indexOf(": ");if(i>0){var o=n.substring(0,i).toLowerCase(),a=n.substring(i+2);this._headers[o]=a}}},e.prototype.get=function(e){return this._headers[e.toLowerCase()]||null},e.prototype.has=function(e){return this._headers.hasOwnProperty(e.toLowerCase())},e}();r.XHRHeaders=n},{}],187:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.request=void 0;var n=e("@js-sdk/common/es5/debug_tools"),i=e("@js-sdk/common/es5/monotonic_now"),o=e("../../enums/allows_payload"),a=e("../../enums/errors"),s=e("../../enums/status_code"),u=e("../../error/request"),l=e("../response"),c=e("./headers"),d=e("../../helpers/abortcontroller"),_=e("../../_internal/is_readable_stream"),p=n.logging.forTag("transport.http.xhr"),f=function(){},h={json:!0,text:!0,document:!0};function v(){this.onabort=f,this.onerror=f,this.onload=f,this.onloadend=f}function y(e,t,r){var n,o;if(!(null===(n=e.options.signal)||void 0===n?void 0:n.aborted)){var a=i.monotonicNow(),u=this.status,d=new l.HTTPResponse(this.responseURL||e.url,u);d.body=null;var _=e.options;if(_.timing&&(d.timing={completed:i.monotonicDuration(t,a)}),(null===(o=_.connectionObserver)||void 0===o?void 0:o.isOnline)&&(d.offline=!_.connectionObserver.isOnline()),(_.parseResponseHeaders||u>299)&&(d.headers=new c.XHRHeaders(this.getAllResponseHeaders())),!_.ignoreResponseBody&&u!==s.StatusCode.NO_CONTENT){var f=_.responseType||"";if(!_.forcePolyfill&&"response"in this&&f===this.responseType)d.body=this.response;else if("document"===f)d.body=this.responseXML;else if("json"===f)try{d.body=JSON.parse(this.responseText)}catch(e){p.warn("Could not parse response as JSON:",e),d.body=null}else"text"!==f&&""!==f||(d.body=this.responseText)}r(d)}}function m(e,t,r){4===this.readyState?t(new l.HTTPResponse(this.responseURL||e,this.status)):r(new u.RequestError("Request cannot be completed.",a.TransportErrors.HTTP_REQUEST_FAILED,this.status,e))}function E(e){var t=e.options.signal;return new Promise((function(r,n){if(null==t?void 0:t.aborted)n(d.createErrorFromSignal(e.url,t));else{var a=new XMLHttpRequest,s=e.url;if(s){var u=null,l=e.method||"GET",c=e.payload||"";if(_.isReadableStream(c))n(new TypeError("payload is a ReadableStream, which is not supported"));else{l in o.AllowsPayload&&!0===o.AllowsPayload[l]&&c?u=c:c&&(s+="?"+c),a.open(l,s,!0),a.onerror=m.bind(a,s,r,n),a.onabort=v,a.onloadend=v,a.onprogress=f;var p=e.options;"include"===p.credentials&&(a.withCredentials=!0);var E=p.responseType;if(E)if(p.forcePolyfill){if(!(E in h))return void n(new TypeError('Cannot polyfill responseType "'+E+'"'))}else{if(!("responseType"in a)&&!(E in h))return void n(new TypeError("Cannot set responseType: not supported in browser."));try{a.responseType=E}catch(e){return void n(new TypeError('Unknown responseType "'+E+'".'))}if(a&&E!==a.responseType&&!(E in h))return void n(new TypeError('Unknown responseType "'+E+'".'))}var g=e.headers.count()?e.headers.toJSON():null;if(g)for(var R in g)if(g.hasOwnProperty(R)&&g[R])try{a.setRequestHeader(R,g[R])}catch(e){return void n(e)}t&&t.addEventListener("abort",(function e(){t.removeEventListener("abort",e),a.abort(),n(d.createErrorFromSignal(s,t))})),a.onload=y.bind(a,e,i.monotonicNow(),r);try{a.send(u)}catch(e){return void n(e)}}}else n(new TypeError("Request URL cannot be blank."))}}))}r.request=function(e){return E(e)}},{"../../_internal/is_readable_stream":165,"../../enums/allows_payload":168,"../../enums/errors":170,"../../enums/status_code":175,"../../error/request":177,"../../helpers/abortcontroller":180,"../response":185,"./headers":186,"@js-sdk/common/es5/debug_tools":9,"@js-sdk/common/es5/monotonic_now":15}],188:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createTransport=r.createBaseTransport=r.requestTransformerCreator=r.REQUEST_TRANSFORMER_PLUGIN_NAME=r.dealerCreator=r.DealerErrors=r.DEALER_PLUGIN_NAME=r.createSpotifyComProviders=r.createSpotifyComTokenProvider=r.createSpotifyComEndpointsProvider=r.createXResolveProvider=r.createAbortSignalWithTimeout=r.createAbortControllerLike=r.ConnectionObserver=r.DisconnectionReason=r.PluginEvent=r.Method=r.TransportEvent=r.TransportErrors=void 0;var n=e("tslib"),i=e("./enums/errors");Object.defineProperty(r,"TransportErrors",{enumerable:!0,get:function(){return i.TransportErrors}});var o=e("./enums/event");Object.defineProperty(r,"TransportEvent",{enumerable:!0,get:function(){return o.Event}});var a=e("./enums/method");Object.defineProperty(r,"Method",{enumerable:!0,get:function(){return a.Method}});var s=e("./enums/plugin_event");Object.defineProperty(r,"PluginEvent",{enumerable:!0,get:function(){return s.PluginEvent}});var u=e("./enums/disconnection_reason");Object.defineProperty(r,"DisconnectionReason",{enumerable:!0,get:function(){return u.DisconnectionReason}});var l=e("./_internal/connection_observer");Object.defineProperty(r,"ConnectionObserver",{enumerable:!0,get:function(){return l.ConnectionObserver}});var c=e("./helpers/abortcontroller");Object.defineProperty(r,"createAbortControllerLike",{enumerable:!0,get:function(){return c.createAbortControllerLike}}),Object.defineProperty(r,"createAbortSignalWithTimeout",{enumerable:!0,get:function(){return c.createAbortSignalWithTimeout}});var d=e("./plugins/dealer");Object.defineProperty(r,"dealerCreator",{enumerable:!0,get:function(){return d.dealerCreator}});var _=e("./http/fetch"),p=e("./transport"),f=e("./http/xhr"),h=(e("./http/response"),e("./http/request"),e("./_internal/public_transport"),e("./providers/endpoints/xresolve"));Object.defineProperty(r,"createXResolveProvider",{enumerable:!0,get:function(){return h.createProvider}});var v=e("./providers/spotify_com");Object.defineProperty(r,"createSpotifyComEndpointsProvider",{enumerable:!0,get:function(){return v.createEndpointsProvider}}),Object.defineProperty(r,"createSpotifyComTokenProvider",{enumerable:!0,get:function(){return v.createTokenProvider}}),Object.defineProperty(r,"createSpotifyComProviders",{enumerable:!0,get:function(){return v.createProviders}});var y=e("./plugins/dealer");Object.defineProperty(r,"DEALER_PLUGIN_NAME",{enumerable:!0,get:function(){return y.DEALER_PLUGIN_NAME}}),Object.defineProperty(r,"DealerErrors",{enumerable:!0,get:function(){return y.DealerErrors}});var m=e("./plugins/request_transformer");function E(e){var t=n.__assign({},e);return t.XHR||(t.XHR=f),t.Fetch=_,p.Transport.create(t)}Object.defineProperty(r,"REQUEST_TRANSFORMER_PLUGIN_NAME",{enumerable:!0,get:function(){return m.REQUEST_TRANSFORMER_PLUGIN_NAME}}),Object.defineProperty(r,"requestTransformerCreator",{enumerable:!0,get:function(){return m.requestTransformerCreator}}),r.createBaseTransport=E,r.createTransport=function(e){var t=E(e);return t.addPlugin(d.dealerCreator,{WebSocket:WebSocket}),t}},{"./_internal/connection_observer":164,"./_internal/public_transport":167,"./enums/disconnection_reason":169,"./enums/errors":170,"./enums/event":171,"./enums/method":173,"./enums/plugin_event":174,"./helpers/abortcontroller":180,"./http/fetch":182,"./http/request":183,"./http/response":185,"./http/xhr":187,"./plugins/dealer":192,"./plugins/request_transformer":194,"./providers/endpoints/xresolve":196,"./providers/spotify_com":197,"./transport":199,tslib:227}],189:[function(e,t,r){(function(t){(function(){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Dealer=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("@js-sdk/common/es5/promise_resolver"),a=e("./typedefs"),s=e("../../enums/internal_socket_code"),u=e("./error"),l=e("./event"),c=function(){},d=/hm:\/\/pusher\/(?:[^]+)?\/connections\/([^]+)/,_="undefined"!=typeof window,p=function(e){function r(t){var r=e.call(this)||this;return r._socket=null,r._lastPingDeferred=null,r._waitingForConnectionId=!0,r._connectionId=null,r._connectionURI=null,r._heartbeatToken=0,r._heartbeatTimeoutToken=0,r._connected=!1,r._endpoint=null,r._closeBeforeEventsRejector=null,r._WebSocket=t.WebSocket||WebSocket,r._heartbeatTimeout=t.heartbeatTimeout||1e4,r}return n.__extends(r,e),r.create=function(e){return new r(e)},r.prototype._startHeartbeat=function(e){var t=this,r=function(){t.ping().then((function(){return t._onHeartbeatSuccess()}),(function(){return t._onHeartbeatError()})),t._heartbeatTimeoutToken=setTimeout((function(){return t._onHeartbeatError()}),t._heartbeatTimeout)};e?r():this._heartbeatToken=setTimeout((function(){return r()}),3e4)},r.prototype._onHeartbeatError=function(){this._stopHeartbeat(),this._socket&&this._socket.close(s.InternalSocketCode.TIMEOUT,"internal-timeout")},r.prototype._onHeartbeatSuccess=function(){this._stopHeartbeat(),this._startHeartbeat()},r.prototype._stopHeartbeat=function(){null!==this._heartbeatToken&&clearTimeout(this._heartbeatToken),null!==this._heartbeatTimeoutToken&&clearTimeout(this._heartbeatTimeoutToken)},r.prototype._prepareConnectionId=function(e){var t;if(!e.uri)return!1;var r,n=(null!==(t=e.uri.match(d))&&void 0!==t?t:[])[1];return!!n&&(r=e.headers&&e.headers["Spotify-Connection-Id"]?e.headers["Spotify-Connection-Id"]:decodeURIComponent(n),this._connectionId=r,this._connectionURI=e.uri,this.emit(l.DealerEvent.CONNECTION_ID,{id:r,uri:e.uri}),!0)},r.prototype._reply=function(e,t){if(!e)throw new TypeError("Invalid key.");var r=this._socket;if(r&&1===r.readyState){var n={type:"reply",key:e,payload:t};r.send(JSON.stringify(n))}},r.prototype._parseMessage=function(e){var t;try{t=JSON.parse(e)}catch(e){return}if("message"===t.type)this._waitingForConnectionId&&this._prepareConnectionId(t)?(this._waitingForConnectionId=!1,this._startHeartbeat(!0)):this.emit(l.DealerEvent.MESSAGE,{message:t});else if("pong"===t.type&&this._lastPingDeferred)this._lastPingDeferred.resolve(!0),this._lastPingDeferred=null;else if("request"===t.type){var r=t.key;r&&this.emit(l.DealerEvent.REQUEST,{request:t,reply:this._reply.bind(this,r)})}},r.prototype._handleOpen=function(e){e.resolve(!0),this._connected=!0,this.emit(l.DealerEvent.AUTHENTICATED,null)},r.prototype._handleMessage=function(e){var r=this,n=e.data;if(_&&window.Blob&&n instanceof window.Blob){var i=new FileReader;i.onloadend=function(){if(this.result){var e;if(this.result instanceof ArrayBuffer){e="";for(var t=new Uint8Array(this.result),n=0;n<t.length;n++)e+=String.fromCharCode(t[n])}else e=this.result;r._parseMessage(e)}},i.readAsText(n)}else void 0!==t&&"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer?this._parseMessage(new t(n).toString("ascii")):this._parseMessage(n)},r.prototype._handleClose=function(e){var t=this._connected;if(this._connected=!1,t)this.emitSync(l.DealerEvent.DISCONNECTED,{wsCode:e.code,reason:e.reason});else{var r=new u.DealerError(a.DealerErrors.DEALER_AUTHENTICATION_FAILED,"Dealer connection error",e);this.emit(l.DealerEvent.AUTHENTICATION_FAILED,{error:r})}},r.prototype._handleError=function(e){var t=new u.DealerError(a.DealerErrors.DEALER_CONNECTION_ERROR,"Cannot connect to dealer");e.reject(t),this._connected=!1,this.emit(l.DealerEvent.ERROR,{error:t})},r.prototype._handleDisconnectBeforeEvents=function(e){e.reject(new u.DealerError(a.DealerErrors.DEALER_DISCONNECTED_BEFORE_EVENTS,"Dealer disconnected before events"))},r.prototype.connect=function(e){return this._endpoint=e,this._waitingForConnectionId=!0,this.emit(l.DealerEvent.CONNECTED,null),Promise.resolve(!0)},r.prototype.authenticate=function(e){var t=o.createPromiseResolver(),r=this._endpoint+"?access_token="+e,n=this._socket=new this._WebSocket(r);return n.onopen=this._handleOpen.bind(this,t),n.onclose=this._handleClose.bind(this),n.onerror=this._handleError.bind(this,t),n.onmessage=this._handleMessage.bind(this),this._closeBeforeEventsRejector=this._handleDisconnectBeforeEvents.bind(this,t),t.promise},r.prototype.disconnect=function(){var e;this._socket&&(this._stopHeartbeat(),this._waitingForConnectionId=!0,this._connected=!1,this._socket.close(s.InternalSocketCode.CLOSE,"internal-close"),this._socket.onopen=c,this._socket.onerror=c,this._socket.onmessage=c,this._socket.onclose=c,this._socket=null,null===(e=this._closeBeforeEventsRejector)||void 0===e||e.call(this),this.emitSync(l.DealerEvent.DISCONNECTED,{wsCode:s.InternalSocketCode.CLOSE,reason:"internal-close"}))},r.prototype.ping=function(){return this._socket&&1===this._socket.readyState?(this._lastPingDeferred=o.createPromiseResolver(),this._socket.send('{"type":"ping"}'),this._lastPingDeferred.promise):Promise.reject(new u.DealerError(a.DealerErrors.DEALER_CONNECTION_ERROR,"Dealer connection error"))},r.prototype.getConnectionId=function(){var e=this;return this._waitingForConnectionId?new Promise((function(t){e.once(l.DealerEvent.CONNECTION_ID,(function(e){t(e.data.id)}))})):Promise.resolve(this._connectionId)},r.prototype.getConnectionInfo=function(){var e=this;return this._waitingForConnectionId?new Promise((function(t){e.once(l.DealerEvent.CONNECTION_ID,(function(e){t({id:e.data.id,uri:e.data.uri})}))})):Promise.resolve({id:this._connectionId,uri:this._connectionURI})},r.prototype.hasConnectionId=function(){return!this._waitingForConnectionId&&!!this._connectionId},r}(i.EventEmitter);r.Dealer=p}).call(this)}).call(this,e("buffer").Buffer)},{"../../enums/internal_socket_code":172,"./error":190,"./event":191,"./typedefs":193,"@js-sdk/common/es5/promise_resolver":16,"@spotify-internal/emitter/es5":109,buffer:222,tslib:227}],190:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DealerError=void 0;var n=e("tslib"),i=e("./typedefs"),o=function(e){function t(t,r,n){void 0===t&&(t=i.DealerErrors.DEALER_ERROR),void 0===n&&(n={});var o=e.call(this,r)||this;return o.name="DealerError",o.message=r,o.code=t,o.raw=n,o.wsCode=n.code||null,o.wsReason=n.reason||null,o}return n.__extends(t,e),t}(Error);r.DealerError=o},{"./typedefs":193,tslib:227}],191:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DealerEvent=void 0,function(e){e.AUTHENTICATED="authenticated",e.AUTHENTICATION_FAILED="authentication_failed",e.CONNECTED="connected",e.CONNECTION_ID="connection_id",e.ERROR="error",e.DISCONNECTED="disconnected",e.MESSAGE="message",e.REQUEST="request"}(r.DealerEvent||(r.DealerEvent={}))},{}],192:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.dealerCreator=r.DealerErrors=r.DEALER_PLUGIN_NAME=void 0;var n=e("tslib"),i=e("./typedefs");Object.defineProperty(r,"DealerErrors",{enumerable:!0,get:function(){return i.DealerErrors}});var o=e("../../enums/plugin_event"),a=e("./error"),s=e("./event"),u=e("./dealer");r.DEALER_PLUGIN_NAME="dealer";var l=function(){function e(e){var t=this;this.name=r.DEALER_PLUGIN_NAME,this._dealer=new u.Dealer(e),this.api={hasConnectionInfo:function(){return t._dealer.hasConnectionId()},getConnectionInfo:function(){return t._dealer.getConnectionInfo().then((function(e){return n.__assign({plugin:t.name},e)}))}},this._onDealerConnectionId=this._onDealerConnectionId.bind(this),this._onDealerDisconnected=this._onDealerDisconnected.bind(this),this._onDealerMessage=this._onDealerMessage.bind(this),this._onDealerRequest=this._onDealerRequest.bind(this),this._onTransportConnect=this._onTransportConnect.bind(this),this._onTransportAuthenticate=this._onTransportAuthenticate.bind(this),this._onTransportDisconnect=this._onTransportDisconnect.bind(this)}return e.prototype._onDealerConnectionId=function(e){this._mediator&&this._mediator.emit(o.PluginEvent.PLUGIN_CONNECTION_INFO,n.__assign({plugin:this.name},e.data))},e.prototype._onDealerDisconnected=function(e){if(this._mediator){var t=e.data;this._mediator.emit(o.PluginEvent.PLUGIN_DISCONNECTED,{plugin:this.name,code:t.wsCode,reason:t.reason})}},e.prototype._onDealerMessage=function(e){this._mediator&&this._mediator.emit(o.PluginEvent.PLUGIN_MESSAGE,n.__assign({plugin:this.name},e.data))},e.prototype._onDealerRequest=function(e){this._mediator&&this._mediator.emit(o.PluginEvent.PLUGIN_REQUEST,n.__assign({plugin:this.name},e.data))},e.prototype._onTransportConnect=function(e){var t=e.data.endpoints,r=e.data.awaitPromise;t.dealer?/^wss:/.test(t.dealer)?r(this._dealer.connect(t.dealer)):r(Promise.reject(new a.DealerError(i.DealerErrors.INVALID_ENDPOINT,"Dealer endpoint needs to be wss://"))):r(Promise.reject(new a.DealerError(i.DealerErrors.ENDPOINT_NOT_DEFINED,'No "dealer" endpoint defined.')))},e.prototype._onTransportAuthenticate=function(e){var t=e.data;t.awaitPromise(this._dealer.authenticate(t.token))},e.prototype._onTransportDisconnect=function(){this._dealer.disconnect()},e.prototype._onDealerError=function(e){var t;null===(t=this._mediator)||void 0===t||t.emit(o.PluginEvent.PLUGIN_ERROR,{plugin:this.name,error:e.data.error})},e.prototype.attach=function(e,t){var r,n;this._mediator=t,t.addListeners(((r={})[o.PluginEvent.TRANSPORT_CONNECT]=this._onTransportConnect,r[o.PluginEvent.TRANSPORT_AUTHENTICATE]=this._onTransportAuthenticate,r[o.PluginEvent.TRANSPORT_DISCONNECT]=this._onTransportDisconnect,r)),this._dealer.addListeners(((n={})[s.DealerEvent.DISCONNECTED]=this._onDealerDisconnected,n[s.DealerEvent.CONNECTION_ID]=this._onDealerConnectionId,n[s.DealerEvent.MESSAGE]=this._onDealerMessage,n[s.DealerEvent.REQUEST]=this._onDealerRequest,n[s.DealerEvent.ERROR]=this._onDealerError,n))},e.prototype.detach=function(e,t){var r,n;this._mediator=void 0,t.removeListeners(((r={})[o.PluginEvent.TRANSPORT_CONNECT]=this._onTransportConnect,r[o.PluginEvent.TRANSPORT_AUTHENTICATE]=this._onTransportAuthenticate,r[o.PluginEvent.TRANSPORT_DISCONNECT]=this._onTransportDisconnect,r)),this._dealer.removeListeners(((n={})[s.DealerEvent.DISCONNECTED]=this._onDealerDisconnected,n[s.DealerEvent.CONNECTION_ID]=this._onDealerConnectionId,n[s.DealerEvent.MESSAGE]=this._onDealerMessage,n[s.DealerEvent.REQUEST]=this._onDealerRequest,n[s.DealerEvent.ERROR]=this._onDealerError,n))},e}();r.dealerCreator=function(e,t){return new l(t)}},{"../../enums/plugin_event":174,"./dealer":189,"./error":190,"./event":191,"./typedefs":193,tslib:227}],193:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DealerErrors=void 0,function(e){e.DEALER_CONNECTION_ERROR="DEALER_CONNECTION_ERROR",e.DEALER_AUTHENTICATION_FAILED="DEALER_AUTHENTICATION_FAILED",e.DEALER_ERROR="DEALER_ERROR",e.DEALER_DISCONNECTED_BEFORE_EVENTS="DEALER_DISCONNECTED_BEFORE_EVENTS",e.ENDPOINT_NOT_DEFINED="ENDPOINT_NOT_DEFINED",e.INVALID_ENDPOINT="INVALID_ENDPOINT"}(r.DealerErrors||(r.DealerErrors={}))},{}],194:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.requestTransformerCreator=r.REQUEST_TRANSFORMER_PLUGIN_NAME=void 0;var n=e("tslib"),i=e("../../enums/plugin_event");r.REQUEST_TRANSFORMER_PLUGIN_NAME="request-transformer";var o=function(){function e(e){this.name=r.REQUEST_TRANSFORMER_PLUGIN_NAME,this._uriTransformer=e.uriTransformer,this._optionsOverrides=e.optionsOverrides,this._include=e.include,this._processRequest=this._processRequest.bind(this)}return e.prototype._processRequest=function(e){var t,r,i=e.data;if(!((null===(r=null===(t=i.options)||void 0===t?void 0:t.metadata)||void 0===r?void 0:r.noRequestTransform)||this._include&&!this._include(i.uri,i.options))){this._uriTransformer&&(i.uri=this._uriTransformer(i.uri));var o=this._optionsOverrides;if(o)if(i.options){var a=n.__assign(n.__assign(n.__assign({},i.options),o),{metadata:n.__assign(n.__assign({},i.options.metadata),o.metadata),retry:n.__assign(n.__assign({},i.options.retry),o.retry),headers:n.__assign(n.__assign({},i.options.headers),o.headers)});i.options=a}else i.options=o}},e.prototype.attach=function(e,t){t.on(i.PluginEvent.TRANSPORT_BEFORE_PROCESS_REQUEST,this._processRequest)},e.prototype.detach=function(e,t){t.removeListener(i.PluginEvent.TRANSPORT_BEFORE_PROCESS_REQUEST,this._processRequest)},e}();r.requestTransformerCreator=function(e,t){return new o(t)}},{"../../enums/plugin_event":174,tslib:227}],195:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ProductStateObserver=void 0;var n=e("tslib"),i=e("@spotify-internal/emitter/es5"),o=e("./enums/status_code"),a=e("./enums/event"),s=function(e){function t(t){var r=e.call(this)||this;return r._currentState=null,r._transport=t.transport,r._endpoint=t.endpoint||"@webgate/melody",r._handleUserUpdate=r._handleUserUpdate.bind(r),r._init(),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._init=function(){this.register()},t.prototype._handleUserUpdate=function(){var e=this;clearTimeout(this._debounce),this._debounce=setTimeout((function(){e._transport.forceTokenRefresh().catch((function(){})),e.getCurrentState(!0).then((function(t){e.emit(a.Event.PRODUCT_STATE_CHANGED,{productState:t})}))}),300)},t.prototype._shouldRetry=function(e,t){var r=e.getStatusFamily();return r===t.SERVER_ERROR||r===t.CONNECTION_ERROR},t.prototype.getCurrentState=function(e){var t=this;return!e&&this._currentState?Promise.resolve(this._currentState):this._transport.request(this._endpoint+"/v1/product_state",{method:"GET",responseType:"json",retry:{condition:this._shouldRetry}}).then((function(e){if(e.status!==o.StatusCode.OK||!e.body)throw t._currentState=null,new Error("Cannot get the user's product state.");return t._currentState=e.body,e.body}))},t.prototype.register=function(){return this._transport.matchMessages("spotify:user:attributes:mutated",this._handleUserUpdate),Promise.resolve(!0)},t.prototype.deregister=function(){return this._transport.unmatchMessages("spotify:user:attributes:mutated",this._handleUserUpdate),Promise.resolve(!0)},t}(i.EventEmitter);r.ProductStateObserver=s},{"./enums/event":171,"./enums/status_code":175,"@spotify-internal/emitter/es5":109,tslib:227}],196:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createProvider=void 0;var n=e("../../enums/errors"),i=e("../../error/xresolve"),o="dealer",a="spclient",s={spclient:"spclient.wg.spotify.com",exp:"exp.wg.spotify.com",partners:"partners.wg.spotify.com"};r.createProvider=function(e){void 0===e&&(e={});var t=e.dealer||o,r=e.webgate||a,u="https://apresolve.spotify.com/?type="+t+"&type="+r;return function(e){return e.request(u,{forcePolyfill:!0,responseType:"json",retry:{maxRetries:3,curve:"exponential",condition:function(e,t){return e.getStatusFamily()!==t.SUCCESS}},metadata:{noRequestTransform:!0}}).then((function(e){var o,a,u,l,c,d=e.body,_={dealer:null!==(a=null===(o=null==d?void 0:d[t])||void 0===o?void 0:o[0])&&void 0!==a?a:"dealer.spotify.com",webgate:null!==(c=null!==(l=null===(u=null==d?void 0:d[r])||void 0===u?void 0:u[0])&&void 0!==l?l:s[r])&&void 0!==c?c:s.spclient,webapi:"https://api.spotify.com/"};if(!_.dealer||!_.webgate)throw new i.XResolveError(n.TransportErrors.XRESOLVE_INCOMPLETE_RESPONSE,"X-Resolve responded with incomplete results.",e.status);return _})).then((function(e){return e.dealer="wss://"+e.dealer.replace(/:443$/,""),e.webgate="https://"+e.webgate.replace(/:443$/,""),e}))}}},{"../../enums/errors":170,"../../error/xresolve":179}],197:[function(e,t,r){"use strict";function n(){return function(){return Promise.resolve({webgate:"https://www.spotify.com/api/",webapi:"https://api.spotify.com"})}}function i(){return function(){return Promise.resolve("NOT_A_TOKEN")}}Object.defineProperty(r,"__esModule",{value:!0}),r.createProviders=r.createTokenProvider=r.createEndpointsProvider=void 0,r.createEndpointsProvider=n,r.createTokenProvider=i,r.createProviders=function(){return{endpoints:n(),token:i()}}},{}],198:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ServerTime=void 0;var n=e("@js-sdk/common/es5/debug_tools"),i=e("@js-sdk/common/es5/monotonic_now"),o=e("./enums/status_code"),a=e("./"),s=n.logging.forTag("transport.server_time"),u=function(){function e(e){this._serverTime=0,this._serverTimeFetchedAt=null,this._transport=e}return e.create=function(t){return new e(t)},e.prototype._handleResponse=function(e,t){var r,n=i.monotonicNow();return t.status!==o.StatusCode.OK?this._handleError("Status "+t.status):"number"!=typeof(null===(r=t.body)||void 0===r?void 0:r.timestamp)?this._handleError("Invalid response"):(this._serverTimeFetchedAt=n,this._serverTime=t.body.timestamp+Math.round((n-e)/2),this._serverTime)},e.prototype._handleError=function(e){return s.error("Cannot fetch server time: "+e),this._serverTimeFetchedAt=i.monotonicNow(),this._serverTime=Date.now(),this._serverTime},e.prototype.get=function(){var e=i.monotonicNow();return this._transport.request("@webgate/melody/v1/time",{responseType:"json",signal:a.createAbortSignalWithTimeout(1e3)}).then(this._handleResponse.bind(this,e),this._handleError.bind(this))},e.prototype.getApproximate=function(){if(!this._serverTime||null===this._serverTimeFetchedAt)return this.get(),Date.now();var e=i.monotonicDuration(this._serverTimeFetchedAt);return e>18e4&&this.get(),this._serverTime+e},e}();r.ServerTime=u},{"./":188,"./enums/status_code":175,"@js-sdk/common/es5/debug_tools":9,"@js-sdk/common/es5/monotonic_now":15}],199:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Transport=void 0;var n=e("tslib"),i=e("@js-sdk/common/es5/backoff"),o=e("@js-sdk/common/es5/backoff/counter"),a=e("@js-sdk/common/es5/debug_tools"),s=e("@spotify-internal/emitter/es5"),u=e("./enums/errors"),l=e("./enums/event"),c=e("./enums/plugin_event"),d=e("./enums/internal_socket_code"),_=e("./enums/status_code"),p=e("./enums/status_family"),f=e("./enums/disconnection_reason"),h=e("./error/transport"),v=e("./error/request"),y=e("./_internal/connection_observer"),m=e("./http/response"),E=e("./http/request"),g=e("./_internal/public_transport"),R=e("./_internal/operation_metrics_tracker"),T=e("./helpers/abortcontroller"),I=a.logging.forTag("transport.transport"),S=/^(?:https?:\/\/)?@([^\/]+)\//,P=/^(ws|http)s?:\/\/.*[^\/]$/,b=/^([a-zA-Z]{3},\ \d{1,2}\ [a-zA-Z]{3}\ (\d{1,2}.){3})/,A={xhr:!0,fetch:!0},L=1,C=4;function O(e,t){var r="access_token="+encodeURIComponent(t),n=e.split("?"),i=n[0],o=n[1];if(!o)return i+"?"+r;var a=o.replace(/access_token=[^&]*(&|$)/,r+"$1");return a!==o?i+"?"+a:i+"?"+r+"&"+o}var N=function(e){function t(t){var r=e.call(this)||this;if(r._plugins={},r._pluginMediator=new s.EventEmitter,r._connectCalled=!1,r._authenticateCalled=!1,r._endpoints=null,r._lastToken=null,r._lastTokenExpiry=0,r._refreshTokenPromise=null,r._authenticationPromise=null,r._reconnectTimeout=0,r._isReconnecting=!1,r._initTime=0,r._lastDisconnect=0,r._stateMask=0,r._quickDisconnectCount=0,r._counter=new o.Counter({curve:"exponential",baseTime:5e3,ceiling:15e3}),r._stateAwareListeners={connected:[],authenticated:[],connection_id:[],transport_connect:[],transport_authenticate:[]},r._stateAwareOperationMetrics={authenticated:null},r._stateAwareRunners={connected:null,authenticated:null,connection_id:null,transport_connect:null,transport_authenticate:null},!t)throw new TypeError("Argument `options` for Transport cannot be null.");if(!t.providers)throw new TypeError("Argument `options.providers` for Transport cannot be null.");r._ownerRef="ownerRef"in t?Object(t.ownerRef):{},r._tokenProvider=t.providers.token,r._endpointsProvider=t.providers.endpoints,r._XHR=t.XHR,r._Fetch=t.Fetch,r._reconnectionRetries=t.reconnectionRetries>=0?t.reconnectionRetries:3,r._requestMode=t.requestMode in A?t.requestMode:"xhr",r._forcePolyfillTypes=t.forcePolyfillTypes||{},r._disableAutoLogout="disableAutoLogout"in t&&!!t.disableAutoLogout,r._disconnectBeforeUnload=t.disconnectBeforeUnload||!1;var n=t.createConnectionObserver||y.BrowserConnectionObserver.create;return r._connectionObserver=n({notifyBeforeUnload:r._disconnectBeforeUnload}),r.authenticate=r.authenticate.bind(r),r._authenticateWithToken=r._authenticateWithToken.bind(r),r._connectToEndpoints=r._connectToEndpoints.bind(r),r._parseProvidedToken=r._parseProvidedToken.bind(r),r._onConnected=r._onConnected.bind(r),r._onAuthenticated=r._onAuthenticated.bind(r),r._onAuthenticationFailed=r._onAuthenticationFailed.bind(r),r._init(),r}return n.__extends(t,e),t.create=function(e){return new t(e)},t.prototype._init=function(){var e,t=this;this.onAddListener(l.Event.CONNECTED,this._onAddListener.bind(this,"connected")),this.onAddListener(l.Event.AUTHENTICATED,this._onAddListener.bind(this,"authenticated")),this.onAddListener(l.Event.CONNECTION_ID,this._onAddListener.bind(this,"connection_id")),this.onRemoveListener(l.Event.CONNECTED,this._onRemoveListener.bind(this,"connected")),this.onRemoveListener(l.Event.AUTHENTICATED,this._onRemoveListener.bind(this,"authenticated")),this.onRemoveListener(l.Event.CONNECTION_ID,this._onRemoveListener.bind(this,"connection_id")),this._pluginMediator.onAddListener(c.PluginEvent.TRANSPORT_CONNECT,this._onAddListener.bind(this,"transport_connect")),this._pluginMediator.onAddListener(c.PluginEvent.TRANSPORT_AUTHENTICATE,this._onAddListener.bind(this,"transport_authenticate")),this._pluginMediator.onRemoveListener(c.PluginEvent.TRANSPORT_CONNECT,this._onRemoveListener.bind(this,"transport_connect")),this._pluginMediator.onRemoveListener(c.PluginEvent.TRANSPORT_AUTHENTICATE,this._onRemoveListener.bind(this,"transport_authenticate")),"fetch"!==this._requestMode||this._Fetch&&this._Fetch.isSupported()||(I.warn('Default "fetch" request mode unavailable; Fallback to "xhr"'),this._requestMode="xhr");var r=this._pluginMediator;r.addListeners(((e={})[c.PluginEvent.PLUGIN_DISCONNECTED]=this._onPluginDisconnected.bind(this),e)),this.proxyEmit(r,c.PluginEvent.PLUGIN_CONNECTION_INFO,l.Event.CONNECTION_ID),this._disableAutoLogout||this.matchMessages("client:logout",(function(){return t._onLogout()})),this._connectionObserver.on(l.Event.CONNECTION_ONLINE,(function(){return t._onOnline()})),this._connectionObserver.on(l.Event.CONNECTION_OFFLINE,(function(){return t._onOffline()})),this._connectionObserver.on(l.Event.WINDOW_BEFORE_UNLOAD,(function(){return t._disconnect(f.DisconnectionReason.WINDOW_BEFORE_UNLOAD)}))},t.prototype._runStateAwareQueues=function(e,t){var r=this._stateAwareListeners[e].splice(0);try{for(var n=0,i=r;n<i.length;n++){i[n].call(this,t)}}finally{this._stateAwareRunners[e]=null}},t.prototype._connect=function(){var e=this;return this._stateMask&L?Promise.resolve(!1):this._connectionObserver.isOnline()?this._performConnect():new Promise((function(t,r){I.info("Waiting to go online before connecting"),e._connectionObserver.once(l.Event.CONNECTION_ONLINE,(function(){e._performConnect().then(t,r)}))}))},t.prototype._performConnect=function(){var e=this;return new Promise((function(t){I.info("Resolving endpoints"),t(e._endpointsProvider(e.toPublic()))})).catch((function(e){var t=(null==e?void 0:e.code)?e:new h.TransportError(u.TransportErrors.TRANSPORT_ENDPOINTS_PROVIDER_ERROR,(null==e?void 0:e.message)||"Endpoints provider error",null!=e?e:null);return I.error("Endpoints resolution failed",t),Promise.reject(t)})).then(this._connectToEndpoints).then(this._onConnected).catch((function(t){var r=t&&t.error?t.error:t;return e.emit(l.Event.CONNECTION_FAILED,{error:r}),I.error("Connection failed",r),Promise.reject(r)}))},t.prototype._connectToEndpoints=function(e){var t=this,r={webgate:"",webapi:""};for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];o&&(P.test(o)&&(o+="/"),r[i]=o)}this._endpoints=r,this.emit(l.Event.ENDPOINTS_RESOLVED,{endpoints:n.__assign({},r)}),I.info("Endpoints resolved");var a=[],s=function(e){a.push(e)};return I.info("Waiting for plugins to connect"),new Promise((function(e,i){t._pluginMediator.emitAndWait(c.PluginEvent.TRANSPORT_CONNECT,{endpoints:n.__assign({},r),awaitPromise:s},(function(){Promise.all(a).then((function(){return e(!0)}),i)}))}))},t.prototype._refreshToken=function(e){var t=this;if(void 0===e&&(e=!1),this._refreshTokenPromise)return this._refreshTokenPromise;if(!e&&this._lastToken&&this._lastTokenExpiry>Date.now())return Promise.resolve(this._lastToken);this._refreshTokenPromise=new Promise((function(e){I.info("Requesting token from provider"),e(t._tokenProvider())})).then(this._parseProvidedToken);var r=function(){t._refreshTokenPromise=null};return this._refreshTokenPromise.then(r,r),this._refreshTokenPromise.catch((function(e){var r=(null==e?void 0:e.code)?e:new h.TransportError(u.TransportErrors.TRANSPORT_TOKEN_PROVIDER_ERROR,(null==e?void 0:e.message)||"Token provider error",e);return t.emit(l.Event.TOKEN_PROVIDER_ERROR,{error:r}),I.error("Token provider error",r),Promise.reject(r)}))},t.prototype._parseProvidedToken=function(e){var t,r=3540;if(Array.isArray(e)?(t=e[0],"number"==typeof(r="string"==typeof e[1]?parseInt(e[1],10):e[1])&&isFinite(r)||(r=3540)):t=e,!t)throw this._lastToken=null,this._lastTokenExpiry=0,I.error("No token was provided"),new h.TransportError(u.TransportErrors.TRANSPORT_INVALID_TOKEN,'Token provider returned an invalid token, "'+t+'"');if(this._lastToken===t){I.error("TokenProvider returned same token twice.");var n=new h.TransportError(u.TransportErrors.TRANSPORT_STALE_TOKEN,"Token provider returned the same token twice.");throw this._lastToken=null,this._lastTokenExpiry=0,n}return this._lastToken=t,this._lastTokenExpiry=Date.now()+1e3*r,this.emit(l.Event.ACCESS_TOKEN,{token:t}),I.info("Access token set"),t},t.prototype._authenticateWithToken=function(e){var t=this;if(!this._endpoints)return Promise.resolve(!0);var r=[],n=function(e){r.push(e)};return I.info("Waiting for plugins to authenticate"),new Promise((function(i,o){t._pluginMediator.emitAndWait(c.PluginEvent.TRANSPORT_AUTHENTICATE,{token:e,awaitPromise:n},(function(){Promise.all(r).then((function(){return i(!0)}),o)}))}))},t.prototype._authenticate=function(e){var t=this;if(!(this._stateMask&L))return Promise.reject(new h.TransportError(u.TransportErrors.TRANSPORT_INVALID_STATE,"Cannot authenticate disconnected transport."));if(this._authenticationPromise)return this._authenticationPromise;var r=R.OperationMetricsTracker.create();return r.start(),this._authenticationPromise=i.Backoff.init((function(){return I.info("Authenticating"),t._refreshToken(e).then(t._authenticateWithToken)}),{curve:"exponential",maxRetries:2,baseTime:500,retryPredicate:function(e){return I.warn("Retrying authentication due to failure",e),!0}}).then((function(){return t._onAuthenticated(r)})).catch((function(e){return t._onAuthenticationFailed(e,r)})),this._authenticationPromise},t.prototype._performDisconnect=function(e){this._stateMask=0;var t=!e;return e&&(this.emit(l.Event.DISCONNECTED,{reason:e}),I.info("Disconnected")),I.info("Waiting for plugins to disconnect."),this._pluginMediator.emitSync(c.PluginEvent.TRANSPORT_DISCONNECT,{supressed:t}),!0},t.prototype._createReconnector=function(){var e=this,t=!1;return function(){return e._isReconnecting=!0,e.emit(l.Event.RECONNECTING,null),I.info("Reconnecting"),e._performDisconnect(),e._connect().then((function(){return!!e._authenticateCalled&&e._authenticate(t).then((function(e){return t=!1,e}),(function(e){return t=!0,Promise.reject(e)}))})).then((function(){return e._isReconnecting=!1,e.emit(l.Event.RECONNECTED,null),I.info("Reconnected"),!0}))}},t.prototype._tryToReconnect=function(){var e=this;this._isReconnecting?I.warn("Reconnection triggered while already reconnecting"):(this._stateMask=0,i.Backoff.init(this._createReconnector(),{baseTime:1e3,maxTime:15e3,maxRetries:this._reconnectionRetries,retryPredicate:function(e){return I.warn("Retrying reconnection due to failure",e),!0}}).catch((function(){e._stateMask=0,e._isReconnecting=!1,e.emit(l.Event.DISCONNECTED,{reason:f.DisconnectionReason.RECONNECTION_FAILED}),I.info("Disconnected: reconnection failed")})))},t.prototype._sendRequest=function(e,t,r){var n=this;void 0===t&&(t={}),void 0===r&&(r={});var i=t.signal;return(null==i?void 0:i.aborted)?Promise.reject(T.createErrorFromSignal(e,i)):this._processRequestArgs(e,t).then((function(t){return(null==i?void 0:i.aborted)?Promise.reject(T.createErrorFromSignal(e,i)):t.options.forget?n._sendFireAndForgetRequest(t):n._sendRetriedRequest(t,r)}))},t.prototype._processRequestArgs=function(e,t){var r,i;if(void 0===t&&(t={}),null===(r=t.signal)||void 0===r?void 0:r.aborted)return Promise.reject(T.createErrorFromSignal(e,t.signal));var o=e,a=!1,s=n.__assign(n.__assign({},t),{forcePolyfill:!(!t.responseType||!(t.responseType in this._forcePolyfillTypes)),requestMode:null!==(i=null==t?void 0:t.requestMode)&&void 0!==i?i:this._requestMode,connectionObserver:this._connectionObserver,metadata:(null==t?void 0:t.metadata)||null});if((null==t?void 0:t.signal)&&!T.hasNativeAbortController()&&("fetch"===t.requestMode?I.warn("Request with `{requestMode: fetch}` but no native AbortController."):s.requestMode="xhr"),S.test(o)){a=!0;try{o=this._tryExpandSpecialURL(o)}catch(e){return Promise.reject(e)}"authorize"in s||(s.authorize=!0,s.autoAuthorized=!0)}var u=n.__assign(n.__assign({maxRetries:2,curve:"exponential"},t.retry),{retryPredicate:function(e){return!(e instanceof v.RequestAbortedError)}});return Promise.resolve(E.HTTPRequest.create(o,{method:t.method,headers:t.headers,payload:t.payload,options:s,urlExpanded:a,retryOptions:u}))},t.prototype._tryExpandSpecialURL=function(e){var t=this._endpoints;return e.replace(S,(function(e,r){if(!t.hasOwnProperty(r))throw new TypeError("Cannot replace endpoint @"+r+": endpoint not defined.");return t[r]}))},t.prototype._sendFireAndForgetRequest=function(e){var t,r=e.url,n=e.method,i=e.options;if(null===(t=i.signal)||void 0===t?void 0:t.aborted)return Promise.reject(T.createErrorFromSignal(r,i.signal));if("GET"!==n&&"POST"!==n)return Promise.reject(new h.TransportError(u.TransportErrors.TRANSPORT_UNSUPPORTED_OPTION,"Option 'forget' cannot be used for "+n+" request."));if(!i.autoAuthorized&&i.authorize)return Promise.reject(new h.TransportError(u.TransportErrors.TRANSPORT_UNSUPPORTED_OPTION,"Option 'forget' cannot be used for authorized request."));if(i.requestMode="xhr",i.authorize=!1,i.ignoreResponseBody=!0,"GET"===n)if("function"==typeof fetch){var o={mode:"no-cors"};i.signal&&T.hasNativeAbortController()&&(o.signal=i.signal),fetch(r,o).catch((function(){}))}else"function"==typeof Image?(new Image).src=r:this._sendRetriedRequest(e,{}).catch((function(){}));else if("POST"===n)if("undefined"!=typeof navigator&&(null===navigator||void 0===navigator?void 0:navigator.sendBeacon)){var a=e.headers.get("content-type");navigator.sendBeacon(e.url,"string"==typeof e.payload&&a?new Blob([e.payload],{type:a}):e.payload)}else if("function"==typeof fetch){a=e.headers.get("content-type"),o={method:"POST",body:e.payload,headers:a?{"content-type":a}:void 0};i.signal&&T.hasNativeAbortController()&&(o.signal=i.signal),fetch(r,o).catch((function(){}))}else this._sendRetriedRequest(e,{}).catch((function(){}));return Promise.resolve(new m.HTTPResponse(r,0))},t.prototype._sendRetriedRequest=function(e,t){var r=this,n=e.retryOptions,o=e.options.signal,a=!1,s=function(){return(null==o?void 0:o.aborted)?Promise.reject(T.createErrorFromSignal(e.url,o)):r._setAuthHeader(e,a)},u=this._connectionObserver,d=new i.Backoff((function(){return(u.isOnline()||e.options.allowOffline?s():new Promise((function(e,t){u.once(l.Event.CONNECTION_ONLINE,(function(){s().then(e,t)}))}))).then((function(){if(null==o?void 0:o.aborted)return Promise.reject(T.createErrorFromSignal(e.url,o));var n;if(r._pluginMediator.emitSync(c.PluginEvent.TRANSPORT_BEFORE_SEND_REQUEST,{request:e,context:t}),"fetch"===e.options.requestMode&&r._Fetch&&r._Fetch.isSupported())n=r._Fetch.request(e);else{if(!r._XHR)throw new Error("No available request mechanisms.");n=r._XHR.request(e)}return n})).then((function(t){if(null==o?void 0:o.aborted)return Promise.reject(T.createErrorFromSignal(e.url,o));var r=null;if(t.headers&&(r=t.headers.get("Retry-After")),t.status===_.StatusCode.UNAUTHORIZED&&!e.options.ignoreUnauthorized)return a=!0,Promise.reject(t);if("function"==typeof(null==n?void 0:n.condition)&&(n.condition(t,p.StatusFamily)||r)){if(null!==r)if(b.test(r))t.retryAfter=new Date(r).getTime()-Date.now();else{var i=parseInt(r,10);i>0&&(t.retryAfter=1e3*i)}return Promise.reject(t)}return Promise.resolve(t)}))}),n);return d.start().catch(this._handleRetriedRequestError).then((function(n){return(null==o?void 0:o.aborted)?Promise.reject(T.createErrorFromSignal(e.url,o)):(n.metadata=e.options.metadata,n.retries=n.retries||{count:0},n.retries.count=d.getRetryCount(),r._pluginMediator.emitSync(c.PluginEvent.TRANSPORT_BEFORE_RETURN_RESPONSE,{context:t,response:n}),e.options.rejectNotOk&&!n.ok?Promise.reject(n):n)}))},t.prototype._setAuthHeader=function(e,t){var r=this;if(!e.options.authorize)return Promise.resolve(e);var n=function(){return r._refreshToken(t).then((function(t){return e.headers.set("Authorization","Bearer "+t),e}))};return this._stateMask&C?n():new Promise((function(e,t){I.info("Auth header setting awaiting authentication."),r.once(l.Event.AUTHENTICATED,(function(){I.info("Auth header set after authentication."),n().then(e,t)}))}))},t.prototype._handleRetriedRequestError=function(e){return e instanceof m.HTTPResponse?Promise.resolve(e):Promise.reject(e)},t.prototype._onAddListener=function(e,t){var r=this,i=t.data.options;if(!i.ignoreCurrentState){var o;switch(e){case"connected":if(!this.isConnected())return;o=Promise.resolve(this.createEvent(l.Event.CONNECTED,null));break;case"authenticated":if(!this.isAuthenticated())return;var a=this._stateAwareOperationMetrics.authenticated;o=Promise.resolve(this.createEvent(l.Event.AUTHENTICATED,{timing:a}));break;case"connection_id":var s=this.getPluginAPI("dealer");if(!s||!s.hasConnectionInfo())return;o=s.getConnectionInfo().then((function(e){return r.createEvent(l.Event.CONNECTION_ID,e)}));break;case"transport_connect":if(!this.isConnected()||!this._endpoints)return;o=Promise.resolve(this._pluginMediator.createEvent(c.PluginEvent.TRANSPORT_CONNECT,{endpoints:n.__assign({},this._endpoints),awaitPromise:function(e){}}));break;case"transport_authenticate":if(!this.isAuthenticated())return;o=this._refreshToken().then((function(e){return r._pluginMediator.createEvent(c.PluginEvent.TRANSPORT_AUTHENTICATE,{token:e,awaitPromise:function(e){}})}));break;default:return}var u=t.data.listener;this._stateAwareListeners[e].push(u);var d=this._stateAwareRunners;d[e]||(d[e]=o.then(this._runStateAwareQueues.bind(this,e)),i.once&&t.preventDefault())}},t.prototype._onRemoveListener=function(e,t){var r=t.data.options;if(!r.ignoreCurrentState&&!r.once){var n=t.data.listener,i=this._stateAwareListeners[e].indexOf(n);-1!==i&&this._stateAwareListeners[e].splice(i,1)}},t.prototype._getQuickDisconnectTimeout=function(){return this._counter.getTime(this._quickDisconnectCount)},t.prototype._onPluginDisconnected=function(e){var t=Date.now(),r=t-this._lastDisconnect;if(this._performDisconnect(),e.data.code===d.InternalSocketCode.CLOSE)return I.info('Plugin "'+e.data.plugin+'" explicitly disconnected'),void(this._quickDisconnectCount=0);this._connectionObserver.isOnline()&&(I.info('Plugin "'+e.data.plugin+'" unexpectedly disconnect; trying to reconnect'),r<5e3?(this._reconnectTimeout&&clearTimeout(this._reconnectTimeout),this._quickDisconnectCount++,this.emit(l.Event.SHORT_SESSION_DISCONNECTED,{disconnectCount:this._quickDisconnectCount,sessionLength:r}),this._reconnectTimeout=setTimeout(this._tryToReconnect.bind(this),this._getQuickDisconnectTimeout())):(this._quickDisconnectCount=0,this._lastDisconnect=t,this._tryToReconnect()))},t.prototype._onOnline=function(){this.emit(l.Event.CONNECTION_ONLINE,null),I.info("ConnectionObserver online"),this._connectCalled&&this._tryToReconnect()},t.prototype._onOffline=function(){this.emit(l.Event.CONNECTION_OFFLINE,null),I.info("ConnectioObserver offline"),this._performDisconnect()},t.prototype._onConnected=function(){return this._stateMask|=L,this.emit(l.Event.CONNECTED,null),I.info("Connected"),Promise.resolve(!0)},t.prototype._onAuthenticated=function(e){e.end(),clearTimeout(this._reconnectTimeout),this._authenticationPromise=null,this._stateMask|=C,this._initTime=Date.now();var t=e.getMetrics();return this.emit(l.Event.AUTHENTICATED,{timing:t}),this._stateAwareOperationMetrics.authenticated=t,I.info("Authenticated"),Promise.resolve(!0)},t.prototype._onAuthenticationFailed=function(e,t){t.end();var r=e&&e.error?e.error:e;this._authenticationPromise=null,this._stateMask&=~C;var n={error:r,timing:t.getMetrics()};return this.emit(l.Event.AUTHENTICATION_FAILED,n),this._pluginMediator.emit(c.PluginEvent.TRANSPORT_AUTHENTICATE_FAILED,n),I.info("Authentication failed",r),Promise.reject(r)},t.prototype._onLogout=function(){var e=this,t=function(){e._lastToken=null,e._lastTokenExpiry=0,e.emit(l.Event.LOGGED_OUT,null)};this._disconnect(f.DisconnectionReason.LOG_OUT).then(t,t)},t.prototype._disconnect=function(e){var t=this;if(!this._connectCalled)return Promise.resolve(!1);this._connectCalled=!1,this._authenticateCalled=!1;var r=this.isConnected()?l.Event.BEFORE_ONLINE_DISCONNECT:l.Event.BEFORE_OFFLINE_DISCONNECT,n=[];return this.emitSync(r,{awaitPromise:function(e){n.push(e.catch((function(){})))}}),Promise.all(n).then((function(){return t._performDisconnect(e)}))},t.prototype.isConnected=function(){return!!(this._stateMask&L)},t.prototype.isAuthenticated=function(){return!!(this._stateMask&C)},t.prototype.isReconnecting=function(){return this._isReconnecting},t.prototype.isOnline=function(){return this._connectionObserver.isOnline()},t.prototype.connect=function(){return this._connectCalled=!0,this._connect()},t.prototype.authenticate=function(){return this._authenticateCalled=!0,this._authenticate(!0)},t.prototype.disconnect=function(){return this._disconnect(f.DisconnectionReason.EXPLICIT)},t.prototype.forceDisconnect=function(){return this._connectCalled?(this._connectCalled=!1,this._authenticateCalled=!1,this._performDisconnect(f.DisconnectionReason.EXPLICIT),Promise.resolve(!0)):Promise.resolve(!1)},t.prototype.forceTokenRefresh=function(){return this._refreshToken(!0).then((function(){return!0}))},t.prototype.getInitTime=function(){return this._initTime},t.prototype.getEndpoints=function(){return this._endpoints?n.__assign({},this._endpoints):null},t.prototype.getLastToken=function(){return this._lastToken},t.prototype.toPublic=function(e){return new g.PublicTransport(this,e)},t.prototype.hasOwnerRef=function(e){return this._ownerRef===e},t.prototype.appendTokenQuery=function(e){return this._refreshToken().then((function(t){return O(e,t)}))},t.prototype.appendLastTokenQuery=function(e){return this._lastToken?O(e,this._lastToken):e},t.prototype.matchMessages=function(e,t,r){if(!e)throw new TypeError('Message "matcher" cannot be null.');if("function"!=typeof t)throw new TypeError("Message callback cannot be null.");var n=function(n){var i=n.data.message;!i.uri||!i.uri.match(e)||r&&r!==n.data.plugin||t(i)};n.__matchMessagesExp=e,n.__matchMessagesPlugin=r,t.__matchMessagesWrapper=n,this._pluginMediator.on(c.PluginEvent.PLUGIN_MESSAGE,n)},t.prototype.unmatchMessages=function(e,t,r){if("function"!=typeof t)throw new TypeError("Message callback cannot be null.");var n=t.__matchMessagesWrapper;return!(!n||n.__matchMessagesExp!==e||n.__matchMessagesPlugin!==r)&&(this._pluginMediator.removeListener(c.PluginEvent.PLUGIN_MESSAGE,n),!0)},t.prototype.handlePushRequests=function(e,t,r){if(!e)throw new TypeError('Push request "matcher" cannot be null.');if("function"!=typeof t)throw new TypeError("Push request callback cannot be null.");var n=function(n){var i=n.data.request;!i.message_ident||!i.message_ident.match(e)||r&&r!==n.data.plugin||Promise.resolve(t(i)).then(n.data.reply)};n.__matchRequestExp=e,n.__matchRequestPlugin=r,t.__matchRequestWrapper=n,this._pluginMediator.on(c.PluginEvent.PLUGIN_REQUEST,n)},t.prototype.unhandlePushRequests=function(e,t,r){if("function"!=typeof t)throw new TypeError("Push request callback cannot be null.");var n=t.__matchRequestWrapper;return!(!n||n.__matchRequestExp!==e||n.__matchRequestPlugin!==r)&&(this._pluginMediator.removeListener(c.PluginEvent.PLUGIN_REQUEST,n),!0)},t.prototype.request=function(e,t){var r,n=this,i={uri:e,options:t,context:{}};this._pluginMediator.emitSync(c.PluginEvent.TRANSPORT_BEFORE_PROCESS_REQUEST,i);var o=this._sendRequest.bind(this,i.uri,i.options,i.context);return!this._endpoints&&S.test(i.uri)?(I.info("Request queued until endpoints resolved",i.uri),new Promise((function(e,t){n.once(l.Event.ENDPOINTS_RESOLVED,(function(){I.info("Sending endpoints-queued request",i.uri),o().then(e,t)}))}))):!this._connectionObserver.isOnline()&&!(null===(r=i.options)||void 0===r?void 0:r.allowOffline)?(I.info("Request queued until online",i.uri),new Promise((function(e,t){n.once(l.Event.CONNECTION_ONLINE,(function(){I.info("Sending offline-queued request",i.uri),o().then(e,t)}))}))):o()},t.prototype.addPlugin=function(e,t){var r=e(this,t),n=r.name;if(this._plugins[n])throw new TypeError("Plugin is already added.");return r.attach(this,this._pluginMediator),this._plugins[n]=r,n},t.prototype.removePlugin=function(e){var t=this._plugins[e];return!!t&&(t.detach(this,this._pluginMediator),this._plugins[e]=void 0,!0)},t.prototype.hasPlugin=function(e){return!!this._plugins[e]},t.prototype.getPluginAPI=function(e){var t=this._plugins[e];return t&&t.api?t.api:null},t.prototype.getConnectionId=function(e){void 0===e&&(e="dealer");var t=this._plugins[e];return t?t.api&&function(e){return"getConnectionInfo"in e.api}(t)?t.api.getConnectionInfo().then((function(e){return e.id})):Promise.reject(new TypeError("Plugin "+t+" is not a socket plugin.")):Promise.reject(new TypeError("Cannot retrieve connection id for plugin "+t+"."))},t.prototype.removeAllListeners=function(){return this},t}(s.EventEmitter);r.Transport=N},{"./_internal/connection_observer":164,"./_internal/operation_metrics_tracker":166,"./_internal/public_transport":167,"./enums/disconnection_reason":169,"./enums/errors":170,"./enums/event":171,"./enums/internal_socket_code":172,"./enums/plugin_event":174,"./enums/status_code":175,"./enums/status_family":176,"./error/request":177,"./error/transport":178,"./helpers/abortcontroller":180,"./http/request":183,"./http/response":185,"@js-sdk/common/es5/backoff":4,"@js-sdk/common/es5/backoff/counter":3,"@js-sdk/common/es5/debug_tools":9,"@spotify-internal/emitter/es5":109,tslib:227}],200:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.PluginEvent=void 0,function(e){e.TRANSPORT_AUTHENTICATE="transport_authenticate",e.TRANSPORT_AUTHENTICATE_FAILED="transport_authenticate_failed",e.TRANSPORT_CONNECT="transport_connect",e.TRANSPORT_DISCONNECT="transport_disconnect",e.TRANSPORT_ENDPOINTS_RESOLVED="transport_endpoints_resolved",e.TRANSPORT_BEFORE_PROCESS_REQUEST="transport_before_process_request",e.TRANSPORT_BEFORE_SEND_REQUEST="transport_before_send_request",e.TRANSPORT_BEFORE_RETURN_RESPONSE="transport_before_return_response",e.TRANSPORT_REQUEST="transport_request",e.PLUGIN_CONNECTION_INFO="plugin_connection_info",e.PLUGIN_DISCONNECTED="plugin_disconnected",e.PLUGIN_MESSAGE="plugin_message",e.PLUGIN_REQUEST="plugin_request",e.PLUGIN_ERROR="plugin_error"}(n||(r.PluginEvent=n={}))},{}],201:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.REQUEST_TRANSFORMER_PLUGIN_NAME=void 0,r.requestTransformerCreator=function(e,t){return new u(t)};var n=e("../../enums/plugin_event");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}function a(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}var s=r.REQUEST_TRANSFORMER_PLUGIN_NAME="request-transformer",u=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=s,this._uriTransformer=t.uriTransformer,this._optionsOverrides=t.optionsOverrides,this._include=t.include,this._processRequest=this._processRequest.bind(this)},(t=[{key:"_processRequest",value:function(e){var t,r,n=e.data;if(!((null===(r=null===(t=n.options)||void 0===t?void 0:t.metadata)||void 0===r?void 0:r.noRequestTransform)||this._include&&!this._include(n.uri,n.options))){this._uriTransformer&&(n.uri=this._uriTransformer(n.uri));var i=this._optionsOverrides;if(i)if(n.options){var o=Object.assign(Object.assign(Object.assign({},n.options),i),{metadata:Object.assign(Object.assign({},n.options.metadata),i.metadata),retry:Object.assign(Object.assign({},n.options.retry),i.retry),headers:Object.assign(Object.assign({},n.options.headers),i.headers)});n.options=o}else n.options=i}}},{key:"attach",value:function(e,t){t.on(n.PluginEvent.TRANSPORT_BEFORE_PROCESS_REQUEST,this._processRequest)}},{key:"detach",value:function(e,t){t.removeListener(n.PluginEvent.TRANSPORT_BEFORE_PROCESS_REQUEST,this._processRequest)}}])&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()},{"../../enums/plugin_event":200}],202:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.unknownURI=void 0;var n=e("../enums/uri_type"),i=e("../uri");r.unknownURI=function(e){return i.createURI(n.URITypeMap.UNKNOWN,{args:null!=e?e:[]})}},{"../enums/uri_type":214,"../uri":218}],203:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.matchLocale=r.encodeQueryString=r.decodeComponent=r.encodeComponents=r.encodeComponent=void 0;var n=e("../enums/uri_format");function i(e,t){if(!e)return"";var r=encodeURIComponent(e);return t===n.URIFormat.URI&&(r=r.replace(/%20/g,"+")),r=(r=r.replace(/[!'()]/g,escape)).replace(/\*/g,"%2A")}r.encodeComponent=i,r.encodeComponents=function(e,t,r){void 0===r&&(r=[]);for(var n=0,o=e.length;n<o;++n)r.push(i(e[n],t));return r},r.decodeComponent=function(e,t){if(!e)return"";var r=t===n.URIFormat.URI?e.replace(/\+/g,"%20"):e;return decodeURIComponent(r)},r.encodeQueryString=function(e){var t="?";for(var r in e)if(e.hasOwnProperty(r)&&void 0!==e[r]){t.length>1&&(t+="&");var n=e[r];void 0!==n&&(t+=r+"="+encodeURIComponent(n))}return t};var o=/^intl-[A-Za-z]{2,3}(-[A-Za-z]{4})?(-([A-Za-z]{2}|[0-9]{3}))?$/;r.matchLocale=function(e){return o.test(e)}},{"../enums/uri_format":212}],204:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.parse=r.parseFromComponents=r.splitIntoComponents=void 0;var n=e("../enums/prefix"),i=e("../enums/uri_format"),o=e("../enums/uri_type"),a=e("./uri_definitions/parsers"),s=e("./helpers");function u(e){var t,r,o,a,s=e,u=s.split("?"),l=u[0],c=u[1];if(l&&c){s=l;var d=c.split("#"),_=d[0],p=d[1];_&&(o=function(e){return e.split("&").reduce((function(e,t){var r=t.split("="),n=r[0],i=r[1];return n&&i&&(e[n]=decodeURIComponent(i)),e}),{})}(_),a=p)}var f=s.split("#");if(f.length>1&&(s=f.shift(),a=f.pop()),0===s.indexOf(n.URI_PREFIX))t=s.slice(n.URI_PREFIX.length).split(":"),r=i.URIFormat.URI;else{var h=s.split("?")[0];if(0===(null==h?void 0:h.indexOf(n.PLAY_HTTP_PREFIX)))t=h.slice(n.PLAY_HTTP_PREFIX.length).split("/");else if(0===(null==h?void 0:h.indexOf(n.PLAY_HTTPS_PREFIX)))t=h.slice(n.PLAY_HTTPS_PREFIX.length).split("/");else if(0===(null==h?void 0:h.indexOf(n.OPEN_HTTP_PREFIX)))t=h.slice(n.OPEN_HTTP_PREFIX.length).split("/");else if(0===(null==h?void 0:h.indexOf(n.OPEN_HTTPS_PREFIX)))t=h.slice(n.OPEN_HTTPS_PREFIX.length).split("/");else{if(0!==(null==h?void 0:h.indexOf(n.PATH_PREFIX)))throw new TypeError("Invalid Spotify URI!");t=h.slice(n.PATH_PREFIX.length).split("/")}r=i.URIFormat.URL}return a&&t.push(a),{format:r,components:t,query:o}}function l(e,t,r,n){var u=0,l=function(){var t=e[u++];if(t&&/\s/.test(t))throw new TypeError("Invalid Spotify URI!");return t},c=function(){var e=l();if(!e)throw new TypeError("Invalid Spotify URI!");return e},d={getAllComponents:function(){return e},getQueryParams:function(){return r},getNextComponent:l,getNextRequiredComponent:c,getIdComponent:function(){var e=c();if(e.length>22)throw new TypeError("Invalid Spotify URI!");return e},getHexIdComponent:function(e){var t=c();if(t.length!==e)throw new TypeError("Invalid Spotify URI!");if(!/^[a-fA-F0-9]+$/.test(t))throw new Error("Invalid Hex ID");return t},getBase62IdComponent:function(){var e=c();if(22!==e.length)throw new TypeError("Invalid Spotify URI!");if(!/^[a-zA-Z0-9]+$/.test(e))throw new Error("Invalid ID");return e},getRemainingComponents:function(){return e.slice(u)},getRemainingString:function(){var r=t===i.URIFormat.URI?":":"/";return e.slice(u).join(r)}},_=c(),p=a.URIParsers[_];p||s.matchLocale(_)&&(_=c(),p=a.URIParsers[_]);if(p)return p(d,t,{});if(n)return a.URIParsers[o.URITypeMap.UNKNOWN](d,t,{});throw new TypeError("Invalid or unknown Spotify URI!")}r.splitIntoComponents=u,r.parseFromComponents=l,r.parse=function(e,t){var r=u(e);return l(r.components,r.format,r.query,t)}},{"../enums/prefix":211,"../enums/uri_format":212,"../enums/uri_type":214,"./helpers":203,"./uri_definitions/parsers":206}],205:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createSerializerDefinition=r.createParserDefinition=void 0;r.createParserDefinition=function(){var e={};return[function(t,r){e[t]||(e[t]=r)},e]};r.createSerializerDefinition=function(){var e={};return[function(t,r){e[t]||(e[t]=r)},e]}},{}],206:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.URIParsers=void 0;var n=e("../../../enums/uri_type"),i=e("../../../enums/uri_particle"),o=e("../../../factories"),a=e("../../../_internal/factories"),s=e("../../helpers"),u=e("../helpers"),l=e("./user"),c=u.createParserDefinition(),d=c[0],_=c[1];r.URIParsers=_,d(n.URITypeMap.ALBUM,(function(e){var t=e.getBase62IdComponent(),r=e.getNextComponent();return o.albumURI(t,r?parseInt(r,10):void 0)})),d(i.URIParticle.APP,(function(e,t){var r=e.getNextRequiredComponent(),n=s.decodeComponent(r,t);if(s.encodeComponent(n,t)!==r)throw new TypeError("Invalid or unknown Spotify URI!");for(var i=e.getRemainingComponents(),a=0,u=i.length;a<u;++a)i[a]=s.decodeComponent(i[a],t);return o.applicationURI(r,i)})),d(n.URITypeMap.AD,(function(e){return o.adURI(e.getNextRequiredComponent())})),d(n.URITypeMap.ARTIST,(function(e){var t=e.getBase62IdComponent(),r=e.getNextComponent();return r===i.URIParticle.TOP?o.artistToplistURI(t,e.getNextRequiredComponent()):r===i.URIParticle.CONCERTS?o.artistConcertsURI(t):o.artistURI(t)})),d(n.URITypeMap.AUDIO_FILE,(function(e){return o.audioFileURI(e.getNextRequiredComponent(),e.getNextRequiredComponent())})),d(n.URITypeMap.DAILY_MIX,(function(e){return o.dailyMixURI(e.getIdComponent())})),d(n.URITypeMap.TEMP_PLAYLIST,(function(e){return o.temporaryPlaylistURI(e.getNextRequiredComponent(),e.getRemainingString())})),d(n.URITypeMap.PLAYLIST,(function(e){return o.playlistV2URI(e.getBase62IdComponent())})),d(n.URITypeMap.SEARCH,(function(e,t){return o.searchURI(s.decodeComponent(e.getRemainingString(),t))})),d(n.URITypeMap.TRACK,(function(e){var t=e.getQueryParams();return o.trackURI(e.getBase62IdComponent(),e.getNextComponent(),null==t?void 0:t.context,null==t?void 0:t.play)})),d(n.URITypeMap.TRACKSET,(function(e){var t,r=s.decodeComponent(e.getNextComponent()),n=e.getNextRequiredComponent(),i=e.getNextComponent(),a=parseInt(null!==(t=e.getNextComponent())&&void 0!==t?t:"",10);("%23"!==i||isNaN(a))&&(a=null);var u=[];if(n)for(var l=0,c=(n=s.decodeComponent(n).split(",")).length;l<c;l++){var d=n[l];d&&u.push(o.trackURI(d))}return o.tracksetURI(u,r,a)})),d(n.URITypeMap.CONTEXT_GROUP,(function(e){return o.contextGroupURI(e.getNextRequiredComponent(),e.getNextRequiredComponent())})),d(i.URIParticle.TOP,(function(e){var t=e.getNextRequiredComponent();return e.getNextComponent()===i.URIParticle.GLOBAL?o.toplistURI(t,void 0,!0):o.toplistURI(t,e.getNextComponent(),!1)})),d(n.URITypeMap.LOCAL_TRACK,(function(e,t){var r=e.getNextComponent(),n=s.decodeComponent(r,t),i=e.getNextComponent(),a=s.decodeComponent(i,t),u=e.getNextComponent(),l=s.decodeComponent(u,t),c=e.getNextComponent(),d=c?parseInt(c,10):void 0;return void 0!==u?o.localTrackURI(n,a,l,d):void 0!==i?o.localAlbumURI(n,a):o.localArtistURI(n)})),d(n.URITypeMap.IMAGE,(function(e){return o.imageURI(e.getHexIdComponent(40))})),d(n.URITypeMap.MOSAIC,(function(e){return o.mosaicURI(e.getRemainingComponents())})),d(n.URITypeMap.RADIO,(function(e){return o.radioURI(e.getRemainingString())})),d(n.URITypeMap.SPECIAL,(function(e,t){for(var r=e.getRemainingComponents(),n=0,i=r.length;n<i;++n)r[n]=s.decodeComponent(r[n],t);return o.specialURI(r)})),d(n.URITypeMap.STATION,(function(e){return o.stationURI(e.getRemainingComponents())})),d(n.URITypeMap.EPISODE,(function(e){var t=e.getQueryParams();return o.episodeURI(e.getBase62IdComponent(),null==t?void 0:t.context,null==t?void 0:t.play)})),d(n.URITypeMap.SHOW,(function(e){return o.showURI(e.getBase62IdComponent())})),d(n.URITypeMap.LIVE,(function(e){return o.liveURI(e.getIdComponent())})),d(n.URITypeMap.ROOM,(function(e){return o.roomURI(e.getIdComponent())})),d(n.URITypeMap.EXPRESSION,(function(e){return o.expressionURI(e.getIdComponent())})),d(n.URITypeMap.CONCEPT,(function(e){return o.conceptURI(e.getIdComponent())})),d(n.URITypeMap.CONCERT,(function(e){return o.concertURI(e.getIdComponent())})),d(n.URITypeMap.MERCH,(function(e){return o.merchURI(e.getIdComponent())})),d(n.URITypeMap.MERCHHUB,(function(){return o.merchHubURI()})),d(n.URITypeMap.PRERELEASE,(function(e){return o.prereleaseURI(e.getIdComponent())})),d(n.URITypeMap.SOCIAL_SESSION,(function(e){return o.socialSessionURI(e.getNextRequiredComponent())})),d(n.URITypeMap.JAM,(function(e){var t=e.getAllComponents(),r=(t[0],t[1]),i=t[2],a=t[3];return r===n.URITypeMap.ALBUM||r===n.URITypeMap.ARTIST||r===n.URITypeMap.PLAYLIST?o.jamURI(i,r,!!a):o.jamURI("")})),d(n.URITypeMap.INTERRUPTION,(function(e){return o.interruptionURI(e.getNextRequiredComponent())})),d(n.URITypeMap.COLLECTION,(function(e){return o.collectionURI(void 0,e.getNextComponent())})),d(n.URITypeMap.GENRE,(function(e){return o.genreURI(e.getNextRequiredComponent())})),d(n.URITypeMap.QUEUE,(function(){return o.queueURI()})),d(i.URIParticle.USER,(function(e,t){var r=s.decodeComponent(e.getNextRequiredComponent(),t),i=e.getNextComponent();if(r===n.URITypeMap.FACEBOOK&&i)return o.facebookURI(i);if(i&&l.UserURIParsers[i]){var a=l.UserURIParsers[i];if(!a)throw new TypeError("Invalid Spotify URI!");return a(e,t,{username:r})}var u=e.getRemainingComponents(),c=i?[i].concat(u):void 0;return o.profileURI(r,c)})),d(n.URITypeMap.UNKNOWN,(function(e){var t=e.getAllComponents();return a.unknownURI(t)})),d(n.URITypeMap.MEDIA,(function(e){return o.mediaURI(e.getIdComponent())})),d(n.URITypeMap.POLL,(function(e){return o.pollURI(e.getIdComponent())})),d(n.URITypeMap.QUESTION,(function(e){return o.questionURI(e.getIdComponent())})),d(n.URITypeMap.RESPONSE,(function(e){return o.responseURI(e.getIdComponent())})),d(n.URITypeMap.CULTURAL_MOMENT,(function(e){if(e.getNextComponent()!==i.URIParticle.HUB)throw new TypeError("Invalid or unknown Spotify URI!");return o.culturalMomentURI(e.getIdComponent())})),d(n.URITypeMap.FESTIVAL,(function(e){return o.festivalURI(e.getIdComponent())})),d(n.URITypeMap.TOUR,(function(e){return o.tourURI(e.getIdComponent())})),d(n.URITypeMap.VENUE,(function(e){return o.venueURI(e.getIdComponent())})),d(n.URITypeMap.VIDEO,(function(e){return o.videoURI(e.getIdComponent())})),d(n.URITypeMap.CANVAS,(function(e){return o.canvasURI(e.getIdComponent())})),d(n.URITypeMap.COURSE,(function(e){return o.courseURI(e.getIdComponent())})),d(n.URITypeMap.LESSON,(function(e){return o.lessonURI(e.getIdComponent())})),d(n.URITypeMap.PROMOTER,(function(e){return o.promoterURI(e.getIdComponent())})),d(n.URITypeMap.COMMENT,(function(e){return o.commentURI(e.getIdComponent())}))},{"../../../_internal/factories":202,"../../../enums/uri_particle":213,"../../../enums/uri_type":214,"../../../factories":215,"../../helpers":203,"../helpers":205,"./user":207}],207:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.UserURIParsers=void 0;var n=e("../../../enums/uri_type"),i=e("../../../enums/uri_particle"),o=e("../helpers"),a=e("../../../factories"),s=o.createParserDefinition(),u=s[0],l=s[1];r.UserURIParsers=l,u(n.URITypeMap.PLAYLIST,(function(e,t,r){var n=r.username;return a.playlistURI(n,e.getBase62IdComponent())})),u(n.URITypeMap.FOLDER,(function(e,t,r){var n=r.username;return a.folderURI(n,e.getIdComponent())})),u(n.URITypeMap.COLLECTION_TRACK_LIST,(function(e,t,r){var n=r.username;return a.collectionTrackListURI(n,e.getIdComponent())})),u(n.URITypeMap.COLLECTION,(function(e,t,r){var i=r.username,o=e.getNextComponent();if(o===n.URITypeMap.ALBUM){var s=e.getIdComponent();return"missing"===e.getNextComponent()?a.collectionMissingAlbumURI(i,s):a.collectionAlbumURI(i,s)}return o===n.URITypeMap.ARTIST?a.collectionArtistURI(i,e.getIdComponent()):a.collectionURI(i,o)})),u(n.URITypeMap.STARRED,(function(e,t,r){var n=r.username;return a.starredURI(n)})),u(n.URITypeMap.FOLLOWERS,(function(e,t,r){var n=r.username;return a.followersURI(n)})),u(n.URITypeMap.FOLLOWING,(function(e,t,r){var n=r.username;return a.followingURI(n)})),u(i.URIParticle.TOP,(function(e,t,r){var n=r.username;return a.userToplistURI(n,e.getNextRequiredComponent())})),u(n.URITypeMap.INBOX,(function(e,t,r){var n=r.username;return a.inboxURI(n)})),u(n.URITypeMap.ROOTLIST,(function(e,t,r){var n=r.username;return a.rootlistURI(n)})),u(n.URITypeMap.PUBLISHED_ROOTLIST,(function(e,t,r){var n=r.username;return a.publishedRootlistURI(n)})),u(n.URITypeMap.TOPLIST,(function(e,t,r){var n=r.username;return a.userTopTracksURI(n)})),u(n.URITypeMap.LIBRARY,(function(e,t,r){var n=r.username;return a.libraryURI(n,e.getNextComponent())}))},{"../../../enums/uri_particle":213,"../../../enums/uri_type":214,"../../../factories":215,"../helpers":205}],208:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.URISerializers=void 0;var n=e("../../../enums/uri_type"),i=e("../../../enums/uri_particle"),o=e("../../helpers"),a=e("../helpers").createSerializerDefinition(),s=a[0],u=a[1];r.URISerializers=u,s(n.URITypeMap.ALBUM,(function(e){var t=[n.URITypeMap.ALBUM,e.id];return e.disc&&t.push(e.disc),t})),s(n.URITypeMap.AD,(function(e){return[n.URITypeMap.AD,e.id]})),s(n.URITypeMap.ARTIST,(function(e){return[n.URITypeMap.ARTIST,e.id]})),s(n.URITypeMap.QUEUE,(function(){return[n.URITypeMap.QUEUE]})),s(n.URITypeMap.GENRE,(function(e){return[n.URITypeMap.GENRE,e.genre]})),s(n.URITypeMap.ARTIST_TOPLIST,(function(e){return[n.URITypeMap.ARTIST,e.id,i.URIParticle.TOP,e.toplist]})),s(n.URITypeMap.ARTIST_CONCERTS,(function(e){return[n.URITypeMap.ARTIST,e.id,i.URIParticle.CONCERTS]})),s(n.URITypeMap.DAILY_MIX,(function(e){return[n.URITypeMap.DAILY_MIX,e.id]})),s(n.URITypeMap.SEARCH,(function(e,t){return[n.URITypeMap.SEARCH,o.encodeComponent(e.query,t)]})),s(n.URITypeMap.TRACK,(function(e){var t=e.id;return(e.context||e.play)&&(t+=o.encodeQueryString({context:e.context,play:e.play})),e.anchor&&(t+="#"+e.anchor),[n.URITypeMap.TRACK,t]})),s(n.URITypeMap.TRACKSET,(function(e){var t=[];if(e.tracks)for(var r=0,i=e.tracks.length;r<i;r++)t.push(e.tracks[r].id);return t=[t.join(",")],null!==e.index&&void 0!==e.index&&t.push("#",e.index.toString()),[n.URITypeMap.TRACKSET,o.encodeComponent(e.name)].concat(t)})),s(n.URITypeMap.FACEBOOK,(function(e){return[i.URIParticle.USER,n.URITypeMap.FACEBOOK,e.uid]})),s(n.URITypeMap.AUDIO_FILE,(function(e){return[n.URITypeMap.AUDIO_FILE,e.extension,e.id]})),s(n.URITypeMap.FOLDER,(function(e,t){return[i.URIParticle.USER,o.encodeComponent(e.username,t),n.URITypeMap.FOLDER,e.id]})),s(n.URITypeMap.FOLLOWERS,(function(e,t){return[i.URIParticle.USER,o.encodeComponent(e.username,t),n.URITypeMap.FOLLOWERS]})),s(n.URITypeMap.FOLLOWING,(function(e,t){return[i.URIParticle.USER,o.encodeComponent(e.username,t),n.URITypeMap.FOLLOWING]})),s(n.URITypeMap.PLAYLIST,(function(e,t){return[i.URIParticle.USER,o.encodeComponent(e.username,t),n.URITypeMap.PLAYLIST,e.id]})),s(n.URITypeMap.PLAYLIST_V2,(function(e){return[n.URITypeMap.PLAYLIST,e.id]})),s(n.URITypeMap.STARRED,(function(e,t){return[i.URIParticle.USER,o.encodeComponent(e.username,t),n.URITypeMap.STARRED]})),s(n.URITypeMap.TEMP_PLAYLIST,(function(e){return[n.URITypeMap.TEMP_PLAYLIST,e.origin,e.data]})),s(n.URITypeMap.CONTEXT_GROUP,(function(e){return[n.URITypeMap.CONTEXT_GROUP,e.origin,e.name]})),s(n.URITypeMap.USER_TOPLIST,(function(e,t){return[i.URIParticle.USER,o.encodeComponent(e.username,t),i.URIParticle.TOP,e.toplist]})),s(n.URITypeMap.USER_TOP_TRACKS,(function(e,t){return[i.URIParticle.USER,o.encodeComponent(e.username,t),n.URITypeMap.TOPLIST]})),s(n.URITypeMap.TOPLIST,(function(e){return[i.URIParticle.TOP,e.toplist].concat(e.global||!e.country?[i.URIParticle.GLOBAL]:["country",e.country])})),s(n.URITypeMap.INBOX,(function(e,t){return[i.URIParticle.USER,o.encodeComponent(e.username,t),n.URITypeMap.INBOX]})),s(n.URITypeMap.ROOTLIST,(function(e,t){return[i.URIParticle.USER,o.encodeComponent(e.username,t),n.URITypeMap.ROOTLIST]})),s(n.URITypeMap.PUBLISHED_ROOTLIST,(function(e,t){return[i.URIParticle.USER,o.encodeComponent(e.username,t),n.URITypeMap.PUBLISHED_ROOTLIST]})),s(n.URITypeMap.COLLECTION_TRACK_LIST,(function(e,t){return[i.URIParticle.USER,o.encodeComponent(e.username,t),n.URITypeMap.COLLECTION_TRACK_LIST,e.id]})),s(n.URITypeMap.PROFILE,(function(e,t){return e.args&&e.args.length>0?[i.URIParticle.USER,o.encodeComponent(e.username,t)].concat(e.args):[i.URIParticle.USER,o.encodeComponent(e.username,t)]})),s(n.URITypeMap.LOCAL_ARTIST,(function(e,t){return[n.URITypeMap.LOCAL_TRACK,o.encodeComponent(e.artist,t)]})),s(n.URITypeMap.LOCAL_ALBUM,(function(e,t){return[n.URITypeMap.LOCAL_TRACK,o.encodeComponent(e.artist,t),o.encodeComponent(e.album,t)]})),s(n.URITypeMap.LOCAL_TRACK,(function(e,t){return[n.URITypeMap.LOCAL_TRACK,o.encodeComponent(e.artist,t),o.encodeComponent(e.album,t),o.encodeComponent(e.track,t),e.duration]})),s(n.URITypeMap.LIBRARY,(function(e,t){return[i.URIParticle.USER,o.encodeComponent(e.username,t),n.URITypeMap.LIBRARY].concat(e.category?[e.category]:[])})),s(n.URITypeMap.IMAGE,(function(e){return[n.URITypeMap.IMAGE,e.id]})),s(n.URITypeMap.MOSAIC,(function(e){var t=[];return e.ids&&(t=e.ids.slice(0)),t.unshift(n.URITypeMap.MOSAIC),t})),s(n.URITypeMap.RADIO,(function(e,t){return o.encodeComponents(e.args,t,[n.URITypeMap.RADIO])})),s(n.URITypeMap.SPECIAL,(function(e,t){return o.encodeComponents(e.args,t,[n.URITypeMap.SPECIAL])})),s(n.URITypeMap.STATION,(function(e,t){return o.encodeComponents(e.args,t,[n.URITypeMap.STATION])})),s(n.URITypeMap.APPLICATION,(function(e,t){return o.encodeComponents(e.args,t,[i.URIParticle.APP,e.id])})),s(n.URITypeMap.COLLECTION_ALBUM,(function(e,t){return[i.URIParticle.USER,o.encodeComponent(e.username,t),n.URITypeMap.COLLECTION,n.URITypeMap.ALBUM,e.id]})),s(n.URITypeMap.COLLECTION_MISSING_ALBUM,(function(e,t){return[i.URIParticle.USER,o.encodeComponent(e.username,t),n.URITypeMap.COLLECTION,n.URITypeMap.ALBUM,e.id,"missing"]})),s(n.URITypeMap.COLLECTION_ARTIST,(function(e,t){return[i.URIParticle.USER,o.encodeComponent(e.username,t),n.URITypeMap.COLLECTION,n.URITypeMap.ARTIST,e.id]})),s(n.URITypeMap.COLLECTION,(function(e,t){var r=[n.URITypeMap.COLLECTION].concat(e.category?[e.category]:[]);return e.username?[i.URIParticle.USER,o.encodeComponent(e.username,t)].concat(r):r})),s(n.URITypeMap.COMMENT,(function(e){return[n.URITypeMap.COMMENT,e.id]})),s(n.URITypeMap.EPISODE,(function(e){var t=e.id;return(e.context||e.play)&&(t+=o.encodeQueryString({context:e.context,play:e.play})),[n.URITypeMap.EPISODE,t]})),s(n.URITypeMap.SHOW,(function(e){return[n.URITypeMap.SHOW,e.id]})),s(n.URITypeMap.LIVE,(function(e){return[n.URITypeMap.LIVE,e.id]})),s(n.URITypeMap.ROOM,(function(e){return[n.URITypeMap.ROOM,e.id]})),s(n.URITypeMap.EXPRESSION,(function(e){return[n.URITypeMap.EXPRESSION,e.id]})),s(n.URITypeMap.CONCEPT,(function(e){return[n.URITypeMap.CONCEPT,e.id]})),s(n.URITypeMap.CONCERT,(function(e){return[n.URITypeMap.CONCERT,e.id]})),s(n.URITypeMap.SOCIAL_SESSION,(function(e){return[n.URITypeMap.SOCIAL_SESSION,e.id]})),s(n.URITypeMap.JAM,(function(e){var t=[n.URITypeMap.JAM];return e.contextType&&e.id&&t.push(e.contextType,e.id),e.play&&t.push("play"),t})),s(n.URITypeMap.INTERRUPTION,(function(e){return[n.URITypeMap.INTERRUPTION,e.id]})),s(n.URITypeMap.MERCH,(function(e){return[n.URITypeMap.MERCH,e.id]})),s(n.URITypeMap.MERCHHUB,(function(){return[n.URITypeMap.MERCHHUB]})),s(n.URITypeMap.PRERELEASE,(function(e){return[n.URITypeMap.PRERELEASE,e.id]})),s(n.URITypeMap.UNKNOWN,(function(e,t){return o.encodeComponents(e.args,t)})),s(n.URITypeMap.MEDIA,(function(e){return[n.URITypeMap.MEDIA,e.id]})),s(n.URITypeMap.POLL,(function(e){return[n.URITypeMap.POLL,e.id]})),s(n.URITypeMap.QUESTION,(function(e){return[n.URITypeMap.QUESTION,e.id]})),s(n.URITypeMap.RESPONSE,(function(e){return[n.URITypeMap.RESPONSE,e.id]})),s(n.URITypeMap.FESTIVAL,(function(e){return[n.URITypeMap.FESTIVAL,e.id]})),s(n.URITypeMap.TOUR,(function(e){return[n.URITypeMap.TOUR,e.id]})),s(n.URITypeMap.CULTURAL_MOMENT,(function(e){return[n.URITypeMap.CULTURAL_MOMENT,i.URIParticle.HUB,e.id]})),s(n.URITypeMap.VENUE,(function(e){return[n.URITypeMap.VENUE,e.id]})),s(n.URITypeMap.VIDEO,(function(e){return[n.URITypeMap.VIDEO,e.id]})),s(n.URITypeMap.CANVAS,(function(e){return[n.URITypeMap.CANVAS,e.id]})),s(n.URITypeMap.COURSE,(function(e){return[n.URITypeMap.COURSE,e.id]})),s(n.URITypeMap.LESSON,(function(e){return[n.URITypeMap.LESSON,e.id]})),s(n.URITypeMap.PROMOTER,(function(e){return[n.URITypeMap.PROMOTER,e.id]}))},{"../../../enums/uri_particle":213,"../../../enums/uri_type":214,"../../helpers":203,"../helpers":205}],209:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getComponents=void 0;var n=e("./uri_definitions/serializers");r.getComponents=function(e,t){var r=n.URISerializers[e.type];if(!r)throw new TypeError("Invalid Spotify URI!");return r(e,t)}},{"./uri_definitions/serializers":208}],210:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.base62FromHex=r.base62ToHex=r._ID16=r._ID62=r._HEX256=void 0;var n="0123456789abcdef",i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";r._HEX256=[],r._HEX256.length=256;for(var o=0;o<256;o++)r._HEX256[o]=n[o>>4]+n[15&o];r._ID62=[],r._ID62.length=128;for(o=0;o<i.length;++o)r._ID62[i.charCodeAt(o)]=o;r._ID16=[];for(o=0;o<16;o++)r._ID16[n.charCodeAt(o)]=o;for(o=0;o<6;o++)r._ID16["ABCDEF".charCodeAt(o)]=10+o;r.base62ToHex=function(e){if(22!==e.length)return null;var t,n,i,o,a,s=2.3283064365386963e-10,u=4294967296,l=238328;return t=56800235584*r._ID62[e.charCodeAt(0)]+916132832*r._ID62[e.charCodeAt(1)]+14776336*r._ID62[e.charCodeAt(2)]+238328*r._ID62[e.charCodeAt(3)]+3844*r._ID62[e.charCodeAt(4)]+62*r._ID62[e.charCodeAt(5)]+r._ID62[e.charCodeAt(6)],t=(t-=(n=t*s|0)*u)*l+(a=3844*r._ID62[e.charCodeAt(7)]+62*r._ID62[e.charCodeAt(8)]+r._ID62[e.charCodeAt(9)]),t-=(a=t*s|0)*u,n=n*l+a,t=t*l+(a=3844*r._ID62[e.charCodeAt(10)]+62*r._ID62[e.charCodeAt(11)]+r._ID62[e.charCodeAt(12)]),t-=(a=t*s|0)*u,n=n*l+a,n-=(a=n*s|0)*u,i=a,t=t*l+(a=3844*r._ID62[e.charCodeAt(13)]+62*r._ID62[e.charCodeAt(14)]+r._ID62[e.charCodeAt(15)]),t-=(a=t*s|0)*u,n=n*l+a,n-=(a=n*s|0)*u,i=i*l+a,t=t*l+(a=3844*r._ID62[e.charCodeAt(16)]+62*r._ID62[e.charCodeAt(17)]+r._ID62[e.charCodeAt(18)]),t-=(a=t*s|0)*u,n=n*l+a,n-=(a=n*s|0)*u,i=i*l+a,i-=(a=i*s|0)*u,o=a,t=t*l+(a=3844*r._ID62[e.charCodeAt(19)]+62*r._ID62[e.charCodeAt(20)]+r._ID62[e.charCodeAt(21)]),t-=(a=t*s|0)*u,n=n*l+a,n-=(a=n*s|0)*u,i=i*l+a,i-=(a=i*s|0)*u,o=o*l+a,o-=(a=o*s|0)*u,a?null:r._HEX256[o>>>24]+r._HEX256[o>>>16&255]+r._HEX256[o>>>8&255]+r._HEX256[255&o]+r._HEX256[i>>>24]+r._HEX256[i>>>16&255]+r._HEX256[i>>>8&255]+r._HEX256[255&i]+r._HEX256[n>>>24]+r._HEX256[n>>>16&255]+r._HEX256[n>>>8&255]+r._HEX256[255&n]+r._HEX256[t>>>24]+r._HEX256[t>>>16&255]+r._HEX256[t>>>8&255]+r._HEX256[255&t]},r.base62FromHex=function(e){var t,n=0,o=0,a=0;for(t=0;t<10;t++)a=16*a+r._ID16[e.charCodeAt(t)];for(t=0;t<11;t++)o=16*o+r._ID16[e.charCodeAt(t+10)];for(t=0;t<11;t++)n=16*n+r._ID16[e.charCodeAt(t+21)];if(isNaN(n+o+a))return null;var s,u=17592186044416,l="";for(t=0;t<7;++t)s=((s=((s=a)-62*(a=Math.floor(s*(1/62))))*u+o)-62*(o=Math.floor(s*(1/62))))*u+n,n=Math.floor(s*(1/62)),l=i[s-62*n]+l;for(o+=a*u;t<15;++t)s=((s=o)-62*(o=Math.floor(s*(1/62))))*u+n,n=Math.floor(s*(1/62)),l=i[s-62*n]+l;for(n+=o*u;t<21;++t)s=n,n=Math.floor(s*(1/62)),l=i[s-62*n]+l;return i[n]+l}},{}],211:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PATH_PREFIX=r.OPEN_HTTPS_PREFIX=r.OPEN_HTTP_PREFIX=r.PLAY_HTTPS_PREFIX=r.PLAY_HTTP_PREFIX=r.URI_PREFIX=void 0,r.URI_PREFIX="spotify:",r.PLAY_HTTP_PREFIX="http://play.spotify.com/",r.PLAY_HTTPS_PREFIX="https://play.spotify.com/",r.OPEN_HTTP_PREFIX="http://open.spotify.com/",r.OPEN_HTTPS_PREFIX="https://open.spotify.com/",r.PATH_PREFIX="/"},{}],212:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.URIFormat=void 0,function(e){e[e.URI=0]="URI",e[e.URL=1]="URL"}(r.URIFormat||(r.URIFormat={}))},{}],213:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.URIParticle=void 0,r.URIParticle={APP:"app",FACEBOOK:"facebook",GLOBAL:"global",TOP:"top",USER:"user",CONCERTS:"concerts",HUB:"hub"}},{}],214:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.URITypeMap=void 0,r.URITypeMap={AD:"ad",ALBUM:"album",GENRE:"genre",QUEUE:"queue",APPLICATION:"application",ARTIST:"artist",ARTIST_TOPLIST:"artist-toplist",ARTIST_CONCERTS:"artist-concerts",AUDIO_FILE:"audiofile",COLLECTION:"collection",COLLECTION_ALBUM:"collection-album",COLLECTION_ARTIST:"collection-artist",COLLECTION_MISSING_ALBUM:"collection-missing-album",COLLECTION_TRACK_LIST:"collectiontracklist",COMMENT:"comment",CONCEPT:"concept",CONCERT:"concert",CONTEXT_GROUP:"context-group",CULTURAL_MOMENT:"cultural-moment",DAILY_MIX:"dailymix",EMPTY:"empty",EPISODE:"episode",FACEBOOK:"facebook",FESTIVAL:"festival",FOLDER:"folder",FOLLOWERS:"followers",FOLLOWING:"following",IMAGE:"image",INBOX:"inbox",INTERRUPTION:"interruption",LIBRARY:"library",LIVE:"live",ROOM:"room",EXPRESSION:"expression",JAM:"jam",LOCAL:"local",LOCAL_TRACK:"local",LOCAL_ALBUM:"local-album",LOCAL_ARTIST:"local-artist",MERCH:"merch",MERCHHUB:"merchhub",MOSAIC:"mosaic",PLAYLIST:"playlist",PLAYLIST_V2:"playlist-v2",PRERELEASE:"prerelease",PROFILE:"profile",PROMOTER:"promoter",PUBLISHED_ROOTLIST:"published-rootlist",RADIO:"radio",ROOTLIST:"rootlist",SEARCH:"search",SHOW:"show",SOCIAL_SESSION:"socialsession",SPECIAL:"special",STARRED:"starred",STATION:"station",TEMP_PLAYLIST:"temp-playlist",TOPLIST:"toplist",TOUR:"tour",TRACK:"track",TRACKSET:"trackset",USER_TOPLIST:"user-toplist",USER_TOP_TRACKS:"user-top-tracks",UNKNOWN:"unknown",VENUE:"venue",VIDEO:"video",MEDIA:"media",QUESTION:"question",POLL:"poll",RESPONSE:"response",COURSE:"course",LESSON:"lesson",CANVAS:"canvas"}},{}],215:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.profileURI=r.prereleaseURI=r.playlistV2URI=r.playlistURI=r.mosaicURI=r.merchHubURI=r.merchURI=r.localArtistURI=r.localAlbumURI=r.localURI=r.localTrackURI=r.responseURI=r.pollURI=r.questionURI=r.expressionURI=r.roomURI=r.liveURI=r.libraryURI=r.jamURI=r.interruptionURI=r.inboxURI=r.imageURI=r.followingURI=r.followersURI=r.folderURI=r.festivalURI=r.facebookURI=r.episodeURI=r.emptyURI=r.dailyMixURI=r.culturalMomentURI=r.contextGroupURI=r.concertURI=r.conceptURI=r.commentURI=r.collectionTrackListURI=r.collectionMissingAlbumURI=r.collectionArtistURI=r.collectionAlbumURI=r.canvasURI=r.queueURI=r.genreURI=r.collectionURI=r.audioFileURI=r.artistConcertsURI=r.artistToplistURI=r.artistURI=r.applicationURI=r.albumURI=r.adURI=void 0,r.promoterURI=r.lessonURI=r.courseURI=r.videoURI=r.venueURI=r.mediaURI=r.userTopTracksURI=r.userToplistURI=r.tracksetURI=r.trackURI=r.tourURI=r.toplistURI=r.temporaryPlaylistURI=r.stationURI=r.starredURI=r.specialURI=r.socialSessionURI=r.showURI=r.searchURI=r.rootlistURI=r.radioURI=r.publishedRootlistURI=void 0;var n=e("./enums/uri_type"),i=e("./uri");function o(e,t,r,o){return i.createURI(n.URITypeMap.LOCAL_TRACK,{artist:e,album:t,track:r,duration:o})}r.adURI=function(e){return i.createURI(n.URITypeMap.AD,{id:e})},r.albumURI=function(e,t){return i.createURI(n.URITypeMap.ALBUM,{id:e,disc:t,hasBase62Id:!0})},r.applicationURI=function(e,t){return i.createURI(n.URITypeMap.APPLICATION,{id:e,args:Array.isArray(t)?t:[]})},r.artistURI=function(e){return i.createURI(n.URITypeMap.ARTIST,{id:e,hasBase62Id:!0})},r.artistToplistURI=function(e,t){return i.createURI(n.URITypeMap.ARTIST_TOPLIST,{id:e,toplist:t,hasBase62Id:!0})},r.artistConcertsURI=function(e){return i.createURI(n.URITypeMap.ARTIST_CONCERTS,{id:e,hasBase62Id:!0})},r.audioFileURI=function(e,t){return i.createURI(n.URITypeMap.AUDIO_FILE,{id:t,extension:e})},r.collectionURI=function(e,t){return i.createURI(n.URITypeMap.COLLECTION,{username:e,category:t})},r.genreURI=function(e){return i.createURI(n.URITypeMap.GENRE,{genre:e})},r.queueURI=function(){return i.createURI(n.URITypeMap.QUEUE,{})},r.canvasURI=function(e){return i.createURI(n.URITypeMap.CANVAS,{id:e,hasBase62Id:!0})},r.collectionAlbumURI=function(e,t){return i.createURI(n.URITypeMap.COLLECTION_ALBUM,{id:t,username:e,hasBase62Id:!0})},r.collectionArtistURI=function(e,t){return i.createURI(n.URITypeMap.COLLECTION_ARTIST,{id:t,username:e,hasBase62Id:!0})},r.collectionMissingAlbumURI=function(e,t){return i.createURI(n.URITypeMap.COLLECTION_MISSING_ALBUM,{id:t,username:e,hasBase62Id:!0})},r.collectionTrackListURI=function(e,t){return i.createURI(n.URITypeMap.COLLECTION_TRACK_LIST,{id:t,username:e,hasBase62Id:!0})},r.commentURI=function(e){return i.createURI(n.URITypeMap.COMMENT,{id:e,hasBase62Id:!0})},r.conceptURI=function(e){return i.createURI(n.URITypeMap.CONCEPT,{id:e,hasBase62Id:!0})},r.concertURI=function(e){return i.createURI(n.URITypeMap.CONCERT,{id:e,hasBase62Id:!0})},r.contextGroupURI=function(e,t){return i.createURI(n.URITypeMap.CONTEXT_GROUP,{origin:e,name:t,hasBase62Id:!0})},r.culturalMomentURI=function(e){return i.createURI(n.URITypeMap.CULTURAL_MOMENT,{id:e})},r.dailyMixURI=function(e){return i.createURI(n.URITypeMap.DAILY_MIX,{id:e,hasBase62Id:!0})},r.emptyURI=function(){return i.createURI(n.URITypeMap.EMPTY,{})},r.episodeURI=function(e,t,r){return i.createURI(n.URITypeMap.EPISODE,{id:e,context:t?i.parseURIFromString(t):null,play:r,hasBase62Id:!0})},r.facebookURI=function(e){return i.createURI(n.URITypeMap.FACEBOOK,{uid:e})},r.festivalURI=function(e){return i.createURI(n.URITypeMap.FESTIVAL,{id:e,hasBase62Id:!0})},r.folderURI=function(e,t){return i.createURI(n.URITypeMap.FOLDER,{id:t,username:e,hasBase62Id:!0})},r.followersURI=function(e){return i.createURI(n.URITypeMap.FOLLOWERS,{username:e})},r.followingURI=function(e){return i.createURI(n.URITypeMap.FOLLOWING,{username:e})},r.imageURI=function(e){return i.createURI(n.URITypeMap.IMAGE,{id:e})},r.inboxURI=function(e){return i.createURI(n.URITypeMap.INBOX,{username:e})},r.interruptionURI=function(e){return i.createURI(n.URITypeMap.INTERRUPTION,{id:e})},r.jamURI=function(e,t,r){return i.createURI(n.URITypeMap.JAM,{id:e,contextType:t,hasBase62Id:Boolean(e),play:Boolean(r)})},r.libraryURI=function(e,t){return i.createURI(n.URITypeMap.LIBRARY,{username:e,category:t})},r.liveURI=function(e){return i.createURI(n.URITypeMap.LIVE,{id:e,hasBase62Id:!0})},r.roomURI=function(e){return i.createURI(n.URITypeMap.ROOM,{id:e,hasBase62Id:!0})},r.expressionURI=function(e){return i.createURI(n.URITypeMap.EXPRESSION,{id:e,hasBase62Id:!0})},r.questionURI=function(e){return i.createURI(n.URITypeMap.QUESTION,{id:e,hasBase62Id:!0})},r.pollURI=function(e){return i.createURI(n.URITypeMap.POLL,{id:e,hasBase62Id:!0})},r.responseURI=function(e){return i.createURI(n.URITypeMap.RESPONSE,{id:e,hasBase62Id:!0})},r.localTrackURI=o,r.localURI=o,r.localAlbumURI=function(e,t){return i.createURI(n.URITypeMap.LOCAL_ALBUM,{artist:e,album:t})},r.localArtistURI=function(e){return i.createURI(n.URITypeMap.LOCAL_ARTIST,{artist:e})},r.merchURI=function(e){return i.createURI(n.URITypeMap.MERCH,{id:e,hasBase62Id:!0})},r.merchHubURI=function(){return i.createURI(n.URITypeMap.MERCHHUB,{})},r.mosaicURI=function(e){return i.createURI(n.URITypeMap.MOSAIC,{ids:e})},r.playlistURI=function(e,t){return i.createURI(n.URITypeMap.PLAYLIST,{id:t,username:e,hasBase62Id:!0})},r.playlistV2URI=function(e){return i.createURI(n.URITypeMap.PLAYLIST_V2,{id:e,hasBase62Id:!0})},r.prereleaseURI=function(e){return i.createURI(n.URITypeMap.PRERELEASE,{id:e,hasBase62Id:!0})},r.profileURI=function(e,t){return i.createURI(n.URITypeMap.PROFILE,{username:e,args:null!=t?t:[]})},r.publishedRootlistURI=function(e){return i.createURI(n.URITypeMap.PUBLISHED_ROOTLIST,{username:e})},r.radioURI=function(e){return i.createURI(n.URITypeMap.RADIO,{args:null!=e?e:""})},r.rootlistURI=function(e){return i.createURI(n.URITypeMap.ROOTLIST,{username:e})},r.searchURI=function(e){return i.createURI(n.URITypeMap.SEARCH,{query:e})},r.showURI=function(e){return i.createURI(n.URITypeMap.SHOW,{id:e,hasBase62Id:!0})},r.socialSessionURI=function(e){return i.createURI(n.URITypeMap.SOCIAL_SESSION,{id:e,hasBase62Id:!0})},r.specialURI=function(e){return i.createURI(n.URITypeMap.SPECIAL,{args:null!=e?e:[]})},r.starredURI=function(e){return i.createURI(n.URITypeMap.STARRED,{username:e})},r.stationURI=function(e){return i.createURI(n.URITypeMap.STATION,{args:null!=e?e:[]})},r.temporaryPlaylistURI=function(e,t){return i.createURI(n.URITypeMap.TEMP_PLAYLIST,{origin:e,data:t})},r.toplistURI=function(e,t,r){return i.createURI(n.URITypeMap.TOPLIST,{toplist:e,country:t,global:Boolean(r)})},r.tourURI=function(e){return i.createURI(n.URITypeMap.TOUR,{id:e,hasBase62Id:!0})},r.trackURI=function(e,t,r,o){return i.createURI(n.URITypeMap.TRACK,{id:e,anchor:t,context:r?i.parseURIFromString(r):null,play:o,hasBase62Id:!0})},r.tracksetURI=function(e,t,r){return i.createURI(n.URITypeMap.TRACKSET,{tracks:e,name:t||"",index:isNaN(r)?null:null!=r?r:null})},r.userToplistURI=function(e,t){return i.createURI(n.URITypeMap.USER_TOPLIST,{username:e,toplist:t})},r.userTopTracksURI=function(e){return i.createURI(n.URITypeMap.USER_TOP_TRACKS,{username:e})},r.mediaURI=function(e){return i.createURI(n.URITypeMap.MEDIA,{id:e,hasBase62Id:!0})},r.venueURI=function(e){return i.createURI(n.URITypeMap.VENUE,{id:e,hasBase62Id:!0})},r.videoURI=function(e){return i.createURI(n.URITypeMap.VIDEO,{id:e,hasBase62Id:!0})},r.courseURI=function(e){return i.createURI(n.URITypeMap.COURSE,{id:e,hasBase62Id:!0})},r.lessonURI=function(e){return i.createURI(n.URITypeMap.LESSON,{id:e,hasBase62Id:!0})},r.promoterURI=function(e){return i.createURI(n.URITypeMap.PROMOTER,{id:e,hasBase62Id:!0})}},{"./enums/uri_type":214,"./uri":218}],216:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getDisplayUsername=r.getCanonicalUsername=r.idToHex=r.hexToId=r.isSameIdentity=r.URITypeDefs=r.URITypeMap=void 0;var n=e("tslib"),i=e("./enums/uri_type");Object.defineProperty(r,"URITypeMap",{enumerable:!0,get:function(){return i.URITypeMap}}),n.__exportStar(e("./uri"),r),r.URITypeDefs=e("./uri_typedefs"),n.__exportStar(e("./factories"),r),n.__exportStar(e("./type_guards"),r);var o=e("./utils");Object.defineProperty(r,"isSameIdentity",{enumerable:!0,get:function(){return o.isSameIdentity}}),Object.defineProperty(r,"hexToId",{enumerable:!0,get:function(){return o.hexToId}}),Object.defineProperty(r,"idToHex",{enumerable:!0,get:function(){return o.idToHex}}),Object.defineProperty(r,"getCanonicalUsername",{enumerable:!0,get:function(){return o.getCanonicalUsername}}),Object.defineProperty(r,"getDisplayUsername",{enumerable:!0,get:function(){return o.getDisplayUsername}})},{"./enums/uri_type":214,"./factories":215,"./type_guards":217,"./uri":218,"./uri_typedefs":219,"./utils":220,tslib:227}],217:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isPublishedRootlistURI=r.isProfileURI=r.isPrereleaseURI=r.isPlaylistV1OrV2URI=r.isPlaylistV2URI=r.isPlaylistURI=r.isPlaylistV1URI=r.isMosaicURI=r.isMerchHubURI=r.isMerchURI=r.isLocalArtistURI=r.isLocalAlbumURI=r.isLocalTrackURI=r.isLocalURI=r.isExpressionURI=r.isRoomURI=r.isLiveURI=r.isLibraryURI=r.isJamURI=r.isInterruptionURI=r.isInboxURI=r.isImageURI=r.isFollowingURI=r.isFollowersURI=r.isFolderURI=r.isFestivalURI=r.isFacebookURI=r.isEpisodeURI=r.isEmptyURI=r.isDailyMixURI=r.isContextGroupURI=r.isConcertURI=r.isCollectionTrackListURI=r.isCollectionMissingAlbumURI=r.isCollectionArtistURI=r.isCollectionAlbumURI=r.isQueueURI=r.isGenreURI=r.isCulturalMomentURI=r.isConceptURI=r.isCommentURI=r.isCollectionURI=r.isCanvasURI=r.isAudioFileURI=r.isArtistConcertsURI=r.isArtistToplistURI=r.isArtistURI=r.isApplicationURI=r.isAlbumURI=r.isAdURI=void 0,r.isPromoterURI=r.isLessonURI=r.isCourseURI=r.isResponseURI=r.isQuestionURI=r.isPollURI=r.isMediaURI=r.isVideoURI=r.isVenueURI=r.isUnknownURI=r.isUserTopTracksURI=r.isUserToplistURI=r.isTracksetURI=r.isTrackURI=r.isTourURI=r.isToplistURI=r.isTemporaryPlaylistURI=r.isStationURI=r.isStarredURI=r.isSpecialURI=r.isSocialSessionURI=r.isShowURI=r.isSearchURI=r.isRootlistURI=r.isRadioURI=void 0;var n=e("./enums/uri_type"),i=e("./uri");function o(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.PLAYLIST}function a(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.PLAYLIST_V2}r.isAdURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.AD},r.isAlbumURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.ALBUM},r.isApplicationURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.APPLICATION},r.isArtistURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.ARTIST},r.isArtistToplistURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.ARTIST_TOPLIST},r.isArtistConcertsURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.ARTIST_CONCERTS},r.isAudioFileURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.AUDIO_FILE},r.isCanvasURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.CANVAS},r.isCollectionURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.COLLECTION},r.isCommentURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.COMMENT},r.isConceptURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.CONCEPT},r.isCulturalMomentURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.CULTURAL_MOMENT},r.isGenreURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.GENRE},r.isQueueURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.QUEUE},r.isCollectionAlbumURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.COLLECTION_ALBUM},r.isCollectionArtistURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.COLLECTION_ARTIST},r.isCollectionMissingAlbumURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.COLLECTION_MISSING_ALBUM},r.isCollectionTrackListURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.COLLECTION_TRACK_LIST},r.isConcertURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.CONCERT},r.isContextGroupURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.CONTEXT_GROUP},r.isDailyMixURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.DAILY_MIX},r.isEmptyURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.EMPTY},r.isEpisodeURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.EPISODE},r.isFacebookURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.FACEBOOK},r.isFestivalURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.FESTIVAL},r.isFolderURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.FOLDER},r.isFollowersURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.FOLLOWERS},r.isFollowingURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.FOLLOWING},r.isImageURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.IMAGE},r.isInboxURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.INBOX},r.isInterruptionURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.INTERRUPTION},r.isJamURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.JAM},r.isLibraryURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.LIBRARY},r.isLiveURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.LIVE},r.isRoomURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.ROOM},r.isExpressionURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.EXPRESSION},r.isLocalURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.LOCAL},r.isLocalTrackURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.LOCAL_TRACK},r.isLocalAlbumURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.LOCAL_ALBUM},r.isLocalArtistURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.LOCAL_ARTIST},r.isMerchURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.MERCH},r.isMerchHubURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.MERCHHUB},r.isMosaicURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.MOSAIC},r.isPlaylistV1URI=o,r.isPlaylistURI=o,r.isPlaylistV2URI=a,r.isPlaylistV1OrV2URI=function(e){return o(e)||a(e)},r.isPrereleaseURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.PRERELEASE},r.isProfileURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.PROFILE},r.isPublishedRootlistURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.PUBLISHED_ROOTLIST},r.isRadioURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.RADIO},r.isRootlistURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.ROOTLIST},r.isSearchURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.SEARCH},r.isShowURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.SHOW},r.isSocialSessionURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.SOCIAL_SESSION},r.isSpecialURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.SPECIAL},r.isStarredURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.STARRED},r.isStationURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.STATION},r.isTemporaryPlaylistURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.TEMP_PLAYLIST},r.isToplistURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.TOPLIST},r.isTourURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.TOUR},r.isTrackURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.TRACK},r.isTracksetURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.TRACKSET},r.isUserToplistURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.USER_TOPLIST},r.isUserTopTracksURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.USER_TOP_TRACKS},r.isUnknownURI=function(e){var t;return(null===(t=i.parseURI(e,{parseUnknown:!0}))||void 0===t?void 0:t.type)===n.URITypeMap.UNKNOWN},r.isVenueURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.VENUE},r.isVideoURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.VIDEO},r.isMediaURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.MEDIA},r.isPollURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.POLL},r.isQuestionURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.QUESTION},r.isResponseURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.RESPONSE},r.isCourseURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.COURSE},r.isLessonURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.LESSON},r.isPromoterURI=function(e){var t;return(null===(t=i.parseURI(e))||void 0===t?void 0:t.type)===n.URITypeMap.PROMOTER}},{"./enums/uri_type":214,"./uri":218}],218:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getURIHexId=r.parseURI=r.parseURIFromString=r.createURI=void 0;var n=e("tslib"),i=e("./enums/uri_format"),o=e("./enums/uri_type"),a=e("./enums/prefix"),s=e("./enums/uri_particle"),u=e("./_internal/parser"),l=e("./_internal/utils"),c=e("./utils"),d="function"==typeof Object.assign?function(e,t){Object.assign(e,t)}:function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},_=function(){function e(e,t){void 0===t&&(t={}),this.type=e,this.hasBase62Id=!!t.hasBase62Id,d(this,t)}return e.prototype.toURI=function(){return"spotify:"+l.getComponents(this,i.URIFormat.URI).join(":")},e.prototype.toString=function(){return this.toURI()},e.prototype.toURLPath=function(e){void 0===e&&(e=!1);var t=l.getComponents(this,i.URIFormat.URL);t[0]===s.URIParticle.APP&&t.shift();var r=t[0]===o.URITypeMap.TRACKSET,n=t[0]===o.URITypeMap.LOCAL_TRACK;if(!r&&!n){for(var a=[],u=0,c=t.length;u<c;u++){var d=t[u];d&&a.push(d)}t=a}var _=t.join("/");return e?"/"+_:_},e.prototype.getPath=function(){return this.toString().replace(/[#?].*/,"")},e.prototype.toURL=function(e){return""+(e||a.OPEN_HTTPS_PREFIX)+this.toURLPath()},e.prototype.clone=function(){return new e(this.type,this)},e}();function p(e,t){if("string"!=typeof e)throw new TypeError("Argument `uri` must be a string.");return u.parse(e,null==t?void 0:t.parseUnknown)}r.createURI=function(e,t){return new _(e,t)},r.parseURIFromString=p,r.parseURI=function(e,t){var r,i,o;if(!e)return null;var a={};if(t&&(Array.isArray(t)?a.allowedTypes=t:a=t),e instanceof _)return-1===(null===(r=a.allowedTypes)||void 0===r?void 0:r.indexOf(e.type))?null:e.clone();if("string"==typeof e)try{var s=p(e,a);return-1===(null===(i=a.allowedTypes)||void 0===i?void 0:i.indexOf(s.type))?null:s}catch(e){return null}if(null==e?void 0:e.type){if(-1===(null===(o=a.allowedTypes)||void 0===o?void 0:o.indexOf(e.type)))return null;var u=e.type,l=n.__rest(e,["type"]);return new _(u,l)}return null},r.getURIHexId=function(e){return e.hasBase62Id&&e.id?c.idToHex(e.id):null}},{"./_internal/parser":204,"./_internal/utils":209,"./enums/prefix":211,"./enums/uri_format":212,"./enums/uri_particle":213,"./enums/uri_type":214,"./utils":220,tslib:227}],219:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})},{}],220:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getDisplayUsername=r.getCanonicalUsername=r.hexToId=r.idToHex=r.isSameIdentity=void 0;var n=e("./enums/uri_format"),i=e("./enums/uri_type"),o=e("./base62"),a=e("./uri"),s=e("./_internal/parser"),u=e("./_internal/helpers");r.isSameIdentity=function e(t,r){var o=a.parseURI(t),u=a.parseURI(r);if(!o||!u)return!1;if(o.toString()===u.toString())return!0;if(!(o.type!==i.URITypeMap.PLAYLIST&&o.type!==i.URITypeMap.PLAYLIST_V2||u.type!==i.URITypeMap.PLAYLIST&&u.type!==i.URITypeMap.PLAYLIST_V2))return o.id===u.id;if(o.type===i.URITypeMap.STATION&&u.type===i.URITypeMap.STATION){var l=s.parseFromComponents(o.args,n.URIFormat.URI);return!!l&&e(l,s.parseFromComponents(u.args,n.URIFormat.URI))}return!1},r.idToHex=function(e){return 22===e.length?o.base62ToHex(e):e},r.hexToId=function(e){return 32===e.length?o.base62FromHex(e):e},r.getCanonicalUsername=function(e){return u.encodeComponent(e,n.URIFormat.URI)},r.getDisplayUsername=function(e){return u.decodeComponent(e,n.URIFormat.URI)}},{"./_internal/helpers":203,"./_internal/parser":204,"./base62":210,"./enums/uri_format":212,"./enums/uri_type":214,"./uri":218}],221:[function(e,t,r){"use strict";r.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return 3*(r+n)/4-n},r.toByteArray=function(e){var t,r,n=l(e),a=n[0],s=n[1],u=new o(function(e,t,r){return 3*(t+r)/4-r}(0,a,s)),c=0,d=s>0?a-4:a;for(r=0;r<d;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;2===s&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,u[c++]=255&t);1===s&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t);return u},r.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],a=0,s=r-i;a<s;a+=16383)o.push(c(e,a,a+16383>s?s:a+16383));1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=a.length;s<u;++s)n[s]=a[s],i[a.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function c(e,t,r){for(var i,o,a=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],222:[function(e,t,r){(function(t){(function(){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
"use strict";var t=e("base64-js"),n=e("ieee754");r.Buffer=o,r.SlowBuffer=function(e){+e!=e&&(e=0);return o.alloc(+e)},r.INSPECT_MAX_BYTES=50;function i(e){if(e>2147483647)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=o.prototype,t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}return a(e,t,r)}function a(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!o.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|d(e,t),n=i(r),a=n.write(e,t);a!==r&&(n=n.slice(0,a));return n}(e,t);if(ArrayBuffer.isView(e))return l(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(x(e,ArrayBuffer)||e&&x(e.buffer,ArrayBuffer))return function(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r);return n.__proto__=o.prototype,n}(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return o.from(n,t,r);var a=function(e){if(o.isBuffer(e)){var t=0|c(e.length),r=i(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||H(e.length)?i(0):l(e);if("Buffer"===e.type&&Array.isArray(e.data))return l(e.data)}(e);if(a)return a;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return s(e),i(e<0?0:0|c(e))}function l(e){for(var t=e.length<0?0:0|c(e.length),r=i(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function c(e){if(e>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|e}function d(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||x(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return w(e).length;default:if(i)return n?-1:U(e).length;t=(""+t).toLowerCase(),i=!0}}function _(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return b(this,t,r);case"utf8":case"utf-8":return I(this,t,r);case"ascii":return S(this,t,r);case"latin1":case"binary":return P(this,t,r);case"base64":return T(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function p(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function f(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),H(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:h(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):h(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function h(e,t,r,n,i){var o,a=1,s=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,r/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var c=-1;for(o=r;o<s;o++)if(l(e,o)===l(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===u)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(r+u>s&&(r=s-u),o=r;o>=0;o--){for(var d=!0,_=0;_<u;_++)if(l(e,o+_)!==l(t,_)){d=!1;break}if(d)return o}return-1}function v(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(H(s))return a;e[r+a]=s}return a}function y(e,t,r,n){return F(U(t,e.length-r),e,r,n)}function m(e,t,r,n){return F(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function E(e,t,r,n){return m(e,t,r,n)}function g(e,t,r,n){return F(w(t),e,r,n)}function R(e,t,r,n){return F(function(e,t){for(var r,n,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)r=e.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function T(e,r,n){return 0===r&&n===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(r,n))}function I(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,s,u,l=e[i],c=null,d=l>239?4:l>223?3:l>191?2:1;if(i+d<=r)switch(d){case 1:l<128&&(c=l);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&l)<<6|63&o)>127&&(c=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(u=(15&l)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(c=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(c=u)}null===c?(c=65533,d=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}r.kMaxLength=2147483647,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),o.poolSize=8192,o.from=function(e,t,r){return a(e,t,r)},o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,o.alloc=function(e,t,r){return function(e,t,r){return s(e),e<=0?i(e):void 0!==t?"string"==typeof r?i(e).fill(t,r):i(e).fill(t):i(e)}(e,t,r)},o.allocUnsafe=function(e){return u(e)},o.allocUnsafeSlow=function(e){return u(e)},o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(x(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),x(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var a=e[r];if(x(a,Uint8Array)&&(a=o.from(a)),!o.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,i),i+=a.length}return n},o.byteLength=d,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):_.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},o.prototype.compare=function(e,t,r,n,i){if(x(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),u=Math.min(a,s),l=this.slice(n,i),c=e.slice(t,r),d=0;d<u;++d)if(l[d]!==c[d]){a=l[d],s=c[d];break}return a<s?-1:s<a?1:0},o.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return f(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return f(this,e,t,r,!1)},o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return v(this,e,t,r);case"utf8":case"utf-8":return y(this,e,t,r);case"ascii":return m(this,e,t,r);case"latin1":case"binary":return E(this,e,t,r);case"base64":return g(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function S(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function P(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function b(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=k(e[o]);return i}function A(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function L(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function C(e,t,r,n,i,a){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function O(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function N(e,t,r,i,o){return t=+t,r>>>=0,o||O(e,0,r,4),n.write(e,t,r,i,23,4),r+4}function D(e,t,r,i,o){return t=+t,r>>>=0,o||O(e,0,r,8),n.write(e,t,r,i,52,8),r+8}o.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=o.prototype,n},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||L(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||L(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUInt8=function(e,t){return e>>>=0,t||L(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||L(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||L(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||L(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||L(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return e>>>=0,t||L(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||L(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||L(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||L(e,4,this.length),n.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||L(e,4,this.length),n.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||L(e,8,this.length),n.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||L(e,8,this.length),n.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||C(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||C(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);C(this,e,t,r,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);C(this,e,t,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return N(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return N(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return D(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return D(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var a=i-1;a>=0;--a)e[a+t]=this[a+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var s=o.isBuffer(e)?e:o.from(e,n),u=s.length;if(0===u)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<r-t;++a)this[a+t]=s[a%u]}return this};var M=/[^+/0-9A-Za-z-_]/g;function k(e){return e<16?"0"+e.toString(16):e.toString(16)}function U(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function w(e){return t.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function F(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function x(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function H(e){return e!=e}}).call(this)}).call(this,e("buffer").Buffer)},{"base64-js":221,buffer:222,ieee754:224}],223:[function(e,t,r){(function(n,i){(function(){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */
!function(e,n){"object"==typeof r&&void 0!==t?t.exports=n():"function"==typeof define&&define.amd?define(n):e.ES6Promise=n()}(this,(function(){"use strict";function t(e){return"function"==typeof e}var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=0,a=void 0,s=void 0,u=function(e,t){h[o]=e,h[o+1]=t,2===(o+=2)&&(s?s(v):R())};var l="undefined"!=typeof window?window:void 0,c=l||{},d=c.MutationObserver||c.WebKitMutationObserver,_="undefined"==typeof self&&void 0!==n&&"[object process]"==={}.toString.call(n),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var e=setTimeout;return function(){return e(v,1)}}var h=new Array(1e3);function v(){for(var e=0;e<o;e+=2){(0,h[e])(h[e+1]),h[e]=void 0,h[e+1]=void 0}o=0}var y,m,E,g,R=void 0;function T(e,t){var r=this,n=new this.constructor(P);void 0===n[S]&&U(n);var i=r._state;if(i){var o=arguments[i-1];u((function(){return M(i,n,o,r._result)}))}else N(r,n,e,t);return n}function I(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(P);return A(t,e),t}_?R=function(){return n.nextTick(v)}:d?(m=0,E=new d(v),g=document.createTextNode(""),E.observe(g,{characterData:!0}),R=function(){g.data=m=++m%2}):p?((y=new MessageChannel).port1.onmessage=v,R=function(){return y.port2.postMessage(0)}):R=void 0===l&&"function"==typeof e?function(){try{var e=Function("return this")().require("vertx");return void 0!==(a=e.runOnLoop||e.runOnContext)?function(){a(v)}:f()}catch(e){return f()}}():f();var S=Math.random().toString(36).substring(2);function P(){}function b(e,r,n){r.constructor===e.constructor&&n===T&&r.constructor.resolve===I?function(e,t){1===t._state?C(e,t._result):2===t._state?O(e,t._result):N(t,void 0,(function(t){return A(e,t)}),(function(t){return O(e,t)}))}(e,r):void 0===n?C(e,r):t(n)?function(e,t,r){u((function(e){var n=!1,i=function(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}(r,t,(function(r){n||(n=!0,t!==r?A(e,r):C(e,r))}),(function(t){n||(n=!0,O(e,t))}),e._label);!n&&i&&(n=!0,O(e,i))}),e)}(e,r,n):C(e,r)}function A(e,t){if(e===t)O(e,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof(n=t),null===n||"object"!==i&&"function"!==i)C(e,t);else{var r=void 0;try{r=t.then}catch(t){return void O(e,t)}b(e,t,r)}var n,i}function L(e){e._onerror&&e._onerror(e._result),D(e)}function C(e,t){void 0===e._state&&(e._result=t,e._state=1,0!==e._subscribers.length&&u(D,e))}function O(e,t){void 0===e._state&&(e._state=2,e._result=t,u(L,e))}function N(e,t,r,n){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+1]=r,i[o+2]=n,0===o&&e._state&&u(D,e)}function D(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,i=void 0,o=e._result,a=0;a<t.length;a+=3)n=t[a],i=t[a+r],n?M(r,n,i,o):i(o);e._subscribers.length=0}}function M(e,r,n,i){var o=t(n),a=void 0,s=void 0,u=!0;if(o){try{a=n(i)}catch(e){u=!1,s=e}if(r===a)return void O(r,new TypeError("A promises callback cannot return that same promise."))}else a=i;void 0!==r._state||(o&&u?A(r,a):!1===u?O(r,s):1===e?C(r,a):2===e&&O(r,a))}var k=0;function U(e){e[S]=k++,e._state=void 0,e._result=void 0,e._subscribers=[]}var w=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(P),this.promise[S]||U(this.promise),r(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?C(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&C(this.promise,this._result))):O(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;void 0===this._state&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===I){var i=void 0,o=void 0,a=!1;try{i=e.then}catch(e){a=!0,o=e}if(i===T&&void 0!==e._state)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(r===F){var s=new r(P);a?O(s,o):b(s,e,i),this._willSettleAt(s,t)}else this._willSettleAt(new r((function(t){return t(e)})),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,r){var n=this.promise;void 0===n._state&&(this._remaining--,2===e?O(n,r):this._result[t]=r),0===this._remaining&&C(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;N(e,void 0,(function(e){return r._settledAt(1,t,e)}),(function(e){return r._settledAt(2,t,e)}))},e}();var F=function(){function e(t){this[S]=k++,this._result=this._state=void 0,this._subscribers=[],P!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t((function(t){A(e,t)}),(function(t){O(e,t)}))}catch(t){O(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var r=this.constructor;return t(e)?this.then((function(t){return r.resolve(e()).then((function(){return t}))}),(function(t){return r.resolve(e()).then((function(){throw t}))})):this.then(e,e)},e}();return F.prototype.then=T,F.all=function(e){return new w(this,e).promise},F.race=function(e){var t=this;return r(e)?new t((function(r,n){for(var i=e.length,o=0;o<i;o++)t.resolve(e[o]).then(r,n)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},F.resolve=I,F.reject=function(e){var t=new this(P);return O(t,e),t},F._setScheduler=function(e){s=e},F._setAsap=function(e){u=e},F._asap=u,F.polyfill=function(){var e=void 0;if(void 0!==i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=F},F.Promise=F,F}))}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:225}],224:[function(e,t,r){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
r.read=function(e,t,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,l=u>>1,c=-7,d=r?i-1:0,_=r?-1:1,p=e[t+d];for(d+=_,o=p&(1<<-c)-1,p>>=-c,c+=s;c>0;o=256*o+e[t+d],d+=_,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+e[t+d],d+=_,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,n),o-=l}return(p?-1:1)*a*Math.pow(2,o-n)},r.write=function(e,t,r,n,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,d=c>>1,_=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,f=n?1:-1,h=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+d>=1?_/u:_*Math.pow(2,1-d))*u>=2&&(a++,u/=2),a+d>=c?(s=0,a=c):a+d>=1?(s=(t*u-1)*Math.pow(2,i),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),a=0));i>=8;e[r+p]=255&s,p+=f,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;e[r+p]=255&a,p+=f,a/=256,l-=8);e[r+p-f]|=128*h}},{}],225:[function(e,t,r){var n,i,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var l,c=[],d=!1,_=-1;function p(){d&&l&&(d=!1,l.length?c=l.concat(c):_=-1,c.length&&f())}function f(){if(!d){var e=u(p);d=!0;for(var t=c.length;t;){for(l=c,c=[];++_<t;)l&&l[_].run();_=-1,t=c.length}l=null,d=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function v(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new h(e,t)),1!==c.length||d||u(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=v,o.addListener=v,o.once=v,o.off=v,o.removeListener=v,o.removeAllListeners=v,o.emit=v,o.prependListener=v,o.prependOnceListener=v,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],226:[function(e,t,r){(function(t,n){(function(){var i=e("process/browser.js").nextTick,o=Function.prototype.apply,a=Array.prototype.slice,s={},u=0;function l(e,t){this._id=e,this._clearFn=t}r.setTimeout=function(){return new l(o.call(setTimeout,window,arguments),clearTimeout)},r.setInterval=function(){return new l(o.call(setInterval,window,arguments),clearInterval)},r.clearTimeout=r.clearInterval=function(e){e.close()},l.prototype.unref=l.prototype.ref=function(){},l.prototype.close=function(){this._clearFn.call(window,this._id)},r.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},r.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},r._unrefActive=r.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},r.setImmediate="function"==typeof t?t:function(e){var t=u++,n=!(arguments.length<2)&&a.call(arguments,1);return s[t]=!0,i((function(){s[t]&&(n?e.apply(null,n):e.call(null),r.clearImmediate(t))})),t},r.clearImmediate="function"==typeof n?n:function(e){delete s[e]}}).call(this)}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":225,timers:226}],227:[function(e,t,r){(function(e){(function(){var r,n,i,o,a,s,u,l,c,d,_,p,f,h,v,y,m,E,g,R,T,I,S,P,b,A,L,C,O,N,D;!function(r){var n="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:{};function i(e,t){return e!==n&&("function"==typeof Object.create?Object.defineProperty(e,"__esModule",{value:!0}):e.__esModule=!0),function(r,n){return e[r]=t?t(r,n):n}}"function"==typeof define&&define.amd?define("tslib",["exports"],(function(e){r(i(n,i(e)))})):"object"==typeof t&&"object"==typeof t.exports?r(i(n,i(t.exports))):r(i(n))}((function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])};r=function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},o=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},a=function(e,t){return function(r,n){t(r,n,e)}},s=function(e,t,r,n,i,o){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var s,u=n.kind,l="getter"===u?"get":"setter"===u?"set":"value",c=!t&&e?n.static?e:e.prototype:null,d=t||(c?Object.getOwnPropertyDescriptor(c,n.name):{}),_=!1,p=r.length-1;p>=0;p--){var f={};for(var h in n)f[h]="access"===h?{}:n[h];for(var h in n.access)f.access[h]=n.access[h];f.addInitializer=function(e){if(_)throw new TypeError("Cannot add initializers after decoration has completed");o.push(a(e||null))};var v=(0,r[p])("accessor"===u?{get:d.get,set:d.set}:d[l],f);if("accessor"===u){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw new TypeError("Object expected");(s=a(v.get))&&(d.get=s),(s=a(v.set))&&(d.set=s),(s=a(v.init))&&i.unshift(s)}else(s=a(v))&&("field"===u?i.unshift(s):d[l]=s)}c&&Object.defineProperty(c,n.name,d),_=!0},u=function(e,t,r){for(var n=arguments.length>2,i=0;i<t.length;i++)r=n?t[i].call(e,r):t[i].call(e);return n?r:void 0},l=function(e){return"symbol"==typeof e?e:"".concat(e)},c=function(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})},d=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},p=function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},f=function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||O(t,e,r)},O=Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},h=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},v=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},y=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(v(arguments[t]));return e},m=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n},E=function(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},g=function(e){return this instanceof g?(this.v=e,this):new g(e)},R=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),o=[];return n={},a("next"),a("throw"),a("return",(function(e){return function(t){return Promise.resolve(t).then(e,l)}})),n[Symbol.asyncIterator]=function(){return this},n;function a(e,t){i[e]&&(n[e]=function(t){return new Promise((function(r,n){o.push([e,t,r,n])>1||s(e,t)}))},t&&(n[e]=t(n[e])))}function s(e,t){try{(r=i[e](t)).value instanceof g?Promise.resolve(r.value.v).then(u,l):c(o[0][2],r)}catch(e){c(o[0][3],e)}var r}function u(e){s("next",e)}function l(e){s("throw",e)}function c(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}},T=function(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:g(e[n](t)),done:!1}:i?i(t):t}:i}},I=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=h(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,i,(t=e[r](t)).done,t.value)}))}}},S=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};var M=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};P=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&O(t,e,r);return M(t,e),t},b=function(e){return e&&e.__esModule?e:{default:e}},A=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},L=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},C=function(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)},N=function(e,t,r){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var n,i;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(void 0===n){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],r&&(i=n)}if("function"!=typeof n)throw new TypeError("Object not disposable.");i&&(n=function(){try{i.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:n,async:r})}else r&&e.stack.push({async:!0});return t};var k="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var n=new Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};D=function(e){function t(t){e.error=e.hasError?new k(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}return function r(){for(;e.stack.length;){var n=e.stack.pop();try{var i=n.dispose&&n.dispose.call(n.value);if(n.async)return Promise.resolve(i).then(r,(function(e){return t(e),r()}))}catch(e){t(e)}}if(e.hasError)throw e.error}()},e("__extends",r),e("__assign",n),e("__rest",i),e("__decorate",o),e("__param",a),e("__esDecorate",s),e("__runInitializers",u),e("__propKey",l),e("__setFunctionName",c),e("__metadata",d),e("__awaiter",_),e("__generator",p),e("__exportStar",f),e("__createBinding",O),e("__values",h),e("__read",v),e("__spread",y),e("__spreadArrays",m),e("__spreadArray",E),e("__await",g),e("__asyncGenerator",R),e("__asyncDelegator",T),e("__asyncValues",I),e("__makeTemplateObject",S),e("__importStar",P),e("__importDefault",b),e("__classPrivateFieldGet",A),e("__classPrivateFieldSet",L),e("__classPrivateFieldIn",C),e("__addDisposableResource",N),e("__disposeResources",D)}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],228:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),e("es6-promise").polyfill();var n=e("../enums/errors"),i=e("../error/player_error"),o=e("./player_wrapper");window.addEventListener("load",(function(){if(window.parent===window)throw new i.PlayerError(n.Errors.MISSING_IFRAME,"Embedded player needs to be in an iframe");o.PlayerWrapper.create(window,window.parent).listen()}))},{"../enums/errors":230,"../error/player_error":232,"./player_wrapper":229,"es6-promise":223}],229:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PlayerWrapper=void 0;var n=e("@spotify-internal/harmony/es5/streamer"),i=e("@spotify-internal/harmony"),o=e("@spotify-internal/transport/es5/_internal/connection_observer"),a=e("@spotify-internal/harmony/es5/client"),s=e("@spotify-internal/harmony/es5/next"),u=e("@spotify-internal/transport"),l=e("@spotify-internal/transport/lib/plugins/request_transformer"),c=e("@spotify-internal/harmony/es5/utils/create_transport"),d=e("@js-sdk/common/lib/promise_resolver"),_=e("@js-sdk/common/lib/user_agent/interpolate_ua"),p=e("../enums/messages"),f=e("../shared/messages_factory"),h=e("../shared/message_dispatcher"),v=function(){function e(e,t){var r;this._client=null,this._streamer=null,this._transport=null,this._getTokenRequests={},this._messageHandlers=((r={})[p.Messages.INIT]=this._onInit.bind(this),r[p.Messages.CONNECT]=this._onConnect.bind(this),r[p.Messages.DISCONNECT]=this._onDisconnect.bind(this),r[p.Messages.TOKEN]=this._onToken.bind(this),r[p.Messages.GET_CURRENT_STATE]=this._onGetCurrentState.bind(this),r[p.Messages.GET_VOLUME]=this._onGetVolume.bind(this),r[p.Messages.SET_VOLUME]=this._onSetVolume.bind(this),r[p.Messages.SET_NAME]=this._onSetName.bind(this),r[p.Messages.ACTIVATE_ELEMENT]=this._onActivateElement.bind(this),r[p.Messages.PAUSE]=this._onPause.bind(this),r[p.Messages.RESUME]=this._onResume.bind(this),r[p.Messages.TOGGLE_PLAY]=this._onTogglePlay.bind(this),r[p.Messages.SEEK]=this._onSeek.bind(this),r[p.Messages.PREV_TRACK]=this._onPrevTrack.bind(this),r[p.Messages.NEXT_TRACK]=this._onNextTrack.bind(this),r),this._currentWindow=e,this._loaderWindow=t,this._msgDispatcher=h.MessageDispatcher.create(),this._getToken=this._getToken.bind(this),this._onAuthError=this._onAuthError.bind(this),this._onAutoplayFailed=this._onAutoplayFailed.bind(this),this._onClientError=this._onClientError.bind(this),this._onLocalPlayerEnabled=this._onLocalPlayerEnabled.bind(this),this._onPlayerInitError=this._onPlayerInitError.bind(this),this._onProductStateChanged=this._onProductStateChanged.bind(this),this._onRegistrationError=this._onRegistrationError.bind(this),this._onStateChanged=this._onStateChanged.bind(this),this._onProgress=this._onProgress.bind(this),this._verifyToken=this._verifyToken.bind(this),this._handleMessages=this._handleMessages.bind(this)}return e.create=function(t,r){return new e(t,r)},e.prototype._onConnect=function(e,t){var r=this,n=this._transport;n&&n.connect().then((function(){return n.authenticate()})).then((function(e){r._sendMessage(f.messages.connected(e,t))})).catch((function(){r._sendMessage(f.messages.connected(!1,t))}))},e.prototype._getFlags=function(){var e,t=this,r=function(){var e,r=null===(e=t._transport)||void 0===e?void 0:e.request("@webgate/melody/v1/flags",{authorize:!0,responseType:"json",signal:u.createAbortSignalWithTimeout(5e3)});return null!=r?r:Promise.resolve(void 0)};return((null===(e=this._transport)||void 0===e?void 0:e.isConnected())?r():new Promise((function(e,n){var i;null===(i=t._transport)||void 0===i||i.once(u.TransportEvent.CONNECTED,(function(){r().then(e,n)}))}))).then((function(e){var t;return{useCpWithTp:200===(null==e?void 0:e.status)&&!!(null===(t=e.body)||void 0===t?void 0:t.anthemUseCpWithTp)}})).catch((function(){return{useCpWithTp:!1}}))},e.prototype._onInit=function(e){var t=this;this._transport=c.createTransportForHarmony({getToken:this._getToken,endpoints:{webgate:"https://api.spotify.com/v1"}});var r=d.createPromiseResolver(),p=a.createHarmonyClient({transport:this._transport,descriptor:r.promise});this._client=p,this._getFlags().then((function(a){var c,d,f;null===(f=t._transport)||void 0===f||f.addPlugin(l.requestTransformerCreator,{include:function(e){return-1!==e.indexOf("https://cpapi.spotify.com/v1")},optionsOverrides:{headers:{"use-tp":""+a.useCpWithTp}}}),t._streamer=n.createStreamerForClientWithPlaybackService(p,s.PlaybackServiceCreators["cloud-playback"],{initialVolume:e.volume,endpoint:"https://cpapi.spotify.com/v1",enableMediaSession:e.enableMediaSession,audioProcessorOptions:{disable:!0}}),"volume"in e&&t._streamer.once("registered",(function(){t._streamer&&t._streamer.setVolume(e.volume)})),t._streamer.addListeners(((c={}).registered=t._onLocalPlayerEnabled,c.autoplay_failed=t._onAutoplayFailed,c.state_changed=t._onStateChanged,c.player_initialization_failed=t._onPlayerInitError,c.progress=t._onProgress,c.registration_error=t._onRegistrationError,c)),p.addListeners(((d={})[i.HarmonyEvent.AUTHENTICATION_ERROR]=t._onAuthError,d[i.HarmonyEvent.ERROR]=t._onClientError,d[i.HarmonyEvent.PRODUCT_STATE_CHANGED]=t._onProductStateChanged,d));var h=o.BrowserConnectionObserver.create();h.on(u.TransportEvent.CONNECTION_ONLINE,t._onLocalPlayerEnabled),h.on(u.TransportEvent.CONNECTION_OFFLINE,t._onLocalPlayerDisabled),r.resolve({id:null,name:e.name,brand:"public_js-sdk",randomizeId:!0,platform_identifier:_.interpolateUA("Partner public_js-sdk harmony-{{name}}.{{version}}-{{platform}};cp")})}))},e.prototype._onToken=function(e){var t,r=e.ref,n=e.token;null===(t=this._getTokenRequests[r])||void 0===t||t.resolve(n)},e.prototype._onGetCurrentState=function(e,t){var r=this;this._streamer.getCurrentState().then((function(e){r._sendMessage(f.messages.currentState(e,t))}))},e.prototype._onProductStateChanged=function(){var e=this;this._client.getProductState().then((function(t){"1"===t.ads&&(e._sendMessage(f.messages.accountError("This functionality is restricted to premium users only")),e._transport.disconnect())}))},e.prototype._onGetVolume=function(e,t){var r=this;this._streamer.getVolume().then((function(e){r._sendMessage(f.messages.volume(e,t))}))},e.prototype._onSetName=function(e){this._client.setName(e)},e.prototype._onSetVolume=function(e){this._streamer.setVolume(e)},e.prototype._onDisconnect=function(){this._transport.disconnect()},e.prototype._onLocalPlayerEnabled=function(){var e=this;this._client.getClientDescriptor().then((function(t){var r=t.id;e._sendMessage(f.messages.playerReady({device_id:r}))}))},e.prototype._onLocalPlayerDisabled=function(){var e=this;this._client.getClientDescriptor().then((function(t){var r=t.id;e._sendMessage(f.messages.playerNotReady({device_id:r}))}))},e.prototype._onStateChanged=function(e){this._sendMessage(f.messages.playerStateChanged(e.data.state))},e.prototype._onProgress=function(e){this._sendMessage(f.messages.progress({position:e.data.position}))},e.prototype._getToken=function(e){var t,r=this._sendMessage(f.messages.getToken());this._getTokenRequests[r]=d.createPromiseResolver(),null===(t=this._getTokenRequests[r])||void 0===t||t.promise.then(this._verifyToken).then(e)},e.prototype._verifyToken=function(e){var t=this;return this._client?this._client.request("@webgate/melody/v1/check_scope?scope=web-playback",{authorize:!1,signal:u.createAbortSignalWithTimeout(5e3),headers:{Authorization:"Bearer "+e}}).then((function(r){return 403===r.status&&t._sendMessage(f.messages.authError({message:"Invalid token scopes."})),e})).catch((function(){return e})):Promise.resolve(e)},e.prototype._handleMessages=function(e,t,r){"function"==typeof this._messageHandlers[e]?this._messageHandlers[e](t,r):console.info("No handler for",e)},e.prototype._onAuthError=function(){this._sendMessage(f.messages.authError({message:"Authentication failed"}))},e.prototype._onActivateElement=function(){var e,t=this;null===(e=this._streamer)||void 0===e||e.activateElement().catch((function(e){var r=e.message;t._sendMessage(f.messages.activateElementError({message:r}))}))},e.prototype._onPause=function(){var e,t=this;null===(e=this._streamer)||void 0===e||e.pause().catch((function(e){var r=e.message;t._sendMessage(f.messages.playbackError({message:r}))}))},e.prototype._onResume=function(){var e=this;this._streamer.resume().catch((function(t){var r=t.message;e._sendMessage(f.messages.playbackError({message:r}))}))},e.prototype._onTogglePlay=function(){var e=this;this._streamer.togglePlay().catch((function(t){var r=t.message;e._sendMessage(f.messages.playbackError({message:r}))}))},e.prototype._onSeek=function(e){var t=this;this._streamer.seek(e).catch((function(e){var r=e.message;t._sendMessage(f.messages.playbackError({message:r}))}))},e.prototype._onPrevTrack=function(e){var t=this;this._streamer.previousTrack(e).catch((function(e){var r=e.message;t._sendMessage(f.messages.playbackError({message:r}))}))},e.prototype._onNextTrack=function(e){var t=this;this._streamer.nextTrack(e).catch((function(e){var r=e.message;t._sendMessage(f.messages.playbackError({message:r}))}))},e.prototype._onPlayerInitError=function(){this._sendMessage(f.messages.playerInitError({message:"Failed to initialize player"}))},e.prototype._onAutoplayFailed=function(){this._sendMessage(f.messages.autoplayFailed({message:"Browser prevented autoplay due to lack of interaction"}))},e.prototype._onRegistrationError=function(e){var t=e.data.error.code;t!==i.HarmonyError.TP_REGISTRATION_FAILED_NON_PREMIUM&&t!==i.HarmonyError.CP_REGISTRATION_FAILED_NON_PREMIUM||this._sendMessage(f.messages.accountError("This functionality is restricted to premium users only"))},e.prototype._onClientError=function(e){var t=e.data.source;t!==i.HarmonyErrorSource.HARMONY&&t!==i.HarmonyErrorSource.PLAYBACK||this._sendMessage(f.messages.playbackError({message:"Playback error"}))},e.prototype._sendMessage=function(e){return this._msgDispatcher.send(this._loaderWindow,e)},e.prototype.listen=function(){var e=this;this._msgDispatcher.listen(this._currentWindow,this._handleMessages),this._currentWindow.addEventListener("beforeunload",(function(){e._client&&e._transport.disconnect()})),this._sendMessage(f.messages.embeddedLoaded())},e}();r.PlayerWrapper=v},{"../enums/messages":231,"../shared/message_dispatcher":233,"../shared/messages_factory":234,"@js-sdk/common/lib/promise_resolver":20,"@js-sdk/common/lib/user_agent/interpolate_ua":21,"@spotify-internal/harmony":151,"@spotify-internal/harmony/es5/client":132,"@spotify-internal/harmony/es5/next":152,"@spotify-internal/harmony/es5/streamer":153,"@spotify-internal/harmony/es5/utils/create_transport":157,"@spotify-internal/transport":188,"@spotify-internal/transport/es5/_internal/connection_observer":164,"@spotify-internal/transport/lib/plugins/request_transformer":201}],230:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Errors=void 0,function(e){e.INVALID_LISTENER="INVALID_LISTENER",e.INVALID_WEBPLAYBACK="INVALID_WEBPLAYBACK",e.NO_BODY="NO_BODY",e.NO_EVENT="NO_EVENT",e.INVALID_OAUTH="INVALID_OAUTH",e.MISSING_IFRAME="MISSING_IFRAME",e.AUTOPLAY_FAILED="AUTOPLAY_FAILED"}(r.Errors||(r.Errors={}))},{}],231:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Messages=void 0,function(e){e.SPOTIFY_MESSAGE="SP_MESSAGE",e.ACCOUNT_ERROR="ACCOUNT_ERROR",e.AUTH_ERROR="AUTH_ERROR",e.CONNECT="CONNECT",e.CONNECTED="CONNECTED",e.CURRENT_STATE="CURRENT_STATE",e.DISCONNECT="DISCONNECT",e.EVENT="EVENT",e.GET_CURRENT_STATE="GET_CURRENT_STATE",e.GET_TOKEN="GET_TOKEN",e.GET_VOLUME="GET_VOLUME",e.INIT="INIT",e.LOADED="LOADED",e.NEXT_TRACK="NEXT_TRACK",e.PAUSE="PAUSE",e.PLAYBACK_ERROR="PLAYBACK_ERROR",e.ACTIVATE_ELEMENT="ACTIVATE_ELEMENT",e.ACTIVATE_ELEMENT_ERROR="ACTIVATE_ELEMENT_ERROR",e.PLAYER_INIT_ERROR="PLAYER_INIT_ERROR",e.PLAYER_READY="PLAYER_READY",e.PLAYER_NOT_READY="PLAYER_NOT_READY",e.PLAYER_STATE_CHANGED="PLAYER_STATE_CHANGED",e.PREV_TRACK="PREV_TRACK",e.PROGRESS="PROGRESS",e.RESUME="RESUME",e.SEEK="SEEK",e.SET_NAME="SET_NAME",e.SET_VOLUME="SET_VOLUME",e.TOGGLE_PLAY="TOGGLE_PLAY",e.TOKEN="TOKEN",e.VOLUME="VOLUME",e.AUTOPLAY_FAILED="AUTOPLAY_FAILED"}(r.Messages||(r.Messages={}))},{}],232:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PlayerError=void 0;var n=e("tslib"),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.code=t,n.message=r,n.name="AnthemError",n}return n.__extends(t,e),t}(Error);r.PlayerError=i},{tslib:227}],233:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MessageDispatcher=void 0;var n=e("../enums/messages"),i=function(){function e(){this._seq=0,this._onMessageCallback=function(){},this._receiveMessage=this._receiveMessage.bind(this)}return e.create=function(){return new e},e.prototype._addMessageId=function(e){return e.seq=this._seq++,e},e.prototype._receiveMessage=function(e){if(e.data){var t=e.data,r=t.type,i=t.body,o=t.seq;r===n.Messages.SPOTIFY_MESSAGE&&(null==i?void 0:i.topic)&&this._onMessageCallback(i.topic,i.data,o)}},e.prototype.listen=function(e,t){this._onMessageCallback=t,e.addEventListener("message",this._receiveMessage)},e.prototype.stopListening=function(e){e.removeEventListener("message",this._receiveMessage)},e.prototype.send=function(e,t,r){void 0===r&&(r="*");var n=this._addMessageId(t);return e.postMessage(n,r),n.seq},e}();r.MessageDispatcher=i},{"../enums/messages":231}],234:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.messages=void 0;var n=e("../enums/messages"),i=function(){function e(){}return e.create=function(){return new e},e.prototype._createEventMessage=function(e,t){return this._createMessage(n.Messages.EVENT,{name:e,eventData:t})},e.prototype._createMessage=function(e,t){return{type:n.Messages.SPOTIFY_MESSAGE,body:{topic:e,data:void 0!==t?JSON.parse(JSON.stringify(t)):void 0}}},e.prototype.accountError=function(e){return this._createEventMessage(n.Messages.ACCOUNT_ERROR,{message:e})},e.prototype.authError=function(e){return this._createEventMessage(n.Messages.AUTH_ERROR,e)},e.prototype.autoplayFailed=function(e){return this._createEventMessage(n.Messages.AUTOPLAY_FAILED,e)},e.prototype.playbackError=function(e){return this._createEventMessage(n.Messages.PLAYBACK_ERROR,e)},e.prototype.playerReady=function(e){return this._createEventMessage(n.Messages.PLAYER_READY,e)},e.prototype.playerNotReady=function(e){return this._createEventMessage(n.Messages.PLAYER_NOT_READY,e)},e.prototype.connect=function(){return this._createMessage(n.Messages.CONNECT)},e.prototype.connected=function(e,t){return this._createMessage(n.Messages.CONNECTED,{connected:e,ref:t})},e.prototype.disconnect=function(){return this._createMessage(n.Messages.DISCONNECT)},e.prototype.init=function(e){return this._createMessage(n.Messages.INIT,e)},e.prototype.playerInitError=function(e){return this._createEventMessage(n.Messages.PLAYER_INIT_ERROR,e)},e.prototype.getToken=function(){return this._createMessage(n.Messages.GET_TOKEN)},e.prototype.token=function(e,t){return this._createMessage(n.Messages.TOKEN,{token:e,ref:t})},e.prototype.activateElement=function(){return this._createMessage(n.Messages.ACTIVATE_ELEMENT)},e.prototype.activateElementError=function(e){return this._createEventMessage(n.Messages.ACTIVATE_ELEMENT_ERROR,e)},e.prototype.pause=function(){return this._createMessage(n.Messages.PAUSE)},e.prototype.resume=function(){return this._createMessage(n.Messages.RESUME)},e.prototype.togglePlay=function(){return this._createMessage(n.Messages.TOGGLE_PLAY)},e.prototype.seek=function(e){return this._createMessage(n.Messages.SEEK,e)},e.prototype.nextTrack=function(e){return this._createMessage(n.Messages.NEXT_TRACK,e)},e.prototype.previousTrack=function(e){return this._createMessage(n.Messages.PREV_TRACK,e)},e.prototype.getCurrentState=function(){return this._createMessage(n.Messages.GET_CURRENT_STATE)},e.prototype.currentState=function(e,t){return this._createMessage(n.Messages.CURRENT_STATE,{state:e,ref:t})},e.prototype.playerStateChanged=function(e){return this._createEventMessage(n.Messages.PLAYER_STATE_CHANGED,e)},e.prototype.progress=function(e){return this._createEventMessage(n.Messages.PROGRESS,e)},e.prototype.getVolume=function(){return this._createMessage(n.Messages.GET_VOLUME)},e.prototype.volume=function(e,t){return this._createMessage(n.Messages.VOLUME,{volume:e,ref:t})},e.prototype.setVolume=function(e){return this._createMessage(n.Messages.SET_VOLUME,e)},e.prototype.setName=function(e){return this._createMessage(n.Messages.SET_NAME,e)},e.prototype.embeddedLoaded=function(){return this._createMessage(n.Messages.LOADED)},e}();r.messages=i.create()},{"../enums/messages":231}]},{},[228]);